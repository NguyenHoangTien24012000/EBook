<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
</style>
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><section class="chapter" title="Chapter&nbsp;8.&nbsp;Design Principles: Originality is Overrated" epub:type="chapter" id="design_principles_originality_is_overrat"><div class="titlepage"><div><div><h2 class="title">Chapter&nbsp;8.&nbsp;Design Principles: Originality is Overrated</h2></div></div></div><div class="informalfigure"><a id="med_id00511a"></a><div class="mediaobject"><a id="med_id00511"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069716.png.jpg" alt="image with no caption" width="664" height="521"></div></div><p><span class="strong"><strong>Imitation is the sincerest form of not being stupid.</strong></span></p><p>There’s nothing as satisfying as coming up with a completely new and original solution to a problem that’s been troubling you for days—until you find out someone else <span class="strong"><strong>solved the same problem</strong></span>, long before you did, and did an even better job than you did! In this chapter, we’re going to look at some <span class="strong"><strong>design principles</strong></span> that people have come up with over the years, and how they can make you a better programmer. Lay aside your thoughts of “doing it your way”; this chapter is about <span class="strong"><strong>doing it the smarter, faster way</strong></span>.</p><div class="sect1" title="Design principle roundup"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="design_principle_roundup">Design principle roundup</h2></div></div></div><p><a id="iddle1174" class="indexterm"></a>So far, we’ve really been concentrating on all the things that you do before you start coding your application. Gathering requirements, analysis, writing out feature lists, and drawing use case diagrams. Of course, at some point you actually are going to have to write some code. And that’s where design principles really come into play.</p><div class="note" title="Note"><h3 class="title"><a id="ch08note01"></a>Note</h3><div class="informalfigure"><a id="med_id00512a"></a><div class="mediaobject"><a id="med_id00512"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069718.png.jpg" alt="image with no caption" width="85" height="84"></div></div><p><span class="emphasis"><em>A <span class="strong"><strong>design principle</strong></span> is a basic tool or technique that can be applied to designing or writing code to make that code more maintainable, flexible, or extensible.</em></span></p></div><p>You’ve already seen a few design principles in earlier chapters:</p><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>Using proven OO design principles results in more <span class="underline">maintainable</span>, <span class="underline">flexible</span>, and <span class="underline">extensible</span> software.</strong></span></p></blockquote></div><div class="note" title="OO Principles"><h3 class="title"><a id="ch08note02"></a>OO Principles</h3><p>Encapsulate what varies.</p><p>Code to an interface rather than to an implementation.</p><p>Each class in your application should have only one reason to change.</p><p>Classes are about behavior and functionality.</p></div><p>In this chapter, we’re going to look at several more key design principles, and how each one can improve the design and implementation of your code. We’ll even see that sometimes you’ll have to choose between two design principles... but we’re getting ahead of ourselves. Let’s begin by looking at the first of our design principles.</p></div><div class="sect1" title="Principle #1: The Open-Closed Principle (OCP)"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="principle_hash1_the_open-closed_principl">Principle #1: The Open-Closed Principle (OCP)</h2></div></div></div><p><a id="iddle1104" class="indexterm"></a><a id="iddle1175" class="indexterm"></a><a id="iddle1451" class="indexterm"></a><a id="iddle1484" class="indexterm"></a>Our first design principle is the OCP, or the Open-Closed principle. The OCP is all about <span class="strong"><strong>allowing change</strong></span>, but doing it <span class="strong"><strong>without requiring you to modify existing code</strong></span>. Here’s how we usually define the OCP:</p><div class="informalfigure"><a id="med_id00513a"></a><div class="mediaobject"><a id="med_id00513"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069720.png.jpg" alt="image with no caption" width="161" height="115"></div></div><div class="note" title="Note"><h3 class="title"><a id="ch08note03"></a>Note</h3><div class="informalfigure"><a id="med_id00514a"></a><div class="mediaobject"><a id="med_id00514"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069722.png.jpg" alt="image with no caption" width="129" height="88"></div></div><p><span class="bolditalic">Open-Closed Principle</span></p><p><span class="emphasis"><em>Classes should be open for extension, and closed for modification.</em></span></p></div><div class="sect2" title="Closed for modication..."><div class="titlepage"><div><div><h3 class="title" id="closed_for_modicationhellip">Closed for modication...</h3></div></div></div><p>Suppose you have a class with a particular behavior, and you’ve got that behavior coded up just the way you want it. Make sure that nobody can change your class’s code, and you’ve made that particular piece of behavior <span class="strong"><strong><span class="emphasis"><em>closed for modification</em></span></strong></span>. In other words, nobody can change the behavior, because you’ve locked it up in a class that you’re sure won’t change.</p><div class="informalfigure"><a id="med_id00515a"></a><div class="mediaobject"><a id="med_id00515"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069724.png.jpg" alt="image with no caption" width="317" height="252"></div></div></div><div class="sect2" title="... but open for extension"><div class="titlepage"><div><div><h3 class="title" id="hellip_but_open_for_extension">... but open for extension</h3></div></div></div><p>But then suppose someone else comes along, and they just have to change that behavior. You really don’t want them messing with your perfect code, which works well in almost every situation... but you also want to make it possible for them to use your code, and extend it. So you let them subclass your class, and then they can override your method to work like they want it to. So even though they didn’t mess with your working code, you still left your class <span class="strong"><strong><span class="emphasis"><em>open for extension</em></span></strong></span>.</p><div class="informalfigure"><a id="med_id00516a"></a><div class="mediaobject"><a id="med_id00516"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069726.png.jpg" alt="image with no caption" width="367" height="258"></div></div></div></div><div class="sect1" title="Remember working on Rick’s Stringed Instruments?"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="remember_working_on_rickapostrophes_stri">Remember working on Rick’s Stringed Instruments?</h2></div></div></div><p><a id="iddle1377" class="indexterm"></a><a id="iddle1485" class="indexterm"></a>You probably didn’t realize it, but we were using the Open-Closed Principle when we wrote those <span class="strong"><strong>InstrumentSpec</strong></span> classes for Rick’s Stringed Instruments, back in <a class="xref" href="ch05.html" title="Chapter&nbsp;5.&nbsp;(Part 1) Good Design = Flexible Software: Nothing Ever Stays the Same">Chapter&nbsp;5</a>:</p><div class="informalfigure"><a id="med_id00517a"></a><div class="mediaobject"><a id="med_id00517"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069728.png.jpg" alt="image with no caption" width="825" height="436"></div></div><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>InstrumentSpec is <span class="underline">closed</span> for <span class="underline">modification</span>; the matches() method is defined in the base class and <span class="underline">doesn’t</span> <span class="underline">change</span>.</strong></span></p><p><span class="strong"><strong>But it’s <span class="underline">o</span><span class="underline">pen</span> for <span class="underline">extension</span>, because all of the subclasses can <span class="underline">chan</span>g<span class="underline">e</span> the behavior of matches().</strong></span></p></blockquote></div></div><div class="sect1" title="The OCP, step-by-step"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="ocpcomma_step-by-step">The OCP, step-by-step</h2></div></div></div><p><a id="iddle1455" class="indexterm"></a>Let’s take what we did back in <a class="xref" href="ch05.html" title="Chapter&nbsp;5.&nbsp;(Part 1) Good Design = Flexible Software: Nothing Ever Stays the Same">Chapter&nbsp;5</a>, and look at in terms of the OCP, one step at a time.</p><div class="informalfigure"><a id="med_id00518a"></a><div class="mediaobject"><a id="med_id00518"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069720.png.jpg" alt="image with no caption" width="161" height="115"></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="strong"><strong>We coded matches() in InstrumentSpec.java, and <span class="underline">closed</span> it for modification.</strong></span></p><p>This version of <span class="strong"><strong><code class="literal">matches()</code></strong></span> works just fine, and we don’t want anyone messing with it. In other words, once we’re done coding <span class="strong"><strong><code class="literal">InstrumentSpec</code></strong></span> and this version of <span class="strong"><strong><code class="literal">matches()</code></strong></span>, they shouldn’t change.</p><div class="informalfigure"><a id="med_id00519a"></a><div class="mediaobject"><a id="med_id00519"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069730.png.jpg" alt="image with no caption" width="443" height="194"></div></div></li><li class="listitem"><p><span class="strong"><strong>But we needed to <span class="underline">modify</span> matches() to work with instrument-specific spec classes.</strong></span></p><p>Even though <span class="strong"><strong><code class="literal">matches()</code></strong></span> works great for other <span class="strong"><strong><code class="literal">InstrumentSpec</code></strong></span> objects, it doesn’t quite do what it should for guitars and mandolins. So even though <span class="strong"><strong><code class="literal">matches()</code></strong></span> is closed for modification, we need a way to extend and change it... otherwise, <span class="strong"><strong><code class="literal">InstrumentSpec</code></strong></span> isn’t very flexible, which is a big problem.</p></li><li class="listitem"><p><span class="strong"><strong>So we <span class="underline">extended</span> InstrumentSpec, and <span class="underline">overrode</span> matches() to change its behavior.</strong></span></p><p>We don’t want to change the code in InstrumentSpec, but we can <span class="emphasis"><em>extend</em></span> it, with <span class="strong"><strong><code class="literal">GuitarSpec</code></strong></span> and <span class="strong"><strong><code class="literal">MandolinSpec</code></strong></span>, and then <span class="emphasis"><em>override</em></span> <span class="strong"><strong><code class="literal">matches()</code></strong></span> in each of those classes to add instrument-specific behavior.</p><div class="informalfigure"><a id="med_id00520a"></a><div class="mediaobject"><a id="med_id00520"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069732.png.jpg" alt="image with no caption" width="640" height="213"></div></div></li></ol></div><div class="informalfigure"><a id="med_id00521a"></a><div class="mediaobject"><a id="med_id00521"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069720.png.jpg" alt="image with no caption" width="161" height="115"></div></div><div class="informalfigure"><a id="med_id00522a"></a><div class="mediaobject"><a id="med_id00522"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069734.png.jpg" alt="image with no caption" width="530" height="554"></div></div><p><a id="iddle1176" class="indexterm"></a><a id="iddle1295" class="indexterm"></a><a id="iddle1358" class="indexterm"></a><span class="strong"><strong>The OCP is about <span class="underline">flexibility</span>,
and goes beyond just inheritance.</strong></span></p><p>It’s certainly true that inheritance is a simple example of the open-closed principle, but there’s a lot more to it than just subclassing and overriding a method. Anytime you write working code, you want to do your best to make sure that code <span class="emphasis"><em>stays working</em></span>... and that means not letting other people change that code.</p><p>But there are going to be times when that code still needs to be changed, maybe for just one or two particular situations. Rather than just diving into your code and making a bunch of changes, the OCP lets you <span class="strong"><strong><span class="emphasis"><em>extend</em></span></strong></span> your working code, without <span class="strong"><strong><span class="emphasis"><em>changing</em></span></strong></span> that code.</p><p>There are lots of different ways to accomplish this, and while inheritance is often the easiest to implement, it’s certainly not the only option. In fact, we’ll talk about another great way to achieve this later in the chapter, when we talk about composition.</p><div class="sidebar"><a id="sharpen_your_pencil-id00123"></a><div class="sidebar-title">Sharpen your pencil</div><p><a id="iddle1056" class="indexterm"></a><a id="iddle1249" class="indexterm"></a><a id="iddle1486" class="indexterm"></a><a id="iddle1655" class="indexterm"></a><a id="iddle1790" class="indexterm"></a>Find the OCP in your own project.</p><p>Think about the project you’re currently working on. Can you find any places where you’ve used the OCP already? If so, write how you used the OCP in the blanks below:</p><p>_____________________________________________________________________</p><p>_____________________________________________________________________</p><p>_____________________________________________________________________</p><p>_____________________________________________________________________</p><p>Now think about a place in your project where you should be using the Open-Closed Principle, but you aren’t yet. Write down in the blanks below what you think you need to do to put the OCP into place in your current project:</p><p>_____________________________________________________________________</p><p>_____________________________________________________________________</p><p>_____________________________________________________________________</p><p>_____________________________________________________________________</p></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00124"></a><div class="sidebar-title">There are no Dumb Questions</div><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "><col></colgroup><tbody><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa1qe1"></a><a id="ch08qa1q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: What’s the big deal about modifying code in a base class, or a class that you’ve already written?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa1q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Once you have a class that works, and is being used, you really don’t want to make changes to it unless you have to. But remember, CHANGE is the great constant in software development. With the OCP, we allow for change through extension, rather than having to go back and modify your existing code. Subclasses can add and extend the base class’s behavior, without messing around with code that you already know is working and making the customer happy.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa1qe2"></a><a id="ch08qa1q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Isn’t the OCP just another form of encapsulation?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa1q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> It’s really a combination of <span class="emphasis"><em>encapsulation</em></span> and <span class="emphasis"><em>abstraction</em></span>. You’re finding the behavior that stays the same, and abstracting that behavior away into a base class, and then locking that code up from modification. But then when you need new or different behavior, your subclasses handle the changes by extending the base class. That’s where encapsulation comes in: you’re encapsulating what varies (behavior in the subclasses) away from what stays the same (the common behavior in the base class).</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa1qe3"></a><a id="ch08qa1q3"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: So the only way to use the OCP is by extending another class?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa1q3a3"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> No, anytime your code is closed for modification but open for extension, you’re using the OCP. So for example, if you had several private methods in a class, those are closed for modification—no other code can mess with them. But then you could add several public methods that invoked those private methods in different ways. You’re extending the behavior of the private methods, without changing them. That’s another example of the OCP in action.</p></td></tr></tbody></table></div></blockquote></div></div></div><div class="sect1" title="Principle #2: The Don’t Repeat Yourself Principle (DRY)"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="principle_hash2_the_donapostrophet_repea">Principle #2: The Don’t Repeat Yourself Principle (DRY)</h2></div></div></div><p><a id="iddle1048" class="indexterm"></a><a id="iddle1229" class="indexterm"></a><a id="iddle1231" class="indexterm"></a><a id="iddle1524" class="indexterm"></a>Next up is the Don’t Repeat Yourself principle, or DRY for short. This is another principle that looks pretty simple, but turns out to be critical in writing code that’s easy to maintain and reuse.</p><div class="note" title="Note"><h3 class="title"><a id="ch08note04"></a>Note</h3><div class="informalfigure"><a id="med_id00523a"></a><div class="mediaobject"><a id="med_id00523"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069736.png.jpg" alt="image with no caption" width="122" height="103"></div></div><p><span class="bolditalic">Don’t Repeat Yourself</span></p><p><span class="emphasis"><em>Avoid duplicate code by abstracting out things that are common and placing those things in a single location.</em></span></p></div><div class="sect2" title="A prime place to apply DRY..."><div class="titlepage"><div><div><h3 class="title" id="prime_place_to_apply_dryhellip">A prime place to apply DRY...</h3></div></div></div><p>You’ve seen the DRY principle in action, even if you didn’t realize it. We used DRY back in <a class="xref" href="ch02.html" title="Chapter&nbsp;2.&nbsp;Gathering Requirements: Give Them What They Want">Chapter&nbsp;2</a>, when Todd and Gina wanted us to close the dog door automatically after it had been opened.</p><div class="informalfigure"><a id="med_id00524a"></a><div class="mediaobject"><a id="med_id00524"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069738.png.jpg" alt="image with no caption" width="769" height="542"></div></div></div><div class="sect2" title="1. Let’s abstract out the common code"><div class="titlepage"><div><div><h3 class="title" id="onedot_letapostrophes_abstract_out_the_c">1. Let’s abstract out the common code</h3></div></div></div><p><a id="iddle1200" class="indexterm"></a>Using DRY, we first need to take the code that’s common between <span class="strong"><strong><code class="literal">Remote</code></strong></span> and <span class="strong"><strong><code class="literal">BarkRecognizer</code></strong></span>, and put it in a single place. We figured out back in <a class="xref" href="ch02.html" title="Chapter&nbsp;2.&nbsp;Gathering Requirements: Give Them What They Want">Chapter&nbsp;2</a> the best place for it was in the <span class="strong"><strong><code class="literal">DogDoor</code></strong></span> class:</p><div class="informalfigure"><a id="med_id00525a"></a><div class="mediaobject"><a id="med_id00525"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069740.png.jpg" alt="image with no caption" width="664" height="292"></div></div></div><div class="sect2" title="2. Now remove the code from other locations..."><div class="titlepage"><div><div><h3 class="title" id="twodot_now_remove_the_code_from_other_lo">2. Now remove the code from other locations...</h3></div></div></div><p></p></div><div class="sect2" title="3. ...and reference the code from Step #1"><div class="titlepage"><div><div><h3 class="title" id="threedot_hellipand_reference_the_code_fr">3. ...and reference the code from Step #1</h3></div></div></div><p>The next two steps happen at the same time. Remove all the code that you put in a single place in Step #1, and then reference the code you abstracted out explicitly if you need to:</p><div class="informalfigure"><a id="med_id00526a"></a><div class="mediaobject"><a id="med_id00526"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069742.png.jpg" alt="image with no caption" width="779" height="315"></div></div></div></div><div class="sect1" title="DRY is really about ONE requirement in ONE place"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="dry_is_really_about_one_requirement_in_o">DRY is really about ONE requirement in ONE place</h2></div></div></div><p><a id="iddle1232" class="indexterm"></a>Abstracting out duplicate code is a good start to using DRY, but there’s more to it than just that. When you’re trying to avoid duplicate code, you’re really trying to make sure that you only implement each feature and requirement in your application one single time.</p><p>In the dog door we just looked at, the feature we were trying to implement was automatically closing the door.</p><div class="informalfigure"><a id="med_id00527a"></a><div class="mediaobject"><a id="med_id00527"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069744.png.jpg" alt="image with no caption" width="526" height="220"></div></div><p>Originally, though, we implemented that single feature in <span class="emphasis"><em>two</em></span> places: <span class="strong"><strong><code class="literal">Remote.java</code></strong></span> and <span class="strong"><strong><code class="literal">BarkRecognizer.java</code></strong></span>.</p><div class="informalfigure"><a id="med_id00528a"></a><div class="mediaobject"><a id="med_id00528"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069746.png.jpg" alt="image with no caption" width="412" height="197"></div></div><p>By using DRY, we removed the duplicate code. But more importantly, we moved the implementation of this requirement, automatically closing the door, into <span class="emphasis"><em>one</em></span> place, instead of <span class="emphasis"><em>two</em></span> places:</p><div class="informalfigure"><a id="med_id00529a"></a><div class="mediaobject"><a id="med_id00529"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069748.png.jpg" alt="image with no caption" width="377" height="116"></div></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00125"></a><div class="sidebar-title">There are no Dumb Questions</div><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "><col></colgroup><tbody><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa2qe1"></a><a id="ch08qa2q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><a id="iddle1771" class="indexterm"></a><span class="strong"><strong>Q: So DRY <span class="emphasis"><em>isn’t</em></span> about duplicate code, and avoiding copy-and-paste?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa2q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> DRY is about avoiding duplicate code, but it’s also about doing it in a way that won’t create more problems down the line. Rather than just tossing code that appears more than once into a single class, you need to make sure each piece of information and behavior in your system has a single, clear place where it exists. That way, your system always knows exactly where to go when it needs that information or behavior.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa2qe2"></a><a id="ch08qa2q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: If DRY is related to our features and requirements, then shouldn’t we apply it to <span class="emphasis"><em>gathering</em></span> those features and requirements as well as writing our code?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa2q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Absolutely, and that’s a great idea! Whether you’re writing requirements, developing use cases, or coding, you want to be sure that you don’t duplicate things in your system. A requirement should be implemented one time, use cases shouldn’t have overlap, and your code shouldn’t repeat itself. DRY is about a lot more than just code.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa2qe3"></a><a id="ch08qa2q3"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: And this is all to avoid maintenance problems later, right?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa2q3a3"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Right. But it’s more than just avoiding a need to update code in more than one place. Remember, DRY is about having a <span class="emphasis"><em>single source</em></span> for a particular piece of information or behavior. But that single source has to make sense! You wouldn’t want the bark recognizer to be the single source for closing the dog door, would you? Do you think the dog door should be asking the recognizer to close itself?</p><p>So DRY is not just removing duplication, it’s also about making good decisions about how to break up your system’s functionality.</p></td></tr></tbody></table></div></blockquote></div><div class="informalfigure"><a id="med_id00530a"></a><div class="mediaobject"><a id="med_id00530"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069750.png.jpg" alt="image with no caption" width="100" height="84"></div></div><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>DRY is about having each piece of information and behavior in your system in a <span class="underline">single</span>, <span class="underline">sensible place</span>.</strong></span></p></blockquote></div></div><div class="sidebar"><a id="design_puzzle-id00126"></a><div class="sidebar-title">Design Puzzle</div><p>DRY is about a lot more than just finding duplicate code in your system. It also applies to your features and requirements. It’s time to put DRY into action on your own now, and to do it in more than just code.</p><p><span class="strong"><strong>The problem:</strong></span></p><p>Todd and Gina have come up with yet more features for their dog door. It’s your job to make sure the feature list we’ve assembled doesn’t have any duplication issues, and that each feature is handled once and only once in the system you’re designing for them.</p><p><span class="strong"><strong>Your task:</strong></span></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Read through the requirements and features list on the right. We’ve bolded the requirements and features that have been added since you last worked on the dog door.</p></li><li class="listitem"><p>Look through the new features and requirements, and see if you see any possible duplication in the new things you’d need to build.</p></li><li class="listitem"><p>Annotate the requirements and features list indicating what you think has been duplicated.</p></li><li class="listitem"><p>Rewrite the duplicate requirements at the bottom of the list so that there is no more duplication.</p></li><li class="listitem"><p>Write a new definition for the DRY principle in the space below, and make sure you talk about more than just duplicate code.</p></li></ol></div><div class="note" title="Note"><h3 class="title"><a id="ch08note05"></a>Note</h3><div class="informalfigure"><a id="med_id00531a"></a><div class="mediaobject"><a id="med_id00531"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069752.png.jpg" alt="image with no caption" width="122" height="103"></div></div><p><span class="bolditalic">Don’t Repeat Yourself</span></p><p>_____________________________________________________________________</p><p>_____________________________________________________________________</p><p>_____________________________________________________________________</p><p>_____________________________________________________________________</p></div><div class="blockquote"><blockquote class="blockquote"><p>Write your own definition for DRY that includes what you’ve learned over the last few pages.</p></blockquote></div><div class="informalfigure"><a id="med_id00532a"></a><div class="mediaobject"><a id="med_id00532"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069754.png.jpg" alt="image with no caption" width="772" height="888"></div></div><p><a id="iddle1190" class="indexterm"></a><span class="inlinemediaobject"><a id="inline_id00039"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2068819.png.jpg" alt="" width="99" height="9"></span> <span class="strong"><strong>Solutions on the next page.</strong></span></p></div><div class="sidebar"><a id="design_puzzle_solutions"></a><div class="sidebar-title">Design Puzzle Solutions</div><p>DRY is about a lot more than just finding duplicate code in your system. It also applies to your features and requirements. Your job was to put DRY into action on your own, in the context of requirements rather than just code.</p><p><span class="strong"><strong>The problem:</strong></span></p><p>Todd and Gina have come up with yet more features for their dog door. It’s your job to make sure the feature list we’ve assembled doesn’t have any duplication issues, and that each feature is handled once and only once in the system you’re designing for them.</p><p><span class="strong"><strong>Your task:</strong></span></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Read through the requirements and features list on the right. We’ve bolded the requirements and features that have been added since you last worked on the dog door.</p></li><li class="listitem"><p>Look through the new features and requirements, and see if you see any possible duplication in the new things you’d need to build.</p></li><li class="listitem"><p>Annotate the requirements and features list indicating what you think has been duplicated.</p></li><li class="listitem"><p>Rewrite the duplicate requirements at the bottom of the list so that there is no more duplication.</p></li><li class="listitem"><p>Write a new definition for the DRY principle in the space below, and make sure you talk about more than just duplicate code.</p></li></ol></div><div class="informalfigure"><a id="med_id00533a"></a><div class="mediaobject"><a id="med_id00533"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069756.png.jpg" alt="image with no caption" width="562" height="211"></div></div><div class="informalfigure"><a id="med_id00534a"></a><div class="mediaobject"><a id="med_id00534"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069758.png.jpg" alt="image with no caption" width="744" height="887"></div></div></div></div><div class="sect1" title="Principle #3: The Single Responsibility Principle (SRP)"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="principle_hash3_the_single_responsibilit">Principle #3: The Single Responsibility Principle (SRP)</h2></div></div></div><p><a id="iddle1191" class="indexterm"></a><a id="iddle1704" class="indexterm"></a>The SRP is all about responsibility, and which objects in your system do what. You want each object that you design to have just one responsibility to focus on—and when something about that responsibility changes, you’ll know exactly where to look to make those changes in your code.</p><div class="note" title="Note"><h3 class="title"><a id="ch08note07"></a>Note</h3><div class="informalfigure"><a id="med_id00535a"></a><div class="mediaobject"><a id="med_id00535"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069760.png.jpg" alt="image with no caption" width="66" height="107"></div></div><p><span class="bolditalic">Single Responsibility Principle</span></p><p><span class="emphasis"><em>Every object in your system should have a single responsibility, and all the object’s services should be focused on carrying out that single responsibility.</em></span></p></div><div class="informalfigure"><a id="med_id00536a"></a><div class="mediaobject"><a id="med_id00536"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069762.png.jpg" alt="image with no caption" width="394" height="409"></div></div><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>You’ve implemented the Single Responsibility Principle correctly when each of your objects has <span class="underline">only one reason to change</span>.</strong></span></p></blockquote></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00127"></a><div class="sidebar-title">There are no Dumb Questions</div><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "><col></colgroup><tbody><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa3qe1"></a><a id="ch08qa3q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><a id="iddle1799" class="indexterm"></a><span class="strong"><strong>Q: SRP sounded a lot like DRY to me. Aren’t both about a class doing the one thing it’s supposed to do?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa3q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> They are related, and often appear together. DRY is about putting a piece of functionality in a single place, such as a class; SRP is about making sure that a class does only one thing, and that it does it well.</p><p>In good applications, one class does one thing, and does it well, <span class="emphasis"><em>and</em></span> no other classes share that behavior.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa3qe2"></a><a id="ch08qa3q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Isn’t having each class do only one thing kind of limiting?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa3q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> It’s not, when you realize that the one thing a class does can be a pretty <span class="emphasis"><em>big</em></span> thing. For example, the <span class="strong"><strong><code class="literal">Board</code></strong></span> class in Gary’s Games does a lot of different small tasks, but they’re all related to a single big thing: handling the board in a game. It does that one thing, and that’s all the Board class does, so it’s a great example of using the SRP.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa3qe3"></a><a id="ch08qa3q3"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: And using SRP will help my classes stay smaller, since they’re only doing one thing, right?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa3q3a3"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Actually, the SRP will often make your classes <span class="emphasis"><em>bigger</em></span>. Since you’re not spreading out functionality over a lot of classes—which is what many programmers not familiar with the SRP will do—you’re often putting more things into a class.</p><p>But using the SRP will usually result in less classes, and that generally makes your overall application a lot simpler to manage and maintain.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa3qe4"></a><a id="ch08qa3q4"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: This sounds a lot like cohesion, are they the same thing?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa3q4a4"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Cohesion is actually just another name for the SRP. If you’re writing highly cohesive software, then that means that you’re correctly applying the SRP.</p><div class="informalfigure"><a id="med_id00537a"></a><div class="mediaobject"><a id="med_id00537"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069764.png.jpg" alt="image with no caption" width="68" height="110"></div></div></td></tr></tbody></table></div></blockquote></div></div></div><div class="sect1" title="Spotting multiple responsibilities"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="spotting_multiple_responsibilities">Spotting multiple responsibilities</h2></div></div></div><p><a id="iddle1706" class="indexterm"></a>Most of the time, you can spot classes that aren’t using the SRP with a simple test:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>On a sheet of paper, write down a bunch of lines like this: The [blank] [blanks] itself. You should have a line like this for every method in the class you’re testing for the SRP.</p></li><li class="listitem"><p>In the first blank of each line, write down the class name; in the second blank, write down one of the methods in the class. Do this for each method in the class.</p></li><li class="listitem"><p>Read each line out loud (you may have to add a letter or word to get it to read normally). Does what you just said make any sense? Does your class really have the responsibility that the method indicates it does?</p></li></ol></div><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>If what you’ve just said <span class="underline">doesn’t make sense</span>, then you’re probably violating the SRP with that method. The method might belong on a <span class="underline">different</span> class... think about moving it.</strong></span></p></blockquote></div><div class="informalfigure"><a id="med_id00538a"></a><div class="mediaobject"><a id="med_id00538"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069766.png.jpg" alt="image with no caption" width="679" height="495"></div></div><div class="sidebar"><a id="sharpen_your_pencil-id00128"></a><div class="sidebar-title">Sharpen your pencil</div><div class="informalfigure"><a id="med_id00539a"></a><div class="mediaobject"><a id="med_id00539"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069760.png.jpg" alt="image with no caption" width="66" height="107"></div></div><p><a id="iddle1674" class="indexterm"></a>Apply the SRP to the Automobile class.</p><p>Do an SRP analysis on the Automobile class shown below. Fill out the sheet with the class name methods in Automobile, like we’ve described on the last page. Then, decide if you think it makes sense for the Automobile class to have each method, and check the right box.</p><div class="informalfigure"><a id="med_id00540a"></a><div class="mediaobject"><a id="med_id00540"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069768.png.jpg" alt="image with no caption" width="716" height="213"></div></div><div class="informalfigure"><a id="med_id00541a"></a><div class="mediaobject"><a id="med_id00541"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069770.png.jpg" alt="image with no caption" width="700" height="429"></div></div></div><div class="sidebar"><a id="sharpen_your_pencil_answers-id00129"></a><div class="sidebar-title">Sharpen your pencil answers</div><p><a id="iddle1675" class="indexterm"></a>Apply the SRP to the Automobile class.</p><p>Your job was to do an SRP analysis on the Automobile class shown below. You should have filled out the sheet with the class name methods in Automobile, and decided if you think it makes sense for the Automobile class to have each method.</p><div class="informalfigure"><a id="med_id00542a"></a><div class="mediaobject"><a id="med_id00542"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069772.png.jpg" alt="image with no caption" width="768" height="604"></div></div></div></div><div class="sect1" title="Going from multiple responsibilities to a single responsibility"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="going_from_multiple_responsibilities_to">Going from multiple responsibilities to a single responsibility</h2></div></div></div><p><a id="iddle1707" class="indexterm"></a><a id="iddle1800" class="indexterm"></a>Once you’ve done an analysis, you can take all the methods that don’t make sense on a class, and move those methods to classes that do make sense for that particular responsibility.</p><div class="informalfigure"><a id="med_id00543a"></a><div class="mediaobject"><a id="med_id00543"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069774.png.jpg" alt="image with no caption" width="729" height="495"></div></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00130"></a><div class="sidebar-title">There are no Dumb Questions</div><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "><col></colgroup><tbody><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa4qe1"></a><a id="ch08qa4q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: How does SRP analysis work when a method takes parameters, like wash(Automobile) on the CarWash class?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa4q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Good question! For your SRP analysis to make any sense, you need to include the parameter of the method in the method blank. So you would write “The <span class="underline">CarWash washes [an] automobile itself</span>.” That method makes sense (with the <span class="strong"><strong><code class="literal">Automobile</code></strong></span> parameter), so it would stay on the <span class="strong"><strong><code class="literal">CarWash</code></strong></span> class.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa4qe2"></a><a id="ch08qa4q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: But what if CarWash took in an Automobile parameter as part of its constructor, and the method was just wash()? Wouldn’t SRP analysis give you a wrong result?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa4q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> It would. If a parameter that might cause a method to make sense, like an <span class="strong"><strong><code class="literal">Automobile</code></strong></span> for the <span class="strong"><strong><code class="literal">wash()</code></strong></span> method on <span class="strong"><strong><code class="literal">CarWash</code></strong></span>, is passed into a class’s constructor, your SRP analysis might be misleading. But that’s why you always need to apply a good amount of your own common sense and knowledge of the system in addition to what you learn from the SRP analysis.</p></td></tr></tbody></table></div></blockquote></div></div><div class="sidebar"><a id="srp_sightings"></a><div class="sidebar-title">SRP Sightings</div><p><a id="iddle1709" class="indexterm"></a>The SRP has already made a few appearances in our work so far; now that you’re getting familiar with the SRP, it’s time for you to figure out where and how it’s been used. Your task is to look at the page below and figure out how SRP was used, and why.</p><div class="informalfigure"><a id="med_id00544a"></a><div class="mediaobject"><a id="med_id00544"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069776.png.jpg" alt="image with no caption" width="734" height="722"></div></div><div class="informalfigure"><a id="med_id00545a"></a><div class="mediaobject"><a id="med_id00545"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069760.png.jpg" alt="image with no caption" width="66" height="107"></div></div><p>How do you think the Single Responsibility Principle was used in Todd and Gina’s dog door? Write your answer in the blanks below:</p><p>_____________________________________________________________________</p><p>_____________________________________________________________________</p><p>_____________________________________________________________________</p><p>_____________________________________________________________________</p><p>Now see if you can find two more instances in the book’s examples so far where we’ve used the SRP to make our design better and more flexible. You can find the SRP in the dog door, Rick’s instrument inventory searcher, or Gary’s game framework. Write down each instance you found, and how you think the SRP is being used.</p><div class="informalfigure"><a id="med_id00546a"></a><div class="mediaobject"><a id="med_id00546"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069778.png.jpg" alt="image with no caption" width="801" height="516"></div></div></div><div class="sidebar"><a id="srp_sightings_revealedexclamation_mark"></a><div class="sidebar-title">SRP Sightings Revealed!</div><p><a id="iddle1710" class="indexterm"></a>Let’s look back on the times that SRP has already shown up in our software. Here are the SRP sightings we came up with; see if your answers are similar.</p><div class="informalfigure"><a id="med_id00547a"></a><div class="mediaobject"><a id="med_id00547"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069780.png.jpg" alt="image with no caption" width="704" height="693"></div></div><div class="informalfigure"><a id="med_id00548a"></a><div class="mediaobject"><a id="med_id00548"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069760.png.jpg" alt="image with no caption" width="66" height="107"></div></div><p>How do you think the Single Responsibility Principle was used in Todd and Gina’s dog door? Write your answer in the blanks below:</p><div class="informalfigure"><a id="med_id00549a"></a><div class="mediaobject"><a id="med_id00549"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069782.png.jpg" alt="image with no caption" width="705" height="125"></div></div><p>Now see if you can find two more instances in the book’s examples so far where we’ve used the SRP to make our design better and more flexible. You can find the SRP in the dog door, Rick’s instrument inventory searcher, or Gary’s game framework. Write down each instance you found, and how you think the SRP is being used.</p><p><span class="strong"><strong><span class="underline">First Instance</span></strong></span></p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"><col class="c2"><col class="c3"><col class="c4"></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>Example application:</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="inlinemediaobject"><a id="inline_id00040"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069784.png.jpg" alt="" width="21" height="16"></span> Rick’s Instruments</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>___ Doug’s Dog Doors</p></td><td style="vertical-align: top; "><p>_____ Gary’s Games</p></td></tr></tbody></table></div><p>How SRP is being used:</p><div class="informalfigure"><a id="med_id00550a"></a><div class="mediaobject"><a id="med_id00550"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069786.png.jpg" alt="image with no caption" width="706" height="172"></div></div><p><span class="strong"><strong><span class="underline">Second Instance</span></strong></span></p><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"><col class="c2"><col class="c3"><col class="c4"></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>Example application:</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>___Rick’s Instruments</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>___Doug’s Dog Doors</p></td><td style="vertical-align: top; "><p><span class="inlinemediaobject"><a id="inline_id00041"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069784.png.jpg" alt="" width="21" height="16"></span> Gary’s Games</p></td></tr></tbody></table></div><p>How SRP is being used:</p><p><span class="underline"><span class="strong"><strong>When we used a Map to store properties for all types of units in the Unit class, we were using the SRP. So instead of having game-specific Units have to deal with their properties, and still have the base Unit class dealing with a different set of properties, we moved all property-related functionality into the nit class. So handling the properties feature is taken care of in ONE single place—the Unit class.</strong></span></span></p><div class="informalfigure"><a id="med_id00551a"></a><div class="mediaobject"><a id="med_id00551"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069788.png.jpg" alt="image with no caption" width="98" height="272"></div></div></div></div><div class="sect1" title="Contestant #4: The Liskov Substitution Principle (LSP)"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="contestant_hash4_the_liskov_substitution">Contestant #4: The Liskov Substitution Principle (LSP)</h2></div></div></div><p><a id="iddle1177" class="indexterm"></a><a id="iddle1409" class="indexterm"></a><a id="iddle1412" class="indexterm"></a><a id="iddle1452" class="indexterm"></a>Next up in our design principle parade is the Liskov Substitution Principle, or the LSP. It’s definition is as simple as it gets:</p><div class="informalfigure"><a id="med_id00552a"></a><div class="mediaobject"><a id="med_id00552"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069790.png.jpg" alt="image with no caption" width="378" height="118"></div></div><div class="informalfigure"><a id="med_id00553a"></a><div class="mediaobject"><a id="med_id00553"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069792.png.jpg" alt="image with no caption" width="518" height="598"></div></div><p><span class="strong"><strong>The LSP is all about <span class="underline">well</span>-<span class="underline">desi</span>g<span class="underline">ned</span> inheritance. When you inherit from a base class, you must be able to <span class="underline">substitute</span> y<span class="underline">our</span> <span class="underline">subclass</span> for that base class without things going terribly <span class="underline">wrong</span>. Otherwise, you’ve used inheritance incorrectly!</strong></span></p></div><div class="sect1" title="Misusing subclassing: a case study in misusing inheritance"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="misusing_subclassing_a_case_study_in_mis">Misusing subclassing: a case study in misusing inheritance</h2></div></div></div><p><a id="iddle1364" class="indexterm"></a><a id="iddle1723" class="indexterm"></a>Suppose that Gary’s Games has a new client who wants to use their game system framework to create World War II air battles. They need to take the basic <span class="strong"><strong><code class="literal">Board</code></strong></span> base type, and extend it to support a 3-dimensional board to represent the sky. Here’s what they’ve done:</p><div class="informalfigure"><a id="med_id00554a"></a><div class="mediaobject"><a id="med_id00554"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069794.png.jpg" alt="image with no caption" width="567" height="502"></div></div><div class="note" title="Make it Stick"><h3 class="title"><a id="ch08note11"></a>Make it Stick</h3><p><span class="strong"><strong>One of these things is just like another, Use the base or its subclass, it’s not a bother, Substitute, exchange, it doesn’t rattle me, They all work the same, they use the LSP!</strong></span></p></div></div><div class="sect1" title="LSP reveals hidden problems with your inheritance structure"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="lsp_reveals_hidden_problems_with_your_in">LSP reveals hidden problems with your inheritance structure</h2></div></div></div><p><a id="iddle1363" class="indexterm"></a><a id="iddle1414" class="indexterm"></a>At first glance, it may seem like subclassing <span class="strong"><strong><code class="literal">Board</code></strong></span> and using inheritance is a great idea. But look closer, there are lots of problems that this approach creates:</p><div class="informalfigure"><a id="med_id00555a"></a><div class="mediaobject"><a id="med_id00555"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069796.png.jpg" alt="image with no caption" width="683" height="556"></div></div><p><span class="strong"><strong>The 3DBoard class is <span class="underline">not</span> substitutable for Board, because none of the methods on Board work correctly in a 3D environment. Calling a method like getUnits(2, 5) <span class="underline">doesn’t</span> <span class="underline">make</span> <span class="underline">sense</span> for 3DBoard. So this design violates the LSP.</strong></span></p><div class="note" title="Note"><h3 class="title"><a id="ch08note12"></a>Note</h3><p>Even worse, we don’t know what passing a coordinate like (2,5) even <span class="underline">means</span> to 3DBoard. This is <span class="underline">not</span> a good use of inheritance.</p></div></div><div class="sect1" title="“Subtypes must be substitutable for their base types”"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="quotation_marksubtypes_must_be_substitut">“Subtypes must be substitutable for their base types”</h2></div></div></div><div class="informalfigure"><a id="med_id00556a"></a><div class="mediaobject"><a id="med_id00556"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069798.png.jpg" alt="image with no caption" width="130" height="120"></div></div><p><a id="iddle1726" class="indexterm"></a>We already said that LSP states that a subtype must be substitutable for its base type. But what does that really mean? Technically, it doesn’t seem to be a problem:</p><div class="informalfigure"><a id="med_id00557a"></a><div class="mediaobject"><a id="med_id00557"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069800.png.jpg" alt="image with no caption" width="297" height="107"></div></div><p>But when you start to actually <span class="emphasis"><em>use</em></span> that instance of <span class="strong"><strong><code class="literal">3DBoard</code></strong></span> like a <span class="strong"><strong><code class="literal">Board</code></strong></span>, things can get confusing very fast:</p><div class="informalfigure"><a id="med_id00558a"></a><div class="mediaobject"><a id="med_id00558"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069802.png.jpg" alt="image with no caption" width="400" height="115"></div></div><p>So even though <span class="strong"><strong><code class="literal">3DBoard</code></strong></span> is a subclass of <span class="strong"><strong><code class="literal">Board</code></strong></span>, it’s not substitutable for <span class="strong"><strong><code class="literal">Board</code></strong></span>... the methods that <span class="strong"><strong><code class="literal">3DBoard</code></strong></span> inherited don’t have the same meaning as they do on the superclass. Even worse, it’s not clear what meaning those methods <span class="emphasis"><em>do</em></span> have!</p><div class="informalfigure"><a id="med_id00559a"></a><div class="mediaobject"><a id="med_id00559"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069804.png.jpg" alt="image with no caption" width="822" height="464"></div></div></div><div class="sect1" title="Violating the LSP makes for confusing code"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="violating_the_lsp_makes_for_confusing_co">Violating the LSP makes for confusing code</h2></div></div></div><p><a id="iddle1415" class="indexterm"></a>It might seem like this isn’t such a big deal, but code that violates LSP can be confusing, and a real nightmare to debug. Let’s think a bit about someone who comes to use the badly designed <span class="strong"><strong><code class="literal">3DBoard</code></strong></span> for the first time.</p><p>They probably start out by checking out the class’s methods:</p><div class="informalfigure"><a id="med_id00560a"></a><div class="mediaobject"><a id="med_id00560"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069806.png.jpg" alt="image with no caption" width="400" height="356"></div></div><p><span class="strong"><strong>It’s <span class="underline">hard</span> <span class="underline">to</span> <span class="underline">understand</span> code that misuses inheritance.</strong></span></p><p>When you use inheritance, your subclass gets all the methods from its superclass, even if you don’t want those methods. And if you’ve used inheritance badly, then you’re going to end up with a lot of methods that you don’t want, because they probably don’t make sense on your subclass.</p><p>So what can you do to avoid this? First, be sure your subclasses can substitute for their base types, which is just following the LSP. Second, learn about some <span class="strong"><strong><span class="emphasis"><em>alternatives</em></span></strong></span> to using inheritance in your code...</p><div class="informalfigure"><a id="med_id00561a"></a><div class="mediaobject"><a id="med_id00561"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069808.png.jpg" alt="image with no caption" width="529" height="471"></div></div></div><div class="sect1" title="Solving the 3DBoard problem without using inheritance"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="solving_the_3dboard_problem_without_usin">Solving the 3DBoard problem <span class="underline">without</span> using inheritance</h2></div></div></div><div class="informalfigure"><a id="med_id00562a"></a><div class="mediaobject"><a id="med_id00562"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069810.png.jpg" alt="image with no caption" width="117" height="108"></div></div><p><a id="iddle1001" class="indexterm"></a><a id="iddle1361" class="indexterm"></a>It’s not enough to just know that inheritance isn’t the answer... now we’ve got to figure out what we <span class="emphasis"><em>should</em></span> have done. Let’s look at the <span class="strong"><strong><code class="literal">Board</code></strong></span> and <span class="strong"><strong><code class="literal">3DBoard</code></strong></span> classes again, and see how we can create a 3-dimensional board without using inheritance.</p><div class="informalfigure"><a id="med_id00563a"></a><div class="mediaobject"><a id="med_id00563"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069812.png.jpg" alt="image with no caption" width="653" height="713"></div></div><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>So what options are there besides inheritance?</strong></span></p></blockquote></div></div><div class="sect1" title="Delegate functionality to another class"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="delegate_functionality_to_another_class"><span class="underline">Dele</span>g<span class="underline">ate</span> functionality to another class</h2></div></div></div><p><a id="iddle1155" class="indexterm"></a>You’ve already seen that delegation is when one class hands off the task of doing something to another class. It’s also just one of several alternatives to inheritance.</p><div class="note" title="Note"><h3 class="title"><a id="ch08note13"></a>Note</h3><div class="informalfigure"><a id="med_id00564a"></a><div class="mediaobject"><a id="med_id00564"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069814.png.jpg" alt="image with no caption" width="84" height="120"></div></div><p><span class="bolditalic">Delegation</span> <span class="emphasis"><em>is when you hand over the responsibility for a particular task to another class or method.</em></span></p></div><p>Delegation was what we used to solve the <span class="strong"><strong><code class="literal">3DBoard</code></strong></span> problem we’ve been looking at, without resorting to inheritance:</p><div class="informalfigure"><a id="med_id00565a"></a><div class="mediaobject"><a id="med_id00565"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069816.png.jpg" alt="image with no caption" width="480" height="541"></div></div></div><div class="sect1" title="When to use delegation"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="when_to_use_delegation">When to use delegation</h2></div></div></div><p><a id="iddle1158" class="indexterm"></a><a id="iddle1159" class="indexterm"></a><a id="iddle1365" class="indexterm"></a>Delegation is best used when you want to use another class’s functionality, as is, without changing that behavior at all. In the case of <span class="strong"><strong><code class="literal">3DBoard</code></strong></span>, we wanted to use the various methods in the <span class="strong"><strong><code class="literal">Board</code></strong></span> class:</p><div class="informalfigure"><a id="med_id00566a"></a><div class="mediaobject"><a id="med_id00566"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069818.png.jpg" alt="image with no caption" width="448" height="224"></div></div><p>Since we don’t want to change the existing behavior, but we do want to use it, we can simply create a delegation relationship between <span class="strong"><strong><code class="literal">3DBoard</code></strong></span> and <span class="strong"><strong><code class="literal">Board</code></strong></span>. <span class="strong"><strong><code class="literal">3DBoard</code></strong></span> stores multiple instances of <span class="strong"><strong><code class="literal">Board</code></strong></span> objects, and delegates handling each individual board-related task.</p><div class="informalfigure"><a id="med_id00567a"></a><div class="mediaobject"><a id="med_id00567"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069820.png.jpg" alt="image with no caption" width="622" height="284"></div></div><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>If you need to use functionality in another class, but you <span class="underline">don’t</span> <span class="underline">want</span> <span class="underline">to</span> <span class="underline">change</span> that functionality, consider using delegation instead of inheritance.</strong></span></p></blockquote></div></div><div class="sect1" title="Use composition to assemble behaviors from other classes"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="use_composition_to_assemble_behaviors_fr">Use <span class="underline">composition</span> to assemble behaviors from other classes</h2></div></div></div><p><a id="iddle1119" class="indexterm"></a><a id="iddle1122" class="indexterm"></a><a id="iddle1898" class="indexterm"></a>Sometimes delegation isn’t quite what you need; in delegation, the behavior of the object you’re delegating behavior to never changes. <span class="strong"><strong><code class="literal">3DBoard</code></strong></span> <span class="emphasis"><em>always</em></span> uses instances of <span class="strong"><strong><code class="literal">Board</code></strong></span>, and the behavior of the <span class="strong"><strong><code class="literal">Board</code></strong></span> methods <span class="emphasis"><em>always</em></span> stay the same.</p><p>But in some cases, you need to have more than one single behavior to choose from. For example, suppose we wanted to develop a <span class="strong"><strong><code class="literal">Weapon</code></strong></span> interface, and then create several implementations of that interface that all behave differently:</p><div class="informalfigure"><a id="med_id00568a"></a><div class="mediaobject"><a id="med_id00568"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069822.png.jpg" alt="image with no caption" width="573" height="240"></div></div><p>Now we need to use the behavior from these classes in our <span class="strong"><strong><code class="literal">Unit</code></strong></span> class. One of the properties in our <span class="strong"><strong><code class="literal">properties Map</code></strong></span> will be “weapon”, and the value for that property needs to be an implementation of the <span class="strong"><strong><code class="literal">Weapon</code></strong></span> class. But a <span class="strong"><strong><code class="literal">Unit</code></strong></span> might change weapons, so we don’t want to tie the weapon property to a specific implementation of <span class="strong"><strong><code class="literal">Weapon</code></strong></span>; instead, we just want each <span class="strong"><strong><code class="literal">Unit</code></strong></span> to be able to reference a <span class="strong"><strong><code class="literal">Weapon</code></strong></span>, regardless of which implementation of <span class="strong"><strong><code class="literal">Weapon</code></strong></span> we want to use.</p><div class="informalfigure"><a id="med_id00569a"></a><div class="mediaobject"><a id="med_id00569"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069824.png.jpg" alt="image with no caption" width="752" height="358"></div></div></div><div class="sect1" title="When to use composition"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="when_to_use_composition">When to use composition</h2></div></div></div><p><a id="iddle1125" class="indexterm"></a>When we reference a whole family of behaviors like in the Unit class, we’re using <span class="strong"><strong>composition</strong></span>. The <span class="strong"><strong><code class="literal">Unit</code></strong></span>’s weapons property is <span class="strong"><strong><span class="emphasis"><em>composed</em></span></strong></span> of a particular <span class="strong"><strong><code class="literal">Weapon</code></strong></span> implementation’s behavior. We can show this in UML like this:</p><div class="informalfigure"><a id="med_id00570a"></a><div class="mediaobject"><a id="med_id00570"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069826.png.jpg" alt="image with no caption" width="678" height="466"></div></div><p>Composition is most powerful when you want to use behavior defined in an interface, and then <span class="underline">choose</span> from a variety of implementations of that interface, at both compile time and run time.</p><div class="note" title="Note"><h3 class="title"><a id="ch08note14"></a>Note</h3><div class="informalfigure"><a id="med_id00571a"></a><div class="mediaobject"><a id="med_id00571"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069828.png.jpg" alt="image with no caption" width="104" height="103"></div></div><p><span class="emphasis"><em><span class="strong"><strong>Composition</strong></span> allows you to use behavior from a family of other classes, and to change that behavior at runtime.</em></span></p></div><div class="blockquote"><blockquote class="blockquote"><p>Pizza is actually a great example of composition: it’s composed of different ingredients, but you can swap out different ingredients without affecting the overall pizza slice.</p><p>[note from marketing: how will anyone take us seriously if we compare programming principles to <span class="underline">pizza</span>?]</p></blockquote></div></div><div class="sect1" title="When the pizza is gone, so are the ingredients..."><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="when_the_pizza_is_gonecomma_so_are_the_i">When the pizza is gone, so are the ingredients...</h2></div></div></div><p>There’s one important point we haven’t mentioned so far about composition. When an object is composed of other objects, and the owning object is destroyed, <span class="emphasis"><em>the objects that are part of the composition go away, too</em></span>. That’s a little confusing, so let’s take a closer look at what that actually means.</p><p>Here’s our <span class="strong"><strong><code class="literal">Unit</code></strong></span> class again, which has a composition relationship to the <span class="strong"><strong><code class="literal">Weapon</code></strong></span> interface and its implementations:</p><div class="informalfigure"><a id="med_id00572a"></a><div class="mediaobject"><a id="med_id00572"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069830.png.jpg" alt="image with no caption" width="596" height="237"></div></div><p>Suppose we create a new <span class="strong"><strong><code class="literal">Unit</code></strong></span>, and assign its weapon property to an instance of <span class="strong"><strong><code class="literal">Sword</code></strong></span>:</p><div class="informalfigure"><a id="med_id00573a"></a><div class="mediaobject"><a id="med_id00573"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069832.png.jpg" alt="image with no caption" width="771" height="293"></div></div><p>What happens if this <span class="strong"><strong><code class="literal">Unit</code></strong></span> is destroyed? Obviously, the <span class="strong"><strong><code class="literal">pirate</code></strong></span> variable is trashed, but the instance of <span class="strong"><strong><code class="literal">Sword</code></strong></span> referenced by pirate is also thrown away. It doesn’t exist <span class="emphasis"><em>outside of</em></span> the <span class="strong"><strong><code class="literal">pirate</code></strong></span> object.</p><div class="informalfigure"><a id="med_id00574a"></a><div class="mediaobject"><a id="med_id00574"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069834.png.jpg" alt="image with no caption" width="546" height="213"></div></div><div class="blockquote"><blockquote class="blockquote"><p><a id="iddle1123" class="indexterm"></a><span class="strong"><strong>In composition, the object composed of other behaviors <span class="underline">owns</span> those behaviors. When the object is destroyed, <span class="underline">so</span> <span class="underline">are</span> <span class="underline">all</span> <span class="underline">of</span> <span class="underline">its</span> <span class="underline">behaviors.</span></strong></span></p><p><span class="strong"><strong>The behaviors in a composition <span class="underline">do</span> <span class="underline">not</span> <span class="underline">exist</span> outside of the composition itself.</strong></span></p></blockquote></div><div class="informalfigure"><a id="med_id00575a"></a><div class="mediaobject"><a id="med_id00575"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069836.png.jpg" alt="image with no caption" width="437" height="450"></div></div><div class="note" title="Brain Power"><h3 class="title"><a id="ch08note15"></a>Brain Power</h3><p>Can you think of an example where the ownership aspect of composition would be a negative in your application? When might you want the composed objects to exist outside of the composing class?</p></div></div><div class="sect1" title="Aggregation: composition, without the abrupt ending"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="aggregation_compositioncomma_without_the">Aggregation: composition, without the abrupt ending</h2></div></div></div><p><a id="iddle1011" class="indexterm"></a><a id="iddle1413" class="indexterm"></a>What happens when you want all the benefits of composition—flexibility in choosing a behavior, and adhering to the LSP—but your composed objects need to exist <span class="emphasis"><em>outside</em></span> of your main object? That’s where aggregation comes in.</p><div class="note" title="Note"><h3 class="title"><a id="ch08note16"></a>Note</h3><div class="informalfigure"><a id="med_id00576a"></a><div class="mediaobject"><a id="med_id00576"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069838.png.jpg" alt="image with no caption" width="104" height="121"></div></div><p><span class="bolditalic">Aggregation</span> <span class="emphasis"><em>is when one class is used as part of another class, but still exists outside of that other class.</em></span></p></div><div class="blockquote"><blockquote class="blockquote"><p>The ice cream, bananas, and cherries exist <span class="underline">outside</span> of a banana split. Take away that fancy container, and you’ve still got the individual components.</p></blockquote></div><div class="sect2" title="You’ve already used aggregation..."><div class="titlepage"><div><div><h3 class="title" id="youapostropheve_already_used_aggregation">You’ve already used aggregation...</h3></div></div></div><p>We’ve been using aggregation already, in Rick’s Stringed Instruments, from <a class="xref" href="ch05.html" title="Chapter&nbsp;5.&nbsp;(Part 1) Good Design = Flexible Software: Nothing Ever Stays the Same">Chapter&nbsp;5</a>:</p><div class="informalfigure"><a id="med_id00577a"></a><div class="mediaobject"><a id="med_id00577"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069840.png.jpg" alt="image with no caption" width="663" height="413"></div></div></div></div><div class="sect1" title="Aggregation versus composition"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="aggregation_versus_composition">Aggregation versus composition</h2></div></div></div><p><a id="iddle1014" class="indexterm"></a><a id="iddle1124" class="indexterm"></a>It’s easy to get confused about when you should use composition, and when you should use aggregation. The easiest way to figure this out is to ask yourself, <span class="emphasis"><em>Does the object whose behavior I want to use exist outside of the object that uses its behavior?</em></span></p><p>If the object does make sense existing on its own, then you should use aggregation; if not, then go with composition. But be careful! Sometimes the slightest change in the usage of your objects can make all the difference.</p><div class="sidebar"><a id="five-minute_mystery"></a><div class="sidebar-title">Five-Minute Mystery</div><p>Joel leaned back in his seat, arched his back, and thought again about buying that new Aeron chair once his stock options came in. Being a game programmer was hard work, and Joel was the last coder in the office yet again.</p><p>“People are gonna go nuts over Cows Gone Wild,” he thought. He pulled up the user guide for Gary’s Game System Framework, and started to think about how he was going to implement the cowboys, one of the last features he had to deal with. Suddenly, his eyes lit upon the Unit class, and he realized that he could use Units for cowboys, and the Weapon interface for lassos, revolvers, and even branding irons.</p><p>Joel created Lasso, Revolver, and BrandingIron classes, and made sure they all implemented the Weapon interface. He even added a Weapon property to his Building class, so the cowboys could hang their gear up at the end of long days chasing the cows.</p><p>“This is so money... a little bit of composition, and I’ll bet boss-man Brad will put me as the lead designer in the game credits.” He quickly drew up a class diagram of what he had done for the morning shift, colored in his composition diamond between the Unit and Weapon classes, and headed for Taco Bell on the way back to his apartment.</p><p>Little did Joel know that when he got back into work the next day, Brad would be yelling at him, instead of congratulating him...</p><p><span class="strong"><strong>What did Joel do wrong?</strong></span></p><p><span class="inlinemediaobject"><a id="inline_id00042"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2068819.png.jpg" alt="" width="99" height="9"></span> <span class="strong"><strong>Answer in <a class="xref" href="ch08.html#exercise_solutions-id00135" title="Exercise Solutions">Exercise Solutions</a></strong></span></p></div></div><div class="sect1" title="Inheritance is just one option"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="inheritance_is_just_one_option">Inheritance is just one option</h2></div></div></div><p><a id="iddle1012" class="indexterm"></a><a id="iddle1058" class="indexterm"></a><a id="iddle1120" class="indexterm"></a><a id="iddle1153" class="indexterm"></a><a id="iddle1362" class="indexterm"></a>We started out this section talking about the LSP, and the basic idea that subclasses must be substitutable for their base classes. More importantly, though, now you have several ways to reuse behavior from other classes, beyond inheritance.</p><p>Let’s take a quick look back at our options for reusing behavior from other classes, without resorting to subclassing.</p><div class="note" title="Delegation"><h3 class="title"><a id="ch08note17"></a><span class="underline">Delegation</span></h3><div class="informalfigure"><a id="med_id00578a"></a><div class="mediaobject"><a id="med_id00578"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069842.png.jpg" alt="image with no caption" width="77" height="122"></div></div><p><span class="strong"><strong><span class="emphasis"><em>Delegate</em></span></strong></span> behavior to another class when you don’t want to change the behavior, but it’s not your object’s responsibility to implement that behavior on its own.</p></div><div class="note" title="Composition"><h3 class="title"><a id="ch08note18"></a><span class="underline">Composition</span></h3><div class="informalfigure"><a id="med_id00579a"></a><div class="mediaobject"><a id="med_id00579"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069844.png.jpg" alt="image with no caption" width="104" height="103"></div></div><p>You can reuse behavior from one or more classes, and in particular from a family of classes, with <span class="strong"><strong><span class="emphasis"><em>composition</em></span></strong></span>. Your object completely owns the composed objects, and they do not exist outside of their usage in your object.</p></div><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>If you favor delegation, composition, and aggregation <span class="underline">over</span> inheritance, your software will usually be more flexible, and easier to maintain, extend, and reuse.</strong></span></p></blockquote></div><div class="note" title="Aggregation"><h3 class="title"><a id="ch08note19"></a><span class="underline">Aggregation</span></h3><div class="informalfigure"><a id="med_id00580a"></a><div class="mediaobject"><a id="med_id00580"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069846.png.jpg" alt="image with no caption" width="104" height="121"></div></div><p>When you want the benefits of composition, but you’re using behavior from an object that does exist outside of your object, use <span class="strong"><strong><span class="emphasis"><em>aggregation</em></span></strong></span>.</p></div><div class="blockquote"><blockquote class="blockquote"><p>All three of these OO techniques allow you to reuse behavior <span class="underline">without</span> violating the LSP.</p></blockquote></div><div class="informalfigure"><a id="med_id00581a"></a><div class="mediaobject"><a id="med_id00581"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069848.png.jpg" alt="image with no caption" width="117" height="108"></div></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00131"></a><div class="sidebar-title">There are no Dumb Questions</div><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table style="border: 0; width: 100%; "><colgroup><col style="text-align: left; width: 1%; "><col></colgroup><tbody><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa5qe1"></a><a id="ch08qa5q1"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><a id="iddle1178" class="indexterm"></a><a id="iddle1756" class="indexterm"></a><a id="iddle1765" class="indexterm"></a><a id="iddle1769" class="indexterm"></a><a id="iddle1784" class="indexterm"></a><a id="iddle1802" class="indexterm"></a><span class="strong"><strong>Q: I thought subclassing was a good thing. Now you’re saying it’s a <span class="emphasis"><em>bad</em></span> thing?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa5q1a1"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> No, subclassing and inheritance are key to any good OO programming language. The LSP is not about subclassing, though; it’s about <span class="emphasis"><em>when</em></span> to subclass. If your subclass really is substitutable for its base type, then you’ve probably done a good job using inheritance. If your subclass is <span class="emphasis"><em>not</em></span> substitutable for its base type, then you might look at other OO solutions like aggregation or delegation.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa5qe2"></a><a id="ch08qa5q2"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: But it is OK to use delegation, composition, or aggregation in a class that really shouldn’t extend another class?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa5q2a2"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Sure. In fact, the LSP doesn’t apply at all to aggregate or delegate classes, because those are two great ways to fix an inheritance tree that doesn’t conform to the LSP. You might even say that good use of the LSP goes hand-in-hand with more delegation, composition, and aggregation.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa5qe3"></a><a id="ch08qa5q3"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: Do we really need to apply the LSP all the time to figure this out? Isn’t this just writing good OO software?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa5q3a3"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> Lots of times, you don’t need to worry about the formal name of a design principle to write good code. For example, look back at the <span class="strong"><strong><code class="literal">Board</code></strong></span> example in <a class="xref" href="ch08.html#misusing_subclassing_a_case_study_in_mis" title="Misusing subclassing: a case study in misusing inheritance">Misusing subclassing: a case study in misusing inheritance</a>; to make <span class="strong"><strong><code class="literal">3DBoard</code></strong></span> extend <span class="strong"><strong><code class="literal">Board</code></strong></span>, all of the methods had to be changed! That should be a real tip-off that you’re got some inheritance problems.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa5qe4"></a><a id="ch08qa5q4"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: There were a lot of weird UML symbols in there. How am I supposed to remember what they all mean?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa5q4a4"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> You really don’t need to memorize these symbols at all. While UML provides specific notation for aggregation and composition, they are all just different forms of association. So just like we did with delegation, you can use a normal line with an arrow, a normal association, for composition and aggregation.</p></td></tr><tr class="question" title="Q:"><td style="text-align: left; vertical-align: top; "><a id="ch08qa5qe5"></a><a id="ch08qa5q5"></a><p><strong>Q:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>Q: But won’t that be confusing to developers if they don’t know what type of association should be used?</strong></span></p></td></tr><tr class="answer"><td style="text-align: left; vertical-align: top; "><a id="ch08qa5q5a5"></a><p><strong>A:</strong></p></td><td style="text-align: left; vertical-align: top; "><p><span class="strong"><strong>A:</strong></span> That’s possible, but it also allows for a lot more flexibility. Suppose that you decide later on that when an army is destroyed, you don’t want the individual units destroyed as well. So you might change the relationship between army and unit from composition to aggregation.</p><p>If you’re using a basic association arrow, you won’t need to change your class diagram at all. It also gives the developer freedom to come up with their own ideas about how to implement the association.</p><p>There’s nothing wrong with using the aggregation and composition symbols, but you shouldn’t get too hung up on it, especially if you’re early on in the development cycle. You never know what might change later, and flexibility is always better than rigidity in your design.</p></td></tr></tbody></table></div></blockquote></div></div><div class="sidebar"><a id="who_am_iquestion_mark"></a><div class="sidebar-title">Who Am I?</div><p><a id="iddle1900" class="indexterm"></a>A bunch of classes involved in OO principles, all in full costume, are playing a party game, <a class="xref" href="ch08.html#who_am_iquestion_mark" title="Who Am I?">Who Am I?</a> They give a clue, and you try to guess who they are, based on what they say. Assume they always tell the truth about themselves. If they happen to say something that could be true for more than one of them, choose all for whom that sentence can apply. Fill in the blanks next to the sentence with the names of one or more attendees. The first one’s on us.</p><p><span class="strong"><strong>Tonight’s attendees:</strong></span></p><div class="informalfigure"><a id="med_id00582a"></a><div class="mediaobject"><a id="med_id00582"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069850.png.jpg" alt="image with no caption" width="425" height="40"></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"><col class="c2"></colgroup><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>I’m substitutable for my base type.</strong></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>___________________________________</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>I let someone else do things for me.</strong></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>___________________________________</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>My behavior is used as part of another class’s behavior.</strong></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>___________________________________</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>I change the behavior of another class.</strong></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>___________________________________</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>I don’t change the behavior of another class.</strong></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>___________________________________</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>I can combine the behavior of other classes together.</strong></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>___________________________________</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>I’m not gonna go away, even if other related classes do.</strong></span></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>___________________________________</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="strong"><strong>I get my behavior and functionality from my base type.</strong></span></p></td><td style="vertical-align: top; "><p>___________________________________</p></td></tr></tbody></table></div><p><span class="inlinemediaobject"><a id="inline_id00043"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2068819.png.jpg" alt="" width="99" height="9"></span> <span class="strong"><strong>Unmask the principles in <a class="xref" href="ch08.html#who_am_iquestion_mark_solutions" title="Who Am I? Solutions">Who Am I? Solutions</a></strong></span></p></div><div class="sidebar"><a id="bullet_points-id00132"></a><div class="sidebar-title">Bullet Points</div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a id="iddle1079" class="indexterm"></a><a id="iddle1105" class="indexterm"></a><a id="iddle1453" class="indexterm"></a><a id="iddle1487" class="indexterm"></a>The Open-Closed Principle keeps your software reusable, but still flexible, by keeping classes open for extension, but closed for modification.</p></li><li class="listitem"><p>With classes doing one single thing through the Single Responsibility Principle, it’s even easier to apply the OCP to your code.</p></li><li class="listitem"><p>When you’re trying to determine if a method is the responsibility of a class, ask yourself, <span class="emphasis"><em>Is it this class’s job to do this particular thing?</em></span> If not, move the method to another class.</p></li><li class="listitem"><p>Once you have your OO code nearly complete, be sure that you Don’t Repeat Yourself. You’ll avoid duplicate code, and ensure that each behavior in your code is in a single place.</p></li><li class="listitem"><p>DRY applies to requirements as well as your code: you should have each feature and requirement in your software implemented in a single place.</p></li><li class="listitem"><p>The Liskov Substitution Principle ensures that you use inheritance correctly, by requiring that subtypes be substitutable for their base types.</p></li><li class="listitem"><p>When you find code that violates the LSP, consider using delegation, composition, or aggregation to use behavior from other classes without resorting to inheritance.</p></li><li class="listitem"><p>If you need behavior from another class but don’t need to change or modify that behavior, you can simply delegate to that class to use the desired behavior.</p></li><li class="listitem"><p>Composition lets you choose a behavior from a family of behaviors, often via several implementations of an interface.</p></li><li class="listitem"><p>When you use composition, the composing object owns the behaviors it uses, and they stop existing as soon as the composing object does.</p></li><li class="listitem"><p>Aggregation allows you to use behaviors from another class without limiting the lifetime to those behaviors.</p></li><li class="listitem"><p>Aggregated behaviors continue to exist even after the aggregating object is destroyed.</p></li></ul></div></div><div class="sidebar"><a id="tools_for_your_ooaampersandd_too-id00133"></a><div class="sidebar-title">Tools for your OOA&amp;D Toolbox</div><p><a id="iddle1106" class="indexterm"></a><a id="iddle1454" class="indexterm"></a><a id="iddle1476" class="indexterm"></a><a id="iddle1488" class="indexterm"></a><span class="strong"><strong>We’ve got a lot more OO principles to add to the toolbox. Let’s add what we’ve learned to our notes—and remember: these principles are best used together, not separately!</strong></span></p><div class="informalfigure"><a id="med_id00583a"></a><div class="mediaobject"><a id="med_id00583"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069852.png.jpg" alt="image with no caption" width="724" height="729"></div></div></div><div class="sidebar"><a id="ooaampersandd_cross-id00134"></a><div class="sidebar-title">OOA&amp;D Cross</div><p><a id="iddle1468" class="indexterm"></a>This one is a particularly tough puzzle: almost all the answers are more than one word. Good luck, and keep that left brain working.</p><div class="informalfigure"><a id="med_id00584a"></a><div class="mediaobject"><a id="med_id00584"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069854.png.jpg" alt="image with no caption" width="488" height="382"></div></div><div class="informaltable"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"><col class="c2"></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Across</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Down</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>1. A variation in composition.</p>
<p>3. This is when one object owns behaviors from other objects.</p>
<p>6. This is when you hand over responsibility for a particular behavior.</p>
<p>7. He was all about substitution.</p>
<p>8. The LSP reveals problems related to this.</p>
<p>11. You should keep a single piece of code in this many places.</p>
<p>13. You should have each piece of your information and this in a single, sensible place.</p>
<p>14. ________ Out things that are common in your code.</p>
<p>15. Each object in your system should have this many responsibilities.</p>
<p>16. This is overrated in good <span class="emphasis"><em>OO</em></span> software design.</p>
<p>17. Another term for SRP is this.</p></td><td style="vertical-align: top; "><p>2. Aggregated objects exist _______ of the classes that use them.</p>
<p>4. Subtypes must be substitutable for these.</p>
<p>5. Classes should be closed for this.</p>
<p>9. <span class="emphasis"><em>OO</em></span> principles work best when used this way.</p>
<p>10. A well-designed class has only one reason to do this.</p>
<p>12. Classes should be open for this.</p></td></tr></tbody></table></div></div><div class="sidebar"><a id="who_am_iquestion_mark_solutions"></a><div class="sidebar-title">Who Am I? Solutions</div><p><a id="iddle1902" class="indexterm"></a>A bunch of classes involved in OO principles, all in full costume, are playing a party game, <a class="xref" href="ch08.html#who_am_iquestion_mark_solutions" title="Who Am I? Solutions">Who Am I? Solutions</a> They give a clue, and you try to guess who they are, based on what they say. Assume they always tell the truth about themselves. If they happen to say something that could be true for more than one of them, choose all for whom that sentence can apply. Fill in the blanks next to the sentence with the names of one or more attendees. The first one’s on us.</p><p><span class="strong"><strong>Tonight’s attendees:</strong></span></p><div class="informalfigure"><a id="med_id00585a"></a><div class="mediaobject"><a id="med_id00585"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069856.png.jpg" alt="image with no caption" width="463" height="44"></div></div><div class="informalfigure"><a id="med_id00586a"></a><div class="mediaobject"><a id="med_id00586"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069858.png.jpg" alt="image with no caption" width="634" height="519"></div></div></div><div class="sidebar"><a id="exercise_solutions-id00135"></a><div class="sidebar-title">Exercise Solutions</div><div class="informalfigure"><a id="med_id00587a"></a><div class="mediaobject"><a id="med_id00587"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/httpatomoreillycomsourceoreillyimages2069860.png.jpg" alt="image with no caption" width="443" height="349"></div></div></div><div class="sidebar"><a id="five-minute_mystery_solved"></a><div class="sidebar-title">Five-Minute Mystery <span class="underline">Solved</span></div><p>Joel’s big mistake was revealed in this line:</p><p><span class="strong"><strong><span class="emphasis"><em>He even added a Weapon property to his Building class, so the cowboys could hang their gear up at the end of long days chasing the cows.</em></span></strong></span></p><p>When Joel decided that cowboys could hang up their weapons, he committed to the Lasso, Revolver, and BrandingIron classes existing <span class="emphasis"><em>outside</em></span> of any individual Unit instance. No cowboy owned the gear; they just used the behavior of the gear for a time.</p><p>Since the Weapon implementations exist outside of a specific cowboy, Joel should have used aggregation instead of composition. Different cowboys could use the same Weapon implementation at different times, and those weapons should stay in existence, even if the cowboy using them was trampled by a mad cow.</p></div></div></section></div></div><link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:0596008678/files/core.css" crossorigin="anonymous"></div></div></section>
</div>

