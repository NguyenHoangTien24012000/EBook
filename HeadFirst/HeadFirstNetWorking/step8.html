<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
</style>
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><div class="chapter" title="Chapter&nbsp;8.&nbsp;The Domain Name System: Names to Numbers"><div class="titlepage"><div><div><h1 class="title"><a id="domain_name_system_names_to_numbers"></a>Chapter&nbsp;8.&nbsp;The Domain Name System: Names to Numbers</h1></div></div></div><div class="informalfigure"><a id="med_id00327a"></a><div class="mediaobject"><a id="med_id00327"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566722.png.jpg" alt="image with no caption" width="522" height="486"></div></div><p><span class="strong"><strong>You probably don’t even think about it, but when you type a URL into a browser, how does your computer find an IP address for that server?</strong></span></p><p>In this chapter you will discover the world of Internet domains. You will find out how there are 13 root servers that deal out domain name information for the entire Internet. You will also install and configure your own DNS server.</p><div class="sect1" title="The Head First Health Club needs a website"><div class="titlepage"><div><div><h1 class="title"><a id="head_first_health_club_needs_a_website"></a>The Head First Health Club needs a website</h1></div></div></div><p>The Head First Health Club prides itself on its ability to find the perfect class for everyone. Whether you want to learn how to swim, practice martial arts, or get your body into shape, it has just the right class.</p><p>Unfortunately, competition between the different health clubs is fierce. In a bid to attract more customers, the CEO has decided that the Head First Health Club needs to have a website.</p><div class="informalfigure"><a id="med_id00328a"></a><div class="mediaobject"><a id="med_id00328"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566724.png.jpg" alt="image with no caption" width="517" height="409"></div></div><p>The CEO already has web page developers handling the actual web pages that need to go on the site, and web servers for the site itself. What <span class="emphasis"><em>you</em></span> need to do is get a domain for the website.</p><p>So what’s a domain?</p></div><div class="sect1" title="Hello, my domain name is..."><div class="titlepage"><div><div><h1 class="title"><a id="hellocomma_my_domain_name_ishellip"></a>Hello, my domain name is...</h1></div></div></div><p><a id="iddle1161" class="indexterm"></a>Even if you’ve never heard of a domain name, you’ve seen and used a zillion of them; you know... google.com, yahoo.com, amazon.com, headfirstlabs.com, and maybe a few you wouldn’t want us to mention.</p><p>So what’s a domain name? Well, it’s really just a unique name that’s used to locate your site. Here’s an example:</p><div class="informalfigure"><a id="med_id00329a"></a><div class="mediaobject"><a id="med_id00329"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566726.png" alt="image with no caption" width="680" height="213"></div></div><p>The main reason why you should care about domain names is that it gives you a unique, specific, and memorable name for your site.</p><p>There’s one other thing you should know. Domain names are controlled be a centralized authority (called ICANN) to make sure that only one person at a time uses a domain name. Also, you pay a small annual registration fee to keep your domain name (you knew it was coming).</p><div class="sect2" title="So how do we get a domain name?"><div class="titlepage"><div><div><h2 class="title"><a id="so_how_do_we_get_a_domain_namequestion_m"></a>So how do we get a domain name?</h2></div></div></div><p>The easy answer is to go to a domain registrar and step through the process of searching for an unused domain name that you would like to register. Some offer great tools to manage your domain names and extra tools for web pages, email, and other servers. But like most things, that comes at a price. You really need to shop around and find the best deal and service for what you need.</p><p>Here’s a list of some of the top domain registrars you might want to try out. <span class="emphasis"><em>[Note from Marketing: are they paying us for this?]</em></span></p><div class="informalfigure"><a id="med_id00330a"></a><div class="mediaobject"><a id="med_id00330"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566728.png" alt="image with no caption" width="443" height="109"></div></div><div class="note" title="FQDN"><h3 class="title"><a id="ch08note01"></a>FQDN</h3><p>Stands for Fully Qualified Domain Name. An example is:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a></p></li></ul></div><p>It’s basically the name of the website you’d type into your browser.</p></div></div></div><div class="sect1" title="Let’s go buy a domain name"><div class="titlepage"><div><div><h1 class="title"><a id="letapostrophes_go_buy_a_domain_name"></a>Let’s go buy a domain name</h1></div></div></div><p><a id="iddle1284" class="indexterm"></a>The Health Club CEO likes the domain <code class="literal">hfhealthclub.com</code>, and a quick search reveals that it’s available to buy. Before too long, you’ve bought up the domain and linked it to the Health Club web server. When the web page developers have deployed the web pages onto it, you’re good to go.</p><div class="sidebar"><a id="there_are_no_dumb_questions-id00114"></a><p class="title">There are no Dumb Questions</p><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table border="0" width="100%" summary="Q and A Set"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch08qa1qe1"></a><a id="ch08qa1q1"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: Why is it called a “domain name” rather than a “website name”?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch08qa1q1a1"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Because they are different things. If you look at <a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a>, that’s the web server’s name that is hosting that website, but only the “hfhealthclub.com” part is the domain name. You could also create other websites that use the same domain name, like corporate hfhealthclub.com or employees.hfhealthclub.com. So the domain name is something you can use for a lot of websites.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch08qa1qe2"></a><a id="ch08qa1q2"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: But I thought <a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a> was the name of a website?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch08qa1q2a2"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Yes and no. With regards to DNS, it is the name of a specific web server. A given web server can host lots of different websites, and it uses the domain name to decide which website to serve out.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch08qa1qe3"></a><a id="ch08qa1q3"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: If I was going to get the domain name for the Health Club, wouldn’t I want to get the name <a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a>? Everyone seems to use websites with the “www” at the front.</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch08qa1q3a3"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Again, don’t confuse a domain name with a web server’s name: hfhealthclub.com is a domain name, while <a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a> is the name of a web server. Buying a domain is like buying a piece of land—let’s say 100mainstreet.com. On that land, you can set up as many web servers as you like, for example, home.100mainstreet.com, toolshed.100mainstreet.com and outhouse.100mainstreet.com. So <a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a> is just one web server in the hfhealthclub.com domain.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch08qa1qe4"></a><a id="ch08qa1q4"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: What if I don’t have my own web servers?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch08qa1q4a4"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> In that case, you can use those of a hosting company. They often have package deals for hosting web pages, registering domain names, and so on. Your best bet is to figure out what you need, and then shop around for the best deal.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch08qa1qe5"></a><a id="ch08qa1q5"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: What’s so great about a domain name anyway? Do I really need one? My hosting company says I can just use their name, <a class="ulink" href="http://www.dirtcheaphosting.com">www.dirtcheaphosting.com</a>.</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch08qa1q5a5"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> If that meets your needs, there’s nothing wrong with using their name, But (and it’s a big but) here’s the disadvantage: should you ever want to choose another hosting company, or should that hosting company go out of business, then everyone who knows your site will no longer be able to easily find it. If, on the other hand, you have a domain name, you can just take that with you to your new hosting company. Your users will never even know you’ve switched.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch08qa1qe6"></a><a id="ch08qa1q6"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: I don’t know how to develop web pages. Is that a problem?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch08qa1q6a6"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Not at all. We’re assuming that a separate group of web page developers are doing the web page development and deploying it to the server. If, on the other hand, you’re interested in learning more about how web pages are developed, <span class="emphasis"><em>Head First HTML with CSS &amp; XHTML</em></span> is a great starting point.</p></td></tr></tbody></table></div></blockquote></div></div><div class="sidebar"><a id="test_drive-id00115"></a><p class="title">Test Drive</p><p><a id="iddle1172" class="indexterm"></a><a id="iddle1262" class="indexterm"></a>Let’s try browsing to <code class="literal">www.hfhealthclub.com</code> and see what happens.</p><div class="informalfigure"><a id="med_id00331a"></a><div class="mediaobject"><a id="med_id00331"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566730.png" alt="image with no caption" width="694" height="376"></div></div><div class="informalfigure"><a id="med_id00332a"></a><div class="mediaobject"><a id="med_id00332"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566732.png.jpg" alt="image with no caption" width="388" height="415"></div></div><p><span class="strong"><strong>So everything’s working well... right?</strong></span></p></div></div><div class="sect1" title="Uh-oh! We’re in trouble"><div class="titlepage"><div><div><h1 class="title"><a id="uh-ohexclamation_mark_weapostrophere_in"></a>Uh-oh! We’re in trouble</h1></div></div></div><p><a id="iddle1411" class="indexterm"></a>Everything seemed to be going well, but before too long, a customer reported a problem.</p><div class="informalfigure"><a id="med_id00333a"></a><div class="mediaobject"><a id="med_id00333"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566734.png.jpg" alt="image with no caption" width="416" height="404"></div></div><div class="informalfigure"><a id="med_id00334a"></a><div class="mediaobject"><a id="med_id00334"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566736.png" alt="image with no caption" width="646" height="406"></div></div><div class="sect2" title="And she’s not the only one"><div class="titlepage"><div><div><h2 class="title"><a id="and_sheapostrophes_not_the_only_one"></a>And she’s not the only one</h2></div></div></div><p>Before too long, the Head First Health Club is getting lots of complaints of intermittant problems and timeout issues.</p><p>So what could the problem be? And what can we do to fix it?</p><div class="informalfigure"><a id="med_id00335a"></a><div class="mediaobject"><a id="med_id00335"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566738.png.jpg" alt="image with no caption" width="294" height="573"></div></div><p title="Frank:"><span class="title"><strong><span class="strong"><strong>Frank:</strong></span></strong></span>&nbsp;<a id="iddle1178" class="indexterm"></a>No, I saw what the developers have done; it looks great.</p><p title="Jim:"><span class="title"><strong><span class="strong"><strong>Jim:</strong></span></strong></span>&nbsp;Well I can’t seem to get to it, and we have had some customer complaints as well.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;I know the web server is running. I was just looking at it this morning. There were no errors or anything on it.</p><p title="Jim:"><span class="title"><strong><span class="strong"><strong>Jim:</strong></span></strong></span>&nbsp;What else could be the problem?</p><p title="Frank:"><span class="title"><strong><span class="strong"><strong>Frank:</strong></span></strong></span>&nbsp;I am trying to pull it up right now on my browser, and I am just getting an error.</p><p title="Jim:"><span class="title"><strong><span class="strong"><strong>Jim:</strong></span></strong></span>&nbsp;That does not sound good.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;What error message does the browser give?</p><p title="Jim:"><span class="title"><strong><span class="strong"><strong>Jim:</strong></span></strong></span>&nbsp;It says it can’t find the server <a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a>.</p><p title="Frank:"><span class="title"><strong><span class="strong"><strong>Frank:</strong></span></strong></span>&nbsp;Sounds like our domain is not available, or at least that server’s domain name is not available.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;Did our domain registrar update the DNS records for the new web server?</p></div></div><div class="sect1" title="Introducing the DNS"><div class="titlepage"><div><div><h1 class="title"><a id="introducing_the_dns"></a>Introducing the DNS</h1></div></div></div><p>Before we look at how the client can find the web pages on <a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a>, we need to take a look at how DNS works. So what’s that?</p><p>DNS stands for Domain Name System. It translates fully qualified domain names that are meaningful to humans into IP addresses that computers understand. It’s a bit like an address book for the Internet that tells clients where to access resources.</p><div class="informalfigure"><a id="med_id00336a"></a><div class="mediaobject"><a id="med_id00336"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566740.png" alt="image with no caption" width="667" height="333"></div></div></div><div class="sect1" title="The DNS relies on name servers"><div class="titlepage"><div><div><h1 class="title"><a id="dns_relies_on_name_servers"></a>The DNS relies on name servers</h1></div></div></div><p>The translation between domain name and IP address is made possible because of a hierarchy of name servers. By a name server, we mean a server that can give an answer to a DNS query. So if we want to know which IP address is mapped to domain <a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a>, the name servers can tell us.</p><p>Let’s take a closer look at this.</p></div><div class="sect1" title="How the DNS sees your domain"><div class="titlepage"><div><div><h1 class="title"><a id="how_the_dns_sees_your_domain"></a>How the DNS sees your domain</h1></div></div></div><p>You can think of the DNS as being like an upside down tree. The name servers are like the branches, and the leaves are like the domains. To get to a particular domain or leaf, we trace our way through the relevant name servers (branches) to get to where we want to be.</p><p>Let’s look at <a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a> as an example.</p><div class="informalfigure"><a id="med_id00337a"></a><div class="mediaobject"><a id="med_id00337"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566742.png" alt="image with no caption" width="815" height="650"></div></div><p><span class="strong"><strong>So how does the client use this to get to the domain?</strong></span></p><div class="sidebar"><a id="dns_magnets"></a><p class="title">DNS Magnets</p><p>Take a look at the following fully qualified domain names:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="ulink" href="http://www.apple.com">www.apple.com</a></p></li><li class="listitem"><p>en.wikipedia.org</p></li><li class="listitem"><p>oreilly.com</p></li><li class="listitem"><p>icann.org</p></li></ul></div><p>Your job is to use the magnets below to say what the top level domain name, domain name, and host name is for each one.</p><div class="informalfigure"><a id="med_id00338a"></a><div class="mediaobject"><a id="med_id00338"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566744.png" alt="image with no caption" width="727" height="540"></div></div></div><div class="sidebar"><a id="be_the_domain_name_system"></a><p class="title">BE the Domain Name System</p><p><a id="iddle1166" class="indexterm"></a>Your job is to play the domain system and fill in what happens in each step of the process of resolving a domain name when a client requests an name to be resolved to an IP address.</p><div class="informalfigure"><a id="med_id00339a"></a><div class="mediaobject"><a id="med_id00339"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566746.png" alt="image with no caption" width="738" height="558"></div></div></div><div class="sidebar"><a id="dns_magnets_solution"></a><p class="title">DNS Magnets Solution</p><p>Take a look at the following fully qualified domain names:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="ulink" href="http://www.apple.com">www.apple.com</a></p></li><li class="listitem"><p>en.wikipedia.org</p></li><li class="listitem"><p>oreilly.com</p></li><li class="listitem"><p>icann.org</p></li></ul></div><p>Your job is to use the magnets below to say what the top level domain name, domain name, and host name is for each one.</p><div class="informalfigure"><a id="med_id00340a"></a><div class="mediaobject"><a id="med_id00340"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566748.png" alt="image with no caption" width="701" height="492"></div></div></div><div class="sidebar"><a id="be_the_domain_name_system_solution"></a><p class="title">BE the Domain Name System Solution</p><p>Your job is to play the domain system and fill in what happens in each step of the process of resolving a domain name when a client requests an name to be resolved to an IP address.</p><div class="informalfigure"><a id="med_id00341a"></a><div class="mediaobject"><a id="med_id00341"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566750.png" alt="image with no caption" width="730" height="568"></div></div></div></div><div class="sect1" title="So how does this affect the Health Club?"><div class="titlepage"><div><div><h1 class="title"><a id="so_how_does_this_affect_the_health_clubq"></a>So how does this affect the Health Club?</h1></div></div></div><p>So far we’ve seen how the DNS relies on name servers, and how the name servers resolve IP addresses. But why might this be causing a problem for the Health Club? Why are the customers getting server timeout errors?</p><div class="informalfigure"><a id="med_id00342a"></a><div class="mediaobject"><a id="med_id00342"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566752.png" alt="image with no caption" width="403" height="296"></div></div><p><span class="strong"><strong>He may be right.</strong></span></p><p>When a client tries to browse to a particular domain, it needs to know which IP address the domain name represents. The client gets this from the name server.</p><p>If the name server is down, this means that the client has no way of knowing how to get to the website at <a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a>. This means that anyone trying to reach the website will get errors.</p><div class="informalfigure"><a id="med_id00343a"></a><div class="mediaobject"><a id="med_id00343"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566754.png" alt="image with no caption" width="578" height="308"></div></div><div class="informalfigure"><a id="med_id00344a"></a><div class="mediaobject"><a id="med_id00344"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566756.png.jpg" alt="image with no caption" width="346" height="440"></div></div><p><span class="strong"><strong>We can replace the name server with our own.</strong></span></p><p>At the moment the Health Club is using the domain registrar’s name servers, but there’s an alternative. Instead of using the name servers of the domain registrar, we can take control and setup our own instead. There are pros and cons to this approach, but if the current name servers are causing a problem for the Health Club, it might be the way to go.</p><p>So how do we set up our own name server?</p><div class="sidebar"><a id="sharpen_your_pencil-id00116"></a><p class="title">Sharpen your pencil</p><p>Write down some more pros and cons of running your own name servers.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Pros</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>____________________________________________________________________________</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>_______________________________________________________________________________</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>_______________________________________________________________________________</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>_______________________________________________________________________________</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Cons</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>____________________________________________________________________________</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>_______________________________________________________________________________</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>_______________________________________________________________________________</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>_______________________________________________________________________________<a id="iddle1037" class="indexterm"></a><a id="iddle1162" class="indexterm"></a><a id="iddle1167" class="indexterm"></a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Pros</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><span class="underline">When you want to make a change in your DNS, there is no waiting around for it to take effect.</span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><span class="underline">You can gain a really thorough understanding of how your DNS service is working.</span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><span class="underline">You can immediately correct any problems that come up.</span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>_______________________________________________________________________________</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Cons</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><span class="underline">You have to perform sys admin duties not only on the DNS service but on the host operating system as well. This means updates, etc.</span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><span class="underline">You have to purchase hardware and possibly licensing for the server OS.</span></p></td></tr><tr><td style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="" valign="top"><p><span class="underline">You have to house the hardware somewhere.</span></p></td></tr></tbody></table></div></div></div><div class="sect1" title="First install a DNS name server..."><div class="titlepage"><div><div><h1 class="title"><a id="first_install_a_dns_name_serverhellip"></a>First install a DNS name server...</h1></div></div></div><p>A DNS name server is basically just an application that runs on an operating server. That means you have to have a server running Windows Server OS, Mac OS X Server, or a Linux variant. There are hardened servers that just do DNS. For some of these, you purchase subscriptions to keep the server up-to-date.</p><p>The most commonly used DNS server on the Internet is BIND. Installing BIND is relatively simple, but there’s something else we need to do too. We need to configure the name server so that it can translate fully qualified domain names into IP addresses.</p><div class="note" title="Note"><h3 class="title"><a id="ch08note02"></a>Note</h3><p>We’ve put some instructions on how to install the BIND DNS server in <a class="xref" href="apc.html" title="Appendix&nbsp;C.&nbsp;Installing Bind: Getting a Server to talk DNS">Appendix&nbsp;C</a>.</p></div></div><div class="sect1" title="...then configure the name server"><div class="titlepage"><div><div><h1 class="title"><a id="hellipthen_configure_the_name_server"></a>...then configure the name server</h1></div></div></div><p>Your name server uses something called a DNS zone file that translates a FQDN to an IP address. Let’s look at an example.</p><div class="sidebar"><a id="exercise-id00117"></a><p class="title">Exercise</p><p>Since name servers are public, we can take a look at other name servers to see how they are configured using a command called dig. Go through the following steps to bring up details of the O’Reilly web servers. What do you think the output means?</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p><span class="strong"><strong>Open a terminal (cmd) window.</strong></span></p></li><li class="listitem"><p><span class="strong"><strong>Type dig ns.oreilly.com <a class="ulink" href="http://www.oreilly.com">www.oreilly.com</a> any</strong></span></p><div class="note" title="Note"><h3 class="title"><a id="ch08note03"></a>Note</h3><p>On a Windows system you need to download dig from <a class="ulink" href="http://members.shaw.ca/nicholas.fong/dig/">http://members.shaw.ca/nicholas.fong/dig/</a></p></div></li><li class="listitem"><p><span class="strong"><strong>This will return the records for the O’Reilly web servers. The A stands for Address.</strong></span></p></li><li class="listitem"><p><span class="strong"><strong>You should see somewhere in the output:</strong></span></p><a id="pro_id00001"></a><pre class="programlisting">;; ANSWER SECTION:
www.oreilly.com.    21600  IN    A      208.201.239.36
www.oreilly.com.    21600  IN    A      208.201.239.37
;; AUTHORITY SECTION:
oreilly.com.        21600  IN    NS     ns.oreilly.com.
oreilly.com.        21600  IN    NS     b.auth-ns.sonic.net.
oreilly.com.        21600  IN    NS     a.auth-ns.sonic.net.
oreilly.com.        21600  IN    NS     c.auth-ns.sonic.net.</pre></li></ol></div></div><div class="sidebar"><a id="exercise_solution-id00118"></a><p class="title">Exercise Solution</p><p><a id="iddle1038" class="indexterm"></a><a id="iddle1163" class="indexterm"></a><a id="iddle1168" class="indexterm"></a>Since name servers are public, we can take a look at other name servers to see how they are configured using a command called dig. Go through the following steps to bring up details of the O’Reilly web servers. What do you think the output means?</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p><span class="strong"><strong>Open a terminal (cmd) window.</strong></span></p></li><li class="listitem"><p><span class="strong"><strong>Type dig ns.oreilly.com <a class="ulink" href="http://www.oreilly.com">www.oreilly.com</a> any</strong></span></p><div class="note" title="Note"><h3 class="title"><a id="ch08note04"></a>Note</h3><p>dig command allows us to lookup domain information.</p></div></li><li class="listitem"><p><span class="strong"><strong>This will return the records for the O’Reilly web servers. The A stands for Address.</strong></span></p></li><li class="listitem"><p><span class="strong"><strong>You should see somewhere in the output:</strong></span></p><div class="informalfigure"><a id="med_id00345a"></a><div class="mediaobject"><a id="med_id00345"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566758.png" alt="image with no caption" width="621" height="270"></div></div></li></ol></div></div><div class="sidebar"><a id="who_am_iquestion_mark"></a><p class="title">Who am I?</p><p>A bunch of BIND configuration file acronyms are playing the party game “Who am I?” They give you a clue, and you try to guess who they are, based on what they say. Assume they always tell the truth about themselves. If they happen to say something that could be true for more than one guy, then write down all for whom that sentence applies. Fill in the blanks next to the sentence with the names of one or more attendees.</p><p><span class="strong"><strong>Tonight’s attendees:</strong></span></p><p><span class="strong"><strong>SOA, CNAME, IN, MX, A, NS, PTR</strong></span></p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>Acronym</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>I specify hosts used for handling email.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>__________</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>I designate a host address.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>__________</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>I point to a domain name.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>__________</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>I designate a name server.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>__________</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>I mark off the start of a zone of authority.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>__________</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>I define an alias.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>__________</p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p>I designate an Internet class record.</p></td><td style="" valign="top"><p>__________</p></td></tr></tbody></table></div></div><div class="sidebar"><a id="who_am_iquestion_mark-id00119"></a><p class="title">Who am I?</p><p>A bunch of BIND configuration file acronyms are playing the party game “Who am I?” They give you a clue, and you try to guess who they are, based on what they say. Assume they always tell the truth about themselves. If they happen to say something that could be true for more than one guy, then write down all for whom that sentence applies. Fill in the blanks next to the sentence with the names of one or more attendees.</p><p><span class="strong"><strong>Tonight’s attendees:</strong></span></p><p><span class="strong"><strong>SOA, CNAME, IN, MX, A, NS, PTR</strong></span></p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>Acronym</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>I specify hosts used for handling email.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><span class="underline">MX</span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>I designate a host address.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><span class="underline">A</span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>I point to a domain name.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><span class="underline">PTR</span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>I designate a name server.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><span class="underline">NS</span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>I mark off the start of a zone of authority.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><span class="underline">SOA</span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>I define an alias.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><span class="underline">CNAME</span></p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p>I designate an Internet class record.</p></td><td style="" valign="top"><p><span class="underline">IN</span></p></td></tr></tbody></table></div></div><div class="sidebar"><a id="pool_puzzle"></a><p class="title">Pool Puzzle</p><p>Your <span class="strong"><strong>job</strong></span> is to take Bind elements from the pool and place them into the blank lines in the Health Club Bind configuration file. You may <span class="strong"><strong>not</strong></span> use the same Bind element more than once, and you won’t need to use all the Bind elements. Your <span class="strong"><strong>goal</strong></span> is to make a complete Bind configuration that will properly serve out IP addresses.</p><div class="note" title="Note"><h3 class="title"><a id="ch08note05"></a>Note</h3><p>Hint: You’ll need to use some of the BIND configuration file acronyms from the previous exercise.</p></div><a id="pro_id00002"></a><pre class="programlisting">$ORIGIN hfhealthclub.com
$TTL 86400
@     IN     _____   dns1.hfhealthclub.com.   hostmaster.hfhealthclub.com. (
                    2001062501 ; serial
                    21600      ; refresh after 6 hours
                    3600       ; retry after 1 hour
                    604800     ; expire after 1 week
                    86400 )    ; minimum TTL of 1 day

      IN   _____     ________________________
      IN   _____     dns2.hfhealthclub.com.
      IN   _____     10     _______________.

             IN     _____        10.0.1.5
server1      IN     _____        10.0.1.5
www          IN     _____        10.0.1.6
mail         IN     _____        _______________
dns1         IN     _____        10.0.1.2
dns2         IN     _____        10.0.1.3</pre><p><span class="strong"><strong>Note: each thing from the pool can only be used once!</strong></span></p><div class="informalfigure"><a id="med_id00346a"></a><div class="mediaobject"><a id="med_id00346"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566760.png.jpg" alt="image with no caption" width="724" height="244"></div></div></div><div class="sidebar"><a id="pool_puzzle_solution"></a><p class="title">Pool Puzzle Solution</p><p>Your <span class="strong"><strong>job</strong></span> is to take Bind elements from the pool and place them into the blank lines in the Health Club Bind configuration file. You may <span class="strong"><strong>not</strong></span> use the same Bind element more than once, and you won’t need to use all the Bind elements. Your <span class="strong"><strong>goal</strong></span> is to make a complete Bind configuration that will properly serve out IP addresses.</p><a id="pro_id00003"></a><pre class="programlisting">$ORIGIN hfhealthclub.com
$TTL 86400
@     IN     SOA    dns1.hfhealthclub.com.   hostmaster.hfhealthclub.com. (
                    2001062501 ; serial
                    21600      ; refresh after 6 hours
                    3600       ; retry after 1 hour
                    604800     ; expire after 1 week
                    86400 )    ; minimum TTL of 1 day

      IN     NS     dns1.hfhealthclub.com.
      IN     NS     dns2.hfhealthclub.com.
      IN     MX     10     mail.hfhealthclub.com.

             IN     A       10.0.1.5
server1      IN     A       10.0.1.5
www          IN     A       10.0.1.6
mail         IN     A       10.0.1.7
dns1         IN     A       10.0.1.2
dns2         IN     A       10.0.1.3</pre><p><span class="strong"><strong>Note: each thing from the pool can only be used once!</strong></span></p><div class="informalfigure"><a id="med_id00347a"></a><div class="mediaobject"><a id="med_id00347"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566762.png" alt="image with no caption" width="724" height="244"></div></div></div><div class="sidebar"><a id="nameserver_exposed"></a><p class="title">The Nameserver Exposed</p><p><a id="iddle1573" class="indexterm"></a><span class="strong"><strong>This week’s interview: DNS Namserver</strong></span></p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;Good morning! How are you?</p><p title="DNS Namserver:"><span class="title"><strong><span class="strong"><strong>DNS Namserver:</strong></span></strong></span>&nbsp;I don’t recognize that request.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;Excuse me? I was just saying good morning and asking how you are doing.</p><p title="DNS Namserver:"><span class="title"><strong><span class="strong"><strong>DNS Namserver:</strong></span></strong></span>&nbsp;My apologizes. I am so used to answering requests for names. I sometimes just can’t seem to do anything else. I am great this morning.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;So what is it like being a DNS nameserver? Busy all the time?</p><p title="DNS Namserver:"><span class="title"><strong><span class="strong"><strong>DNS Namserver:</strong></span></strong></span>&nbsp;Yes.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;OK .... Could you speak a little more to what kind of things you do?</p><p title="DNS Namserver:"><span class="title"><strong><span class="strong"><strong>DNS Namserver:</strong></span></strong></span>&nbsp;Yes, I get requests for IP addresses. Other computers send me a FQDN for the domain that I am responsible for, and I return an IP address. I do other requests as well.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;What would be some other request types?</p><p title="DNS Namserver:"><span class="title"><strong><span class="strong"><strong>DNS Namserver:</strong></span></strong></span>&nbsp;I do a lot of NS and MX types. The NS type is when they are looking for my or my partner’s IP addresses. The NS stands for NameServer. The MX type is for email servers for our domain. When I get a request of that type, I return the IP address of the email server responsible for our domain.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;Are there other types of DNS records that you deal with?</p><p title="DNS Nameserver:"><span class="title"><strong><span class="strong"><strong>DNS Nameserver:</strong></span></strong></span>&nbsp;Oh yes, I also deal with PTR records. These are fun because there are a reverse lookup. The computers making these requests give me an IP address, and I return a FQDN to them.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;Why would a computer want to do that?</p><p title="DNS Namserver:"><span class="title"><strong><span class="strong"><strong>DNS Namserver:</strong></span></strong></span>&nbsp;You can tell if a computer is lying about who they are. It is very easy to say you are email.somewhere.com, but your IP address will not match. A reverse lookup enables someone to verify that you are who you say you are.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;Are there other things that you do besides this?</p><p title="DNS Nameserver:"><span class="title"><strong><span class="strong"><strong>DNS Nameserver:</strong></span></strong></span>&nbsp;Besides this? My kin and I are the heart of the Internet. Without us you would not be able to get to your precious online shopping or news websites. You would have to memorize all those IP addresses. But we make it so easy; you just type in a name and voilà, there it is.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;I am sorry, that is not what I meant to say. I was asking more about other things you do with regards to DNS.</p><p title="DNS Nameserver:"><span class="title"><strong><span class="strong"><strong>DNS Nameserver:</strong></span></strong></span>&nbsp;My apologies. I go off sometimes. I think one cool thing I do is load-balancing. I can load balance a web server by doing a round robin lookup. How that works is that I have the IP addresses of several web servers, and I rotate amongst them to distribute the workload.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;Thank you for taking the time to answer my questions.</p></div></div><div class="sect1" title="The anatomy of a DNS zone file"><div class="titlepage"><div><div><h1 class="title"><a id="anatomy_of_a_dns_zone_file"></a>The anatomy of a DNS zone file</h1></div></div></div><p><a id="iddle1574" class="indexterm"></a>So what’s really going on inside the Health Club DNS zone file? Let’s take a close look at the file:</p><p><span class="strong"><strong>DNS Zone File</strong></span></p><div class="informalfigure"><a id="med_id00348a"></a><div class="mediaobject"><a id="med_id00348"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566764.png" alt="image with no caption" width="1000" height="456"></div></div><p>The best way to interpret this is to start reading from the bottom of the DNS zone file upwards.</p><p>The last set of lines in the file tell us that there are five servers that the name server knows about. These servers have IP addresses 10.0.1.5, 10.0.1.6, 10.0.1.7, 10.0.1.2 and 10.0.1.3, and they’re known by host names server1, www, mail, dns1 and dns2. These are all within the domain hfhealthclub.com.</p><p>The next batch of lines tell us that dns1 and dns2 are name servers, while mail is used as a mail server.</p><p>Finally, the top of the file tells us that the primary name server for domain hfhealthclub.com is dns1.</p><div class="note" title="Watch it!"><h3 class="title"><a id="ch08note06"></a>Watch it!</h3><p><span class="strong"><strong>Every host name needs an IP address.</strong></span></p><p><span class="emphasis"><em>Every host name in a zone file needs to have an IP address or a CNAME record pointing to another host.</em></span></p></div></div><div class="sect1" title="Here’s what the DNS zone file tells us about the Health Club servers"><div class="titlepage"><div><div><h1 class="title"><a id="hereapostrophes_what_the_dns_zone_file_t"></a>Here’s what the DNS zone file tells us about the Health Club servers</h1></div></div></div><p><a id="iddle1170" class="indexterm"></a><a id="iddle1379" class="indexterm"></a>So how do we visualize this? Here are the servers described in the zone file.</p><div class="sidebar"><a id="test_drive-id00120"></a><p class="title">Test Drive</p><p><a id="iddle1091" class="indexterm"></a><a id="iddle1182" class="indexterm"></a><a id="iddle1830" class="indexterm"></a>The DNS zone file has been configured as a name server for the Health Club, and the domain registrar notified. In the future, all DNS queries relating to hfhealthclub.com will come via the Health Club name server.</p><p>So what effect has adding our own name server had on the Health Club website?</p><div class="informalfigure"><a id="med_id00349a"></a><div class="mediaobject"><a id="med_id00349"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566766.png.jpg" alt="image with no caption" width="716" height="397"></div></div><p>Before too long, business is booming, and more and more customers are signing up for classes. But then something weird happens to email...</p></div></div><div class="sect1" title="The Health Club can’t send emails"><div class="titlepage"><div><div><h1 class="title"><a id="health_club_canapostrophet_send_emails"></a>The Health Club can’t send emails</h1></div></div></div><p><a id="iddle1169" class="indexterm"></a><a id="iddle1171" class="indexterm"></a><a id="iddle1354" class="indexterm"></a><a id="iddle1380" class="indexterm"></a>When the DNS server was up and running, everything was great... until someone tried to send an email.</p><div class="informalfigure"><a id="med_id00350a"></a><div class="mediaobject"><a id="med_id00350"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566768.png" alt="image with no caption" width="675" height="355"></div></div><p>Ever since the name server was swapped over, the Health Club has been unable to send emails to their customers, even though they’re still able to receive them. This means that they can’t send email confirmations to their customers about classes they’re interested in, and that’s bad for business.</p><p>So what do you think the problem could be?</p><div class="note" title="Brain Power"><h3 class="title"><a id="ch08note07"></a>Brain Power</h3><p>The Health Club uses email addresses in the form &lt;name&gt;@hfhealthclub.com. What do you think the problem might be?</p></div></div><div class="sect1" title="So what’s the problem?"><div class="titlepage"><div><div><h1 class="title"><a id="so_whatapostrophes_the_problemquestion_m"></a>So what’s the problem?</h1></div></div></div><p><a id="iddle1181" class="indexterm"></a>The DNS server we’ve set up allows people to find our IP addresses from fully qualified domain names like this:</p><p><span class="strong"><strong><a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a></strong></span> <span class="inlinemediaobject"><a id="inline_id00088"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566770.png.jpg" alt="" width="47" height="17"></span> <span class="strong"><strong>10.0.1.7</strong></span></p><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>Reverse DNS (RDNS) let’s you find a domain for an IP address.</strong></span></p></blockquote></div><p>The trouble is, the DNS server doesn’t allow us to do a Reverse DNS lookup. So what’s that?</p><p>Reverse DNS lookup allows us to find a fully qualified domain name from an IP address like this:</p><p><span class="strong"><strong>10.0.1.7</strong></span> <span class="inlinemediaobject"><a id="inline_id00089"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566770.png.jpg" alt="" width="47" height="17"></span> <span class="strong"><strong><a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a></strong></span></p><p>So why is this a problem? Why didn’t the recipient’s email system simply pass on the email?</p></div><div class="sect1" title="Email servers use RDNS to fight SPAM"><div class="titlepage"><div><div><h1 class="title"><a id="email_servers_use_rdns_to_fight_spam"></a>Email servers use RDNS to fight SPAM</h1></div></div></div><p>SPAM email is a huge problem on the Internet, and email servers have to do a lot of work to protect themselves from being submerged under a pile of junk mail. One common trick that they use is to check the domain name of the email server that sent them the email.</p><p>So why would they do that?</p><p>Well, the main reason is they need to be sure that the email comes from a reliable source. A spammer might decide to set up an email server on their PC at home. They could then make a connection to the Internet and flood the world with millions and millions of pieces of junk email.</p><p>So how does a reverse DNS lookup prevent this from happening?</p></div><div class="sect1" title="Check your sources with reverse DNS"><div class="titlepage"><div><div><h1 class="title"><a id="check_your_sources_with_reverse_dns"></a>Check your sources with reverse DNS</h1></div></div></div><p><a id="iddle1164" class="indexterm"></a><a id="iddle1195" class="indexterm"></a>To prevent that from happening, email servers look at the IP address of the server that sent the message and do a <span class="bolditalic">Reverse DNS lookup</span> to see which domain the message came from.</p><p>If the email message comes from a domain that’s on a blocked list, then the email will be rejected.</p><div class="informalfigure"><a id="med_id00351a"></a><div class="mediaobject"><a id="med_id00351"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566772.png" alt="image with no caption" width="313" height="210"></div></div><p>But it will <span class="emphasis"><em>also</em></span> be rejected if the sending server’s reverse DNS lookup IP address does not match its real IP address. Spammers try to do this by using a fake domain name.</p><div class="informalfigure"><a id="med_id00352a"></a><div class="mediaobject"><a id="med_id00352"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566774.png" alt="image with no caption" width="282" height="226"></div></div><p>In this way Reverse DNS is used to <span class="strong"><strong>challenge</strong></span> the sending server. It’s key to preventing chaos on the email system.</p><div class="note" title="Brain Power"><h3 class="title"><a id="ch08note08"></a>Brain Power</h3><p>What command will let us lookup a domain from an IP address?</p></div></div><div class="sect1" title="The dig command can do a reverse DNS lookup"><div class="titlepage"><div><div><h1 class="title"><a id="dig_command_can_do_a_reverse_dns_lookup"></a>The dig command can do a reverse DNS lookup</h1></div></div></div><p><a id="iddle1165" class="indexterm"></a><a id="iddle1174" class="indexterm"></a><a id="iddle1196" class="indexterm"></a><a id="iddle1589" class="indexterm"></a>We’ve already used a command that can perform a Reverse DNS lookup—the <span class="strong"><strong><code class="literal">dig</code></strong></span> command.</p><p>The name <code class="literal">dig</code> stands for <span class="strong"><strong>Domain Information Groper</strong></span>, and it’s your window to the DNS system. It lets you interrogate DNS servers by asking just about any question.</p><p>You already know that you can find an IP address from a domain name by using the <code class="literal">dig</code> command:</p><div class="informalfigure"><a id="med_id00353a"></a><div class="mediaobject"><a id="med_id00353"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566776.png" alt="image with no caption" width="628" height="255"></div></div><p>You can use the <code class="literal">dig</code> to go the other way too:</p><div class="informalfigure"><a id="med_id00354a"></a><div class="mediaobject"><a id="med_id00354"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566778.png" alt="image with no caption" width="668" height="220"></div></div><p><span class="strong"><strong>So what happens if we try to do a Reverse DNS lookup on our new server?</strong></span></p><div class="sidebar"><a id="test_drive-id00121"></a><p class="title">Test Drive</p><p>So are we able to do a reverse DNS? Let’s try it and find out.</p><div class="informalfigure"><a id="med_id00355a"></a><div class="mediaobject"><a id="med_id00355"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566780.png" alt="image with no caption" width="602" height="296"></div></div><p>Oh dear—the command didn’t return anything. This means that the reverse DNS isn’t working.</p><p>So how can we fix it?</p></div><div class="note" title="Watch it!"><h3 class="title"><a id="ch08note09"></a>Watch it!</h3><p><span class="strong"><strong>10.0.1.7 is a private IP address, and the below command will not work in real life.</strong></span></p><p><span class="emphasis"><em>10.0.1.7 is not assigned to any domain, so the dig command will not return anything if you try this at home.</em></span></p></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00122"></a><p class="title">There are no Dumb Questions</p><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table border="0" width="100%" summary="Q and A Set"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch08qa2qe1"></a><a id="ch08qa2q1"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: Why didn’t the dig command return the domain that the ping command asked about?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch08qa2q1a1"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Sometimes DNS servers associate several domain names with a particular IP address. That allows large companies like Google to give hundreds and thousands of servers the same IP “<a class="ulink" href="http://www.google.com">www.google.com</a>”.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch08qa2qe2"></a><a id="ch08qa2q2"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: Why would they want to do that?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch08qa2q2a2"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Scalability. They can spread millions of requests across thousands of servers.</p></td></tr></tbody></table></div></blockquote></div></div></div><div class="sect1" title="Your name server has another important zone file..."><div class="titlepage"><div><div><h1 class="title"><a id="your_name_server_has_another_important_z"></a>Your name server has another important zone file...</h1></div></div></div><p><a id="iddle1158" class="indexterm"></a><a id="iddle1175" class="indexterm"></a><a id="iddle1184" class="indexterm"></a><a id="iddle1590" class="indexterm"></a>That is the reverse lookup zone file. This is where all the PTR or pointer records go. Your name server uses this file to do DNS lookups using an IP address to return a FQDN.</p><a id="pro_id00004"></a><pre class="programlisting">$ttl 38400
1.0.10.in-addr.arpa. IN SOA skc.edu. hostmaster.1.0.10.in-addr.arpa. (
    2007080609
    10800
    3600
    604800
    38400 )
1.0.10.in-addr.arpa. IN NS dns1.hfhealthclub.com.

5    IN   PTR  www.hfhealthclub.com.</pre><p>So in order to do reverse DNS lookups, we need to make changes to this file.</p><div class="informalfigure"><a id="med_id00356a"></a><div class="mediaobject"><a id="med_id00356"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566782.png" alt="image with no caption" width="638" height="188"></div></div><div class="sidebar"><a id="be_the_domain_name_system-id00123"></a><p class="title">BE the Domain Name System</p><p><a id="iddle1159" class="indexterm"></a><a id="iddle1176" class="indexterm"></a><a id="iddle1180" class="indexterm"></a><a id="iddle1410" class="indexterm"></a><a id="iddle1823" class="indexterm"></a>Your job is to play the domain system and fill in what happens in each step of the process of a reverse DNS lookup.</p><div class="informalfigure"><a id="med_id00357a"></a><div class="mediaobject"><a id="med_id00357"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566784.png" alt="image with no caption" width="781" height="541"></div></div></div><div class="sidebar"><a id="be_the_domain_name_system_soluti-id00124"></a><p class="title">BE the Domain Name System Solution</p><p><a id="iddle1173" class="indexterm"></a><a id="iddle1183" class="indexterm"></a><a id="iddle1571" class="indexterm"></a>Your job is to play the domain system and fill in what happens in each step of the process of a reverse DNS lookup.</p><div class="informalfigure"><a id="med_id00358a"></a><div class="mediaobject"><a id="med_id00358"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566786.png" alt="image with no caption" width="781" height="524"></div></div></div><div class="informalfigure"><a id="med_id00359a"></a><div class="mediaobject"><a id="med_id00359"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566788.png.jpg" alt="image with no caption" width="392" height="523"></div></div><p><span class="strong"><strong>Backward IP addresses allow the name servers to work from the top down.</strong></span></p><p>They start with the root DNS servers (the in-addr.arpa part) and work their way down the IP network address until they find the name server responsible for that particular IP network.</p><div class="informalfigure"><a id="med_id00360a"></a><div class="mediaobject"><a id="med_id00360"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566790.png" alt="image with no caption" width="544" height="119"></div></div><div class="note" title="Brain Power"><h3 class="title"><a id="ch08note10"></a>Brain Power</h3><p>Why wouldn’t an IP address in the normal order work for reverse DNS lookups?</p></div><div class="sidebar"><a id="test_drive-id00125"></a><p class="title">Test Drive</p><p>Let’s try doing a reverse DNS lookup again using dig.</p><div class="informalfigure"><a id="med_id00361a"></a><div class="mediaobject"><a id="med_id00361"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566792.png" alt="image with no caption" width="594" height="275"></div></div><p>The Reverse DNS is working! That means your server now works both ways—it’s made the link from the FQDN to the IP address:</p><p><span class="strong"><strong><a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a></strong></span> <span class="inlinemediaobject"><a id="inline_id00090"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566770.png.jpg" alt="" width="47" height="17"></span> <span class="strong"><strong>10.0.1.7</strong></span></p><p>And by using Reverse DNS, it’s also made the link from the IP address to the FQDN:</p><p><span class="strong"><strong>10.0.1.7</strong></span> <span class="inlinemediaobject"><a id="inline_id00091"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566770.png.jpg" alt="" width="47" height="17"></span> <span class="strong"><strong><a class="ulink" href="http://www.hfhealthclub.com">www.hfhealthclub.com</a></strong></span></p><p>So has this fixed the email problem?</p></div></div><div class="sect1" title="The emails are working!"><div class="titlepage"><div><div><h1 class="title"><a id="emails_are_workingexclamation_mark"></a>The emails are working!</h1></div></div></div><p>Following your change, the Health Club can successfully send emails to their customers, which means that they can send email confirmations telling customers which courses they are enrolled in. Before too long, all of their classes are filled to capacity.</p><div class="informalfigure"><a id="med_id00362a"></a><div class="mediaobject"><a id="med_id00362"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/httpatomoreillycomsourceoreillyimages1566794.png.jpg" alt="image with no caption" width="491" height="479"></div></div></div></div></div></div><link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780596804398/files/core.css" crossorigin="anonymous"></div></div></section>
</div>

