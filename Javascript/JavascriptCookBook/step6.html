<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
    
</style>
<link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492092506/files/epub.css" crossorigin="anonymous">
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Functions"><div class="chapter" id="ch06">
        <h1><span class="label">Chapter 6. </span>Functions</h1>
        
        
        <p><a data-type="indexterm" data-primary="functions" id="ix_functions_ch6"></a>Functions are the building blocks that you use to assemble a program out of discrete, reusable code routines. But in JavaScript, that’s only part of the story.</p>
        
        <p><a data-type="indexterm" data-primary="Function type" id="idm45475168744408"></a><a data-type="indexterm" data-primary="function objects" id="idm45475168743480"></a>JavaScript functions are also genuine <em>objects</em>—instances of the <code>Function</code> type. They can be assigned to variables and passed around your code. <a data-type="indexterm" data-primary="arrow syntax" id="idm45475168741848"></a>They can be declared in an expression, without a function name, and optionally using a streamlined <em>arrow syntax</em>. <a data-type="indexterm" data-primary="closures" id="idm45475168740520"></a>You can even wrap one function in another to create a private package that includes the function’s state (called a <em>closure</em>).</p>
        
        <p>Functions are also at the core of JavaScript’s object-oriented support. <a data-type="indexterm" data-primary="function constructor" id="idm45475168738824"></a>That’s because custom classes are really just a special type of constructor function (as you’ll see in <a data-type="xref" href="ch08.html#ch08">Chapter&nbsp;8</a>). Sooner or later, everything in JavaScript comes back to functions.</p>
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Passing a Function as an Argument to Another Function"><div class="sect1" id="passing_function_as_argument">
        <h1>Passing a Function as an Argument to Another Function</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475168735480">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="functions" data-secondary="passing as arguments to other functions" id="ix_function_pass_arg"></a>You’re calling a function that expects you to provide your own function. What’s the best way to pass it?</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475168732552">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="callback function" data-secondary="arguments supported" id="ix_callback_arg"></a>Many functions in JavaScript accept, or even require, a function that’s passed as an argument. Some operations ask for a callback function that will be triggered when a task is complete. <a data-type="indexterm" data-primary="functions" data-secondary="converting arguments into arrays" id="idm45475168729080"></a>Others need to use your function to complete a broader task. For example, many methods of the <code>Array</code> object ask you to provide a function for sorting, converting, combining, or selecting data. The array then uses your function multiple times, until it has processed every element.</p>
        
        <p>There are several different approaches you can use when supplying a function as an argument. Here are three common patterns:</p>
        
        <ul>
        <li>
        <p>Provide a reference to a function that’s already declared elsewhere in your code. This approach makes sense if you want to use the function in other parts of your application, or if the function is particularly long or complex.</p>
        </li>
        <li>
        <p>Declare the function in a <em>function expression</em>, then pass it as an argument. <a data-type="indexterm" data-primary="function expression" id="idm45475168724216"></a>This approach works well for straightforward tasks, and if you don’t plan to use the function anywhere else.</p>
        </li>
        <li>
        <p>Declare the function inline, at the exact moment it’s required—when you pass it as an argument to another function. This is similar to the second approach, but it makes your code even more compact. It works best for very short, straightforward functions (especially one-liners).</p>
        </li>
        </ul>
        
        <p>Let’s start with a simple page that has this button:</p>
        
        <pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;button</code> <code class="na">id=</code><code class="s">"runTest"</code><code class="nt">&gt;</code>Run Test<code class="nt">&lt;/button&gt;</code></pre>
        
        <p>We attach an event handler as follows:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="c1">// Attach button event handler.</code>
        <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'runTest'</code><code class="p">).</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s2">"click"</code><code class="p">,</code> <code class="nx">buttonClicked</code><code class="p">);</code></pre>
        
        <p><a data-type="indexterm" data-primary="setTimeout() function" data-secondary="asynchronous programming" id="idm45475168674312"></a>Now consider the built-in <code>setTimeout()</code> function, which schedules a function to run after a certain delay (you supply the function). <a data-type="indexterm" data-primary="showMessage() function" id="idm45475168672840"></a>Here’s the first approach to function passing, with a separate function named <code>showMessage()</code>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="c1">// Runs when a button is clicked</code>
        <code class="kd">function</code> <code class="nx">buttonClicked</code><code class="p">()</code> <code class="p">{</code>
          <code class="c1">// Trigger the function after 2000 milliseconds (2 seconds)</code>
          <code class="nx">setTimeout</code><code class="p">(</code><code class="nx">showMessage</code><code class="p">,</code> <code class="mi">2000</code><code class="p">);</code>
        <code class="p">}</code>
        
        <code class="c1">// Runs when setTimeout() triggers it</code>
        <code class="kd">function</code> <code class="nx">showMessage</code><code class="p">()</code> <code class="p">{</code>
          <code class="nx">alert</code><code class="p">(</code><code class="s1">'You clicked the button 2 seconds ago'</code><code class="p">);</code>
        <code class="p">}</code></pre>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>When you pass a function reference by name, make sure you don’t add a set of empty parentheses. This example passes <code>showMessage</code> to the <code>setTimeout()</code> function. If you accidentally write <code>showMessage()</code>, JavaScript will <em>run</em> the <code>showMessage()</code> function immediately, and pass its return value to <code>setTimeout()</code> instead of passing a function reference.</p>
        </div>
        
        <p>Here’s the second approach, which declares the function closer to where it’s needed using a function expression:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">buttonClicked</code><code class="p">()</code> <code class="p">{</code>
          <code class="c1">// Declare a function expression to use with setTimeout()</code>
          <code class="kr">const</code> <code class="nx">timeoutCallback</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">showMessage</code><code class="p">()</code> <code class="p">{</code>
            <code class="nx">alert</code><code class="p">(</code><code class="s1">'You clicked the button 2 seconds ago'</code><code class="p">);</code>
          <code class="p">}</code>
        
          <code class="c1">// Trigger the function after 2000 milliseconds (2 seconds)</code>
          <code class="nx">setTimeout</code><code class="p">(</code><code class="nx">timeoutCallback</code><code class="p">,</code> <code class="mi">2000</code><code class="p">);</code>
        <code class="p">}</code></pre>
        
        <p>In this case, the scope of <code>showMessage()</code> is limited to the <code>buttonClicked()</code> function. It can’t be called from another function elsewhere in your code. Optionally, you could omit the function name (<code>showMessage</code>), making it an <em>anonymous function</em>. Either way, <code>timeoutCallback</code> works the same, but a function name can be useful in debugging, because it will appear in a stack trace if an error occurs.</p>
        
        <p>And here’s the third approach, which declares the function inline when calling <span class="keep-together"><code>setTimeout()</code></span>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">buttonClicked</code><code class="p">()</code> <code class="p">{</code>
          <code class="c1">// Trigger the function after 2000 milliseconds (2 seconds)</code>
          <code class="nx">setTimeout</code><code class="p">(</code><code class="kd">function</code> <code class="nx">showMessage</code><code class="p">()</code> <code class="p">{</code>
            <code class="nx">alert</code><code class="p">(</code><code class="s1">'You clicked the button 2 seconds ago'</code><code class="p">);</code>
          <code class="p">},</code> <code class="mi">2000</code><code class="p">);</code>
        <code class="p">}</code></pre>
        
        <p>Now the <code>showMessage()</code> function is declared and passed to <code>setTimeout()</code> in one statement. There’s no way for any other part of code to interact with <code>showMessage()</code>, even inside the <code>buttonClicked()</code> function. Optionally, you can leave out the name <code>showMessage()</code> so that it becomes an anonymous function:</p>
        
        <pre data-type="programlisting" data-code-language="javascript">  <code class="nx">setTimeout</code><code class="p">(</code><code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
            <code class="nx">alert</code><code class="p">(</code><code class="s1">'You clicked the button 2 seconds ago'</code><code class="p">);</code>
          <code class="p">},</code> <code class="mi">2000</code><code class="p">);</code></pre>
        
        <p>You can simplify this approach even further using arrow syntax, as demonstrated in <a data-type="xref" href="#arrow_functions">“Using Arrow Functions”</a>. But using a function name is a good practice for long or complex code routines. That’s because you’ll see the function name in the stack trace if an error occurs inside the function.</p>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p><a data-type="indexterm" data-primary="anonymous functions" id="idm45475168494600"></a><a data-type="indexterm" data-primary="functions" data-secondary="anonymous" id="idm45475168493896"></a>Pay attention to your organization’s style conventions when you use anonymous functions. One common pattern is to place the <code>function()</code> declaration and the opening <code>{</code> brace on the same line. Then, put all the code for the anonymous function underneath, with one extra level of indent. Finally, put the closing <code>}</code> brace on a separate line, followed immediately by the rest of the arguments for the function call.</p>
        </div>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475168490808">
        <h2>Discussion</h2>
        
        <p>These three approaches demonstrate a gradually narrowing scope, from the most accessible function (in the first example) to the least accessible function (in the last example). As a general rule, it’s best to use the narrowest scope possible. This reduces ambiguity in your code (making it more understandable for the other developers who follow in your footsteps), and reduces the possibility of unexpected side effects. However, there’s a trade-off. As a function becomes longer and more complex, inline declarations become less readable. And if you want to use the function separately, or run unit tests against it, you will need to break it out into a separate function.</p>
        
        <p>If you’re in any doubt about how a function <em>uses</em> a function reference, here’s a simple example with a custom function named <code>callYouBack()</code> that accepts a function parameter and then calls it. Inside the <code>callYouBack()</code> function, you treat the function reference exactly like an ordinary function, calling it by name and supplying any parameters it needs:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">buttonClicked</code><code class="p">()</code> <code class="p">{</code>
          <code class="c1">// Create a function that will handle the callback</code>
          <code class="kd">function</code> <code class="nx">logTime</code><code class="p">(</code><code class="nx">time</code><code class="p">)</code> <code class="p">{</code>
            <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Logging at: '</code> <code class="o">+</code> <code class="nx">time</code><code class="p">.</code><code class="nx">toLocaleTimeString</code><code class="p">());</code>
          <code class="p">}</code>
        
          <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'About to call callYouBack()'</code><code class="p">);</code>
          <code class="nx">callYouBack</code><code class="p">(</code><code class="nx">logTime</code><code class="p">);</code>
          <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'All finished'</code><code class="p">);</code>
        <code class="p">}</code>
        
        <code class="kd">function</code> <code class="nx">callYouBack</code><code class="p">(</code><code class="nx">callbackFunction</code><code class="p">)</code> <code class="p">{</code>
          <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Starting callYouBack()'</code><code class="p">);</code>
        
          <code class="c1">// Call the provided function and supply an argument</code>
          <code class="nx">callbackFunction</code><code class="p">(</code><code class="k">new</code> <code class="nb">Date</code><code class="p">());</code>
        
          <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Ending callYouBack()'</code><code class="p">);</code>
        <code class="p">}</code></pre>
        
        <p>If you run this code and click the button, it produces output like this:</p>
        
        <pre data-type="programlisting" class="pagebreak-before less_space">About to call callYouBack()
        Starting callYouBack()
        Logging at: 2:20:59 PM
        Ending callYouBack()
        All finished</pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45475168369656">
        <h2>See Also</h2>
        
        <p>See <a data-type="xref" href="#arrow_functions">“Using Arrow Functions”</a> for a syntax that lets you simplify the declaration of anonymous functions, and is especially useful for single-line functions that return a value. See <a data-type="xref" href="ch05.html#functional_array_methods">Table&nbsp;5-1</a> for the most important <code>Array</code> methods that accept function parameters.<a data-type="indexterm" data-primary="" data-startref="ix_function_pass_arg" id="idm45475168366200"></a><a data-type="indexterm" data-primary="" data-startref="ix_callback_arg" id="idm45475168365224"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Using Arrow Functions"><div class="sect1" id="arrow_functions">
        <h1>Using Arrow Functions</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475168362536">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="arrow syntax" id="ix_arrow_syntax"></a><a data-type="indexterm" data-primary="functions" data-secondary="arrow" id="ix_function_arrow"></a>You want to use JavaScript’s arrow syntax to declare an inline function in the most compact way possible.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475168358600">
        <h2>Solution</h2>
        
        <p>In recent years, JavaScript has shifted to emphasize functional programming patterns—array processing and asynchronous promises are two notable examples. To help, they’ve added a new, streamlined function syntax for writing inline functions, called <em>arrow syntax</em>.</p>
        
        <p><a data-type="indexterm" data-primary="functions" data-secondary="named" id="idm45475168356056"></a><a data-type="indexterm" data-primary="named functions" id="idm45475168355080"></a><a data-type="indexterm" data-primary="arrays (Array object)" data-secondary="converting function arguments into" id="idm45475168354408"></a><a data-type="indexterm" data-primary="functions" data-secondary="converting arguments into arrays" id="idm45475168353496"></a>Here’s an example of using the <code>Array.map()</code> method to transform the contents of an array using a named function without using arrow syntax. The initial array is a list of numbers, and the transformed array has the square of each number:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">numbers</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">,</code><code class="mi">4</code><code class="p">,</code><code class="mi">5</code><code class="p">,</code><code class="mi">6</code><code class="p">,</code><code class="mi">7</code><code class="p">,</code><code class="mi">8</code><code class="p">,</code><code class="mi">9</code><code class="p">,</code><code class="mi">10</code><code class="p">];</code>
        
        <code class="kd">function</code> <code class="nx">squareNumber</code><code class="p">(</code><code class="nx">number</code><code class="p">)</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">number</code><code class="o">**</code><code class="mi">2</code><code class="p">;</code>
        <code class="p">}</code>
        <code class="kr">const</code> <code class="nx">squares</code> <code class="o">=</code> <code class="nx">numbers</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">squareNumber</code><code class="p">);</code>
        
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">squares</code><code class="p">);</code>
        <code class="c1">// Displays [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]</code></pre>
        
        <p>Here’s the same example, but with the <code>squareNumber()</code> function declared inline using arrow syntax:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">numbers</code> <code class="o">=</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">,</code><code class="mi">4</code><code class="p">,</code><code class="mi">5</code><code class="p">,</code><code class="mi">6</code><code class="p">,</code><code class="mi">7</code><code class="p">,</code><code class="mi">8</code><code class="p">,</code><code class="mi">9</code><code class="p">,</code><code class="mi">10</code><code class="p">];</code>
        <code class="kr">const</code> <code class="nx">squares</code> <code class="o">=</code> <code class="nx">numbers</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code> <code class="nx">number</code> <code class="o">=&gt;</code> <code class="nx">number</code><code class="o">**</code><code class="mi">2</code> <code class="p">);</code>
        
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">squares</code><code class="p">);</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475168240168">
        <h2>Discussion</h2>
        
        <p>This example uses the most compact form of arrow syntax. This works for single-parameter, single-statement functions. Other functions may not be able to use all the simplifications of arrow syntax. To understand why, here’s a step-by-step breakdown of how you convert a named function to a function expression that uses arrow syntax:</p>
        <ol start="1">
        <li>
        <p>Put the list of parameters first, followed the <code>=&gt;</code> symbol. If there are no parameters, use an empty set of parentheses before the <code>=&gt;</code> symbol.</p>
        </li>
        
        </ol>
        
        <pre data-type="programlisting">(number) =&gt;</pre>
        <ol start="2">
        <li>
        <p>If there is exactly one parameter (as in this example), you can remove the parentheses around the parameter list.</p>
        </li>
        
        </ol>
        
        <pre data-type="programlisting">number =&gt;</pre>
        <ol start="3">
        <li>
        <p>Put the braces and body of the function on the other side of the arrow.</p>
        </li>
        
        </ol>
        
        <pre data-type="programlisting">number =&gt; {
          return number**2;
        }</pre>
        <ol start="4">
        <li>
        <p>If there is just one statement, you can remove the braces and the <code>return</code> keyword. But if you have more than one statement, you must keep both the braces <em>and</em> the <code>return</code> keyword.</p>
        </li>
        
        </ol>
        
        <pre data-type="programlisting">number =&gt; number**2;</pre>
        
        <p>Remember, the arrow function is used for declaring inline functions, so you’ll always be passing it to a parameter or assigning it to a variable in an expression:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">myFunc</code> <code class="o">=</code> <code class="nx">number</code> <code class="o">=&gt;</code> <code class="nx">number</code><code class="o">**</code><code class="mi">2</code><code class="p">;</code>
        
        <code class="kr">const</code> <code class="nx">squaredNumber</code> <code class="o">=</code> <code class="nx">myFunc</code><code class="p">(</code><code class="mi">10</code><code class="p">);</code>
        <code class="c1">// squaredNumber = 100</code></pre>
        
        <p>Now let’s look at converting this slightly more complex function:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">raiseToPower</code><code class="p">(</code><code class="nx">number</code><code class="p">,</code> <code class="nx">power</code><code class="p">)</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">number</code><code class="o">**</code><code class="nx">power</code><code class="p">;</code>
        <code class="p">}</code></pre>
        
        <p>You can carry out steps 1, 3, and 4, but step 2 doesn’t apply (because this function has two parameters):</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">myFunc</code> <code class="o">=</code> <code class="p">(</code><code class="nx">number</code><code class="p">,</code> <code class="nx">power</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">number</code><code class="o">**</code><code class="nx">power</code><code class="p">;</code></pre>
        
        <p>Or, consider this more detailed string processing function:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">applyTitleCase</code><code class="p">(</code><code class="nx">inputString</code><code class="p">)</code> <code class="p">{</code>
          <code class="c1">// Split the string into an array of words</code>
          <code class="kr">const</code> <code class="nx">wordArray</code> <code class="o">=</code> <code class="nx">inputString</code><code class="p">.</code><code class="nx">split</code><code class="p">(</code><code class="s1">' '</code><code class="p">);</code>
        
          <code class="c1">// Create a new array that will hold the processed words</code>
          <code class="kr">const</code> <code class="nx">processedWordArray</code> <code class="o">=</code> <code class="p">[];</code>
        
          <code class="k">for</code> <code class="p">(</code><code class="kr">const</code> <code class="nx">word</code> <code class="k">of</code> <code class="nx">wordArray</code><code class="p">)</code> <code class="p">{</code>
            <code class="c1">// Capitalize the first letter of this word</code>
            <code class="nx">processedWordArray</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="nx">word</code><code class="p">[</code><code class="mi">0</code><code class="p">].</code><code class="nx">toUpperCase</code><code class="p">()</code> <code class="o">+</code> <code class="nx">word</code><code class="p">.</code><code class="nx">slice</code><code class="p">(</code><code class="mi">1</code><code class="p">));</code>
          <code class="p">}</code>
        
          <code class="c1">// Join the words back into a single string</code>
          <code class="k">return</code> <code class="nx">processedWordArray</code><code class="p">.</code><code class="nx">join</code><code class="p">(</code><code class="s1">' '</code><code class="p">);</code>
        <code class="p">}</code></pre>
        
        <p>Here, steps 1, 2, and 3 apply, but step 4 does not. You must keep the braces and <code>return</code> statement intact.</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">myFunc</code> <code class="o">=</code> <code class="nx">inputString</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="c1">// Split the string into an array of words</code>
          <code class="kr">const</code> <code class="nx">wordArray</code> <code class="o">=</code> <code class="nx">inputString</code><code class="p">.</code><code class="nx">split</code><code class="p">(</code><code class="s1">' '</code><code class="p">);</code>
        
          <code class="c1">// Create a new array that will hold the processed words</code>
          <code class="kr">const</code> <code class="nx">processedWordArray</code> <code class="o">=</code> <code class="p">[];</code>
        
          <code class="k">for</code> <code class="p">(</code><code class="kr">const</code> <code class="nx">word</code> <code class="k">of</code> <code class="nx">wordArray</code><code class="p">)</code> <code class="p">{</code>
            <code class="c1">// Capitalize the first letter of this word</code>
            <code class="nx">processedWordArray</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="nx">word</code><code class="p">[</code><code class="mi">0</code><code class="p">].</code><code class="nx">toUpperCase</code><code class="p">()</code> <code class="o">+</code> <code class="nx">word</code><code class="p">.</code><code class="nx">slice</code><code class="p">(</code><code class="mi">1</code><code class="p">));</code>
          <code class="p">}</code>
        
          <code class="c1">// Join the words back into a single string</code>
          <code class="k">return</code> <code class="nx">processedWordArray</code><code class="p">.</code><code class="nx">join</code><code class="p">(</code><code class="s1">' '</code><code class="p">);</code>
        <code class="p">}</code></pre>
        
        <p>Now the difference between the traditional approach and the arrow syntax is much smaller. Only the function declaration at the beginning has changed, and the overall code savings is minimal.</p>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>Here’s where the decisions around arrow syntax become murkier. It’s often possible to compress a function with several statements into a single expression. In the string processing example, you could use method chaining (as in <a data-type="xref" href="ch02.html#replacing_all_occurrences_string">“Replacing All Occurrences of a String”</a>) and the <code>Array.map()</code> function (<a data-type="xref" href="ch05.html#mapping_array">“Transforming Every Element of an Array”</a>) instead of a <code>for</code> loop. Applied aggressively, these changes can shorten <code>applyTitleCase()</code> down to one long statement. You could then use all the arrow syntax shortcuts. However, in this case the goal of more concise code isn’t worth the tradeoff in clarity. As a general rule of thumb, arrow syntax is a benefit only when it helps you write more readable code.</p>
        </div>
        
        <p>Arrow functions have a different way of binding the <code>this</code> keyword. In a declared function, <code>this</code> maps to the object that calls the function, which could be the current window, a button, and so on. In an arrow function, <code>this</code> simply refers to the code where the arrow function is defined. (In other words, whatever <code>this</code> is where you create your arrow function remains <code>this</code> when the function runs.) This behavior simplifies many issues, but at a cost. It means that arrow syntax isn’t suitable for object methods and constructors, because arrow functions won’t be bound to the object on which they’re called. Even using <code>Function.bind()</code> won’t change this behavior.</p>
        
        <p><a data-type="indexterm" data-primary="arguments object" id="idm45475167867736"></a>There are a few smaller restrictions as well. Arrow functions can’t be used with <code>yield</code> to make a generator function, and don’t support the <code>arguments</code> object.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45475168179624">
        <h2>See Also</h2>
        
        <p><a data-type="xref" href="ch05.html#arrays">Chapter&nbsp;5</a> has numerous examples that use arrow syntax to pass short functions to array-processing methods. See, for instance, Recipes <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch05.html#copying_items_by_criteria"></a>, <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch05.html#searching_array_test_function"></a>, and <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch05.html#sorting_array"></a>.<a data-type="indexterm" data-primary="" data-startref="ix_function_arrow" id="idm45475167860568"></a><a data-type="indexterm" data-primary="" data-startref="ix_arrow_syntax" id="idm45475167859560"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Providing a Default Parameter Value"><div class="sect1" id="provide_default_parameter">
        <h1>Providing a Default Parameter Value</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475167856968">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="functions" data-secondary="default parameters" id="idm45475167855768"></a><a data-type="indexterm" data-primary="default parameters" id="idm45475167854792"></a><a data-type="indexterm" data-primary="parameters" data-secondary="default" id="idm45475167854120"></a>You want to specify a default value for a parameter, which will be used if the caller doesn’t pass in an argument when calling the function.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475167852632">
        <h2>Solution</h2>
        
        <p>You can directly assign default values to your parameters when you declare a function. Here’s an example that sets a default value for the third parameter, <code>thirdNum</code>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">addNumbers</code><code class="p">(</code><code class="nx">firstNum</code><code class="p">,</code> <code class="nx">secondNum</code><code class="p">,</code> <code class="nx">thirdNum</code><code class="o">=</code><code class="mi">0</code><code class="p">)</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">firstNum</code><code class="o">+</code><code class="nx">secondNum</code><code class="o">+</code><code class="nx">thirdNum</code><code class="p">;</code>
        <code class="p">}</code></pre>
        
        <p>Now it’s possible to call this function without specifying all three parameters:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">addNumbers</code><code class="p">(</code><code class="mi">42</code><code class="p">,</code> <code class="mi">6</code><code class="p">,</code> <code class="mi">10</code><code class="p">));</code>  <code class="c1">// displays 58</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">addNumbers</code><code class="p">(</code><code class="mi">42</code><code class="p">,</code> <code class="mi">6</code><code class="p">));</code>      <code class="c1">// displays 48</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475167777048">
        <h2>Discussion</h2>
        
        <p>Default parameters are a relatively recent invention. However, JavaScript has never forced function callers to supply all the parameters for a function. In this distant past, functions could simply check if a parameter was <code>undefined</code> (by testing it with the <code>typeof</code> operator, as described in <a data-type="xref" href="ch07.html#check_object_type">“Checking if an Object Is a Certain Type”</a>).</p>
        
        <p>You can set default values for as many parameters as you want. As a matter of good style, you should put your required parameters first, followed by parameters that have default values. In other words, once you add a default parameter, all the parameters <em>after</em> should also become optional and have default values. This convention isn’t required, but it makes code clearer.</p>
        
        <p>When calling a function that has multiple default parameters, you can pick and choose which values you supply. Consider this example:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">addNumbers</code><code class="p">(</code><code class="nx">firstNum</code><code class="o">=</code><code class="mi">10</code><code class="p">,</code> <code class="nx">secondNum</code><code class="o">=</code><code class="mi">20</code><code class="p">,</code> <code class="nx">thirdNum</code><code class="o">=</code><code class="mi">30</code><code class="p">,</code> <code class="nx">multiplier</code><code class="o">=</code><code class="mi">1</code><code class="p">)</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">multiplier</code><code class="o">*</code><code class="p">(</code><code class="nx">firstNum</code><code class="o">+</code><code class="nx">secondNum</code><code class="o">+</code><code class="nx">thirdNum</code><code class="p">);</code>
        <code class="p">}</code></pre>
        
        <p>If you want to specify <code>firstNum</code>, <code>secondNum</code>, and <code>multiplier</code>, but omit the <code>thirdNum</code> parameter, you need to use <code>undefined</code> as a placeholder. This allows you to pass all your parameters in the proper order:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">sum</code> <code class="o">=</code> <code class="nx">addNumbers</code><code class="p">(</code><code class="mi">42</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="kc">undefined</code><code class="p">,</code> <code class="mi">1</code><code class="p">);</code>
        <code class="c1">// sum = 82</code></pre>
        
        <p>But <code>null</code> won’t work as a placeholder. In this example, it’s simply converted to the number 0, changing the result:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">sum</code> <code class="o">=</code> <code class="nx">addNumbers</code><code class="p">(</code><code class="mi">42</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="kc">null</code><code class="p">,</code> <code class="mi">1</code><code class="p">);</code>
        <code class="c1">// sum = 52</code></pre>
        
        <p>Many other languages have nicer shortcuts for default parameters (such as using commas to indicate order without needing to supply a placeholder value, or setting parameter values by name). JavaScript does not, although you can simulate named parameters using object literal syntax (<a data-type="xref" href="#named_parameters">“Using Named Function Parameters”</a>).</p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Creating a Function That Accepts Unlimited Arguments"><div class="sect1" id="creating_function_unlimted_arguments">
        <h1>Creating a Function That Accepts Unlimited Arguments</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475167627320">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="functions" data-secondary="accepting unlimited arguments" id="ix_function_unlimited_arg"></a>You want to create a function that accepts as many arguments as the caller wants to supply, without requiring the creation of an array.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475167600152">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="parameters" data-secondary="rest" id="idm45475167598984"></a><a data-type="indexterm" data-primary="rest parameter" id="idm45475167598008"></a>Use a <em>rest parameter</em> when you declare your function. The rest parameter is defined with three dots before its name:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">sumRounds</code><code class="p">(...</code><code class="nx">numbers</code><code class="p">)</code> <code class="p">{</code>
          <code class="kd">let</code> <code class="nx">sum</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>
          <code class="k">for</code><code class="p">(</code><code class="kd">let</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">numbers</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">i</code><code class="o">+=</code><code class="mi">1</code><code class="p">)</code>  <code class="p">{</code>
            <code class="nx">sum</code> <code class="o">+=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">round</code><code class="p">(</code><code class="nx">numbers</code><code class="p">[</code><code class="nx">i</code><code class="p">]);</code>
          <code class="p">}</code>
          <code class="k">return</code> <code class="nx">sum</code><code class="p">;</code>
        <code class="p">}</code>
        
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">sumRounds</code><code class="p">(</code><code class="mf">2.3</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">5</code><code class="p">,</code> <code class="mi">16</code><code class="p">,</code> <code class="mf">18.1</code><code class="p">));</code>  <code class="c1">// 45</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475167595304">
        <h2>Discussion</h2>
        
        <p>The rest parameter does not need to be the only parameter, but it must be the last parameter. It collects all the extra arguments that are passed to the function and adds them to a new array.</p>
        
        <p><a data-type="indexterm" data-primary="arguments object" id="idm45475167514600"></a>In the past, JavaScript developers used the <code>arguments</code> object for similar functionality. The <code>arguments</code> object is available in every function (technically, it’s the <code>Function.arguments</code> property), and it provides array-like access to all the parameters. However, <code>arguments</code> is not a true array, and developers often used boilerplate code to transform it into one. You may still see this approach in the wild, but today rest parameters avoid this hassle.</p>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>The rest parameter looks the same as the spread operator (<a data-type="xref" href="ch05.html#destructuring_arrays">“Breaking Down an Array into Separate Variables”</a>), but the two play complementary roles. The spread operator <em>expands</em> an array or the properties of an object into separate values, whereas the rest operator collects separate values and inserts them into a single array object.</p>
        </div>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45475167509096">
        <h2>See Also</h2>
        
        <p>If you have an array of values that you want to pass into a function, but the function expects a rest parameter, you can make the conversion using the spread operator (see <a data-type="xref" href="ch05.html#destructuring_arrays">“Breaking Down an Array into Separate Variables”</a>).</p>
        
        <p>This example uses a loop to process the array of values, but you could achieve the same result more cleanly with the <code>Array.reduce()</code> function, as demonstrated in <a data-type="xref" href="ch05.html#reducing_array">“Combining an Array’s Values in a Single Calculation”</a>.<a data-type="indexterm" data-primary="" data-startref="ix_function_unlimited_arg" id="idm45475167504952"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Using Named Function Parameters"><div class="sect1" id="named_parameters">
        <h1>Using Named Function Parameters</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475167502392">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="named functions" id="ix_named_function"></a><a data-type="indexterm" data-primary="parameters" data-secondary="named function" id="ix_param_name_func"></a><a data-type="indexterm" data-primary="functions" data-secondary="named" id="ix_function_named"></a>You want an easier way to choose the optional parameters you send to a function.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475167497400">
        <h2>Solution</h2>
        
        <p>Bundle all the optional parameters into a single object literal (<a data-type="xref" href="ch07.html#object_literal">“Using an Object Literal to Bundle Data”</a>). <a data-type="indexterm" data-primary="objects (Object type)" data-secondary="literal" id="ix_object_literal4"></a><a data-type="indexterm" data-primary="object literal" id="ix_object_literal1"></a><a data-type="indexterm" data-primary="functions" data-secondary="literals in" id="ix_function_literal"></a><a data-type="indexterm" data-primary="literal functions" id="ix_literal_func"></a>The caller can then decide what optional parameters to include when they create the object literal. Here’s an example of how you call a function that uses this pattern:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">someFunction</code><code class="p">(</code><code class="nx">arg1</code><code class="p">,</code> <code class="nx">arg2</code><code class="p">,</code> <code class="p">{</code><code class="nx">optionalArg1</code><code class="o">:</code> <code class="nx">val1</code><code class="p">,</code> <code class="nx">optionalArg2</code><code class="o">:</code> <code class="nx">val2</code><code class="p">});</code></pre>
        
        <p><a data-type="indexterm" data-primary="destructuring assignment" id="ix_destructure2"></a><a data-type="indexterm" data-primary="code" data-secondary="simplifying with destructuring assignment" id="ix_destructure"></a>In your function, you can use <em>destructuring assignment</em> to quickly copy the values out of the object literal and into separate variables. Here’s an example of a function that accepts three arguments. The first two (<code>newerDate</code> and <code>olderDate</code>) are required, but the third parameter is an object literal that can hold three optional values (<code>discardTime</code>, <code>discardYears</code>, and <code>precision</code>):</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">dateDifferenceInSeconds</code><code class="p">(</code>
         <code class="nx">newerDate</code><code class="p">,</code> <code class="nx">olderDate</code><code class="p">,</code> <code class="p">{</code><code class="nx">discardTime</code><code class="p">,</code> <code class="nx">discardYears</code><code class="p">,</code> <code class="nx">precision</code><code class="p">}</code> <code class="o">=</code> <code class="p">{})</code> <code class="p">{</code>
          <code class="k">if</code> <code class="p">(</code><code class="nx">discardTime</code><code class="p">)</code> <code class="p">{</code>
            <code class="nx">newerDate</code> <code class="o">=</code> <code class="nx">newerDate</code><code class="p">.</code><code class="nx">setHours</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">0</code><code class="p">,</code><code class="mi">0</code><code class="p">,</code><code class="mi">0</code><code class="p">);</code>
            <code class="nx">olderDate</code> <code class="o">=</code> <code class="nx">newerDate</code><code class="p">.</code><code class="nx">setHours</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">0</code><code class="p">,</code><code class="mi">0</code><code class="p">,</code><code class="mi">0</code><code class="p">);</code>
          <code class="p">}</code>
          <code class="k">if</code> <code class="p">(</code><code class="nx">discardYears</code><code class="p">)</code> <code class="p">{</code>
            <code class="nx">newerDate</code><code class="p">.</code><code class="nx">setYear</code><code class="p">(</code><code class="mi">0</code><code class="p">);</code>
            <code class="nx">olderDate</code><code class="p">.</code><code class="nx">setYear</code><code class="p">(</code><code class="mi">0</code><code class="p">);</code>
          <code class="p">}</code>
        
          <code class="kr">const</code> <code class="nx">differenceInSeconds</code> <code class="o">=</code> <code class="p">(</code><code class="nx">newerDate</code><code class="p">.</code><code class="nx">getTime</code><code class="p">()</code> <code class="o">-</code> <code class="nx">olderDate</code><code class="p">.</code><code class="nx">getTime</code><code class="p">())</code><code class="o">/</code><code class="mi">1000</code><code class="p">;</code>
          <code class="k">return</code> <code class="nx">differenceInSeconds</code><code class="p">.</code><code class="nx">toFixed</code><code class="p">(</code><code class="nx">precision</code><code class="p">);</code>
        <code class="p">}</code></pre>
        
        <p>You can call <code>dateDifferenceInSeconds()</code> with or without the object literal:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="c1">// Compare the current date to an older date</code>
        <code class="kr">const</code> <code class="nx">newDate</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">();</code>
        <code class="kr">const</code> <code class="nx">oldDate</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">(</code><code class="mi">2010</code><code class="p">,</code> <code class="mi">1</code><code class="p">,</code> <code class="mi">10</code><code class="p">);</code>
        
        <code class="c1">// Call the function without an object literal</code>
        <code class="kd">let</code> <code class="nx">difference</code> <code class="o">=</code> <code class="nx">dateDifferenceInSeconds</code><code class="p">(</code><code class="nx">newDate</code><code class="p">,</code> <code class="nx">oldDate</code><code class="p">);</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">difference</code><code class="p">);</code>   <code class="c1">// Shows something like 354378086</code>
        
        <code class="c1">// Call the function with an object literal, and specify two properties</code>
        <code class="nx">difference</code> <code class="o">=</code> <code class="nx">dateDifferenceInSeconds</code><code class="p">(</code>
         <code class="nx">newDate</code><code class="p">,</code> <code class="nx">oldDate</code><code class="p">,</code> <code class="p">{</code><code class="nx">discardYears</code><code class="o">:</code><code class="kc">true</code><code class="p">,</code> <code class="nx">precision</code><code class="o">:</code><code class="mi">2</code><code class="p">});</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">difference</code><code class="p">);</code>   <code class="c1">// Shows something like 7226485.90</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475167294328">
        <h2>Discussion</h2>
        
        <p>A common pattern in JavaScript is to use an object literal to transmit optional values. This lets you set only the properties you need, without worrying about the order.</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="c1">// This works</code>
        <code class="nx">dateDifferenceInSeconds</code><code class="p">(</code><code class="nx">newDate</code><code class="p">,</code> <code class="nx">oldDate</code><code class="p">,</code> <code class="p">{</code><code class="nx">precision</code><code class="o">:</code><code class="mi">2</code><code class="p">});</code>
        
        <code class="c1">// This also works</code>
        <code class="nx">dateDifferenceInSeconds</code><code class="p">(</code><code class="nx">newDate</code><code class="p">,</code> <code class="nx">oldDate</code><code class="p">,</code> <code class="p">{</code><code class="nx">discardYears</code><code class="o">:</code><code class="kc">true</code><code class="p">,</code> <code class="nx">precision</code><code class="o">:</code><code class="mi">2</code><code class="p">});</code>
        
        <code class="c1">// This works too</code>
        <code class="nx">dateDifferenceInSeconds</code><code class="p">(</code><code class="nx">newDate</code><code class="p">,</code> <code class="nx">oldDate</code><code class="p">,</code> <code class="p">{</code><code class="nx">precision</code><code class="o">:</code><code class="mi">2</code><code class="p">,</code> <code class="nx">discardYears</code><code class="o">:</code><code class="kc">true</code><code class="p">});</code></pre>
        
        <p>In the function, you can retrieve properties from the object literal individually, like this:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">dateDifferenceInSeconds</code><code class="p">(</code><code class="nx">newerDate</code><code class="p">,</code> <code class="nx">olderDate</code><code class="p">,</code> <code class="nx">options</code><code class="p">)</code> <code class="p">{</code>
          <code class="kr">const</code> <code class="nx">precision</code> <code class="o">=</code> <code class="nx">options</code><code class="p">.</code><code class="nx">precision</code><code class="p">;</code></pre>
        
        <p>But this solution in this recipe uses a better shortcut. It unpacks the object literal into named variables using destructuring, which maps the properties of an object to individual, named variables. You can use destructuring assignment in a statement:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">dateDifferenceInSeconds</code><code class="p">(</code><code class="nx">newerDate</code><code class="p">,</code> <code class="nx">olderDate</code><code class="p">,</code> <code class="nx">options</code><code class="p">)</code> <code class="p">{</code>
          <code class="kr">const</code> <code class="p">{</code><code class="nx">discardTime</code><code class="p">,</code> <code class="nx">discardYears</code><code class="p">,</code> <code class="nx">precision</code><code class="p">}</code> <code class="o">=</code> <code class="nx">options</code><code class="p">;</code></pre>
        
        <p>or right in the function declaration:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">dateDifferenceInSeconds</code><code class="p">(</code>
         <code class="nx">newerDate</code><code class="p">,</code> <code class="nx">olderDate</code><code class="p">,</code> <code class="p">{</code><code class="nx">discardTime</code><code class="p">,</code> <code class="nx">discardYears</code><code class="p">,</code> <code class="nx">precision</code><code class="p">})</code></pre>
        
        <p>It’s a good practice to set an empty object literal as a default value (<a data-type="xref" href="#provide_default_parameter">“Providing a Default Parameter Value”</a>). This empty object is used if the caller doesn’t supply the object literal:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code><code> </code><code class="nx">dateDifferenceInSeconds</code><code class="p">(</code><code>
         </code><code class="nx">newerDate</code><code class="p">,</code><code> </code><code class="nx">olderDate</code><code class="p">,</code><code> </code><code class="p">{</code><code class="nx">discardTime</code><code class="p">,</code><code> </code><code class="nx">discardYears</code><code class="p">,</code><code> </code><code class="nx">precision</code><code class="p">}</code><code> </code><strong><code class="o">=</code><code> </code><code class="p">{</code><code class="p">}</code></strong><code class="p">)</code></pre>
        
        <p>It’s up to the caller whether they decide to set some, all, or none of the properties in the object literal. Any values that aren’t set will evaluate to the special value <code>undefined</code>, which you can test for in your code. Here’s a less-optimized example:</p>
        
        <pre data-type="programlisting" data-code-language="javascript">  <code class="k">if</code> <code class="p">(</code><code class="nx">discardTime</code> <code class="o">!=</code> <code class="kc">undefined</code> <code class="o">||</code> <code class="nx">discardTime</code> <code class="o">===</code> <code class="kc">true</code><code class="p">)</code> <code class="p">{</code></pre>
        
        <p>Often, you won’t need to explicitly check for <code>undefined</code> values. For example, <code>undefined</code> evaluates to <code>false</code> in conditional logic. The <code>dateDifferenceInSeconds()</code> function uses the behavior when it evaluates the <code>discardYears</code> and <code>discardTime</code> properties, allowing us to shorten the code:</p>
        
        <pre data-type="programlisting" data-code-language="javascript">  <code class="k">if</code> <code class="p">(</code><code class="nx">discardTime</code><code class="p">)</code> <code class="p">{</code></pre>
        
        <p>There’s a similar shortcut with the <code>precision</code> property. It’s safe to call <code>Number.toPrecision(undefined)</code>, because that’s the same as calling <code>toPrecision()</code> with no argument. Either way, the number is rounded to the nearest whole integer.</p>
        
        <p>The only disadvantage to the object literal pattern is that there’s no way to prevent property-naming mistakes, like this one:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="c1">// We want discardYears, but we accidentally set discardYear</code>
        <code class="nx">dateDifferenceInSeconds</code><code class="p">(</code><code class="nx">newDate</code><code class="p">,</code> <code class="nx">oldDate</code><code class="p">,</code> <code class="p">{</code><code class="nx">discardYear</code><code class="o">:</code><code class="kc">true</code><code class="p">});</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45475167293864">
        <h2>See Also</h2>
        
        <p><a data-type="xref" href="ch07.html#object_literal">“Using an Object Literal to Bundle Data”</a> introduces object literals. <a data-type="xref" href="ch05.html#destructuring_arrays">“Breaking Down an Array into Separate Variables”</a> shows the array destructuring syntax, which is similar to the object destructuring syntax used in this recipe, except it acts on arrays instead of objects (and uses square brackets instead of curly braces).<a data-type="indexterm" data-primary="" data-startref="ix_function_named" id="idm45475166870536"></a><a data-type="indexterm" data-primary="" data-startref="ix_named_function" id="idm45475166869704"></a><a data-type="indexterm" data-primary="" data-startref="ix_param_name_func" id="idm45475166868760"></a><a data-type="indexterm" data-primary="" data-startref="ix_function_literal" id="idm45475166867816"></a><a data-type="indexterm" data-primary="" data-startref="ix_object_literal1" id="idm45475166866872"></a><a data-type="indexterm" data-primary="" data-startref="ix_object_literal4" id="idm45475166865928"></a><a data-type="indexterm" data-primary="" data-startref="ix_literal_func" id="idm45475166864984"></a><a data-type="indexterm" data-primary="" data-startref="ix_destructure" id="idm45475166864040"></a><a data-type="indexterm" data-primary="" data-startref="ix_destructure2" id="idm45475166845240"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Creating a Function That Stores its State with a Closure"><div class="sect1" id="create_a_function_that_remembers_its_sta">
        <h1>Creating a Function That Stores its State <span class="keep-together">with a Closure</span></h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475166842088">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="state, functions storing with closure" id="ix_state_func_closure"></a><a data-type="indexterm" data-primary="closures" id="ix_closures"></a><a data-type="indexterm" data-primary="functions" data-secondary="storing state with closure" id="ix_function_store_closure"></a>You want to create a function that can remember data, but without having to use global variables and without repeatedly sending the same data with each function call.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475166837288">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="functions" data-secondary="inner and outer" id="ix_function_inner-outer"></a>Wrap the function that needs to preserve its state in <em>another</em> function. The outer function returns the inner function, following this structure:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">outerFunction</code><code class="p">()</code> <code class="p">{</code>
        
          <code class="kd">function</code> <code class="nx">innerFunction</code><code class="p">()</code> <code class="p">{</code>
            <code class="p">...</code>
          <code class="p">}</code>
        
          <code class="k">return</code> <code class="nx">innerFunction</code><code class="p">;</code>
        <code class="p">}</code></pre>
        
        <p><a data-type="indexterm" data-primary="data" data-secondary="persistence of" id="idm45475166832456"></a>Both of these functions can accept parameters. But here’s the trick. The outer function’s parameters live as long as you have a reference to the inner function. You can call the inner function as many times as you want, and the data from the outer function persists. (Conceptually, it’s as though the outer function is an object-creation method, and the inner function is an object with state.)</p>
        
        <p>Here’s a complete example:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">greetingMaker</code><code class="p">(</code><code class="nx">greeting</code><code class="p">)</code> <code class="p">{</code>
          <code class="kd">function</code> <code class="nx">addName</code><code class="p">(</code><code class="nx">name</code><code class="p">)</code> <code class="p">{</code>
            <code class="k">return</code> <code class="sb">`</code><code class="si">${</code><code class="nx">greeting</code><code class="si">}</code><code class="sb"> </code><code class="si">${</code><code class="nx">name</code><code class="si">}</code><code class="sb">`</code><code class="p">;</code>
          <code class="p">}</code>
          <code class="k">return</code> <code class="nx">addName</code><code class="p">;</code>
        <code class="p">}</code>
        
        <code class="c1">// Use the outer function to create two copies of the inner function,</code>
        <code class="c1">// each with a different value for greeting</code>
        <code class="kr">const</code> <code class="nx">daytimeGreeting</code> <code class="o">=</code> <code class="nx">greetingMaker</code><code class="p">(</code><code class="s1">'Good Day to you'</code><code class="p">);</code>
        <code class="kr">const</code> <code class="nx">nightGreeting</code> <code class="o">=</code> <code class="nx">greetingMaker</code><code class="p">(</code><code class="s1">'Good Evening'</code><code class="p">);</code>
        
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">daytimeGreeting</code><code class="p">(</code><code class="s1">'Peter'</code><code class="p">));</code>   <code class="c1">// Shows 'Good Day to you Peter'</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">nightGreeting</code><code class="p">(</code><code class="s1">'Sally'</code><code class="p">));</code>     <code class="c1">// Shows 'Good Evening Sally'</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475166791064">
        <h2>Discussion</h2>
        
        <p><a data-type="indexterm" data-primary="global variables" id="idm45475166685848"></a><a data-type="indexterm" data-primary="variables" data-secondary="global" id="idm45475166685144"></a>Often, you’ll find that you need a way to store data that’s used across several function calls. You could use global variables, but that’s a technique of last resort. Global <span class="keep-together">variables</span> lead to naming collisions, complicate code, and often lead to hidden interdependencies between different functions, limiting the reuse of your code and giving cover for subtle coding bugs to hide.</p>
        
        <p>You could ask the function caller to maintain this information, and send it with each function call, but this can also be awkward. This example shows a different solution—creating a stateful function package called a <em>closure</em>.</p>
        
        <p>In this solution, the outer function <code>greetingMaker()</code> takes one argument, which is a specific greeting. It also returns an inner function, <code>addName()</code>, which itself takes the person’s name. The closure encompasses the <code>addName()</code> function and its surrounding context, which includes the parameter that was passed to the <code>greetingMaker()</code> function. To demonstrate this fact, two copies of <code>addName()</code> are created, in two different contexts. One exists in a closure where a daytime message was passed to <code>greetingMaker()</code>, and the other exists in a closure where a nighttime message was passed to <code>greetingMaker()</code>. Either way, when the <code>addName()</code> function is called, it uses the current context to construct its message.</p>
        
        <p>It’s worth noting that state isn’t limited to parameter values. Any variables that are in the outer function also stay alive as long as the function reference exists. Here’s an example that uses a simple counter variable to keep track of how many function calls you’ve made:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">createCounter</code><code class="p">()</code> <code class="p">{</code>
          <code class="c1">// This variable persists as long as the createCounter function reference</code>
          <code class="kd">let</code> <code class="nx">count</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>
        
          <code class="kd">function</code> <code class="nx">counter</code><code class="p">()</code> <code class="p">{</code>
            <code class="nx">count</code> <code class="o">+=</code> <code class="mi">1</code><code class="p">;</code>
            <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">count</code><code class="p">);</code>
          <code class="p">}</code>
          <code class="k">return</code> <code class="nx">counter</code><code class="p">;</code>
        <code class="p">}</code>
        
        <code class="kr">const</code> <code class="nx">counterFunction</code> <code class="o">=</code> <code class="nx">createCounter</code><code class="p">();</code>
        <code class="nx">counterFunction</code><code class="p">();</code>  <code class="c1">// displays 1</code>
        <code class="nx">counterFunction</code><code class="p">();</code>  <code class="c1">// displays 2</code>
        <code class="nx">counterFunction</code><code class="p">();</code>  <code class="c1">// displays 3</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45475166600248">
        <h2>See Also</h2>
        
        <p>To see an another example of a function that uses a closure to store state, see <a data-type="xref" href="#repeatable_PRNG">“Extra: Building a Repeatable Pseudorandom Number Generator”</a>.</p>
        
        <p>It’s not an accident that closures and wrapped functions seem to echo object-oriented programming. In the past, JavaScript developers used functions to mimic custom classes (see <a data-type="xref" href="ch08.html#constructor_pattern">“Using the Constructor Pattern to Make a Custom Class”</a>), and JavaScript’s <code>class</code> keyword extends this approach (see <a data-type="xref" href="ch08.html#using_es6_classes">“Creating a Reusable Class”</a>).<a data-type="indexterm" data-primary="" data-startref="ix_function_store_closure" id="idm45475166629000"></a><a data-type="indexterm" data-primary="" data-startref="ix_state_func_closure" id="idm45475166628056"></a><a data-type="indexterm" data-primary="" data-startref="ix_closures" id="idm45475166627112"></a><a data-type="indexterm" data-primary="" data-startref="ix_function_inner-outer" id="idm45475166626168"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Creating a Generator Function That Yields Multiple Values"><div class="sect1" id="creating_generator_functions">
        <h1>Creating a Generator Function That Yields <span class="keep-together">Multiple Values</span></h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475166594152">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="generator function" id="ix_generator_func1"></a><a data-type="indexterm" data-primary="functions" data-secondary="generator function" id="ix_function_generator"></a>You want to create a <em>generator</em>, a function that can provide multiple values on-demand. Each time a generator returns a value, it pauses its execution until the caller requests the next value.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475166589784">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="function keyword" id="idm45475166588344"></a>To declare a generator function, start by replacing the <code>function</code> keyword with <span class="keep-together"><code>function*</code></span>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code><code class="o">*</code> <code class="nx">generateValues</code><code class="p">()</code> <code class="p">{</code>
        <code class="p">}</code></pre>
        
        <p>Inside the generator function, use the <code>yield</code> keyword each time you want to return a result. Remember, execution stops after you yield (much like when you use the <code>return</code> keyword). However, execution <em>resumes</em> when the caller asks for the function’s next value. This process continues until your function code ends, or you return a final value with the <code>return</code> keyword.</p>
        
        <p>Here is a naïve implementation of a generator. (It works, but it doesn’t solve a useful problem.) This function yields three values, followed by a return value:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code><code class="o">*</code> <code class="nx">generateValues</code><code class="p">()</code> <code class="p">{</code>
          <code class="k">yield</code> <code class="mi">895498</code><code class="p">;</code>
          <code class="k">yield</code> <code class="s1">'This is the second value'</code><code class="p">;</code>
          <code class="k">yield</code> <code class="mi">5</code><code class="p">;</code>
          <code class="k">return</code> <code class="s1">'This is the end'</code><code class="p">;</code>
        <code class="p">}</code></pre>
        
        <p><a data-type="indexterm" data-primary="Generator object" id="idm45475166540152"></a>When you call a generator function, you receive a <code>Generator</code> object as a return value. This happens immediately, before the generator function code begins to run. You use the <code>Generator</code> object to run the function and retrieve the values that are yielded. You can also use it to determine when the generator function is finished.</p>
        
        <p><a data-type="indexterm" data-primary="yield keyword" id="idm45475166563704"></a>Each time you call <code>Generator.next()</code>, the generator function runs until it reaches the next <code>yield</code> (or the final <code>return</code>). <a data-type="indexterm" data-primary="next() method" id="idm45475166561432"></a>The <code>next()</code> method returns an object with two values. The <code>value</code> property wraps the yielded or returned value from the generator function. The <code>done</code> property is a Boolean that remains <code>false</code> until the generator function has ended.</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">generator</code> <code class="o">=</code> <code class="nx">generateValues</code><code class="p">();</code>
        
        <code class="c1">// Start the generator (it runs from the beginning to the first yield)</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">generator</code><code class="p">.</code><code class="nx">next</code><code class="p">().</code><code class="nx">value</code><code class="p">);</code>  <code class="c1">// 895498</code>
        
        <code class="c1">// Resume the generator (until the next yield)</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">generator</code><code class="p">.</code><code class="nx">next</code><code class="p">().</code><code class="nx">value</code><code class="p">);</code>  <code class="c1">// 'This is the second value'</code>
        
        <code class="c1">// Get the final two values</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">generator</code><code class="p">.</code><code class="nx">next</code><code class="p">().</code><code class="nx">value</code><code class="p">);</code>  <code class="c1">// 5</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">generator</code><code class="p">.</code><code class="nx">next</code><code class="p">().</code><code class="nx">value</code><code class="p">);</code>  <code class="c1">// 'This is the end'</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475166513816">
        <h2>Discussion</h2>
        
        <p>Generators allow you to create functions that can be paused and resumed. Best of all, JavaScript manages their state automatically, which means you don’t need to write any code to preserve values in-between calls to <code>next()</code>. (This is different than building a custom iterator, for example.)</p>
        
        <p>Because generators have a lazy-execution model, they’re a good choice for time-consuming data creation or retrieval operations. For example, you could use a generator to calculate numbers in a complex sequence, to retrieve chunks of information from a stream of data.</p>
        
        <p>Usually, you won’t know how many values a generator will return. <a data-type="indexterm" data-primary="while loop" id="idm45475166427240"></a>You could write a <code>while</code> loop that checks the <code>Generator.done</code> property and keeps calling <code>next()</code> until it’s finished. <a data-type="indexterm" data-primary="for…of loop" id="idm45475166425240"></a>But because the generator object is iterable, a <code>for</code>…<code>of</code> loop works even better:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="c1">// Get all the values from the generator</code>
        <code class="k">for</code> <code class="p">(</code><code class="kr">const</code> <code class="nx">value</code> <code class="k">of</code> <code class="nx">generateValues</code><code class="p">())</code> <code class="p">{</code>
          <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">value</code><code class="p">);</code>
        <code class="p">}</code>
        
        <code class="c1">// With spread syntax, you can dump everything into an array in one step</code>
        <code class="kr">const</code> <code class="nx">values</code> <code class="o">=</code> <code class="p">[...</code><code class="nx">generateValues</code><code class="p">()];</code></pre>
        
        <p>Either way, this approach only gets <em>yielded</em> results. If your generator has a final return value, it’s ignored.</p>
        
        <p>Some generator functions are designed to be <em>infinite</em>. As long as you keep calling <code>next()</code>, they keep yielding values. If you’re calling an infinite generator, you can’t dump all its values into an array (your program will hang). Instead, you’ll probably use a <code>while</code> loop with a condition that turns <code>false</code> when you have all the values you need.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45475166398376">
        <h2>See Also</h2>
        
        <p><a data-type="xref" href="ch09.html#async_generator">“Creating an Asynchronous Generator Function”</a> shows how to create generators that run asynchronously.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Extra: Building a Repeatable Pseudorandom Number Generator"><div class="sect2" id="repeatable_PRNG">
        <h2>Extra: Building a Repeatable Pseudorandom Number Generator</h2>
        
        <p><a data-type="indexterm" data-primary="pseudorandom number generator" id="ix_pseudo_num_gen"></a><a data-type="indexterm" data-primary="numbers" data-secondary="pseudorandom generator" id="ix_numbers_pseudo"></a>Although you’ve dissected the essential syntax for generator functions, you haven’t seen a truly practical example. Here’s one that shows how an infinite generator function can provide a useful sequence of values.</p>
        
        <p><a data-type="indexterm" data-primary="seed value, pseudorandom number generator" id="idm45475166391448"></a>As explained in <a data-type="xref" href="ch03.html#generating_random_numbers">“Generating Random Numbers”</a>, the <code>Math.random()</code> method lets you generate pseudorandom numbers, but you can’t control the <em>seed value</em>. (Instead, <code>Math.random()</code> seeds its pseudorandom number generator using a opaque, noncryptographically secure method that may vary from one JavaScript implementation to the next.) This is fine for most applications. But in some scenarios you need a way to generate a <em>repeatable</em> sequence of random-seeming numbers. The numbers still need to be statistically random in their distribution; the only difference is that you need to be able to ask your pseudorandom number generator to give you same sequence more than once. Examples where repeatable pseudorandom numbers are important include certain types of simulations or tests that need to be precisely reproducible.</p>
        
        <p>There are several third-party JavaScript libraries that provide seedable (and thus repeatable) pseudorandom number generators. You can find a long list at <a href="https://github.com/bryc/code/blob/master/jshash/PRNGs.md">GitHub</a>. One of the simplest is Mulberry32. Its JavaScript implementation fits in a single dense block of code:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">mulberry32</code><code class="p">(</code><code class="nx">seed</code><code class="p">)</code> <code class="p">{</code>
          <code class="k">return</code> <code class="kd">function</code> <code class="nx">random</code><code class="p">()</code> <code class="p">{</code>
            <code class="kd">let</code> <code class="nx">t</code> <code class="o">=</code> <code class="nx">seed</code> <code class="o">+=</code> <code class="mh">0x6D2B79F5</code><code class="p">;</code>
            <code class="nx">t</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">imul</code><code class="p">(</code><code class="nx">t</code> <code class="o">^</code> <code class="nx">t</code> <code class="o">&gt;&gt;&gt;</code> <code class="mi">15</code><code class="p">,</code> <code class="nx">t</code> <code class="o">|</code> <code class="mi">1</code><code class="p">);</code>
            <code class="nx">t</code> <code class="o">^=</code> <code class="nx">t</code> <code class="o">+</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">imul</code><code class="p">(</code><code class="nx">t</code> <code class="o">^</code> <code class="nx">t</code> <code class="o">&gt;&gt;&gt;</code> <code class="mi">7</code><code class="p">,</code> <code class="nx">t</code> <code class="o">|</code> <code class="mi">61</code><code class="p">);</code>
            <code class="k">return</code> <code class="p">((</code><code class="nx">t</code> <code class="o">^</code> <code class="nx">t</code> <code class="o">&gt;&gt;&gt;</code> <code class="mi">14</code><code class="p">)</code> <code class="o">&gt;&gt;&gt;</code> <code class="mi">0</code><code class="p">)</code> <code class="o">/</code> <code class="mi">4294967296</code><code class="p">;</code>
          <code class="p">}</code>
        <code class="p">}</code>
        
        <code class="c1">// Choose a seed</code>
        <code class="kr">const</code> <code class="nx">seed</code> <code class="o">=</code> <code class="mi">98345</code><code class="p">;</code>
        
        <code class="c1">// Get a version of mulberry32() that uses this seed:</code>
        <code class="kr">const</code> <code class="nx">randomFunction</code> <code class="o">=</code> <code class="nx">mulberry32</code><code class="p">(</code><code class="nx">seed</code><code class="p">);</code>
        
        <code class="c1">// Generate some random numbers</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">randomFunction</code><code class="p">());</code>  <code class="c1">// 0.9057375795673579</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">randomFunction</code><code class="p">());</code>  <code class="c1">// 0.44091642647981644</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">randomFunction</code><code class="p">());</code>  <code class="c1">// 0.7662326360587031</code></pre>
        
        <p><a data-type="indexterm" data-primary="mulberry32() function" id="idm45475166415000"></a>The <code>mulberry32()</code> function uses the closure technique described in <a data-type="xref" href="#create_a_function_that_remembers_its_sta">“Creating a Function That Stores its State <span class="keep-together">with a Closure</span>”</a>. <a data-type="indexterm" data-primary="random() method" id="idm45475166412696"></a>It accepts a seed value that’s then locked into the context of the inner <code>random()</code> function. That means that whenever you call <code>random()</code>, the original seed value will be available in the outer function. This is important, because a different seed means a different sequence of random variables. If you call <code>mulberry32()</code> with the same seed value, you’re guaranteed to get the same sequence of pseudorandom numbers from <code>random()</code>.</p>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>Like most pseudorandom number generators, Mulberry32 returns a fractional value between 0 and 1. To convert this to integer in a given range, use the technique shown in <a data-type="xref" href="ch03.html#generating_random_numbers">“Generating Random Numbers”</a>.</p>
        </div>
        
        <p><a data-type="indexterm" data-primary="closures" id="idm45475166222120"></a>Closures have been a part of the JavaScript language since time immemorial, but generators are a much newer innovation. You can rewrite this example using a generator function, which more clearly expresses its purpose:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code><code class="o">*</code> <code class="nx">mulberry32</code><code class="p">(</code><code class="nx">seed</code><code class="p">)</code> <code class="p">{</code>
          <code class="kd">let</code> <code class="nx">t</code> <code class="o">=</code> <code class="nx">seed</code> <code class="o">+=</code> <code class="mh">0x6D2B79F5</code><code class="p">;</code>
        
          <code class="c1">// Generate numbers indefinitely</code>
          <code class="k">while</code><code class="p">(</code><code class="kc">true</code><code class="p">)</code> <code class="p">{</code>
            <code class="nx">t</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">imul</code><code class="p">(</code><code class="nx">t</code> <code class="o">^</code> <code class="nx">t</code> <code class="o">&gt;&gt;&gt;</code> <code class="mi">15</code><code class="p">,</code> <code class="nx">t</code> <code class="o">|</code> <code class="mi">1</code><code class="p">);</code>
            <code class="nx">t</code> <code class="o">^=</code> <code class="nx">t</code> <code class="o">+</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">imul</code><code class="p">(</code><code class="nx">t</code> <code class="o">^</code> <code class="nx">t</code> <code class="o">&gt;&gt;&gt;</code> <code class="mi">7</code><code class="p">,</code> <code class="nx">t</code> <code class="o">|</code> <code class="mi">61</code><code class="p">);</code>
            <code class="k">yield</code> <code class="p">((</code><code class="nx">t</code> <code class="o">^</code> <code class="nx">t</code> <code class="o">&gt;&gt;&gt;</code> <code class="mi">14</code><code class="p">)</code> <code class="o">&gt;&gt;&gt;</code> <code class="mi">0</code><code class="p">)</code> <code class="o">/</code> <code class="mi">4294967296</code><code class="p">;</code>
          <code class="p">}</code>
        <code class="p">}</code>
        
        <code class="c1">// Use the same seed to get the same sequence.</code>
        <code class="kr">const</code> <code class="nx">seed</code> <code class="o">=</code> <code class="mi">98345</code><code class="p">;</code>
        
        <code class="kr">const</code> <code class="nx">generator</code> <code class="o">=</code> <code class="nx">mulberry32</code><code class="p">(</code><code class="nx">seed</code><code class="p">);</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">generator</code><code class="p">.</code><code class="nx">next</code><code class="p">().</code><code class="nx">value</code><code class="p">);</code>  <code class="c1">// 0.9057375795673579</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">generator</code><code class="p">.</code><code class="nx">next</code><code class="p">().</code><code class="nx">value</code><code class="p">);</code>  <code class="c1">// 0.7620641703251749</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">generator</code><code class="p">.</code><code class="nx">next</code><code class="p">().</code><code class="nx">value</code><code class="p">);</code>  <code class="c1">// 0.0211441791616380</code></pre>
        
        <p>Because the <code>mulberry32()</code> function is declared with <code>function*</code>, it’s immediately obvious that it will return multiple values. Inside, an infinite loop ensures that the generator will always be ready to create a new number. After each pass through the loop, <code>random()</code> yields a new random value and then pauses until a new value is requested with <code>next()</code>. The overall operation of this solution is similar to its original version, but now it follows a familiar pattern that could make its usage easier to discover. (But—as always—the value of a refactoring like this depends on the conventions of your organization, the expectations of the people reading your code, and your own personal taste.)</p>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p><a data-type="indexterm" data-primary="scope" id="idm45475166052808"></a>There’s no danger to building an infinite loop in a generator as long as it yields. Yielding pauses the code, ensuring that it won’t tie up the JavaScript event loop. Unlike normal functions, there is no expectation that a generator function will run to its final closing brace. As soon as a <code>Generator</code> object goes out of scope, that function and its context are made available for garbage collection.<a data-type="indexterm" data-primary="" data-startref="ix_function_generator" id="idm45475166051160"></a><a data-type="indexterm" data-primary="" data-startref="ix_generator_func1" id="idm45475166050184"></a><a data-type="indexterm" data-primary="" data-startref="ix_numbers_pseudo" id="idm45475166049240"></a><a data-type="indexterm" data-primary="" data-startref="ix_pseudo_num_gen" id="idm45475166048296"></a></p>
        </div>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Reducing Redundancy by Using Partial Application"><div class="sect1" id="reducing_redundancy_use_partial_application">
        <h1>Reducing Redundancy by Using Partial Application</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475166045704">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="redundancy, reducing" id="ix_redund_reduce"></a><a data-type="indexterm" data-primary="partial application" id="ix_partial_app_func"></a><a data-type="indexterm" data-primary="functions" data-secondary="partial application" id="ix_function_partial_app"></a>You have a function that takes several arguments. You want to wrap this function with one or more specialized versions that require fewer arguments.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475166040824">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="makeString() function" id="idm45475166039416"></a>The following <code>makestring()</code> function accepts three parameters (in other words, it has an <em>arity</em> of 3):</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">makeString</code><code class="p">(</code><code class="nx">prefix</code><code class="p">,</code> <code class="nx">str</code><code class="p">,</code> <code class="nx">suffix</code><code class="p">)</code> <code class="p">{</code>
           <code class="k">return</code> <code class="nx">prefix</code> <code class="o">+</code> <code class="nx">str</code> <code class="o">+</code> <code class="nx">suffix</code><code class="p">;</code>
        <code class="p">}</code></pre>
        
        <p>However, the first and last arguments are often repeated based on a specific use case. You want to eliminate the repetition of arguments whenever possible.</p>
        
        <p>You can solve this problem by creating new functions that wrap the previously created <code>makeString()</code> function, but with known argument values locked down:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">quoteString</code><code class="p">(</code><code class="nx">str</code><code class="p">)</code> <code class="p">{</code>
           <code class="k">return</code> <code class="nx">makeString</code><code class="p">(</code><code class="s1">'"'</code><code class="p">,</code><code class="nx">str</code><code class="p">,</code><code class="s1">'"'</code><code class="p">);</code>
        <code class="p">}</code>
        
        <code class="kd">function</code> <code class="nx">barString</code><code class="p">(</code><code class="nx">str</code><code class="p">)</code> <code class="p">{</code>
           <code class="k">return</code> <code class="nx">makeString</code><code class="p">(</code><code class="s1">'-'</code><code class="p">,</code> <code class="nx">str</code><code class="p">,</code> <code class="s1">'-'</code><code class="p">);</code>
        <code class="p">}</code>
        
        <code class="kd">function</code> <code class="nx">namedEntity</code><code class="p">(</code><code class="nx">str</code><code class="p">)</code> <code class="p">{</code>
           <code class="k">return</code> <code class="nx">makeString</code><code class="p">(</code><code class="s1">'&amp;#'</code><code class="p">,</code> <code class="nx">str</code><code class="p">,</code> <code class="s1">';'</code><code class="p">);</code>
        <code class="p">}</code></pre>
        
        <p>Now only one argument is needed to call any of these new functions:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">quoteString</code><code class="p">(</code><code class="s1">'apple'</code><code class="p">));</code> <code class="c1">// "apple"</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">barString</code><code class="p">(</code><code class="s1">'apple'</code><code class="p">));</code>   <code class="c1">// -apple-</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">namedEntity</code><code class="p">(</code><code class="mi">169</code><code class="p">));</code>     <code class="c1">// "&amp;#169; (the copyright symbol in HTML)</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475165803352">
        <h2>Discussion</h2>
        
        <p>The technique of wrapping one function in another function to lock down one or more argument values is called <em>partial application</em> (because the new functions <em>partially apply</em> the argument values to the original function). Of course, the tradeoff is that the extra functions you create can also clutter up your code, so don’t build wrappers you don’t intend to use and reuse.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Advanced: A Partial Function Factory"><div class="sect2" id="idm45475165794040">
        <h2>Advanced: A Partial Function Factory</h2>
        
        <p><a data-type="indexterm" data-primary="factory functions" id="ix_factory_func"></a>You can reduce the redundancy of this approach even further by creating a function that can partial-ize <em>any</em> other function. In fact, this approach is a fairly common JavaScript design pattern. <a data-type="indexterm" data-primary="arguments object" id="idm45475165790856"></a>In the past, you needed to rely on the JavaScript <code>arguments</code> object and array manipulation. In modern JavaScript, the rest and spread operators make the job much simpler.</p>
        
        <p>In the implementation shown here, the partial-izing function is named <code>partial()</code>. It’s capable of reducing any number of arguments for any function.</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">partial</code><code class="p">(</code><code class="nx">fn</code><code class="p">,</code> <code class="p">...</code><code class="nx">argsToApply</code><code class="p">)</code> <code class="p">{</code>
          <code class="k">return</code> <code class="kd">function</code><code class="p">(...</code><code class="nx">restArgsToApply</code><code class="p">)</code> <code class="p">{</code>
            <code class="k">return</code> <code class="nx">fn</code><code class="p">(...</code><code class="nx">argsToApply</code><code class="p">,</code> <code class="p">...</code><code class="nx">restArgsToApply</code><code class="p">);</code>
          <code class="p">}</code>
        <code class="p">}</code></pre>
        
        <p>This function requires a bit of unpacking. But first, it helps to see a simple example that uses it. Here, the <code>partial()</code> function is used to create a new <code>cubeIt()</code> function that wraps the more general <code>raiseToPower()</code> function. In other words, <code>cubeIt()</code> uses partial application to lock down one of the <code>raiseToPower()</code> arguments (the exponent, which it sets to 3).</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="c1">// The function you want to partialize</code>
        <code class="kd">function</code> <code class="nx">raiseToPower</code><code class="p">(</code><code class="nx">exponent</code><code class="p">,</code> <code class="nx">number</code><code class="p">)</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">number</code><code class="o">**</code><code class="nx">exponent</code><code class="p">;</code>
        <code class="p">}</code>
        
        <code class="c1">// Using partial(), make a customized function</code>
        <code class="kr">const</code> <code class="nx">cubeIt</code> <code class="o">=</code> <code class="nx">partial</code><code class="p">(</code><code class="nx">raiseToPower</code><code class="p">,</code> <code class="mi">3</code><code class="p">);</code>
        
        <code class="c1">// Calculate the cube of 9 (9**3)</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">cubeIt</code><code class="p">(</code><code class="mi">9</code><code class="p">));</code>  <code class="c1">// 729</code></pre>
        
        <p>Now when you call <code>cubeIt(9)</code>, the call is mapped to <code>raiseToPower(3, 9)</code>.</p>
        
        <p>So how does it work? The <code>partial()</code> function accepts two arguments. First is the function you want to partial-ize (<code>fn</code>). Second is a list of all the arguments you want to lock in place (<code>argsToApply</code>), which is captured in an array using the rest operator (<code>...</code>), as explained in <a data-type="xref" href="#creating_function_unlimted_arguments">“Creating a Function That Accepts Unlimited Arguments”</a>.</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">partial</code><code class="p">(</code><code class="nx">fn</code><code class="p">,</code> <code class="p">...</code><code class="nx">argsToApply</code><code class="p">)</code> <code class="p">{</code></pre>
        
        <p>Now things get interesting. The <code>partial</code> function returns a nested inner function (a technique explored in <a data-type="xref" href="#create_a_function_that_remembers_its_sta">“Creating a Function That Stores its State <span class="keep-together">with a Closure</span>”</a>). The nested inner function accepts all the arguments that <em>aren’t</em> locked in place. Once again, these arguments are captured in an array using the rest operator (<code>...restToApply</code>):</p>
        
        <pre data-type="programlisting" data-code-language="javascript">  <code class="c1">// This returns a new anonymous function</code>
          <code class="k">return</code> <code class="kd">function</code><code class="p">(...</code><code class="nx">restArgsToApply</code><code class="p">)</code> <code class="p">{</code></pre>
        
        <p>This newly created function now has three key pieces of information: the underlying function (<code>fn</code>), the arguments that are locked in place (<code>argsToApply</code>), and the arguments that are set each time the function is called (<code>restArgsToApply</code>).<a data-type="indexterm" data-primary="" data-startref="ix_factory_func" id="idm45475165667800"></a></p>
        
        <p>There’s only one line of code inside this function, but it packs in a lot. It expands the two arrays into argument lists using the spread operator (which, somewhat confusingly, looks exactly like the rest operator). In other words, <code>argsToApply</code> becomes a list or arguments followed by <code>restToApply</code>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript">    <code class="c1">// This calls the wrapped function</code>
            <code class="k">return</code> <code class="nx">fn</code><code class="p">(...</code><code class="nx">argsToApply</code><code class="p">,</code> <code class="p">...</code><code class="nx">restArgsToApply</code><code class="p">);</code></pre>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p><a data-type="indexterm" data-primary="functions" data-secondary="higher order" id="idm45475165612280"></a><a data-type="indexterm" data-primary="higher order functions" id="idm45475165611336"></a>A common practice in functional programming is writing <em>higher-order functions</em> (functions that operate on other functions). The <code>partial()</code> function is a higher-level function that creates a wrapper for another function.</p>
        </div>
        
        <p>There is one limitation to this implementation of the <code>partial()</code> function. Because it puts fixed arguments first, you can’t lock down a later argument without locking down all the arguments that occur first. If you wanted to use <code>partial()</code> to make a wrapper for the <code>makeString()</code> function from the original solution, you need to rearrange its arguments first:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">makeString</code><code class="p">(</code><code class="nx">prefix</code><code class="p">,</code> <code class="nx">suffix</code><code class="p">,</code> <code class="nx">str</code><code class="p">)</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">prefix</code> <code class="o">+</code> <code class="nx">str</code> <code class="o">+</code> <code class="nx">suffix</code><code class="p">;</code>
        <code class="p">}</code>
        
        <code class="kr">const</code> <code class="nx">namedEntity</code> <code class="o">=</code> <code class="nx">partial</code><code class="p">(</code><code class="nx">makeString</code><code class="p">,</code> <code class="s2">"&amp;#"</code><code class="p">,</code> <code class="s2">";"</code><code class="p">);</code>
        
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">namedEntity</code><code class="p">(</code><code class="mi">169</code><code class="p">));</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Extra: Using bind() to Partially Provide Arguments"><div class="sect2" id="idm45475165793416">
        <h2>Extra: Using bind() to Partially Provide Arguments</h2>
        
        <p><a data-type="indexterm" data-primary="bind() method" id="idm45475165515976"></a><a data-type="indexterm" data-primary="functions" data-secondary="bind() method" id="idm45475165515048"></a>You can also create partial applications with the <code>Function.bind()</code> method. <a data-type="indexterm" data-primary="this keyword" data-secondary="Function" id="idm45475165513592"></a>The <code>bind()</code> method returns a new function, setting <code>this</code> to whatever is provided as a first argument. All the other arguments are prepended to the argument list for the new function.</p>
        
        <p><a data-type="indexterm" data-primary="undefined parameter" id="idm45475165511256"></a><a data-type="indexterm" data-primary="parameters" data-secondary="undefined" id="idm45475165510328"></a>Rather than having to use <code>partial()</code> to create the named entity function, we can now use <code>bind()</code> to provide the same functionality, passing in <code>undefined</code> as the first <span class="keep-together">argument</span>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">makeString</code><code class="p">(</code><code class="nx">prefix</code><code class="p">,</code> <code class="nx">suffix</code><code class="p">,</code> <code class="nx">str</code><code class="p">)</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">prefix</code> <code class="o">+</code> <code class="nx">str</code> <code class="o">+</code> <code class="nx">suffix</code><code class="p">;</code>
        <code class="p">}</code>
        
        <code class="kr">const</code> <code class="nx">named</code> <code class="o">=</code> <code class="nx">makeString</code><code class="p">.</code><code class="nx">bind</code><code class="p">(</code><code class="kc">undefined</code><code class="p">,</code> <code class="s2">"&amp;#"</code><code class="p">,</code> <code class="s2">";"</code><code class="p">);</code>
        
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">named</code><code class="p">(</code><code class="mi">169</code><code class="p">));</code> <code class="c1">// "&amp;#169;"</code></pre>
        
        <p>Now you have two good ways to create multiple versions of a function that use different parameters.<a data-type="indexterm" data-primary="" data-startref="ix_function_partial_app" id="idm45475165401848"></a><a data-type="indexterm" data-primary="" data-startref="ix_partial_app_func" id="idm45475165444856"></a><a data-type="indexterm" data-primary="" data-startref="ix_redund_reduce" id="idm45475165443976"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Fixing this with Function Binding"><div class="sect1" id="setting_scope_bind">
        <h1>Fixing this with Function Binding</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475165441416">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="bind() method" id="ix_bind_method"></a><a data-type="indexterm" data-primary="functions" data-secondary="binding() method" id="ix_function_binding"></a>Your function is attempting to use the keyword <code>this</code>, but it’s not bound to the right object.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475165437192">
        <h2>Solution</h2>
        
        <p>Use the <code>Function.bind()</code> method to change the context of your function and the meaning of the <code>this</code> reference:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nb">window</code><code class="p">.</code><code class="nx">onload</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
          <code class="nb">window</code><code class="p">.</code><code class="nx">name</code> <code class="o">=</code> <code class="s1">'window'</code><code class="p">;</code>
        
          <code class="kr">const</code> <code class="nx">newObject</code> <code class="o">=</code> <code class="p">{</code>
            <code class="nx">name</code><code class="o">:</code> <code class="s1">'object'</code><code class="p">,</code>
        
            <code class="nx">sayGreeting</code><code class="o">:</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
              <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Now this is easy, </code><code class="si">${</code><code class="k">this</code><code class="p">.</code><code class="nx">name</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
        
              <code class="kr">const</code> <code class="nx">nestedGreeting</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code><code class="nx">greeting</code><code class="p">)</code> <code class="p">{</code>
                <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`</code><code class="si">${</code><code class="nx">greeting</code><code class="si">}</code><code class="sb"> </code><code class="si">${</code><code class="k">this</code><code class="p">.</code><code class="nx">name</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
                <code class="p">}.</code><code class="nx">bind</code><code class="p">(</code><code class="k">this</code><code class="p">);</code>
        
              <code class="nx">nestedGreeting</code><code class="p">(</code><code class="s1">'hello'</code><code class="p">);</code>
            <code class="p">}</code>
          <code class="p">};</code>
        
          <code class="nx">newObject</code><code class="p">.</code><code class="nx">sayGreeting</code><code class="p">();</code>
        <code class="p">};</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475165433304">
        <h2>Discussion</h2>
        
        <p><a data-type="indexterm" data-primary="this keyword" data-secondary="Function" id="ix_this_function"></a>The keyword <code>this</code> refers to the owner or parent of a function. The challenge associated with <code>this</code> in JavaScript is that we can’t always guarantee what parent object will apply to a function.</p>
        
        <p>In the solution, the object has a method, <code>sayGreeting()</code>, which outputs a message and maps another nested function to its property, <code>nestedGreeting</code>. <a data-type="indexterm" data-primary="function objects" id="idm45475165307576"></a>You’ll see this approach if you use the constructor pattern (<a data-type="xref" href="ch08.html#constructor_pattern">“Using the Constructor Pattern to Make a Custom Class”</a>) to create class-like function objects.</p>
        
        <p>Without the <code>Function.bind()</code> method, the first message would say “Now this is easy, object,” but the second would say “hello window.” <a data-type="indexterm" data-primary="unscoped function" id="idm45475165304888"></a><a data-type="indexterm" data-primary="nesting" id="idm45475165304184"></a>The reason the second message has a different name is because the nesting of the function disassociates the inner function from the surrounding object, and all <em>unscoped</em> functions automatically become the property of the <code>window</code> object.</p>
        
        <p>The <code>bind()</code> method solves this problem by binding the function to the object you choose. In the example, the <code>bind()</code> method is invoked on the nested function and given a reference to the parent object. Now, when the code inside <code>nestedGreeting()</code> uses <code>this</code>, it points to the parent object you set.</p>
        
        <p><a data-type="indexterm" data-primary="setTimeout() function" data-secondary="asynchronous programming" id="idm45475165299576"></a><a data-type="indexterm" data-primary="timers" data-secondary="event" id="idm45475165298408"></a><a data-type="indexterm" data-primary="events" data-secondary="timer" id="idm45475165297464"></a>The <code>bind()</code> method is particularly useful for the <code>setTimeout()</code> and <code>setInterval()</code> timer functions. <a data-type="indexterm" data-primary="callback function" data-secondary="function binding and" id="ix_callback_bind"></a>Ordinarily, when these functions trigger your callback, the <code>this</code> reference is lost (it becomes <code>undefined</code>). But with <code>bind()</code>, you can ensure that the callback function keeps the reference you want.</p>
        
        <p><a data-type="xref" href="#demonstration_of_the_utility_of_function">Example&nbsp;6-1</a> is a web page that uses <code>setTimeout()</code> to perform a countdown operation from 10 to 0. As the numbers are counted down, they’re inserted into the web page. This example also uses the constructor pattern for object creation (as described in <a data-type="xref" href="ch08.html#constructor_pattern">“Using the Constructor Pattern to Make a Custom Class”</a>) to create a class-like <code>Counter</code> function.</p>
        <div id="demonstration_of_the_utility_of_function" data-type="example">
        <h5><span class="label">Example 6-1. </span>Demonstrating the utility of <code>bind()</code></h5>
        
        <pre data-type="programlisting" data-code-language="html"><code class="cp">&lt;!DOCTYPE html&gt;</code>
        <code class="nt">&lt;html</code> <code class="na">lang=</code><code class="s">"en"</code><code class="nt">&gt;</code>
          <code class="nt">&lt;head&gt;</code>
            <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"UTF-8"</code> <code class="nt">/&gt;</code>
            <code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"viewport"</code> <code class="na">content=</code><code class="s">"width=device-width, initial-scale=1.0"</code> <code class="nt">/&gt;</code>
            <code class="nt">&lt;meta</code> <code class="na">http-equiv=</code><code class="s">"X-UA-Compatible"</code> <code class="na">content=</code><code class="s">"ie=edge"</code> <code class="nt">/&gt;</code>
            <code class="nt">&lt;title&gt;</code>Using Bind with Timers<code class="nt">&lt;/title&gt;</code>
          <code class="nt">&lt;/head&gt;</code>
          <code class="nt">&lt;body&gt;</code>
            <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"counterDiv"</code><code class="nt">&gt;&lt;/div&gt;</code>
        
            <code class="nt">&lt;script&gt;</code>
            <code class="c1">// This is the constructor function for the Counter object.</code>
            <code class="kd">function</code> <code class="nx">Counter</code><code class="p">(</code><code class="nx">from</code><code class="p">,</code> <code class="nx">to</code><code class="p">,</code> <code class="nx">divElement</code><code class="p">)</code> <code class="p">{</code>
              <code class="k">this</code><code class="p">.</code><code class="nx">currentCount</code> <code class="o">=</code> <code class="nx">from</code><code class="p">;</code>
              <code class="k">this</code><code class="p">.</code><code class="nx">finishCount</code> <code class="o">=</code> <code class="nx">to</code><code class="p">;</code>
              <code class="k">this</code><code class="p">.</code><code class="nx">element</code> <code class="o">=</code> <code class="nx">divElement</code><code class="p">;</code>
        
              <code class="c1">// The incrementCounter() method updates the page</code>
              <code class="k">this</code><code class="p">.</code><code class="nx">incrementCounter</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
                <code class="k">this</code><code class="p">.</code><code class="nx">currentCount</code> <code class="o">-=</code> <code class="mi">1</code><code class="p">;</code>
                <code class="k">this</code><code class="p">.</code><code class="nx">element</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">currentCount</code><code class="p">;</code>
        
                <code class="k">if</code> <code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">currentCount</code> <code class="o">&gt;</code> <code class="k">this</code><code class="p">.</code><code class="nx">finishCount</code><code class="p">)</code> <code class="p">{</code>
                  <code class="c1">// Schedule this function to run again after 1 second.</code>
                  <code class="nx">setTimeout</code><code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">incrementCounter</code><code class="p">.</code><code class="nx">bind</code><code class="p">(</code><code class="k">this</code><code class="p">),</code> <code class="mi">1000</code><code class="p">);</code>
                <code class="p">}</code>
              <code class="p">};</code>
        
              <code class="k">this</code><code class="p">.</code><code class="nx">startCounter</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
                <code class="k">this</code><code class="p">.</code><code class="nx">incrementCounter</code><code class="p">();</code>
              <code class="p">}</code>
            <code class="p">}</code>
        
            <code class="c1">// Create the counter for this page.</code>
            <code class="kr">const</code> <code class="nx">counter</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Counter</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'counterDiv'</code><code class="p">));</code>
        
            <code class="c1">// When the page loads, start the counter.</code>
            <code class="nb">window</code><code class="p">.</code><code class="nx">onload</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
              <code class="nx">counter</code><code class="p">.</code><code class="nx">startCounter</code><code class="p">();</code>
            <code class="p">}</code>
            <code class="nt">&lt;/script&gt;</code>
          <code class="nt">&lt;/body&gt;</code>
        <code class="nt">&lt;/html&gt;</code></pre></div>
        
        <p>If the <code>setTimeout()</code> function in the code sample had been the following:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">setTimeout</code><code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">incrementCounter</code><code class="p">,</code> <code class="mi">1000</code><code class="p">);</code></pre>
        
        <p>it would lose <code>this</code>, and the callback function wouldn’t be able to access variables like <code>currentCount</code>, even though the <code>incrementCounter()</code> method is part of the same object.<a data-type="indexterm" data-primary="" data-startref="ix_callback_bind" id="idm45475165053672"></a></p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Extra: self = this"><div class="sect2" id="idm45475165432712">
        <h2>Extra: self = this</h2>
        
        <p>An older alternative to using <code>bind()</code>, and one that is still in use, is to assign <code>this</code> to a variable in the outer function, which is then accessible to the inner. Typically <code>this</code> is assigned to a variable named <code>that</code> or <code>self</code>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nb">window</code><code class="p">.</code><code class="nx">onload</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
          <code class="nb">window</code><code class="p">.</code><code class="nx">name</code> <code class="o">=</code> <code class="s1">'window'</code><code class="p">;</code>
        
          <code class="kr">const</code> <code class="nx">newObject</code> <code class="o">=</code> <code class="p">{</code>
            <code class="nx">name</code><code class="o">:</code> <code class="s1">'object'</code><code class="p">,</code>
        
            <code class="nx">sayGreeting</code><code class="o">:</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
              <code class="kr">const</code> <code class="nx">self</code> <code class="o">=</code> <code class="k">this</code><code class="p">;</code>
              <code class="nx">alert</code><code class="p">(</code><code class="s1">'Now this is easy, '</code> <code class="o">+</code> <code class="k">this</code><code class="p">.</code><code class="nx">name</code><code class="p">);</code>
              <code class="nx">nestedGreeting</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code><code class="nx">greeting</code><code class="p">)</code> <code class="p">{</code>
                <code class="nx">alert</code><code class="p">(</code><code class="nx">greeting</code> <code class="o">+</code> <code class="s1">' '</code> <code class="o">+</code> <code class="nx">self</code><code class="p">.</code><code class="nx">name</code><code class="p">);</code>
              <code class="p">};</code>
        
              <code class="nx">nestedGreeting</code><code class="p">(</code><code class="s1">'hello'</code><code class="p">);</code>
            <code class="p">}</code>
          <code class="p">};</code>
        
          <code class="nx">newObject</code><code class="p">.</code><code class="nx">sayGreeting</code><code class="p">(</code><code class="s1">'hello'</code><code class="p">);</code>
        <code class="p">};</code></pre>
        
        <p>Without the assignment, the second message would once again reference “window,” not “object.”<a data-type="indexterm" data-primary="" data-startref="ix_function_binding" id="idm45475164925880"></a><a data-type="indexterm" data-primary="" data-startref="ix_bind_method" id="idm45475164857864"></a><a data-type="indexterm" data-primary="" data-startref="ix_this_function" id="idm45475164856952"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Implementing a Recursive Algorithm"><div class="sect1" id="implementing_a_recursive_algorithm">
        <h1>Implementing a Recursive Algorithm</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475164854360">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="recursive algorithm" id="ix_recursive_alg"></a><a data-type="indexterm" data-primary="functions" data-secondary="recursive algorithms" id="ix_function_recursive"></a>You want to implement a function that <em>calls itself</em> to accomplish a task, which is a technique called recursion. Recursion is useful when dealing with hierarchical data structures (for example, node trees or nested arrays), certain types of algorithms (sorting), and some mathematical calculations (the Fibonacci sequence).</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475164989320">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="Fibonacci Sequence" id="idm45475164987880"></a>Recursion is a well-known concept in the field of mathematics, as well as computer science. An example of recursion in mathematics is the <em>Fibonacci sequence</em>. A Fibonacci number is the sum of the two previous Fibonacci numbers:</p>
        
        <pre data-type="programlisting">f(n)= f(n-1) + f(n-2),
          for n= 2,3,4,...,n and
          f(0) = 0 and f(1) = 1</pre>
        
        <p><a data-type="indexterm" data-primary="factorials" id="idm45475164985528"></a>Another example of mathematical recursion is a <em>factorial</em>, usually denoted with an exclamation point (4!). A factorial is the product of all integers from 1 to a given number <em>n</em>. If <em>n</em> is 4, then the factorial (4!) would be:</p>
        
        <pre data-type="programlisting">4! = 4 x 3 x 2 x 1 = 24</pre>
        
        <p>These recursions can be coded in JavaScript using a series of loops and conditions, but they can also be coded using functional recursion. Here’s a recursive function that finds the nth number in the Fibonacci sequence:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">fibonacci</code><code class="p">(</code><code class="nx">n</code><code class="p">)</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">n</code> <code class="o">&lt;</code> <code class="mi">2</code> <code class="o">?</code> <code class="nx">n</code> <code class="o">:</code> <code class="nx">fibonacci</code><code class="p">(</code><code class="nx">n</code> <code class="o">-</code> <code class="mi">1</code><code class="p">)</code> <code class="o">+</code> <code class="nx">fibonacci</code><code class="p">(</code><code class="nx">n</code> <code class="o">-</code> <code class="mi">2</code><code class="p">);</code>
        <code class="p">}</code></pre>
        
        <p>And here’s one that solves a factorial:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">factorial</code><code class="p">(</code><code class="nx">n</code><code class="p">)</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">n</code> <code class="o">&lt;=</code> <code class="mi">1</code> <code class="o">?</code> <code class="mi">1</code> <code class="o">:</code> <code class="nx">n</code> <code class="o">*</code> <code class="nx">factorial</code><code class="p">(</code><code class="nx">n</code> <code class="o">-</code> <code class="mi">1</code><code class="p">);</code>
        <code class="p">}</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475164943640">
        <h2>Discussion</h2>
        
        <p><a data-type="indexterm" data-primary="base case, recursive functions" id="idm45475164793400"></a><a data-type="indexterm" data-primary="termination condition, recursive functions" id="idm45475164792728"></a>A characteristic that distinguishes recursive functions is a <em>termination condition</em> (also known as a <em>base case</em>). A recursive function cannot keep calling itself indiscriminately, because that would lead to an infinite loop (until stack space is exhausted and the program fails). Instead, a recursive function examines a condition and then decides to call itself (stepping one level deeper into recursion) or return a value (stepping one level back, to the calling function). When the top-level function returns a value, that becomes the final result and the recursive operation is complete.</p>
        
        <p>In the Fibonacci example, <code>n</code> is tested to see if it’s less than 2. If it is, it’s returned; otherwise the Fibonacci function is called again with (<code>n-1</code>) and with (<code>n-2</code>), and the sum of both is returned.</p>
        
        <p>In the factorial example, when the function is first called, the value passed as the argument is compared to the number 1. If <code>n</code> is less than or equal to 1 (negative numbers aren’t supported in this simple implementation), the function terminates, returning 1. However, if <code>n</code> is greater than 1, what’s returned is the value of <code>n</code> times a call to the <code>factorial()</code> function again, this time passing in a value of <code>n–1</code>. The value of <code>n</code> then decreases with each iteration of the function, until the termination condition is reached.</p>
        
        <p>As a factorial is being computed, the interim values of each function call are pushed onto a stack in memory and kept until the termination condition is met. Then the values are popped from memory and returned, in a state similar to the following:</p>
        <table>
        
        <tbody>
        <tr>
        <td><p>return 1;</p></td>
        <td><p>// 0!</p></td>
        </tr>
        <tr>
        <td><p>return 1;</p></td>
        <td><p>// 1!</p></td>
        </tr>
        <tr>
        <td><p>return 1 * 2;</p></td>
        <td><p>// 2!</p></td>
        </tr>
        <tr>
        <td><p>return 1 * 2 * 3;</p></td>
        <td><p>// 3!</p></td>
        </tr>
        <tr>
        <td><p>return 1 * 2 * 3 * 4;</p></td>
        <td><p>// 4!</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>Most recursive functions can be replaced with code that performs the same function linearly, via some kind of loop. And loops may perform better, although the difference is often negligible. The advantage of recursion is that recursive functions can be very terse and minimal. Whether they are clearer is a matter of debate. (They are clearly <em>shorter</em>, which makes them easier to digest, but their self-referential nature can make their logic harder to grasp at first glance, particularly for programmers who haven’t used recursive functions before.)</p>
        
        <p><a data-type="indexterm" data-primary="call stack" id="idm45475164773816"></a>If a recursive function calls itself over and over again, it will eventually exhaust the call stack. This condition leads to an error with a message like “Out of stack space,” “Too much recursion,” or “Maximum call stack size exceeded.” The exact message and the number of open function calls that are allowed at once depend on the implementation of the JavaScript engine. <a data-type="indexterm" data-primary="" data-startref="ix_function_recursive" id="idm45475164772584"></a><a data-type="indexterm" data-primary="" data-startref="ix_recursive_alg" id="idm45475164771640"></a><a data-type="indexterm" data-primary="" data-startref="ix_functions_ch6" id="idm45475164770696"></a>However, these error messages usually indicate an incorrectly structured recursive function that is failing to evaluate its termination condition and calling itself in an infinite loop.</p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        </div></section></div></div><link rel="stylesheet" href="/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="/api/v2/epubs/urn:orm:book:9781492055747/files/epub.css" crossorigin="anonymous"></div></div></section>
</div>

https://learning.oreilly.com