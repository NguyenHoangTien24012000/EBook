<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
    
</style>
<link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492092506/files/epub.css" crossorigin="anonymous">
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 18. Node Modules"><div class="chapter" id="ch18">
        <h1><span class="label">Chapter 18. </span>Node Modules</h1>
        
        
        <p><a data-type="indexterm" data-primary="modules" id="ix_modules_ch18"></a>One of the great aspects of writing Node.js applications is the built-in modularity the environment provides. It’s simple to download and install any number of Node modules, and using them is equally simple: just include a single <code>require()</code> statement naming the module, and you’re off and running.</p>
        
        <p>The ease with which the modules can be incorporated is one of the benefits of JavaScript <em>modularization</em>. <a data-type="indexterm" data-primary="loose coupling" id="idm45475128019784"></a>Modularizing ensures that external functionality is created in such a way that it isn’t dependent on other external functionality, a concept known as <em>loose coupling</em>. This means I can use a <code>Foo</code> module, without having to include a <code>Bar</code> module, because <code>Foo</code> is tightly dependent on having <code>Bar</code> included.</p>
        
        <p>JavaScript modularization is both a discipline and a contract. The discipline comes in having to follow certain mandated criteria in order for external code to participate in the module system. The contract is between you, me, and other JavaScript developers: we’re following an agreed-on path when we produce (or consume) external functionality in a module system, and we all have expectations based on the module system.</p>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p><a data-type="indexterm" data-primary="GitHub" id="idm45475128015016"></a><a data-type="indexterm" data-primary="Git Pocket Guide (O’Reilly)" id="idm45475128014312"></a><a data-type="indexterm" data-primary="Silverman, Richard" data-secondary="Git Pocket Guide (O’Reilly)" id="idm45475128013624"></a>One major dependency on virtually all aspects of application and library management and publication is the use of Git, a source control system, and GitHub, an extremely popular Git <em>endpoint</em>. How Git works and using Git with GitHub are beyond the scope of this book. I recommend the <em><a class="orm:hideurl" href="http://shop.oreilly.com/product/0636920024972.do">Git Pocket Guide</a></em> by Richard Silverman (O’Reilly) to get more familiar with Git, and GitHub’s <a href="https://github.com">own documentation</a> for more on using this service.</p>
        </div>
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Searching for a Specific Node Module via npm"><div class="sect1" id="searching_node_module">
        <h1>Searching for a Specific Node Module via npm</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475128008264">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="npm (Node package manager)" data-secondary="in search for specific module" data-secondary-sortas="search for specific module" id="ix_npm_search_module"></a><a data-type="indexterm" data-primary="modules" data-secondary="npm in search for specific module" id="ix_module_npm_search"></a>You’re creating a Node application and want to use existing modules, but you don’t know how to discover them.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475128003704">
        <h2>Solution</h2>
        
        <p><a data-type="xref" href="ch01.html#installing_npm_package">“Downloading a Package with npm”</a> explains how to install packages with npm, Node’s popular package manager (and the glue that holds the Node universe together). But you haven’t yet considered how to <em>find</em> the useful packages that you need in npm’s sprawling registry.</p>
        
        <p>In most cases, you’ll discover modules via recommendations from your friends and codevelopers, but sometimes you need something new. You can search for new modules directly at the <a href="https://www.npmjs.org">npm website</a>. You can also use the npm command-line interface directly to search for a module. For instance, if you’re interested in modules that do something with PDFs, run the following search at the command line:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">search</code> <code class="nx">pdf</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475127997528">
        <h2>Discussion</h2>
        
        <p>The npm website provides more than just documentation for using npm; it also provides an interface for searching for modules. If you access each module’s page at npm, you can see how popular the module is, what other modules are dependent on it, the license, and other relevant information.</p>
        
        <p>However, you can also search for modules, directly, using npm. The process can take a fair amount of time and when it finishes, you’re likely to get a huge number of modules in return, especially with a broader topic such as modules that work with PDFs.</p>
        
        <p>You can refine the results by listing multiple terms:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">search</code> <code class="nx">PDF</code> <code class="nx">generation</code></pre>
        
        <p>This query returns a much smaller list of modules, specific to PDF generation.</p>
        
        <p>Once you do find a module that sounds interesting, you can get detailed information about it with:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">view</code> <code class="nx">electron</code></pre>
        
        <p>You’ll get useful information from the <em>package.json</em> of the module, which can tell you what it’s dependent on, who wrote it, and when it was created. We still recommend checking out the module’s npm website page and GitHub repository page directly. There you’ll be able to determine if the module is being actively maintained, get a sense of how popular the module is, review open issues, and look at the source code.<a data-type="indexterm" data-primary="" data-startref="ix_module_npm_search" id="idm45475127991624"></a><a data-type="indexterm" data-primary="" data-startref="ix_npm_search_module" id="idm45475127990776"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Converting Your Library into a Node Module"><div class="sect1" id="converting_library_node_module">
        <h1>Converting Your Library into a Node Module</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475127947864">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="libraries" data-secondary="converting to Node modules" id="ix_library_to_module"></a><a data-type="indexterm" data-primary="modules" data-secondary="converting library into module" id="ix_module_library"></a>You want to use one of your libraries in Node.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475127983240">
        <h2>Solution</h2>
        
        <p>Convert the library into a Node module. In Node, each file is treated as a module. For example, if the library is a file containing a function stored at <code>/lib/hello.js</code>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">hello</code> <code class="o">=</code> <code class="nx">val</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Hello </code><code class="si">${</code><code class="nx">val</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
        <code class="p">};</code></pre>
        
        <p>You can convert it to work as a Node module with the <code>exports</code> keyword:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">hello</code> <code class="o">=</code> <code class="nx">val</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Hello </code><code class="si">${</code><code class="nx">val</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
        <code class="p">};</code>
        
        <code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="nx">hello</code><code class="p">;</code></pre>
        
        <p>Alternately, can also <code>export</code> the function directly:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="nx">val</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Hello </code><code class="si">${</code><code class="nx">val</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
        <code class="p">};</code></pre>
        
        <p>You can then use the module in your application:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">var</code> <code class="nx">hello</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'./lib/hello.js'</code><code class="p">);</code>
        
        <code class="c1">// logs 'Hello world'</code>
        <code class="nx">hello</code><code class="p">(</code><code class="s1">'world'</code><code class="p">);</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475127982936">
        <h2>Discussion</h2>
        
        <p>Node’s default module system is based on CommonJS, which uses three constructs: <code>exports</code> to define what’s exported from the library, <code>require()</code> to include the module in the application, and <code>module</code>, which includes information about the module but also can be used to export a function directly.</p>
        
        <p>If your library returns an object with several functions and data objects, you can assign each to the comparably named property on <code>module.exports</code>, or you could return an object:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">greeting</code> <code class="o">=</code> <code class="p">{</code>
          <code class="nx">hello</code><code class="o">:</code> <code class="nx">val</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="k">return</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Hello </code><code class="si">${</code><code class="nx">val</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
          <code class="p">},</code>
          <code class="nx">ciao</code><code class="o">:</code> <code class="nx">val</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="k">return</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Ciao </code><code class="si">${</code><code class="nx">val</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
          <code class="p">}</code>
        <code class="p">};</code>
        
        <code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="nx">greeting</code><code class="p">;</code></pre>
        
        <p>or:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">hello</code> <code class="o">=</code> <code class="nx">val</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Hello </code><code class="si">${</code><code class="nx">val</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
        <code class="p">};</code>
        
        <code class="kr">const</code> <code class="nx">ciao</code> <code class="o">=</code> <code class="nx">val</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="k">return</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Ciao </code><code class="si">${</code><code class="nx">val</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
        <code class="p">};</code>
        
        <code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="p">{</code> <code class="nx">hello</code><code class="p">,</code> <code class="nx">ciao</code> <code class="p">};</code></pre>
        
        <p>And then access the object properties directly:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">greeting</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'./lib/greeting.js'</code><code class="p">)</code>
        
        <code class="c1">// logs 'Hello world'</code>
        <code class="nx">greeting</code><code class="p">.</code><code class="nx">hello</code><code class="p">(</code><code class="s1">'world'</code><code class="p">);</code>
        <code class="c1">// logs 'Ciao mondo'</code>
        <code class="nx">greeting</code><code class="p">.</code><code class="nx">ciao</code><code class="p">(</code><code class="s1">'mondo'</code><code class="p">);</code></pre>
        
        <p>Because the module isn’t installed using npm, and just resides in the directory where the application resides, it’s accessed by the file location and name, not just the name.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45475127421896">
        <h2>See Also</h2>
        
        <p>In <a data-type="xref" href="#creating_compatible_modules">“Taking Your Code Across Module Environments”</a>, we cover how to make sure your library code works in both CommonJS and ECMAScript module environments.</p>
        
        <p>In <a data-type="xref" href="#creating_installable_node_module">“Creating an Installable Node Module”</a>, we cover how to create an standalone module.<a data-type="indexterm" data-primary="" data-startref="ix_module_library" id="idm45475127478184"></a><a data-type="indexterm" data-primary="" data-startref="ix_library_to_module" id="idm45475127477240"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Taking Your Code Across Module Environments"><div class="sect1" id="creating_compatible_modules">
        <h1>Taking Your Code Across Module Environments</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475127474584">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="ECMAScript" data-secondary="modularization" id="ix_ecma_module"></a><a data-type="indexterm" data-primary="code" data-secondary="sharing across module environments" id="ix_code_share_module"></a><a data-type="indexterm" data-primary="modules" data-secondary="taking code across environments" id="ix_module_code_environ"></a><a data-type="indexterm" data-primary="libraries" data-secondary="sharing across environments" id="ix_lib_share_environ"></a>You’ve written a library that you’d like to share with others, but folks are using a variety of Node versions with both CommonJS and ECMAScript modules. How can you ensure your library works in all of the various environments?</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475127467912">
        <h2>Solution</h2>
        
        <p>Use CommonJS modules with an ECMAScript module wrapper.</p>
        
        <p>First, write the library as a CommonJS module, saved with the <em>.cjs</em> file extension:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">bbarray</code> <code class="o">=</code> <code class="p">{</code>
          <code class="nx">concatArray</code><code class="o">:</code> <code class="p">(</code><code class="nx">str</code><code class="p">,</code> <code class="nx">array</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="k">return</code> <code class="nx">array</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">element</code> <code class="o">=&gt;</code> <code class="p">{</code>
              <code class="k">return</code> <code class="sb">`</code><code class="si">${</code><code class="nx">str</code><code class="si">}</code><code class="sb"> </code><code class="si">${</code><code class="nx">element</code><code class="si">}</code><code class="sb">`</code><code class="p">;</code>
            <code class="p">});</code>
          <code class="p">},</code>
          <code class="nx">splitArray</code><code class="o">:</code> <code class="p">(</code><code class="nx">str</code><code class="p">,</code> <code class="nx">array</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="k">return</code> <code class="nx">array</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">element</code> <code class="o">=&gt;</code> <code class="p">{</code>
              <code class="k">return</code> <code class="nx">element</code><code class="p">.</code><code class="nx">substring</code><code class="p">(</code><code class="nx">str</code><code class="p">.</code><code class="nx">length</code> <code class="o">+</code> <code class="mi">1</code><code class="p">);</code>
            <code class="p">});</code>
          <code class="p">}</code>
        <code class="p">};</code>
        
        <code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="nx">bbarray</code><code class="p">;</code>
        <code class="nx">exports</code><code class="p">.</code><code class="nx">concatArray</code> <code class="o">=</code> <code class="nx">bbarray</code><code class="p">.</code><code class="nx">concatArray</code><code class="p">;</code>
        <code class="nx">exports</code><code class="p">.</code><code class="nx">splitArray</code> <code class="o">=</code> <code class="nx">bbarray</code><code class="p">.</code><code class="nx">splitArray</code><code class="p">;</code></pre>
        
        <p>Followed by an ECMAScript wrapper module, which uses the <em>.mjs</em> file extension:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">bbarray</code> <code class="nx">from</code> <code class="s1">'./index.cjs'</code><code class="p">;</code>
        
        <code class="kr">export</code> <code class="kr">const</code> <code class="p">{</code> <code class="nx">concatArray</code><code class="p">,</code> <code class="nx">splitArray</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">bbarray</code><code class="p">;</code>
        <code class="kr">export</code> <code class="k">default</code> <code class="nx">bbarray</code><code class="p">;</code></pre>
        
        <p>And a <em>package.json</em> file, which includes the <code>type</code>, <code>main</code>, and <code>exports</code> fields:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="s2">"type"</code><code class="o">:</code> <code class="s2">"module"</code><code class="p">,</code>
        <code class="s2">"main"</code><code class="o">:</code> <code class="s2">"./index.cjs"</code><code class="p">,</code>
        <code class="s2">"exports"</code><code class="o">:</code> <code class="p">{</code>
          <code class="s2">"."</code><code class="o">:</code> <code class="s2">"./index.cjs"</code><code class="p">,</code>
          <code class="s2">"./module"</code><code class="o">:</code> <code class="s2">"./wrapper.mjs"</code>
        <code class="p">},</code></pre>
        
        <p><a data-type="indexterm" data-primary="CommonJS" id="idm45475127293576"></a>Users of our module, using CommonJS syntax, can use the <code>require</code> syntax to import the module:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">bbarray</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'bbarray'</code><code class="p">);</code>
        
        <code class="nx">bbarray</code><code class="p">.</code><code class="nx">concatArray</code><code class="p">(</code><code class="s1">'is'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'test'</code><code class="p">,</code> <code class="s1">'three'</code><code class="p">]);</code>
        <code class="nx">bbarray</code><code class="p">.</code><code class="nx">splitArray</code><code class="p">(</code><code class="s1">'is'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'is test'</code><code class="p">,</code> <code class="s1">'is three'</code><code class="p">]);</code></pre>
        
        <p>or:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="p">{</code> <code class="nx">concatArray</code><code class="p">,</code> <code class="nx">splitArray</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'bbarray'</code><code class="p">);</code>
        
        <code class="nx">concatArray</code><code class="p">(</code><code class="s1">'is'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'test'</code><code class="p">,</code> <code class="s1">'three'</code><code class="p">]);</code>
        <code class="nx">splitArray</code><code class="p">(</code><code class="s1">'is'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'is test'</code><code class="p">,</code> <code class="s1">'is three'</code><code class="p">]);</code></pre>
        
        <p>While those using ECMAScript modules can specify the <code>module</code> version of the library to use the ES <code>import</code> syntax:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">bbarray</code> <code class="nx">from</code> <code class="s1">'bbarray/module'</code><code class="p">;</code>
        
        <code class="nx">bbarray</code><code class="p">.</code><code class="nx">concatArray</code><code class="p">(</code><code class="s1">'is'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'test'</code><code class="p">,</code> <code class="s1">'three'</code><code class="p">]);</code>
        <code class="nx">bbarray</code><code class="p">.</code><code class="nx">splitArray</code><code class="p">(</code><code class="s1">'is'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'is test'</code><code class="p">,</code> <code class="s1">'is three'</code><code class="p">]);</code></pre>
        
        <p>or:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="p">{</code> <code class="nx">concatArray</code><code class="p">,</code> <code class="nx">splitArray</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'bbarray/module'</code><code class="p">;</code>
        
        <code class="nx">concatArray</code><code class="p">(</code><code class="s1">'is'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'test'</code><code class="p">,</code> <code class="s1">'three'</code><code class="p">]);</code>
        <code class="nx">splitArray</code><code class="p">(</code><code class="s1">'is'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'is test'</code><code class="p">,</code> <code class="s1">'is three'</code><code class="p">]);</code></pre>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>At the time of writing, it is possible to avoid the <em>/module</em> naming convention for ECMAScript modules using the <code>--experimental-conditional-exports</code> flag. However, due to the current experimental nature and the potential of future changes in the syntax, we currently recommend against it. In future versions of Node, this will likely become the standard. You can read more about this approach in the <a href="https://oreil.ly/Xzkid">Node documentation</a>.</p>
        </div>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475127494520">
        <h2>Discussion</h2>
        
        <p><a data-type="indexterm" data-primary="ES6 (ECMAScript 2015)" data-secondary="sharing code across module environments" id="ix_es6_module"></a>CommonJS modules have been the standard in Node since the beginning, and tools such as Browserify brought this syntax out of the Node ecosystem, allowing developers to use Node style modules in the browser. The ECMAScript 2015 (also known as ES6) standard introduced a native JavaScript module syntax, which was introduced in Node 8.5.0 and could be used behind an <code>--experimental-module</code> flag. Beginning with Node 13.2.0, Node ships with native support for ECMAScript modules.</p>
        
        <p>A common pattern is to write a module using either the CommonJS or ECMAScript module syntax and use a compile tool to ship both as either separate module entry points or exported paths. However, this runs the risk of a module being loaded twice if it is loaded directly via one syntax by the application and either loaded directly or by a dependency using the other syntax.</p>
        
        <p>In <em>package.json</em> there are three key fields:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="s2">"type"</code><code class="o">:</code> <code class="s2">"module"</code><code class="p">,</code>
        <code class="s2">"main"</code><code class="o">:</code> <code class="s2">"./index.cjs"</code><code class="p">,</code>
        <code class="s2">"exports"</code><code class="o">:</code> <code class="p">{</code>
          <code class="s2">"."</code><code class="o">:</code> <code class="s2">"./index.cjs"</code><code class="p">,</code>
          <code class="s2">"./module"</code><code class="o">:</code> <code class="s2">"./wrapper.mjs"</code>
        <code class="p">},</code></pre>
        <dl>
        <dt><code>"type"</code></dt>
        <dd>
        <p>Specifies that this is a <code>module</code>, meaning that this library is using the ECMAScript module syntax. For libraries that exclusively use CommonJS, the <code>"type"</code> would be <code>"commonjs"</code>.</p>
        </dd>
        <dt><code>"main"</code></dt>
        <dd>
        <p>Specifies the main entry point of the application, for which we will point to the CommonJS file.</p>
        </dd>
        <dt><code>"exports"</code></dt>
        <dd>
        <p>Defines the exported paths of our modules. Through this consumers of the default <code>package</code> will receive the CommonJS module directly, while those using <code>package/module</code> will import the file from the ECMAScript module wrapper.</p>
        </dd>
        </dl>
        
        <p>If we wish to avoid using the <em>.cjs</em> and <em>.mjs</em> file extensions, we may do so:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="s2">"type"</code><code class="o">:</code> <code class="s2">"module"</code><code class="p">,</code>
        <code class="s2">"main"</code><code class="o">:</code> <code class="s2">"./index.js"</code><code class="p">,</code>
        <code class="s2">"exports"</code><code class="o">:</code> <code class="p">{</code>
          <code class="s2">"."</code><code class="o">:</code> <code class="s2">"./index.js"</code><code class="p">,</code>
          <code class="s2">"./module"</code><code class="o">:</code> <code class="s2">"./wrapper.js"</code>
        <code class="p">},</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45475126989032">
        <h2>See Also</h2>
        
        <p>In <a data-type="xref" href="#multiplatform">“Writing Multiplatform Libraries”</a>, we cover how to make sure your library code works across multiple module environments in both Node and the browser by using Webpack as a code bundler.<a data-type="indexterm" data-primary="" data-startref="ix_lib_share_environ" id="idm45475126887544"></a><a data-type="indexterm" data-primary="" data-startref="ix_module_code_environ" id="idm45475126886600"></a><a data-type="indexterm" data-primary="" data-startref="ix_code_share_module" id="idm45475126885656"></a><a data-type="indexterm" data-primary="" data-startref="ix_es6_module" id="idm45475126884712"></a><a data-type="indexterm" data-primary="" data-startref="ix_ecma_module" id="idm45475126883768"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Creating an Installable Node Module"><div class="sect1" id="creating_installable_node_module">
        <h1>Creating an Installable Node Module</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475126881112">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="npm (Node package manager)" data-secondary="creating installable module for" id="ix_npm_install_module"></a><a data-type="indexterm" data-primary="modules" data-secondary="installable" id="ix_modules_install"></a>You’ve either created a Node module from scratch, or converted an existing library to one that will work in the browser or in Node. Now, you want to know how to modify it into a module that can be installed using npm.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475126876888">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="package.json file" id="ix_pkg_json_file"></a><a data-type="indexterm" data-primary="files" data-secondary="package.json file" id="ix_file_pkg_json"></a>Once you’ve created your Node module and any supporting functionality (including module tests), you can package the entire directory. The key to packaging and publishing the Node module is creating a <em>package.json</em> file that describes the module, any dependencies, the directory structure, what to ignore, and so on. <a data-type="indexterm" data-primary="init command (npm)" id="idm45475126872216"></a>You can generate a <em>package.json</em> file by running the <code>npm init</code> command in the root of the project’s directory and following the prompts.</p>
        
        <p>The following is a relatively basic <em>package.json</em> file:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="p">{</code>
          <code class="s2">"name"</code><code class="o">:</code> <code class="s2">"bbArray"</code><code class="p">,</code>
          <code class="s2">"version"</code><code class="o">:</code> <code class="s2">"0.1.0"</code><code class="p">,</code>
          <code class="s2">"description"</code><code class="o">:</code> <code class="s2">"A description of what my module is about"</code><code class="p">,</code>
          <code class="s2">"main"</code><code class="o">:</code> <code class="s2">"./lib/bbArray"</code><code class="p">,</code>
          <code class="s2">"author"</code><code class="o">:</code> <code class="p">{</code>
            <code class="s2">"name"</code><code class="o">:</code> <code class="s2">"Shelley Powers"</code>
          <code class="p">},</code>
          <code class="s2">"keywords"</code><code class="o">:</code> <code class="p">[</code>
            <code class="s2">"array"</code><code class="p">,</code>
            <code class="s2">"utility"</code>
          <code class="p">],</code>
          <code class="s2">"repository"</code><code class="o">:</code> <code class="p">{</code>
            <code class="s2">"type"</code><code class="o">:</code> <code class="s2">"git"</code><code class="p">,</code>
            <code class="s2">"url"</code><code class="o">:</code> <code class="s2">"https://github.com/accountname/bbarray.git"</code>
          <code class="p">},</code>
          <code class="s2">"engines"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"node"</code> <code class="o">:</code> <code class="s2">"&gt;=0.10.0"</code>
          <code class="p">},</code>
          <code class="s2">"bugs"</code><code class="o">:</code> <code class="p">{</code>
            <code class="s2">"url"</code><code class="o">:</code> <code class="s2">"https://github.com/accountname/bbarray/issues"</code>
          <code class="p">},</code>
          <code class="s2">"licenses"</code><code class="o">:</code> <code class="p">[</code>
            <code class="p">{</code>
              <code class="s2">"type"</code><code class="o">:</code> <code class="s2">"MIT"</code><code class="p">,</code>
              <code class="s2">"url"</code><code class="o">:</code> <code class="s2">"https://github.com/accountname/bbarray/raw/master/LICENSE"</code>
            <code class="p">}</code>
          <code class="p">],</code>
          <code class="s2">"dependencies"</code><code class="o">:</code> <code class="p">{</code>
             <code class="s2">"some-module"</code><code class="o">:</code> <code class="s2">"~0.1.0"</code>
          <code class="p">},</code>
          <code class="s2">"directories"</code><code class="o">:</code><code class="p">{</code>
             <code class="s2">"doc"</code><code class="o">:</code><code class="s2">"./doc"</code><code class="p">,</code>
             <code class="s2">"man"</code><code class="o">:</code><code class="s2">"./man"</code><code class="p">,</code>
             <code class="s2">"lib"</code><code class="o">:</code><code class="s2">"./lib"</code><code class="p">,</code>
             <code class="s2">"bin"</code><code class="o">:</code><code class="s2">"./bin"</code>
          <code class="p">},</code>
          <code class="s2">"scripts"</code><code class="o">:</code> <code class="p">{</code>
            <code class="s2">"test"</code><code class="o">:</code> <code class="s2">"nodeunit test/test-bbarray.js"</code>
          <code class="p">}</code>
         <code class="p">}</code></pre>
        
        <p>Once you’ve created <em>package.json</em>, package all the source directories and the <em>package.json</em> file as a gzipped tarball. Then install the package locally, or install it in npm for public access.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475126866408">
        <h2>Discussion</h2>
        
        <p>The <em>package.json</em> file is key to packaging up a Node module for local installation or uploading to npm for management. At a minimum, it requires a <code>name</code> and a <code>version</code>. The other fields given in the solution are:</p>
        <dl>
        <dt><code>description</code></dt>
        <dd>
        <p>A description of what the module is and does</p>
        </dd>
        <dt><code>main</code></dt>
        <dd>
        <p>Entry file for the module</p>
        </dd>
        <dt><code>author</code></dt>
        <dd>
        <p>Author(s) of the module</p>
        </dd>
        <dt><code>keywords</code></dt>
        <dd>
        <p>List of keywords that can help others find the module</p>
        </dd>
        <dt><code>repository</code></dt>
        <dd>
        <p>Place where the code lives, typically GitHub</p>
        </dd>
        <dt><code>engines</code></dt>
        <dd>
        <p>Node versions you know your module works with</p>
        </dd>
        <dt><code>bugs</code></dt>
        <dd>
        <p>Where to file bugs</p>
        </dd>
        <dt><code>licenses</code></dt>
        <dd>
        <p>License for your module</p>
        </dd>
        <dt><code>dependencies</code></dt>
        <dd>
        <p>A list of dependencies required by the module</p>
        </dd>
        <dt><code>directories</code></dt>
        <dd>
        <p>A hash describing the directory structure for your module</p>
        </dd>
        <dt><code>scripts</code></dt>
        <dd>
        <p>A hash of object commands that are run during the module life cycle</p>
        </dd>
        </dl>
        
        <p>There are a host of other options that are described at the <a href="https://oreil.ly/iXynV">npm website</a>. You can also use a tool to help you fill in many of these fields. Typing the following at the command line runs the tool that asks questions and then generates a basic <em>package.json</em> file:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">init</code></pre>
        
        <p>Once you have your source set up and your <em>package.json</em> file, you can test whether everything works by running the following command in the top-level directory of your module:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">install</code> <code class="p">.</code> <code class="o">-</code><code class="nx">g</code></pre>
        
        <p>If you have no errors, then you can package the file as a gzipped tarball. At this point, if you want to publish the module, you’ll first need to add yourself as a user in the npm registry:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">add</code><code class="o">-</code><code class="nx">user</code></pre>
        
        <p>To publish the Node module to the npm registry, use the following in the root directory of the module, specifying a URL to the tarball, a filename for the tarball, or a path:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">publish</code> <code class="p">.</code><code class="o">/</code></pre>
        
        <p>If you have development dependencies for your module, such as using a testing framework like Jest, one excellent shortcut to ensure these are added to your <span class="keep-together"><em>package.json</em></span> file is to use the following, in the same directory as the <em>package.json</em> file, when you’re installing the dependent module:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">install</code> <code class="nx">jest</code> <code class="o">--</code><code class="nx">save</code><code class="o">-</code><code class="nx">dev</code></pre>
        
        <p>Not only does this install Jest (discussed later, in <a data-type="xref" href="#unit_testing_node_modules">“Unit Testing Your Modules”</a>), this command also updates your <em>package.json</em> file with the following command:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"> <code class="s2">"devDependencies"</code><code class="o">:</code> <code class="p">{</code>
            <code class="s2">"jest"</code><code class="o">:</code> <code class="s2">"^24.9.0"</code>
          <code class="p">}</code></pre>
        
        <p>You can also use this same type of option to add a module to <code>dependencies</code> in <span class="keep-together"><em>package.json</em></span>. The following:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">install</code> <code class="nx">express</code> <code class="o">--</code><code class="nx">save</code></pre>
        
        <p>adds the following to the <em>package.json</em> file:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="s2">"dependencies"</code><code class="o">:</code> <code class="p">{</code>
            <code class="s2">"express"</code><code class="o">:</code> <code class="s2">"^3.4.11"</code>
          <code class="p">}</code></pre>
        
        <p>If the module is no longer needed and shouldn’t be listed in <em>package.json</em>, remove it from the <code>devDependencies</code> with:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">remove</code> <code class="nx">jest</code></pre>
        
        <p>And remove a module to <code>dependencies</code> with:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">remove</code> <code class="nx">express</code></pre>
        
        <p>If the module is the last in either <code>dependencies</code> or <code>devDependencies</code>, the property isn’t removed. It’s just set to an empty value:<a data-type="indexterm" data-primary="" data-startref="ix_file_pkg_json" id="idm45475126416616"></a><a data-type="indexterm" data-primary="" data-startref="ix_pkg_json_file" id="idm45475126471080"></a></p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="s2">"dependencies"</code><code class="o">:</code> <code class="p">{}</code></pre>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>npm provides <a href="https://oreil.ly/ifa4e">a decent developer guide for creating and installing a Node module</a>. You should consider the use of an <em>.npmignore</em> or <em>.gitignore</em> file for keeping stuff <em>out</em> of your module. And though this is beyond the scope of the book, you should also become familiar with Git and GitHub, and make use of it for your applications/modules.<a data-type="indexterm" data-primary="" data-startref="ix_npm_install_module" id="idm45475126413592"></a></p>
        </div>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Extra: The README File and Markdown Syntax"><div class="sect2" id="extra_readme_markdown_syntax">
        <h2>Extra: The README File and Markdown Syntax</h2>
        
        <p><a data-type="indexterm" data-primary="README files" id="ix_readme_file"></a><a data-type="indexterm" data-primary="Markdown syntax" id="ix_markdown"></a><a data-type="indexterm" data-primary="files" data-secondary="README" id="ix_file_readme"></a>When you package your module or library for reuse and upload it to a source repository such as GitHub, you’ll need to provide how-to information about installing the module/library and basic information about how to use it. For this, you need a README file.</p>
        
        <p>You’ve likely seen files named <em>README.md</em> with applications and Node modules. They’re text-based with some odd, unobtrusive markup that you’re not sure is useful, until you see it in a site like GitHub, where the README file provides all of the project page installation and usage information. The markup translates into HTML, making for readable web-based help.</p>
        
        <p>The content for the README is marked up with annotation known as Markdown. The popular website Daring Fireball calls Markdown easy to read and write, but “Readability, however, is emphasized above all else.” Unlike with HTML, the Markdown markup doesn’t get in the way of reading the text.</p>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p><a data-type="indexterm" data-primary="Daring Fireball" id="idm45475126393416"></a><a data-type="indexterm" data-primary="GitHub" id="idm45475126392712"></a>Daring Fireball also provides an <a href="https://oreil.ly/qkKRT">overview of generic Markdown</a>, but if you’re working with GitHub files, you might also want to check out <a href="https://help.github.com/en/github/writing-on-github">GitHub’s Flavored Markdown</a>.</p>
        </div>
        
        <p>Here is a sample <em>REAMDE.md</em> file:</p>
        
        <pre data-type="programlisting" data-code-language="text"># Project Title
        
        Provide a brief description of the project and what it does.
        If the project has a UI, include a screenshot as well.
        
        If more comprehensive documentation exists, link to it here.
        
        ## Features
        
        Describe the core features of the project (what does it do?)
        in the form of a bulleted list:
        
        - Feature #1
        - Feature #2
        - Feature #3
        
        ## Getting Started
        
        Provide installation instructions, general usage guidance, API examples,
        and build and deployment information. Assume as little prior knowledge
        as possible, describing everything in clear and coherent steps.
        
        ### Installation/Dependencies
        
        How does a user get up and running with your project? What dependencies
        does the project have? Aim to describe these in clear and simple steps.
        Provide external links.
        
        ### Usage
        
        Provide examples of how the project may be used. For large projects with
        external documentation, provide a few examples and link to the full docs here.
        
        ### Build/Deployment
        
        If the user will be building or deploying the project, add any useful guidance.
        
        ## Getting Help
        
        What should users do and expect when they encounter bugs or get stuck using
        your project? Set expectations for support, link to the issue tracker and
        roadmap, if applicable.
        
        Where should users go if they have a question? (Stack Overflow, Gitter, IRC,
        mailing list, etc.)
        
        If desired, you may also provide links to core contributor email addresses.
        
        ## Contributing Guidelines
        
        Include instructions for setting up the development environment, code standards,
        running tests, and submitting pull requests. It may be useful to link to a
        separate CONTRIBUTING.md file. See this example from the Hoodie project:
        https://github.com/hoodiehq/hoodie/blob/master/CONTRIBUTING.md
        
        ## Code of Conduct
        
        Provide a link to the Code of Conduct for your project. I recommend using the
        Contributor Covenant: http://contributor-covenant.org/
        
        ## License
        
        Include a license for your project. If you need help choosing a license,
        use this guide: https://choosealicense.com</pre>
        
        <p>Most popular text editors include Markdown syntax highlighting and previewing capabilities. There are also desktop Markdown editors available for all platforms. I can also use a CLI tool, like <a href="https://oreil.ly/Cc4GX">Pandoc</a>, to covert the <em>README.md</em> file into readable HTML:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">pandoc</code> <code class="nx">README</code><code class="p">.</code><code class="nx">md</code> <code class="o">-</code><code class="nx">o</code> <code class="nx">readme</code><code class="p">.</code><code class="nx">html</code></pre>
        
        <p><a data-type="xref" href="#generated_html_from_markdown">Figure&nbsp;18-1</a> displays the generated content. It’s not fancy, but it is eminently <span class="keep-together">readable</span>.</p>
        
        <figure class="no-frame"><div id="generated_html_from_markdown" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055747/files/assets/jsc3_1801.png" alt="jsc3 1801" width="1445" height="1073">
        <h6><span class="label">Figure 18-1. </span>Generated HTML from README.md text and Markdown annotation</h6>
        </div></figure>
        
        <p>When you host your source code at a site such as GitHub, GitHub uses the <em>README.md</em> file to generate the cover page for the repository.<a data-type="indexterm" data-primary="" data-startref="ix_modules_install" id="idm45475126367768"></a><a data-type="indexterm" data-primary="" data-startref="ix_file_readme" id="idm45475126366792"></a><a data-type="indexterm" data-primary="" data-startref="ix_readme_file" id="idm45475126365848"></a><a data-type="indexterm" data-primary="" data-startref="ix_markdown" id="idm45475126284264"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Writing Multiplatform Libraries"><div class="sect1" id="multiplatform">
        <h1>Writing Multiplatform Libraries</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475126281896">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="ES6 (ECMAScript 2015)" data-secondary="multiplatform libraries" id="idm45475126280696"></a><a data-type="indexterm" data-primary="libraries" data-secondary="multiplatform" id="ix_lib_multiplat"></a><a data-type="indexterm" data-primary="modules" data-secondary="multiplatform libraries" id="ix_module_multiplat"></a>You’ve created a library that is useful both in the browser and in Node.js, and would like to make it available in both environments.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475126276760">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="AMD (Asynchronous Module Definition)" id="idm45475126275352"></a><a data-type="indexterm" data-primary="CommonJS" id="idm45475126317896"></a>Use a bundling tool, such as Webpack, to bundle your library so that it works as an ES2015 module, CommonJS module, and AMD module, and can be loaded as a script tag in the browser.</p>
        
        <p><a data-type="indexterm" data-primary="Webpack" id="idm45475126316760"></a>In Webpack’s <em>webpack.config.js</em> file, include the <code>library</code> and <code>libraryTarget</code> fields, which signify that the module should be bundled as a library and target multiple environments:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">path</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'path'</code><code class="p">);</code>
        
        <code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="p">{</code>
          <code class="nx">entry</code><code class="o">:</code> <code class="s1">'./src/index.js'</code><code class="p">,</code>
          <code class="nx">output</code><code class="o">:</code> <code class="p">{</code>
            <code class="nx">path</code><code class="o">:</code> <code class="nx">path</code><code class="p">.</code><code class="nx">resolve</code><code class="p">(</code><code class="nx">__dirname</code><code class="p">,</code> <code class="s1">'dist'</code><code class="p">),</code>
            <code class="nx">filename</code><code class="o">:</code> <code class="s1">'my-library.js'</code><code class="p">,</code>
            <code class="nx">library</code><code class="o">:</code> <code class="s1">'myLibrary'</code><code class="p">,</code>
            <code class="nx">libraryTarget</code><code class="o">:</code> <code class="s1">'umd'</code><code class="p">,</code>
            <code class="nx">globalObject</code><code class="o">:</code> <code class="s1">'this'</code>
          <code class="p">},</code>
        <code class="p">};</code></pre>
        
        <p>The <code>library</code> field specifies a name for the library that will be used in ECMAScript, CommonJS, and AMD module environments. The <code>libraryTarget</code> field allows you to specify how the module will be exposed. The default is <code>var</code>, which will expose a variable. <a data-type="indexterm" data-primary="Universal Module Definition (UMD)" id="idm45475126224040"></a>Specifying <code>umd</code> will utilize the JavaScript <a href="https://oreil.ly/VSpd0">Universal Module Definition (UMD)</a>, enabling the ability for multiple module styles to consume the library. To make the UMD build available in both browser and Node.js environments, you will need to set the <code>output.globalObject</code> option to <code>this</code>.</p>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>For more details on using Webpack to bundle code, see <a data-type="xref" href="ch17.html#ch17">Chapter&nbsp;17</a>.</p>
        </div>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475126219080">
        <h2>Discussion</h2>
        
        <p>In the example, I’ve created a simple math library. Currently, the only function is one called <code>squareIt</code>, which accepts a number as a parameter and returns the value of that number multiplied by itself.  This is at <em>src/index.js</em>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">export</code> <code class="kd">function</code> <code class="nx">squareIt</code><code class="p">(</code><code class="nx">num</code><code class="p">)</code> <code class="p">{</code>
            <code class="k">return</code> <code class="nx">num</code> <code class="o">*</code> <code class="nx">num</code><code class="p">;</code>
        <code class="p">};</code></pre>
        
        <p>The <em>package.json</em> file contains Webpack and the Webpack command-line interface (CLI) as development dependencies. It also points the <code>main</code> distribution at the <span class="keep-together">
        bundled</span> version of the library, which Webpack will output to the <em>dist</em> folder. I’ve also added a build script that will run the Webpack bundler, aptly named <code>build</code>. This will allow me to generate the bundle by typing <code>npm run build</code> (or <code>yarn run build</code> if using Yarn).</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="p">{</code>
          <code class="s2">"name"</code><code class="o">:</code> <code class="s2">"my-library"</code><code class="p">,</code>
          <code class="s2">"version"</code><code class="o">:</code> <code class="s2">"1.0.0"</code><code class="p">,</code>
          <code class="s2">"description"</code><code class="o">:</code> <code class="s2">"An example library bundled by Webpack"</code><code class="p">,</code>
          <code class="s2">"main"</code><code class="o">:</code> <code class="s2">"dist/my-library.js"</code><code class="p">,</code>
          <code class="s2">"scripts"</code><code class="o">:</code> <code class="p">{</code>
            <code class="s2">"build"</code><code class="o">:</code> <code class="s2">"webpack"</code>
          <code class="p">},</code>
          <code class="s2">"keywords"</code><code class="o">:</code> <code class="p">[</code><code class="s2">"example"</code><code class="p">],</code>
          <code class="s2">"author"</code><code class="o">:</code> <code class="s2">"Adam Scott &lt;adam@jseverywhere.io&gt;"</code><code class="p">,</code>
          <code class="s2">"license"</code><code class="o">:</code> <code class="s2">"MIT"</code><code class="p">,</code>
          <code class="s2">"devDependencies"</code><code class="o">:</code> <code class="p">{</code>
            <code class="s2">"webpack"</code><code class="o">:</code> <code class="s2">"4.44.1"</code><code class="p">,</code>
            <code class="s2">"webpack-cli"</code><code class="o">:</code> <code class="s2">"3.3.12"</code>
          <code class="p">}</code>
        <code class="p">}</code></pre>
        
        <p>Finally, my project contains a <em>webpack.config.js</em>, as described in the recipe:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">path</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'path'</code><code class="p">);</code>
        
        <code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="p">{</code>
          <code class="nx">entry</code><code class="o">:</code> <code class="s1">'./src/index.js'</code><code class="p">,</code>
          <code class="nx">output</code><code class="o">:</code> <code class="p">{</code>
            <code class="nx">path</code><code class="o">:</code> <code class="nx">path</code><code class="p">.</code><code class="nx">resolve</code><code class="p">(</code><code class="nx">__dirname</code><code class="p">,</code> <code class="s1">'dist'</code><code class="p">),</code>
            <code class="nx">filename</code><code class="o">:</code> <code class="s1">'my-library.js'</code><code class="p">,</code>
            <code class="nx">library</code><code class="o">:</code> <code class="s1">'myLibrary'</code><code class="p">,</code>
            <code class="nx">libraryTarget</code><code class="o">:</code> <code class="s1">'umd'</code><code class="p">,</code>
            <code class="nx">globalObject</code><code class="o">:</code> <code class="s1">'this'</code>
          <code class="p">},</code>
        <code class="p">};</code></pre>
        
        <p>With this setup, the command <code>npm run build</code> will bundle the library and place it within the <em>dist</em> directory of the project. This bundled file is what consumers of the library will use.</p>
        <div data-type="tip"><h6>Tip</h6>
        <p><a data-type="indexterm" data-primary="testing" data-secondary="user acceptance" id="idm45475126000600"></a><a data-type="indexterm" data-primary="user acceptance testing" id="idm45475125999624"></a>To test the package locally, before publishing it to npm,  run <code>npm link</code> from the root of the project directory. Then in a separate project, where you’d like to use the module, type <code>npm link &lt;library name&gt;</code>. Doing so will create a symbolic link to the package, as though it is globally installed.</p>
        </div>
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="Publishing the library"><div class="sect3" id="idm45475125997528">
        <h3>Publishing the library</h3>
        
        <p><a data-type="indexterm" data-primary="npm (Node package manager)" data-secondary="publishing a library to" id="idm45475125995928"></a>Once your library is complete, you will most likely want to publish it to npm for distribution. Make sure that your project is version controlled with Git and has been pushed to a public remote repository (such as GitHub or GitLab).  From the root of your project’s directory:</p>
        
        <pre data-type="programlisting" data-code-language="bash"><code class="nv">$ </code>git init
        <code class="nv">$ </code>git remote add origin git://git-remote-url
        <code class="nv">$ </code>npm publish</pre>
        
        <p>Once published to a remote Git repository and the npm registry, the library can be consumed by running <code>npm install</code>, downloading or cloning the Git repository, or directly referencing the library in a web page using <em>https://unpkg.com/&lt;library-name&gt;</em>.  The library can be consumed across the multiple JavaScript library formats.</p>
        
        <p><a data-type="indexterm" data-primary="ES6 (ECMAScript 2015)" data-secondary="multiplatform libraries" id="idm45475125966824"></a>As an ES 2015 module:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="o">*</code> <code class="nx">as</code> <code class="nx">myLibrary</code> <code class="nx">from</code> <code class="s1">'my-library'</code><code class="p">;</code>
        
        <code class="nx">myLibrary</code><code class="p">.</code><code class="nx">squareIt</code><code class="p">(</code><code class="mi">4</code><code class="p">);</code></pre>
        
        <p><a data-type="indexterm" data-primary="CommonJS" id="idm45475125991304"></a>As a CommonJS module:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">myLibrary</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'my-library'</code><code class="p">);</code>
        
        <code class="nx">myLibrary</code><code class="p">.</code><code class="nx">squareIt</code><code class="p">(</code><code class="mi">4</code><code class="p">);</code></pre>
        
        <p><a data-type="indexterm" data-primary="AMD (Asynchronous Module Definition)" id="idm45475125919016"></a>As an AMD module:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">require</code><code class="p">([</code><code class="s1">'myLibrary'</code><code class="p">],</code> <code class="kd">function</code> <code class="p">(</code><code class="nx">myLibrary</code><code class="p">)</code> <code class="p">{</code>
          <code class="nx">myLibrary</code><code class="p">.</code><code class="nx">squareIt</code><code class="p">(</code><code class="mi">4</code><code class="p">);</code>
        <code class="p">});</code></pre>
        
        <p>And using a script tag on a web page:</p>
        
        <pre data-type="programlisting" data-code-language="html"><code class="cp">&lt;!doctype html&gt;</code>
        <code class="nt">&lt;html&gt;</code>
          <code class="nt">&lt;script </code><code class="na">src=</code><code class="s">"https://unpkg.com/my-library"</code><code class="nt">&gt;&lt;/script&gt;</code>
          <code class="nt">&lt;script&gt;</code>
            <code class="nx">myLibrary</code><code class="p">.</code><code class="nx">squareIt</code><code class="p">(</code><code class="mi">4</code><code class="p">);</code>
          <code class="nt">&lt;/script&gt;</code>
        <code class="nt">&lt;/html&gt;</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="Handling library dependencies"><div class="sect3" id="idm45475125882120">
        <h3>Handling library dependencies</h3>
        
        <p><a data-type="indexterm" data-primary="dependencies, managing" id="idm45475125850216"></a><a data-type="indexterm" data-primary="libraries" data-secondary="handling dependencies" id="idm45475125849320"></a>Oftentimes a library may contain subdependencies. With our current setup, all dependencies will be packaged and bundled with the library itself. To limit the outputted bundle and to ensure that library consumers are not installing multiple instances of a subdependency, it may be best to treat them as a “peer dependency,” which must also be installed or referenced on its own. <a data-type="indexterm" data-primary="Webpack" id="idm45475125847848"></a>To do so, add an <code>externals</code> property to your <em>webpack.config.js</em>. In the instance below, <code>moment</code> is being used as a peer dependency:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">path</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'path'</code><code class="p">);</code>
        
        <code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="p">{</code>
          <code class="nx">entry</code><code class="o">:</code> <code class="s1">'./src/index.js'</code><code class="p">,</code>
          <code class="nx">output</code><code class="o">:</code> <code class="p">{</code>
            <code class="nx">path</code><code class="o">:</code> <code class="nx">path</code><code class="p">.</code><code class="nx">resolve</code><code class="p">(</code><code class="nx">__dirname</code><code class="p">,</code> <code class="s1">'dist'</code><code class="p">),</code>
            <code class="nx">filename</code><code class="o">:</code> <code class="s1">'my-library.js'</code><code class="p">,</code>
            <code class="nx">library</code><code class="o">:</code> <code class="s1">'myLibrary'</code><code class="p">,</code>
            <code class="nx">libraryTarget</code><code class="o">:</code> <code class="s1">'umd'</code><code class="p">,</code>
            <code class="nx">globalObject</code><code class="o">:</code> <code class="s1">'this'</code>
          <code class="p">},</code>
          <code class="nx">externals</code><code class="o">:</code> <code class="p">{</code>
            <code class="nx">moment</code><code class="o">:</code> <code class="p">{</code>
              <code class="nx">commonjs</code><code class="o">:</code> <code class="s1">'moment'</code><code class="p">,</code>
              <code class="nx">commonjs2</code><code class="o">:</code> <code class="s1">'moment'</code><code class="p">,</code>
              <code class="nx">amd</code><code class="o">:</code> <code class="s1">'moment'</code><code class="p">,</code>
              <code class="nx">root</code><code class="o">:</code> <code class="s1">'moment'</code><code class="p">,</code>
            <code class="p">}</code>
          <code class="p">}</code>
        <code class="p">};</code></pre>
        
        <p>With this configuration, <code>moment</code> will be treated as a global variable by our library.<a data-type="indexterm" data-primary="" data-startref="ix_module_multiplat" id="idm45475125805752"></a><a data-type="indexterm" data-primary="" data-startref="ix_lib_multiplat" id="idm45475125700968"></a></p>
        </div></section>
        
        
        
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Unit Testing Your Modules"><div class="sect1" id="unit_testing_node_modules">
        <h1>Unit Testing Your Modules</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475125698504">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="unit testing" data-secondary="Node modules" id="ix_unit_test_module"></a><a data-type="indexterm" data-primary="testing" data-secondary="Node modules" id="ix_test_module"></a><a data-type="indexterm" data-primary="modules" data-secondary="unit testing of" id="ix_module_unit_test"></a>You want to make sure your module is functioning correctly and ready to be used by others.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475125693128">
        <h2>Solution</h2>
        
        <p>Add <em>unit tests</em> as part of your production process.</p>
        
        <p>Given the following module, named <code>bbarray</code>, and created in a file named <em>index.js</em>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">util</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'util'</code><code class="p">);</code>
        
        <code class="kr">const</code> <code class="nx">bbarray</code> <code class="o">=</code> <code class="p">{</code>
          <code class="nx">concatArray</code><code class="o">:</code> <code class="p">(</code><code class="nx">str</code><code class="p">,</code> <code class="nx">array</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">util</code><code class="p">.</code><code class="nx">isArray</code><code class="p">(</code><code class="nx">array</code><code class="p">)</code> <code class="o">||</code> <code class="nx">array</code><code class="p">.</code><code class="nx">length</code> <code class="o">===</code> <code class="mi">0</code><code class="p">)</code> <code class="p">{</code>
              <code class="k">return</code> <code class="o">-</code><code class="mi">1</code><code class="p">;</code>
            <code class="p">}</code>
        
            <code class="k">if</code> <code class="p">(</code><code class="k">typeof</code> <code class="nx">str</code> <code class="o">!==</code> <code class="s1">'string'</code><code class="p">)</code> <code class="p">{</code>
              <code class="k">return</code> <code class="o">-</code><code class="mi">1</code><code class="p">;</code>
            <code class="p">}</code>
        
            <code class="k">return</code> <code class="nx">array</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">element</code> <code class="o">=&gt;</code> <code class="p">{</code>
              <code class="k">return</code> <code class="sb">`</code><code class="si">${</code><code class="nx">str</code><code class="si">}</code><code class="sb"> </code><code class="si">${</code><code class="nx">element</code><code class="si">}</code><code class="sb">`</code><code class="p">;</code>
            <code class="p">});</code>
          <code class="p">},</code>
          <code class="nx">splitArray</code><code class="o">:</code> <code class="p">(</code><code class="nx">str</code><code class="p">,</code> <code class="nx">array</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">util</code><code class="p">.</code><code class="nx">isArray</code><code class="p">(</code><code class="nx">array</code><code class="p">)</code> <code class="o">||</code> <code class="nx">array</code><code class="p">.</code><code class="nx">length</code> <code class="o">===</code> <code class="mi">0</code><code class="p">)</code> <code class="p">{</code>
              <code class="k">return</code> <code class="o">-</code><code class="mi">1</code><code class="p">;</code>
            <code class="p">}</code>
        
            <code class="k">if</code> <code class="p">(</code><code class="k">typeof</code> <code class="nx">str</code> <code class="o">!==</code> <code class="s1">'string'</code><code class="p">)</code> <code class="p">{</code>
              <code class="k">return</code> <code class="o">-</code><code class="mi">1</code><code class="p">;</code>
            <code class="p">}</code>
        
            <code class="k">return</code> <code class="nx">array</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">element</code> <code class="o">=&gt;</code> <code class="p">{</code>
              <code class="k">return</code> <code class="nx">element</code><code class="p">.</code><code class="nx">substring</code><code class="p">(</code><code class="nx">str</code><code class="p">.</code><code class="nx">length</code> <code class="o">+</code> <code class="mi">1</code><code class="p">);</code>
            <code class="p">});</code>
          <code class="p">}</code>
        <code class="p">};</code>
        
        <code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="nx">bbarray</code><code class="p">;</code></pre>
        
        <p><a data-type="indexterm" data-primary="Jest" id="ix_jest_test_2"></a>Using <a href="https://jestjs.io">Jest</a>, a JavaScript testing framework, the following unit test (created as <em>index.js</em> and located in the project’s <em>test</em> subdirectory) should result in the successful pass of six tests:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">bbarray</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'../index.js'</code><code class="p">);</code>
        
        <code class="nx">describe</code><code class="p">(</code><code class="s1">'concatArray()'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="nx">test</code><code class="p">(</code><code class="s1">'should return -1 when not using array'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="nx">expect</code><code class="p">(</code><code class="nx">bbarray</code><code class="p">.</code><code class="nx">concatArray</code><code class="p">(</code><code class="mi">9</code><code class="p">,</code> <code class="s1">'str'</code><code class="p">)).</code><code class="nx">toBe</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">);</code>
          <code class="p">});</code>
        
          <code class="nx">test</code><code class="p">(</code><code class="s1">'should return -1 when not using string'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="nx">expect</code><code class="p">(</code><code class="nx">bbarray</code><code class="p">.</code><code class="nx">concatArray</code><code class="p">(</code><code class="mi">9</code><code class="p">,</code> <code class="p">[</code><code class="s1">'test'</code><code class="p">,</code> <code class="s1">'two'</code><code class="p">])).</code><code class="nx">toBe</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">);</code>
          <code class="p">});</code>
        
          <code class="nx">test</code><code class="p">(</code><code class="s1">'should return an array with proper args'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="nx">expect</code><code class="p">(</code><code class="nx">bbarray</code><code class="p">.</code><code class="nx">concatArray</code><code class="p">(</code><code class="s1">'is'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'test'</code><code class="p">,</code> <code class="s1">'three'</code><code class="p">])).</code><code class="nx">toStrictEqual</code><code class="p">([</code>
              <code class="s1">'is test'</code><code class="p">,</code>
              <code class="s1">'is three'</code>
            <code class="p">]);</code>
          <code class="p">});</code>
        <code class="p">});</code>
        
        <code class="nx">describe</code><code class="p">(</code><code class="s1">'splitArray()'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="nx">test</code><code class="p">(</code><code class="s1">'should return -1 when not using array'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="nx">expect</code><code class="p">(</code><code class="nx">bbarray</code><code class="p">.</code><code class="nx">splitArray</code><code class="p">(</code><code class="mi">9</code><code class="p">,</code> <code class="s1">'str'</code><code class="p">)).</code><code class="nx">toBe</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">);</code>
          <code class="p">});</code>
        
          <code class="nx">test</code><code class="p">(</code><code class="s1">'should return -1 when not using string'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="nx">expect</code><code class="p">(</code><code class="nx">bbarray</code><code class="p">.</code><code class="nx">splitArray</code><code class="p">(</code><code class="mi">9</code><code class="p">,</code> <code class="p">[</code><code class="s1">'test'</code><code class="p">,</code> <code class="s1">'two'</code><code class="p">])).</code><code class="nx">toBe</code><code class="p">(</code><code class="o">-</code><code class="mi">1</code><code class="p">);</code>
          <code class="p">});</code>
        
          <code class="nx">test</code><code class="p">(</code><code class="s1">'should return an array with proper args'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="nx">expect</code><code class="p">(</code><code class="nx">bbarray</code><code class="p">.</code><code class="nx">splitArray</code><code class="p">(</code><code class="s1">'is'</code><code class="p">,</code> <code class="p">[</code><code class="s1">'is test'</code><code class="p">,</code> <code class="s1">'is three'</code><code class="p">])).</code><code class="nx">toStrictEqual</code><code class="p">([</code>
              <code class="s1">'test'</code><code class="p">,</code>
              <code class="s1">'three'</code>
            <code class="p">]);</code>
          <code class="p">});</code>
        <code class="p">});</code></pre>
        
        <p>The result of the test is shown in <a data-type="xref" href="#result_of_jest_test">Figure&nbsp;18-2</a>, run using <code>npm test</code>.</p>
        
        <figure><div id="result_of_jest_test" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055747/files/assets/jsc3_1802.png" alt="jsc3 1802" width="1445" height="825">
        <h6><span class="label">Figure 18-2. </span>Running unit tests based on Jest</h6>
        </div></figure>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475125267480">
        <h2>Discussion</h2>
        
        <p><a data-type="indexterm" data-primary="unit testing" data-secondary="writing tests with Jest" id="idm45475125689416"></a>A <em>unit test</em> is a way that developers test their code to ensure it meets the specifications. It involves testing functional behavior, and seeing what happens when you send bad arguments—or no arguments at all. It’s called unit testing because it’s used with individual units of code, such as testing one module in a Node application, as compared to testing the entire Node application. <a data-type="indexterm" data-primary="testing" data-secondary="integration" id="idm45475125264232"></a><a data-type="indexterm" data-primary="testing" data-secondary="user acceptance" id="idm45475125263256"></a><a data-type="indexterm" data-primary="user acceptance testing" id="idm45475125262312"></a><a data-type="indexterm" data-primary="integration testing" id="idm45475125261640"></a>It becomes one part of <em>integration testing</em>, where all the pieces are plugged together, before going to <em>user acceptance testing</em>: testing to ensure that the application does what users expect it to do (and that they generally don’t hate it when they use it).</p>
        
        <p>Unit testing is one of those development tasks that may seem like a pain when you first start, but can soon become second nature. A good goal is to develop both tests and code in parallel to one another. <a data-type="indexterm" data-primary="TDD (Test-Driven Development)" id="idm45475125259352"></a>Many developers even practice <em>test-driven development</em>, where unit tests are written prior to the code itself.</p>
        
        <p>In the solution, we use Jest, a sophisticated testing framework. The module is simple, so we’re not using some of the more complex Jest testing mechanisms. However, this provides an example of the building blocks of writing unit tests.</p>
        
        <p>To install Jest, use the following:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">install</code> <code class="nx">jest</code> <code class="o">--</code><code class="nx">save</code><code class="o">-</code><code class="nx">dev</code></pre>
        
        <p>I’m using the <code>--save-dev</code> flag, because I’m installing Jest into the module’s development dependencies. In addition, I modify the module’s <em>package.json</em> file to add the following section:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"> <code class="s2">"scripts"</code><code class="o">:</code> <code class="p">{</code>
            <code class="s2">"test"</code><code class="o">:</code> <code class="s2">"jest"</code>
          <code class="p">},</code></pre>
        
        <p>The test script is saved as <em>index.js</em> in the <em>tests</em> subdirectory under the project. Jest automatically looks for files in a <em>tests</em> directory or files following the <em>filename.test.js</em> naming pattern. The following command runs the test:<a data-type="indexterm" data-primary="" data-startref="ix_modules_ch18" id="idm45475125229576"></a><a data-type="indexterm" data-primary="" data-startref="ix_module_unit_test" id="idm45475125228600"></a><a data-type="indexterm" data-primary="" data-startref="ix_unit_test_module" id="idm45475125227656"></a><a data-type="indexterm" data-primary="" data-startref="ix_test_module" id="idm45475125226712"></a><a data-type="indexterm" data-primary="" data-startref="ix_jest_test_2" id="idm45475125225768"></a></p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">test</code></pre>
        
        <p>The Jest unit tests makes use of <a href="https://oreil.ly/E7RnY"><em>expect matchers</em></a> to test for the returned values.</p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        </div></section></div></div><link rel="stylesheet" href="/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="/api/v2/epubs/urn:orm:book:9781492055747/files/epub.css" crossorigin="anonymous"></div></div></section>
</div>

https://learning.oreilly.com