<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
    
</style>
<link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492092506/files/epub.css" crossorigin="anonymous">
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 16. Writing Web Applications"><div class="chapter" id="ch16">
        <h1><span class="label">Chapter 16. </span>Writing Web Applications</h1>
        
        
        <p><a data-type="indexterm" data-primary="web apps/APIs" id="ix_web_apps_ch16"></a>While JavaScript was once used to add simple interactivity to web pages, today it can be used to build complicated and fully featured software applications that run in a web browser. The possibilities include mapping, email clients, streaming video sites, real-time chat applications, and much more. The line between “website” and “application” can be fuzzy, but one way to think about it is that an application is any site that takes user input and returns something as a result.</p>
        
        <p>As a developer, you can develop these applications and deploy them instantly across the world, but this ability comes with unique challenges. As an application code base grows, you will need to split your codebase into smaller modules and ensure that users are receiving optimized code bundles. You will need to create features and experiences that compete with those of native mobile applications, such as offline functionality, notifications, and application icons. Thankfully, modern JavaScript and browser APIs enable these feature-rich experiences.</p>
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Bundling JavaScript"><div class="sect1" id="webpack-bundle">
        <h1>Bundling JavaScript</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475134383784">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="web apps/APIs" data-secondary="bundling JavaScript" id="ix_web_apps_bundle"></a>You want to make use of JavaScript modules in a browser environment.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475134380920">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="Webpack" id="ix_webpack"></a>Make use of native JavaScript modules or a bundling tool, such as <a href="https://webpack.js.org">Webpack</a>.</p>
        
        <p>Native JavaScript is supported in <a href="https://oreil.ly/FhPq9">all modern browsers</a>. If we have a simple module that exports a value, named <code>mod.js</code>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">export</code> <code class="kr">const</code> <code class="nx">name</code> <code class="o">=</code> <code class="s1">'Riley'</code><code class="p">;</code></pre>
        
        <p>we can use the module natively in an HTML file:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="o">&lt;</code><code class="nx">script</code> <code class="nx">type</code><code class="o">=</code><code class="s1">'module'</code><code class="o">&gt;</code>
          <code class="kr">import</code> <code class="p">{</code><code class="nx">name</code><code class="p">}</code> <code class="nx">from</code> <code class="s1">'./mod.js'</code><code class="p">;</code>
          <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">name</code><code class="p">);</code>
        <code class="o">&lt;</code><code class="err">/script&gt;</code></pre>
        
        <p>For more advanced applications and sites, you may benefit from using a bundling tool that can optimize your modules. To use Webpack as a bundling tool, first install its dependencies with npm:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">install</code> <code class="nx">webpack</code> <code class="nx">webpack</code><code class="o">-</code><code class="nx">cli</code> <code class="o">--</code><code class="nx">save</code><code class="o">-</code><code class="nx">dev</code></pre>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p><a data-type="indexterm" data-primary="files" data-secondary="package.json file" id="idm45475134303880"></a><a data-type="indexterm" data-primary="Node" data-secondary="installing/maintaining with npm" id="idm45475134302744"></a><a data-type="indexterm" data-primary="npm (Node package manager)" data-secondary="installing" id="idm45475134301832"></a><a data-type="indexterm" data-primary="package.json file" id="idm45475134300920"></a>Before you are able to install packages from npm, your project will need a <em>package.json</em> file. To generate this file, make sure you are in the root of your project’s directory and type <code>npm init</code>. The command-line interface will then guide you through a series of prompts. Additional information about installing and using npm is in <a data-type="xref" href="ch01.html#ch01">Chapter&nbsp;1</a>.</p>
        </div>
        
        <p>We can then create a file named <em>webpack.config.js</em> in the root of the project directory, where we specify the entry file and output directory:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">path</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'path'</code><code class="p">);</code>
        
        <code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="p">{</code>
          <code class="nx">entry</code><code class="o">:</code> <code class="s1">'./src/index.js'</code><code class="p">,</code>
          <code class="nx">output</code><code class="o">:</code> <code class="p">{</code>
            <code class="nx">filename</code><code class="o">:</code> <code class="s1">'bundle.js'</code><code class="p">,</code>
            <code class="nx">path</code><code class="o">:</code> <code class="nx">path</code><code class="p">.</code><code class="nx">resolve</code><code class="p">(</code><code class="nx">__dirname</code><code class="p">,</code> <code class="s1">'dist'</code><code class="p">)</code>
          <code class="p">}</code>
        <code class="p">};</code></pre>
        
        <p>Finally, add a script to the <em>package.json</em> to run the Webpack build:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="s2">"scripts"</code><code class="o">:</code> <code class="p">{</code>
          <code class="p">...</code>
          <code class="s2">"build"</code><code class="o">:</code> <code class="s2">"webpack"</code>
        <code class="p">}</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475134380456">
        <h2>Discussion</h2>
        
        <p>JavaScript modules are now widely available and supported by browsers. This allows us to break our code into smaller, more maintainble pieces.</p>
        
        <p>Webpack is a popular tool for compiling JavaScript modules. The power of Webpack lies in the configuration file.</p>
        
        <p>In the previous configuration file, we are instructing Webpack to look at the <em>src</em> directory for a file named <em>index.js</em>. This file will be the entry file for our project’s JavaScript:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">foo</code> <code class="nx">from</code> <code class="s1">'./foo.js'</code><code class="p">;</code>
        <code class="kr">import</code> <code class="nx">bar</code> <code class="nx">from</code> <code class="s1">'./bar.js'</code><code class="p">;</code>
        
        <code class="nx">foo</code><code class="p">();</code>
        <code class="nx">bar</code><code class="p">();</code></pre>
        
        <p>The <em>index.js</em> file is importing two additional files, <em>foo.js</em> and <em>bar.js</em>.</p>
        
        <p>When the <code>build</code> script is run, Webpack will output a new minified file named <em>bundle.js</em> in the <em>dist</em> directory.</p>
        
        <p>Compiling simple import statements is only the tip of the iceberg. Webpack can be used for hot module reloading,  code splitting, browser support shims, and even as a development server. In <a data-type="xref" href="#mobile-web">“JavaScript and the Mobile Web”</a>, we’ll explore how Webpack can be used to reduce the size of a JavaScript bundle.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Extra: Using npm Modules"><div class="sect2" id="idm45475134045672">
        <h2>Extra: Using npm Modules</h2>
        
        <p><a data-type="indexterm" data-primary="npm (Node package manager)" data-secondary="with Webpack" data-secondary-sortas="Webpack" id="idm45475134044296"></a>In addition to using your own modules, Webpack enables you to download and utilize modules directly from <a href="https://www.npmjs.com">npm</a>. To do so, first install the module and save it as a dependency to the project:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">install</code> <code class="nx">some</code><code class="o">-</code><code class="nx">module</code> <code class="o">--</code><code class="nx">save</code></pre>
        
        <p>You can then require the module directly in your code, without needing to specify the path to the module:<a data-type="indexterm" data-primary="" data-startref="ix_web_apps_bundle" id="idm45475133992296"></a><a data-type="indexterm" data-primary="" data-startref="ix_webpack" id="idm45475133991560"></a></p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">some</code><code class="o">-</code><code class="nx">code</code> <code class="nx">from</code> <code class="s1">'some-module'</code></pre>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="JavaScript and the Mobile Web"><div class="sect1" id="mobile-web">
        <h1>JavaScript and the Mobile Web</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475133955224">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="mobile web loading time issue" id="ix_mobile_web_apps"></a><a data-type="indexterm" data-primary="web apps/APIs" data-secondary="mobile web loading time issue" id="ix_web_apps_mobile"></a>Your website or application makes use of JavaScript, which can noticeably increase the time to load on mobile and slow connections.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475133951400">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="minification of JavaScript" id="idm45475133949832"></a><a data-type="indexterm" data-primary="UglifyJS" id="idm45475133949160"></a>For sites using a small amount of JavaScript in a single file, use a tool such as <a href="https://github.com/mishoo/UglifyJS">UglifyJS</a> to minify your JavaScript. Minification will reduce the size of a JavaScript file by removing unnecessary characters (such as whitespace).</p>
        
        <p>To use UglifyJS, first install it with npm:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">install</code> <code class="nx">uglify</code><code class="o">-</code><code class="nx">js</code></pre>
        
        <p>Then, add a script to your <em>package.json</em> file, specifying the input JavaScript file and a name for the minified file:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="s2">"scripts"</code><code class="o">:</code> <code class="p">{</code>
          <code class="s2">"minify"</code><code class="o">:</code> <code class="s2">"uglifyjs index.js --output index.min.js"</code>
        <code class="p">}</code></pre>
        
        <p><a data-type="indexterm" data-primary="Webpack" id="ix_webpack2"></a>For larger sites and applications with multiple JavaScript files, use a bundling tool, such as <a href="https://webpack.js.org">Webpack</a>, to perform a combination of minification, code splitting, tree shaking, and lazy loading.</p>
        
        <p>Webpack automatically minifies its output in production mode, meaning that no specific configuration or minification tool is needed.</p>
        
        <p><a data-type="indexterm" data-primary="code splitting" id="idm45475133877832"></a>Code splitting is the process of generating multiple bundles, so that HTML pages or templates only load the code they need. The following <em>webpack.config.js</em> file will output two JavaScript files (<em>index.bundle.js</em> and <em>secondary.bundle.js</em>)  to the <em>dist</em> directory:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">path</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'path'</code><code class="p">);</code>
        
        <code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="p">{</code>
          <code class="nx">entry</code><code class="o">:</code> <code class="p">{</code>
            <code class="nx">index</code><code class="o">:</code> <code class="s1">'./src/index.js'</code><code class="p">,</code>
            <code class="nx">secondary</code><code class="o">:</code> <code class="s1">'./src/secondary.js'</code><code class="p">,</code>
          <code class="p">},</code>
          <code class="nx">output</code><code class="o">:</code> <code class="p">{</code>
            <code class="nx">filename</code><code class="o">:</code> <code class="s1">'[name].bundle.js'</code><code class="p">,</code>
            <code class="nx">path</code><code class="o">:</code> <code class="nx">path</code><code class="p">.</code><code class="nx">resolve</code><code class="p">(</code><code class="nx">__dirname</code><code class="p">,</code> <code class="s1">'dist'</code><code class="p">),</code>
          <code class="p">},</code>
        <code class="p">};</code></pre>
        
        <p><a data-type="indexterm" data-primary="tree shaking" id="idm45475133753352"></a>Bundles can balloon in size, particularly when importing third-party libraries with functionality that may not be needed. <em>Tree shaking</em> is the concept of eliminating dead or unused code. Webpack can be configured to eliminate dead code with the <code>optimization</code> setting:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="p">{</code>
          <code class="nx">mode</code><code class="o">:</code> <code class="s1">'development'</code><code class="p">,</code>
          <code class="nx">entry</code><code class="o">:</code> <code class="p">{</code>
            <code class="nx">index</code><code class="o">:</code> <code class="s1">'./src/index.js'</code><code class="p">,</code>
            <code class="nx">secondary</code><code class="o">:</code> <code class="s1">'./src/secondary.js'</code>
          <code class="p">},</code>
          <code class="nx">output</code><code class="o">:</code> <code class="p">{</code>
            <code class="nx">filename</code><code class="o">:</code> <code class="s1">'[name].bundle.js'</code><code class="p">,</code>
            <code class="nx">path</code><code class="o">:</code> <code class="nx">path</code><code class="p">.</code><code class="nx">resolve</code><code class="p">(</code><code class="nx">__dirname</code><code class="p">,</code> <code class="s1">'dist'</code><code class="p">)</code>
          <code class="p">},</code>
          <code class="nx">optimization</code><code class="o">:</code> <code class="p">{</code>
            <code class="nx">usedExports</code><code class="o">:</code> <code class="kc">true</code>
          <code class="p">}</code>
        <code class="p">};</code></pre>
        
        <p class="pagebreak-before less_space"><a data-type="indexterm" data-primary="side effect" id="idm45475133795528"></a>The final step for code splitting is to add a <code>sideEffects</code> field to the project’s <em>package.json</em> file. According to the Webpack documentation, “a <em>side effect</em> is defined as code that performs a special behavior when imported, other than exposing one or more exports.” <a data-type="indexterm" data-primary="polyfills" id="idm45475133715784"></a>An example of a side effect would be a global polyfill, which does not expose any <code>export</code> statements.</p>
        
        <p>If no such file is present, we can set the following in <em>package.json</em>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="s2">"sideEffects"</code><code class="o">:</code> <code class="kc">false</code></pre>
        
        <p>If your project does have JavaScript files that would fall under the “side effect” category, we can provide them as an array:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="s2">"sideEffects"</code><code class="o">:</code> <code class="p">[</code>
          <code class="s2">"./src/file-with-side-effect.js"</code>
        <code class="p">]</code></pre>
        
        <p><a data-type="indexterm" data-primary="lazy loading" id="idm45475133712408"></a>Finally, we can utilize Webpack to enable the lazy loading of JavaScript modules, only loading them when they are needed by a browser interaction. Webpack makes this straightforward with a dynamic <code>import</code> statements. With a file named <em>button.js</em> in the <em>src</em> directory, the contents of the file can be loaded when a user clicks a button. In <em>index.js</em>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">buttonElement</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'button'</code><code class="p">);</code>
        <code class="nx">buttonElement</code><code class="p">.</code><code class="nx">onclick</code> <code class="o">=</code> <code class="nx">e</code> <code class="o">=&gt;</code>
          <code class="kr">import</code><code class="p">(</code><code class="cm">/* webpackChunkName: "button" */</code> <code class="s1">'./button'</code><code class="p">).</code><code class="nx">then</code><code class="p">(</code><code class="nx">module</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="kr">const</code> <code class="nx">button</code> <code class="o">=</code> <code class="nx">module</code><code class="p">.</code><code class="k">default</code><code class="p">;</code>
            <code class="nx">button</code><code class="p">();</code>
          <code class="p">});</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475133950808">
        <h2>Discussion</h2>
        
        <p>The fastest JavaScript is no JavaScript; however, the interactive demands of modern web applications often rely on client-side JavaScript. With that in mind, our goal is to limit the amount and file size of the JavaScript being downloaded by a user’s browser. Utilizing strategies such as minification, code splitting, tree shaking, and lazy loading allows you finer control over size and amount of JavaScript being loaded in a user’s browser.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45475133595944">
        <h2>See Also</h2>
        
        <p>Webpack’s <a href="https://oreil.ly/TAnYG">Getting Started guide</a> is a useful introduction to code bundling and Webpack configuration files.<a data-type="indexterm" data-primary="" data-startref="ix_web_apps_mobile" id="idm45475133593928"></a><a data-type="indexterm" data-primary="" data-startref="ix_mobile_web_apps" id="idm45475133592952"></a><a data-type="indexterm" data-primary="" data-startref="ix_webpack2" id="idm45475133592008"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" class="pagebreak-before less_space" data-pdf-bookmark="Writing a Progressive Web Application"><div class="sect1" id="progressive-web-app">
        <h1>Writing a Progressive Web Application</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475133589144">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="PWAs (progressive web applications)" id="ix_pwas_web_apps"></a><a data-type="indexterm" data-primary="web apps/APIs" data-secondary="progressive web applications" id="ix_web_apps_pwas"></a>You’d like your web application to take advantage of native application features such as fast load times, offline functionality, and app launching icons.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475133585256">
        <h2>Solution</h2>
        
        <p>Turn your web application into a Progressive Web Application (PWA). The phrase “Progressive Web Applications” was coined to describe a set of technologies that, when combined, enable web applications to use native-like features, such as offline functionality and user-installed app icons, while being built with standard web technologies and deployed to the web.</p>
        
        <p>All PWAs are required to include two features that extend beyond that of a typical web page:</p>
        <dl>
        <dt><a data-type="indexterm" data-primary="application manifest" id="idm45475133581720"></a>Application manifest</dt>
        <dd>
        <p>Defines application specific features for the browser.</p>
        </dd>
        <dt>Service worker</dt>
        <dd>
        <p>Enables the application’s offline functionality.</p>
        </dd>
        </dl>
        
        <p>The first step in creating a progressive web application is to add the web app manifest file. This file enables developers to control things like application icons, splash screens,  browser  display style, and view orientation. In a file named <em>manifest.json</em>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript" class="small"><code class="p">{</code>
          <code class="s2">"name"</code><code class="o">:</code> <code class="s2">"JavaScript Everywhere"</code><code class="p">,</code>
          <code class="s2">"short_name"</code><code class="o">:</code> <code class="s2">"JavaScript"</code><code class="p">,</code>
          <code class="s2">"start_url"</code><code class="o">:</code> <code class="s2">"/index.html"</code><code class="p">,</code>
          <code class="s2">"display"</code><code class="o">:</code> <code class="s2">"standalone"</code><code class="p">,</code>
          <code class="s2">"background_color"</code><code class="o">:</code> <code class="s2">"#ffc40d"</code><code class="p">,</code>
          <code class="s2">"theme_color"</code><code class="o">:</code> <code class="s2">"#ffc40d"</code><code class="p">,</code>
          <code class="s2">"icons"</code><code class="o">:</code> <code class="p">[</code>
            <code class="p">{</code>
              <code class="s2">"src"</code><code class="o">:</code> <code class="s2">"/images/icons/icon-192x192.png"</code><code class="p">,</code>
              <code class="s2">"sizes"</code><code class="o">:</code> <code class="s2">"192x192"</code><code class="p">,</code>
              <code class="s2">"type"</code><code class="o">:</code> <code class="s2">"image/png"</code>
            <code class="p">},</code>
            <code class="p">{</code>
              <code class="s2">"src"</code><code class="o">:</code> <code class="s2">"/images/icons/icon-512x512.png"</code><code class="p">,</code>
              <code class="s2">"sizes"</code><code class="o">:</code> <code class="s2">"512x512"</code><code class="p">,</code>
              <code class="s2">"type"</code><code class="o">:</code> <code class="s2">"image/png"</code>
            <code class="p">}</code>
          <code class="p">]</code>
        <code class="p">}</code></pre>
        
        <p>Now, in your HTML files or templates, add a reference to the manifest file and appropriate application icons in the document’s <code>&lt;head&gt;</code>.</p>
        <div id="pws_meta_tags" data-type="example">
        <h5><span class="label">Example 16-1. </span>PWA Metatags</h5>
        
        <pre data-type="programlisting" data-code-language="html" class="small"><code class="c">&lt;!-- link to manifest.json file --&gt;</code>
        <code class="nt">&lt;link</code> <code class="na">rel=</code><code class="s">"manifest"</code> <code class="na">href=</code><code class="s">"manifest.json"</code> <code class="nt">/&gt;</code>
        <code class="c">&lt;!-- link to iOS icons --&gt;</code>
        <code class="nt">&lt;link</code> <code class="na">rel=</code><code class="s">"apple-touch-icon"</code> <code class="na">sizes=</code><code class="s">"180x180"</code> <code class="na">href=</code><code class="s">"images/icons/apple-touch-icon.png"</code> <code class="nt">/&gt;</code>
        <code class="c">&lt;!-- Microsoft application tile icons and color settings --&gt;</code>
        <code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"msapplication-TileColor"</code> <code class="na">content=</code><code class="s">"#ffc40d"</code> <code class="nt">/&gt;</code>
        <code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"msapplication-TileImage"</code> <code class="na">content=</code><code class="s">"/img/icons/mstile-310x310.png"</code> <code class="nt">/&gt;</code>
        <code class="c">&lt;!-- set theme color --&gt;</code>
        <code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"theme-color"</code> <code class="na">content=</code><code class="s">"#ffc40d"</code> <code class="nt">/&gt;</code></pre></div>
        
        <p>The PWA install prompt is automatically triggered in Chrome when a website meets the PWA criteria (see <a data-type="xref" href="#manifest_chrome">Figure&nbsp;16-1</a>). Once installed, the PWA’s icon appears on the user’s device, much like a native application (<a data-type="xref" href="#ios_app">Figure&nbsp;16-2</a>).</p>
        
        <figure class="no-frame"><div id="manifest_chrome" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055747/files/assets/jsc3_1601.png" alt="A screenshot of the install prompt in Chrome" width="631" height="345">
        <h6><span class="label">Figure 16-1. </span>PWA install prompt</h6>
        </div></figure>
        
        <figure class="no-frame width-25"><div id="ios_app" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055747/files/assets/jsc3_1602.png" alt="A screenshot of the app icon on a mobile device" width="605" height="1072">
        <h6><span class="label">Figure 16-2. </span>The application can be saved to a mobile device</h6>
        </div></figure>
        
        <p><a data-type="indexterm" data-primary="service workers" id="ix_serv_worker"></a>The second step is to create a service worker. A service worker is a script that runs separately from the page, providing us with a way to make our sites work offline, run faster, and add capabilities for background features. With the limits of mobile connectivity, service workers provide us with a means to build offline-first capable <span class="keep-together">
        applications</span>, which will load content for our users after an initial site visit, regardless of network conditions. Best of all, service workers are truly a progressive enhancement, layering on an additional feature to supporting browsers without changing the functionality of our site for users of nonsupporting browsers.</p>
        
        <p>When introducing a service worker, the initial step is to register the script that will contain our service worker code with the user’s browser. To accomplish this, add the script registration to the bottom of the page just before the closing <code>&lt;/body&gt;</code> tag:</p>
        
        <pre data-type="programlisting" data-code-language="html"><code class="c">&lt;!-- initiate the service worker --&gt;</code>
        <code class="nt">&lt;script&gt;</code>
          <code class="k">if</code> <code class="p">(</code><code class="s1">'serviceWorker'</code> <code class="k">in</code> <code class="nx">navigator</code><code class="p">)</code> <code class="p">{</code>
            <code class="nb">window</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'load'</code><code class="p">,</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
              <code class="nx">navigator</code><code class="p">.</code><code class="nx">serviceWorker</code>
                <code class="p">.</code><code class="nx">register</code><code class="p">(</code><code class="s1">'service-worker.js'</code><code class="p">)</code>
                <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">reg</code> <code class="o">=&gt;</code> <code class="p">{</code>
                  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Service worker registered!'</code><code class="p">,</code> <code class="nx">reg</code><code class="p">);</code>
                <code class="p">})</code>
                <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">err</code> <code class="o">=&gt;</code> <code class="p">{</code>
                  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Service worker registration failed: '</code><code class="p">,</code> <code class="nx">err</code><code class="p">);</code>
                <code class="p">});</code>
            <code class="p">});</code>
          <code class="p">}</code>
        <code class="nt">&lt;/script&gt;</code></pre>
        
        <p>This script checks for service worker support, and if the support is available, points the browser to a service worker script (in this case <em>service-worker.js</em>). For debugging purposes, the script also catches errors and logs them to the console.</p>
        
        <p>In <em>service-worker.js</em>, begin by specifying a cache version and listing the files that the browser should cache:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">var</code> <code class="nx">cacheVersion</code> <code class="o">=</code> <code class="s1">'v1'</code><code class="p">;</code>
        
        <code class="nx">filesToCache</code> <code class="o">=</code> <code class="p">[</code>
          <code class="s1">'index.html'</code><code class="p">,</code>
          <code class="s1">'/styles/main.css'</code><code class="p">,</code>
          <code class="s1">'/js/main.js'</code><code class="p">,</code>
          <code class="s1">'/images/logo.svg'</code>
        <code class="p">]</code></pre>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>For changes to the site, the <code>cacheVersion</code> needs to be updated, or users risk being served content from the cache.</p>
        </div>
        
        <p>Now, in the <em>service-worker.js</em> file, set up the <code>install</code>, <code>fetch</code>, and <code>activate</code> event listeners. The <code>install</code> event provides the browser with instructions for installing our cached files. The <code>fetch</code> event provides the browser with guidelines for handling fetch events by instructing the browser to either load the cached files or those received over the network. <a data-type="indexterm" data-primary="cacheVersion" id="idm45475133280168"></a>Finally, the <code>activate</code> event, which fires when the service worker is activated, can be used to check for existing items in the cache and remove them if an updated <code>cacheVersion</code> is present and the file is no longer in the <code>filestoCache</code> list (see <a data-type="xref" href="#offline">Figure&nbsp;16-3</a>).<a data-type="indexterm" data-primary="" data-startref="ix_serv_worker" id="idm45475133277064"></a></p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">cacheVersion</code> <code class="o">=</code> <code class="s1">'v1'</code><code class="p">;</code>
        
        <code class="kr">const</code> <code class="nx">filesToCache</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'index.html'</code><code class="p">,</code> <code class="s1">'/styles/main.css'</code><code class="p">,</code> <code class="s1">'/js/main.js'</code><code class="p">];</code>
        
        <code class="nx">self</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'install'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Service worker install event fired'</code><code class="p">);</code>
          <code class="nx">event</code><code class="p">.</code><code class="nx">waitUntil</code><code class="p">(</code>
            <code class="nx">caches</code><code class="p">.</code><code class="nx">open</code><code class="p">(</code><code class="nx">cacheVersion</code><code class="p">).</code><code class="nx">then</code><code class="p">(</code><code class="nx">cache</code> <code class="o">=&gt;</code> <code class="p">{</code>
              <code class="k">return</code> <code class="nx">cache</code><code class="p">.</code><code class="nx">addAll</code><code class="p">(</code><code class="nx">filesToCache</code><code class="p">);</code>
            <code class="p">})</code>
          <code class="p">);</code>
        <code class="p">});</code>
        
        <code class="nx">self</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'fetch'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Fetch intercepted for:'</code><code class="p">,</code> <code class="nx">event</code><code class="p">.</code><code class="nx">request</code><code class="p">.</code><code class="nx">url</code><code class="p">);</code>
          <code class="nx">event</code><code class="p">.</code><code class="nx">respondWith</code><code class="p">(</code>
            <code class="nx">caches</code><code class="p">.</code><code class="nx">match</code><code class="p">(</code><code class="nx">event</code><code class="p">.</code><code class="nx">request</code><code class="p">).</code><code class="nx">then</code><code class="p">(</code><code class="nx">cachedResponse</code> <code class="o">=&gt;</code> <code class="p">{</code>
              <code class="k">if</code> <code class="p">(</code><code class="nx">cachedResponse</code><code class="p">)</code> <code class="p">{</code>
                <code class="k">return</code> <code class="nx">cachedResponse</code><code class="p">;</code>
              <code class="p">}</code>
              <code class="k">return</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">event</code><code class="p">.</code><code class="nx">request</code><code class="p">);</code>
            <code class="p">})</code>
          <code class="p">);</code>
        <code class="p">});</code>
        
        <code class="nx">self</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'activate'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="nx">event</code><code class="p">.</code><code class="nx">waitUntil</code><code class="p">(</code>
            <code class="nx">caches</code><code class="p">.</code><code class="nx">keys</code><code class="p">().</code><code class="nx">then</code><code class="p">(</code><code class="nx">keyList</code> <code class="o">=&gt;</code> <code class="p">{</code>
              <code class="k">return</code> <code class="nb">Promise</code><code class="p">.</code><code class="nx">all</code><code class="p">(</code>
                <code class="nx">keyList</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">key</code> <code class="o">=&gt;</code> <code class="p">{</code>
                  <code class="k">if</code> <code class="p">(</code><code class="nx">key</code> <code class="o">!==</code> <code class="nx">cacheVersion</code><code class="p">)</code> <code class="p">{</code>
                    <code class="k">return</code> <code class="nx">caches</code><code class="p">.</code><code class="k">delete</code><code class="p">(</code><code class="nx">key</code><code class="p">);</code>
                  <code class="p">}</code>
                <code class="p">})</code>
              <code class="p">);</code>
            <code class="p">})</code>
          <code class="p">);</code>
        <code class="p">});</code></pre>
        
        <figure class="no-frame"><div id="offline" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055747/files/assets/jsc3_1603.png" alt="A screenshot of the application running in offline mode" width="1445" height="1011">
        <h6><span class="label">Figure 16-3. </span>With the service worker installed, the application can load files when offline</h6>
        </div></figure>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475133272088">
        <h2>Discussion</h2>
        
        <p>A Progressive Web Application is a user-installable web application with some form of offline functionality. These features allow web applications to closely mimic the best features of native applications while providing the benefits of the open web.</p>
        
        <p><a data-type="indexterm" data-primary="application manifest" id="ix_app_manifest"></a>The web app manifest is a JSON file that provides information about the application. The full list of key values that it can contain are as follows:</p>
        <dl>
        <dt><code>background_color</code></dt>
        <dd>
        <p>A color code for a placeholder launch screen background.</p>
        </dd>
        <dt><code>categories</code></dt>
        <dd>
        <p>An array of strings of categories that the application belongs to.</p>
        </dd>
        <dt><code>description</code></dt>
        <dd>
        <p>A string description of the application.</p>
        </dd>
        <dt><code>dir</code></dt>
        <dd>
        <p>The direction in which to display characters. This can be <code>auto</code>, <code>ltr</code> (left to right), or  <code>rtl</code> (right to left).</p>
        </dd>
        <dt><code>display</code></dt>
        <dd>
        <p>The preferred display mode. This can be either <code>browser</code>, for default browser behavior, or <code>fullscreen</code>, which will reduce the browser chrome on some devices.</p>
        </dd>
        <dt><code>iarc_rating_id</code></dt>
        <dd>
        <p>An International Age Rating value.</p>
        </dd>
        <dt><code>icons</code></dt>
        <dd>
        <p>An array of objects linking to icon images and descriptions.</p>
        </dd>
        <dt><code>lang</code></dt>
        <dd>
        <p>Identifies the primary language of the application.</p>
        </dd>
        <dt><code>name</code></dt>
        <dd>
        <p>The application name.</p>
        </dd>
        <dt><code>orientation</code></dt>
        <dd>
        <p>Allows the developer to set the default orientation of the application.</p>
        </dd>
        <dt><code>prefer_related_applications</code></dt>
        <dd>
        <p>If set to <code>true</code>, allows the developer to specify related applications that should be installed instead of the web application.</p>
        </dd>
        <dt><code>related_applications</code></dt>
        <dd>
        <p>An array of objects containing a list of related native applications.</p>
        </dd>
        <dt><code>scope</code></dt>
        <dd>
        <p>A string that contains the navigation scope of the app. Specifying a scope restricts navigation in application mode to that directory.</p>
        </dd>
        <dt><code>screenshots</code></dt>
        <dd>
        <p>An array of application screenshots.</p>
        </dd>
        <dt><code>short_name</code></dt>
        <dd>
        <p>A shortened version of the application name to be used in contexts where the full name is too long to display.</p>
        </dd>
        <dt><code>start_url</code></dt>
        <dd>
        <p>The URL that should open when a user launches the application.</p>
        </dd>
        <dt><code>theme_color</code></dt>
        <dd>
        <p>A string that defines the default theme color for the application.</p>
        </dd>
        </dl>
        
        <p>The <a href="https://oreil.ly/zlk9P">W3C provides an example</a> of a robust manifest file for a web-based game:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="p">{</code>
          <code class="s2">"lang"</code><code class="o">:</code> <code class="s2">"en"</code><code class="p">,</code>
          <code class="s2">"dir"</code><code class="o">:</code> <code class="s2">"ltr"</code><code class="p">,</code>
          <code class="s2">"name"</code><code class="o">:</code> <code class="s2">"Super Racer 3000"</code><code class="p">,</code>
          <code class="s2">"description"</code><code class="o">:</code> <code class="s2">"The ultimate futuristic racing game from the future!"</code><code class="p">,</code>
          <code class="s2">"short_name"</code><code class="o">:</code> <code class="s2">"Racer3K"</code><code class="p">,</code>
          <code class="s2">"icons"</code><code class="o">:</code> <code class="p">[{</code>
            <code class="s2">"src"</code><code class="o">:</code> <code class="s2">"icon/lowres.webp"</code><code class="p">,</code>
            <code class="s2">"sizes"</code><code class="o">:</code> <code class="s2">"64x64"</code><code class="p">,</code>
            <code class="s2">"type"</code><code class="o">:</code> <code class="s2">"image/webp"</code>
          <code class="p">},{</code>
            <code class="s2">"src"</code><code class="o">:</code> <code class="s2">"icon/lowres.png"</code><code class="p">,</code>
            <code class="s2">"sizes"</code><code class="o">:</code> <code class="s2">"64x64"</code>
          <code class="p">},</code> <code class="p">{</code>
            <code class="s2">"src"</code><code class="o">:</code> <code class="s2">"icon/hd_hi"</code><code class="p">,</code>
            <code class="s2">"sizes"</code><code class="o">:</code> <code class="s2">"128x128"</code>
          <code class="p">}],</code>
          <code class="s2">"scope"</code><code class="o">:</code> <code class="s2">"/racer/"</code><code class="p">,</code>
          <code class="s2">"start_url"</code><code class="o">:</code> <code class="s2">"/racer/start.html"</code><code class="p">,</code>
          <code class="s2">"display"</code><code class="o">:</code> <code class="s2">"fullscreen"</code><code class="p">,</code>
          <code class="s2">"orientation"</code><code class="o">:</code> <code class="s2">"landscape"</code><code class="p">,</code>
          <code class="s2">"theme_color"</code><code class="o">:</code> <code class="s2">"aliceblue"</code><code class="p">,</code>
          <code class="s2">"background_color"</code><code class="o">:</code> <code class="s2">"red"</code><code class="p">,</code>
          <code class="s2">"screenshots"</code><code class="o">:</code> <code class="p">[{</code>
            <code class="s2">"src"</code><code class="o">:</code> <code class="s2">"screenshots/in-game-1x.jpg"</code><code class="p">,</code>
            <code class="s2">"sizes"</code><code class="o">:</code> <code class="s2">"640x480"</code><code class="p">,</code>
            <code class="s2">"type"</code><code class="o">:</code> <code class="s2">"image/jpeg"</code>
          <code class="p">},{</code>
            <code class="s2">"src"</code><code class="o">:</code> <code class="s2">"screenshots/in-game-2x.jpg"</code><code class="p">,</code>
            <code class="s2">"sizes"</code><code class="o">:</code> <code class="s2">"1280x920"</code><code class="p">,</code>
            <code class="s2">"type"</code><code class="o">:</code> <code class="s2">"image/jpeg"</code>
          <code class="p">}]</code>
        <code class="p">}</code></pre>
        
        <p>In addition to the web app manifest file, some platforms, such as iOS and Windows, require additional information which can be provided in the form of HTML metatags. In <a data-type="xref" href="#pws_meta_tags">Example&nbsp;16-1</a>, metatags are used to define a theme color, the iOS icon, and Windows tile settings.<a data-type="indexterm" data-primary="" data-startref="ix_app_manifest" id="idm45475133028408"></a></p>
        <div data-type="tip"><h6>Tip</h6>
        <p><a data-type="indexterm" data-primary="RealFaviconGenerator" id="idm45475132988904"></a>Generating icons for all of the different device types and resolutions can be a tedious affair, so I recommend using <a href="https://oreil.ly/ALsQe">RealFaviconGenerator</a>.</p>
        </div>
        
        <p><a data-type="indexterm" data-primary="service workers" id="idm45475132986840"></a>A service worker is a script that the browser runs in the background, parallel to the rendering and execution of the page. Because it is a “worker,” the service worker cannot access the DOM directly, however this parallel script enables all sorts of new use cases. One of the most exciting of these use cases is the ability to cache bits of our application for offline use. In the above example, I’m caching an HTML, JavaScript, and CSS file to provide a full-featured (if minimal) site experience when offline. Other use cases may include creating a separate offline experience or caching the shared template markup and styles, often referred to as the “application shell.”</p>
        
        <p>When utilizing service workers, there are a few limitations to be aware of:</p>
        
        <ul>
        <li>
        <p>Sites using a service worker must be served over HTTPS.</p>
        </li>
        <li>
        <p>Service workers do not work when a user is in private browsing mode.</p>
        </li>
        <li>
        <p>Since service workers run as a separate thread in the browser, they do not have access to the DOM.</p>
        </li>
        <li>
        <p>Service workers are scoped, meaning that they should be placed in the root of your application.</p>
        </li>
        <li>
        <p>Cache storage sizes can vary by browser and available space on a user’s hard drive.</p>
        </li>
        </ul>
        
        <p><a data-type="indexterm" data-primary="Workbox library" id="idm45475132837672"></a><a data-type="indexterm" data-primary="libraries" data-secondary="Workbox" id="idm45475132836968"></a>Though I’ve created a service worker by hand in the above example, that can quickly become unmanageable for larger applications. The <a href="https://oreil.ly/Gu3Z6">Workbox</a> library, created by Google, is a package for managing service workers and offline functionality in web applications. Workbox takes much of the pain out of versioning and managing the cache, as well as advanced capabilities such as background sync and precaching.</p>
        
        <p>Progressive web applications are an exciting step for the web and are framework agnostic, meaning they can be built with simple HTML, CSS, and JavaScript, or using the latest JavaScript frameworks. <a data-type="indexterm" data-primary="Alter, Tal" data-secondary="Building Progressive Web Apps (O’Reilly)" id="idm45475132834200"></a><a data-type="indexterm" data-primary="Building Progressive Web Apps (O’Reilly)" id="idm45475132833128"></a>In this section we have only scratched the surface of the power of these technologies. Tal Alter’s book <a href="http://shop.oreilly.com/product/0636920052067.do" class="orm:hideurl"><em>Building Progressive Web Apps</em></a> (O’Reilly) offers a detailed look at the features and functionality of Progressive Web Applications.</p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Testing and Profiling a Progressive Web Application"><div class="sect1" id="idm45475133064344">
        <h1>Testing and Profiling a Progressive Web Application</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475132829992">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="profiling, web apps/APIs" id="ix_profile_web-app"></a><a data-type="indexterm" data-primary="testing" data-secondary="web apps/APIs" id="ix_test_pwas"></a><a data-type="indexterm" data-primary="web apps/APIs" data-secondary="testing and profiling" id="ix_web_apps_test_pwa"></a>You’d like to test that you’ve successfully fulfilled the requirements of a Progressive Web Application.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475132824904">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="Lighthouse" id="ix_lighthouse2"></a>Use <a href="https://oreil.ly/hEdHB">Lighthouse</a> to audit performance, accessibility, best practices, SEO, and Progressive Web Application criteria. The easiest way to access Lighthouse is within the “Lighthouse” tab of Google Chrome Developer Tools. Visit the site (either in production or on a local web server) and click “Generate Report” (see <a data-type="xref" href="#lighthouse-pwa">Figure&nbsp;16-4</a>).</p>
        
        <p>Lighthouse will then generate a report, making recommended improvements for any score reductions (see Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#lighthouse_high">16-5</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#lighthouse_low">16-6</a>).</p>
        
        <figure class="no-frame"><div id="lighthouse-pwa" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055747/files/assets/jsc3_1604.png" alt="A sreenshot of Google Lighthouse" width="1445" height="523">
        <h6><span class="label">Figure 16-4. </span>Lighthouse within Chrome Developer Tools</h6>
        </div></figure>
        
        <figure class="no-frame"><div id="lighthouse_high" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055747/files/assets/jsc3_1605.png" alt="A screenshot of a site with a high Lighthouse score" width="905" height="884">
        <h6><span class="label">Figure 16-5. </span>A high score demonstrates a performant application and successful progressive web app</h6>
        </div></figure>
        
        <figure class="no-frame width-75"><div id="lighthouse_low" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055747/files/assets/jsc3_1606.png" alt="A screenshot of a site with a low Lighthouse score" width="1205" height="1243">
        <h6><span class="label">Figure 16-6. </span>A site receiving a low Lighthouse score will also receive recommendations for improvement</h6>
        </div></figure>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>The general use of profiling non-Progressive Web Application sites with Lighthouse in the Chrome Developer Tools is covered in more detail in <a data-type="xref" href="ch11.html#lighthouse">“Using Lighthouse to Measure  Best Practices”</a>.</p>
        </div>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475132808296">
        <h2>Discussion</h2>
        
        <p>Lighthouse is a tool for measuring web best practices, including performance and progressive web application compatibility. It comes built into the Chrome Developer Tools, but can also be installed as a Firefox extension.</p>
        
        <p><a data-type="indexterm" data-primary="npm (Node package manager)" data-secondary="Lighthouse" id="ix_npm_lighthouse"></a><a data-type="indexterm" data-primary="Node" data-secondary="Lighthouse as code module" id="ix_node_lighthouse"></a>In addition to being a browser tool, Lighthouse can be installed through npm and used on the command line or as a Node module. You would install Lighthouse the same as any other Node module:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">npm</code> <code class="nx">install</code> <code class="o">-</code><code class="nx">g</code> <code class="nx">lighthouse</code></pre>
        
        <p>which can then be run by passing a URL as an argument:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">lighthouse</code> <code class="nx">https</code><code class="o">:</code><code class="c1">//www.oreilly.com/</code></pre>
        
        <p>Passing a <code>--view</code> argument will open the results in your browser:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">lighthouse</code> <code class="nx">https</code><code class="o">:</code><code class="c1">//www.oreilly.com/ --view</code></pre>
        
        <p>You can also specify an output filetype and location to store the report results:</p>
        
        <pre data-type="programlisting" data-code-language="javascript" class="small"><code class="nx">$</code> <code class="nx">lighthouse</code> <code class="nx">https</code><code class="o">:</code><code class="c1">//www.oreilly.com/ --view --output html --output-path ./report.html</code></pre>
        
        <p>And a <em>budget.json</em> file can be used to set and test against performance budget limitations. In a <em>budget.json</em> file, define the limitations to test against:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="p">[</code>
          <code class="p">{</code>
            <code class="s2">"path"</code><code class="o">:</code> <code class="s2">"/*"</code><code class="p">,</code>
            <code class="s2">"timings"</code><code class="o">:</code> <code class="p">[</code>
              <code class="p">{</code>
                <code class="s2">"metric"</code><code class="o">:</code> <code class="s2">"interactive"</code><code class="p">,</code>
                <code class="s2">"budget"</code><code class="o">:</code> <code class="mi">3000</code>
              <code class="p">},</code>
              <code class="p">{</code>
                <code class="s2">"metric"</code><code class="o">:</code> <code class="s2">"first-meaningful-paint"</code><code class="p">,</code>
                <code class="s2">"budget"</code><code class="o">:</code> <code class="mi">1000</code>
              <code class="p">}</code>
            <code class="p">],</code>
            <code class="s2">"resourceSizes"</code><code class="o">:</code> <code class="p">[</code>
              <code class="p">{</code>
                <code class="s2">"resourceType"</code><code class="o">:</code> <code class="s2">"script"</code><code class="p">,</code>
                <code class="s2">"budget"</code><code class="o">:</code> <code class="mi">125</code>
              <code class="p">},</code>
              <code class="p">{</code>
                <code class="s2">"resourceType"</code><code class="o">:</code> <code class="s2">"total"</code><code class="p">,</code>
                <code class="s2">"budget"</code><code class="o">:</code> <code class="mi">300</code>
              <code class="p">}</code>
            <code class="p">],</code>
            <code class="s2">"resourceCounts"</code><code class="o">:</code> <code class="p">[</code>
              <code class="p">{</code>
                <code class="s2">"resourceType"</code><code class="o">:</code> <code class="s2">"third-party"</code><code class="p">,</code>
                <code class="s2">"budget"</code><code class="o">:</code> <code class="mi">10</code>
              <code class="p">}</code>
            <code class="p">]</code>
          <code class="p">}</code>
        <code class="p">]</code></pre>
        <div data-type="tip"><h6>Tip</h6>
        <p>The Google Chrome team mantains a <a href="https://github.com/GoogleChrome/budget.json">repository</a> containing the documentation of <em>budget.json</em> options.</p>
        </div>
        
        <p><a data-type="indexterm" data-primary="CI (continuous integration) tools" id="idm45475132559240"></a>Testing locally from the command line can be helpful for local development, but the real power of Lighthouse as a code module is realized when used with continuous integration tools such as GitHub Actions, Circle CI, Jenkins, and Travis CI. The <a href="https://github.com/GoogleChrome/lighthouse-ci">Lighthouse CI</a> module enables you to perform Lighthouse testing in a continuous integration pipeline, such as on every GitHub pull request.</p>
        
        <p>Here’s a sample configuration for CircleCI:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">version</code><code class="o">:</code> <code class="mf">2.1</code>
        <code class="nx">jobs</code><code class="o">:</code>
          <code class="nx">build</code><code class="o">:</code>
            <code class="nx">docker</code><code class="o">:</code>
              <code class="o">-</code> <code class="nx">image</code><code class="o">:</code> <code class="nx">circleci</code><code class="o">/</code><code class="nx">node</code><code class="o">:</code><code class="mf">10.16</code><code class="o">-</code><code class="nx">browsers</code>
            <code class="nx">working_directory</code><code class="o">:</code> <code class="o">~</code><code class="err">/your-project</code>
            <code class="nx">steps</code><code class="o">:</code>
              <code class="o">-</code> <code class="nx">checkout</code>
              <code class="o">-</code> <code class="nx">run</code><code class="o">:</code> <code class="nx">npm</code> <code class="nx">install</code>
              <code class="o">-</code> <code class="nx">run</code><code class="o">:</code> <code class="nx">npm</code> <code class="nx">run</code> <code class="nx">build</code>
              <code class="o">-</code> <code class="nx">run</code><code class="o">:</code> <code class="nx">sudo</code> <code class="nx">npm</code> <code class="nx">install</code> <code class="o">-</code><code class="nx">g</code> <code class="err">@</code><code class="nx">lhci</code><code class="o">/</code><code class="nx">cli</code><code class="err">@</code><code class="mf">0.3</code><code class="p">.</code><code class="nx">x</code>
              <code class="o">-</code> <code class="nx">run</code><code class="o">:</code> <code class="nx">lhci</code> <code class="nx">autorun</code></pre>
        
        <p>Full details on how to use Lighthouse in multiple CI environments are available in Google’s <a href="https://oreil.ly/7jnwx">Getting Started guide</a>.<a data-type="indexterm" data-primary="" data-startref="ix_web_apps_pwas" id="idm45475132498584"></a><a data-type="indexterm" data-primary="" data-startref="ix_pwas_web_apps" id="idm45475132497672"></a><a data-type="indexterm" data-primary="" data-startref="ix_web_apps_test_pwa" id="idm45475132465224"></a><a data-type="indexterm" data-primary="" data-startref="ix_test_pwas" id="idm45475132464280"></a><a data-type="indexterm" data-primary="" data-startref="ix_lighthouse2" id="idm45475132463336"></a><a data-type="indexterm" data-primary="" data-startref="ix_profile_web-app" id="idm45475132462392"></a><a data-type="indexterm" data-primary="" data-startref="ix_node_lighthouse" id="idm45475132461448"></a><a data-type="indexterm" data-primary="" data-startref="ix_npm_lighthouse" id="idm45475132460504"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Getting the Value of the Current URL"><div class="sect1" id="idm45475132459560">
        <h1>Getting the Value of the Current URL</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475132458584">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="URLs" data-secondary="current value" id="ix_url_curr_value"></a><a data-type="indexterm" data-primary="web apps/APIs" data-secondary="URL current value" id="ix_web_apps_url_value"></a>Your application needs to read the value of the current URL.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475132454536">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="window.location" id="idm45475132453368"></a><a data-type="indexterm" data-primary="href property" id="idm45475132452664"></a>Use the <code>href</code> property of <code>window.location</code> to read the current value of the full URL:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">URL</code> <code class="o">=</code> <code class="nb">window</code><code class="p">.</code><code class="nx">location</code><code class="p">.</code><code class="nx">href</code><code class="p">;</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475132445896">
        <h2>Discussion</h2>
        
        <p><code>window.location</code> provides read-only information about the current URL or <em>location</em> of the document.  The <code>href</code> property provides the full URL, which includes the protocol (such as HTTPS), hostname, the path to the current document, and any query strings. All together, this will match what is displayed in the user’s URL bar:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">URL</code> <code class="o">=</code> <code class="nb">window</code><code class="p">.</code><code class="nx">location</code><code class="p">.</code><code class="nx">href</code><code class="p">;</code>
        <code class="c1">// logs https://www.jseverywhere.io/example</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`The current URL is </code><code class="si">${</code><code class="nx">URL</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code></pre>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p><a data-type="indexterm" data-primary="window API" id="idm45475132360568"></a>The global variable <code>location</code> is the same as <code>window.location</code>; however, I prefer the explicitness of using the <code>window</code> API.</p>
        </div>
        
        <p>The <code>href</code> property is not the only useful one. <a data-type="indexterm" data-primary="search property" id="idm45475132357432"></a><a data-type="indexterm" data-primary="pathname property" id="idm45475132356728"></a>If you already know that the user is on your site, it may be more useful to access the <code>pathname</code> and <code>search</code> properties:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="c1">// user is at https://www.jseverywhere.io/example?page=2</code>
        
        <code class="kr">const</code> <code class="nx">PATH</code> <code class="o">=</code> <code class="nb">window</code><code class="p">.</code><code class="nx">location</code><code class="p">.</code><code class="nx">pathname</code><code class="p">;</code>
        <code class="c1">// logs /example/</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`The current path is </code><code class="si">${</code><code class="nx">PATH</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
        
        <code class="kr">const</code> <code class="nx">QUERY</code> <code class="o">=</code> <code class="nb">window</code><code class="p">.</code><code class="nx">location</code><code class="p">.</code><code class="nx">search</code><code class="p">;</code>
        <code class="c1">// logs ?page=2</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`The current query parameter is </code><code class="si">${</code><code class="nx">QUERY</code><code class="si">}</code><code class="sb">`</code><code class="p">)</code></pre>
        
        <p>The full list of read-only properties of <code>window.location</code> are:<a data-type="indexterm" data-primary="" data-startref="ix_web_apps_url_value" id="idm45475132279112"></a><a data-type="indexterm" data-primary="" data-startref="ix_url_curr_value" id="idm45475132278232"></a></p>
        <dl>
        <dt><code>hash</code></dt>
        <dd>
        <p>A hash value in the URL, such as <code>#id</code></p>
        </dd>
        <dt><code>host</code></dt>
        <dd>
        <p>The domain plus port</p>
        </dd>
        <dt><code>hostname</code></dt>
        <dd>
        <p>The domain</p>
        </dd>
        <dt><code>href</code></dt>
        <dd>
        <p>The full URL</p>
        </dd>
        <dt><code>origin</code></dt>
        <dd>
        <p>The protocol, hostname, and port</p>
        </dd>
        <dt><code>pathname</code></dt>
        <dd>
        <p>The path of the current document</p>
        </dd>
        <dt><code>port</code></dt>
        <dd>
        <p>The server’s port number value</p>
        </dd>
        <dt><code>protocol</code></dt>
        <dd>
        <p>The protocol (HTTP or HTTPS)</p>
        </dd>
        <dt><code>search</code></dt>
        <dd>
        <p>Query string values</p>
        </dd>
        </dl>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Redirecting a URL"><div class="sect1" id="idm45475132263096">
        <h1>Redirecting a URL</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475132262056">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="web apps/APIs" data-secondary="redirecting a URL" id="ix_web_apps_url_redirect"></a><a data-type="indexterm" data-primary="redirecting a URL" id="ix_redirect_url"></a><a data-type="indexterm" data-primary="URLs" data-secondary="redirecting" id="ix_url_redirect"></a>You need to use JavaScript to route a user to a different page.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475132257016">
        <h2>Solution</h2>
        
        <p>Use either the <code>assign</code> or <code>replace</code> <code>window.location</code> method, depending on the goal of the redirect:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="c1">// route user to new page &amp; preserve browser history</code>
        <code class="nb">window</code><code class="p">.</code><code class="nx">location</code><code class="p">.</code><code class="nx">assign</code><code class="p">(</code><code class="s1">'https://www.example.com'</code><code class="p">);</code>
        <code class="c1">// route user to new page but do not preserve current page in history</code>
        <code class="nb">window</code><code class="p">.</code><code class="nx">location</code><code class="p">.</code><code class="nx">replace</code><code class="p">(</code><code class="s1">'https://www.example.com'</code><code class="p">);</code></pre>
        
        <p><a data-type="indexterm" data-primary="assign() method" data-secondary="window.location" id="idm45475132219304"></a><a data-type="indexterm" data-primary="replace() method" data-secondary="window.location" id="idm45475132217368"></a>The <code>window.location.assign</code> method will route a user to a new URL, but will preserve the routing page in the browser history. This means that a user will be able to use the browser’s back button to navigate back to the page.  Conversely, <code>window.location.replace</code> will replace the current URL in the history, disabling the ability to return to the current page.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475132214936">
        <h2>Discussion</h2>
        
        <p>By using <code>window.location</code> methods, you are able to route a user to a new URL using JavaScript. This allows you to reroute a user or redirect a user based on a page interaction. <code>assign</code> and <code>replace</code> are not the only <code>window.location</code> methods at your disposal. The full list of methods is as follows:</p>
        <dl>
        <dt><code>.assign()</code></dt>
        <dd>
        <p>Navigates the user’s browser to a given URL</p>
        </dd>
        <dt><code>.reload()</code></dt>
        <dd>
        <p><a data-type="indexterm" data-primary="reload() method" id="idm45475132208264"></a>Reloads the page</p>
        </dd>
        <dt><code>.replace()</code></dt>
        <dd>
        <p>Navigates the user’s browser to a given URL and removes the current document from the browser history</p>
        </dd>
        <dt><code>toString()</code></dt>
        <dd>
        <p><a data-type="indexterm" data-primary="toString() method" data-secondary="window.location" id="idm45475132204568"></a>Returns the current URL as a string</p>
        </dd>
        </dl>
        
        <p>By leveraging these methods, you will be able to use JavaScript to manipulate the route of the page, which can provide useful functionality for application UIs and interactive routing. Although these features can be very useful when developing applications, full page redirects should always be done with an HTTP redirect with the appropriate status code of 301 for permanent redirects or 302 for temporary <span class="keep-together">redirects.</span></p>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>Popular JavaScript frameworks come with a routing library or can be extended with a third-party routing library, which can be used for robust client-side routing.<a data-type="indexterm" data-primary="" data-startref="ix_url_redirect" id="idm45475132200792"></a><a data-type="indexterm" data-primary="" data-startref="ix_web_apps_url_redirect" id="idm45475132199816"></a><a data-type="indexterm" data-primary="" data-startref="ix_redirect_url" id="idm45475132198856"></a></p>
        </div>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Copying Text to a User’s Clipboard"><div class="sect1" id="idm45475132197528">
        <h1>Copying Text to a User’s Clipboard</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475132196552">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="HTML5" data-secondary="copying text to user’s clipboard" id="ix_html5_copy_text"></a><a data-type="indexterm" data-primary="copying text to user clipboard" id="ix_copy_text"></a><a data-type="indexterm" data-primary="text" data-secondary="copying to user clipboard" id="ix_text_copy_user"></a><a data-type="indexterm" data-primary="web apps/APIs" data-secondary="copying text to user clipboard" id="ix_web_apps_copy_text"></a>Your application needs to copy text, such as a share link, to the user’s clipboard.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475132190280">
        <h2>Solution</h2>
        
        <p>To copy text to a user’s clipboard, place the text within a text <code>input</code>  or <code>textarea</code> element and use the <code>navigator.clipboard.writeText</code> method to copy the text.</p>
        
        <p>In your HTML, include the form element as well as a button. In the example, I’m setting an explicit <code>value</code> for the input element. This value could also be set by the user or dynamically in code:</p>
        
        <pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">id=</code><code class="s">"copy-text"</code> <code class="na">value=</code><code class="s">"https://example.com/share/12345"</code><code class="nt">&gt;</code>
        <code class="nt">&lt;button</code> <code class="na">id=</code><code class="s">"copy-button"</code><code class="nt">&gt;</code>Copy To Clipboard<code class="nt">&lt;/button&gt;</code></pre>
        
        <p><a data-type="indexterm" data-primary="writeText() method" id="idm45475132159064"></a>And in the corresponding JavaScript, add an event handler to the <code>button</code> element. When the button is clicked, use the <code>select</code> method to select the text within the <code>input</code> element followed by <code>navigator.clipboard.writeText()</code> to copy the text to the user’s clipboard, as shown in <a data-type="xref" href="#copy-text-js">Example&nbsp;16-2</a>.</p>
        <div id="copy-text-js" data-type="example">
        <h5><span class="label">Example 16-2. </span>Copying text to the clipboard</h5>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">copyText</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'copy-text'</code><code class="p">);</code>
        <code class="kr">const</code> <code class="nx">copyButton</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'copy-button'</code><code class="p">);</code>
        
        <code class="kr">const</code> <code class="nx">copyToClipboard</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="nx">copyText</code><code class="p">.</code><code class="nx">select</code><code class="p">();</code>
          <code class="nx">navigator</code><code class="p">.</code><code class="nx">clipboard</code><code class="p">.</code><code class="nx">writeText</code><code class="p">(</code><code class="nx">copyText</code><code class="p">.</code><code class="nx">value</code><code class="p">);</code>
        <code class="p">};</code>
        
        <code class="nx">copyButton</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code> <code class="nx">copyToClipboard</code><code class="p">);</code></pre></div>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475132098424">
        <h2>Discussion</h2>
        
        <p>Adding text to a user’s clipboard from a text input box is a common UI pattern seen in web applications such as GitHub and Google Docs. This can be a useful feature to simplify the sharing of information or a URL for users. The input and button pattern demonstrated in the primary recipe is the most common use, but there may be times where you want to instead copy a user selection from the page’s content. In this scenario, it may be useful to hide the form control. To do this, include the markup of the page content as well as a <code>textarea</code> or <code>input</code> element. In this example, I’ve used a <code>textarea</code> element and set the <code>tabindex</code> to remove it from the user’s tab flow, then set <code>aria-hidden</code> to <code>true</code> so that screen readers know to ignore the element:</p>
        
        <pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;p&gt;</code>Some example text<code class="nt">&lt;p&gt;</code>
        
        <code class="nt">&lt;textarea</code> <code class="na">id=</code><code class="s">"copy-text"</code> <code class="na">tabindex=</code><code class="s">"-1"</code> <code class="na">aria-hidden=</code><code class="s">"true"</code><code class="nt">&gt;&lt;/textarea&gt;</code>
        <code class="nt">&lt;button</code> <code class="na">id=</code><code class="s">"copy-button"</code><code class="nt">&gt;</code>Copy the Highlighted Text<code class="nt">&lt;/button&gt;</code></pre>
        
        <p>In my CSS, I’ve hidden the element by placing it offscreen and giving it a height and width value of <code>0</code>:</p>
        
        <pre data-type="programlisting" data-code-language="css"><code class="nf">#copy-text</code> <code class="p">{</code>
          <code class="k">position</code><code class="o">:</code> <code class="nb">absolute</code><code class="p">;</code>
          <code class="k">left</code><code class="o">:</code> <code class="m">-9999px</code><code class="p">;</code>
          <code class="k">height</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code>
          <code class="k">width</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code>
        <code class="p">}</code></pre>
        
        <p><a data-type="indexterm" data-primary="getSelection() method" id="idm45475132027208"></a>Finally, in my JavaScript I follow a similar pattern as <a data-type="xref" href="#copy-text-js">Example&nbsp;16-2</a>, with the addition of using the <code>document.getSelection()</code> to get the value of any text that the user has selected on the page:</p>
        
        <pre data-type="programlisting" data-code-language="javascript" class="small"><code class="kr">const</code> <code class="nx">copyText</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'copy-text'</code><code class="p">);</code>
        <code class="kr">const</code> <code class="nx">copyButton</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'copy-button'</code><code class="p">);</code>
        
        <code class="kr">const</code> <code class="nx">copyToClipboard</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="kr">const</code> <code class="nx">selection</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getSelection</code><code class="p">();</code>
          <code class="nx">copyText</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="sb">`</code><code class="si">${</code><code class="nx">selection</code><code class="si">}</code><code class="sb"> — Check out my highlight at https://example.com `</code><code class="p">;</code>
          <code class="nx">copyText</code><code class="p">.</code><code class="nx">select</code><code class="p">();</code>
          <code class="nx">navigator</code><code class="p">.</code><code class="nx">clipboard</code><code class="p">.</code><code class="nx">writeText</code><code class="p">(</code><code class="nx">copyText</code><code class="p">.</code><code class="nx">value</code><code class="p">);</code>
        <code class="p">}</code>
        
        <code class="nx">copyButton</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code> <code class="nx">copyToClipboard</code><code class="p">);</code></pre>
        
        <p>Enabling easy sharing of web application content is a common pattern in the social web era. Using these techniques provides a pattern to simplify that interaction.<a data-type="indexterm" data-primary="" data-startref="ix_web_apps_copy_text" id="idm45475131978536"></a><a data-type="indexterm" data-primary="" data-startref="ix_copy_text" id="idm45475131872408"></a><a data-type="indexterm" data-primary="" data-startref="ix_text_copy_user" id="idm45475131871496"></a><a data-type="indexterm" data-primary="" data-startref="ix_html5_copy_text" id="idm45475131870552"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Enabling a Mobile-Like Notification in the Desktop Browser"><div class="sect1" id="idm45475131869352">
        <h1>Enabling a Mobile-Like Notification in the <span class="keep-together">Desktop Browser</span></h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475131867576">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="notifications in desktop browser" id="ix_notif_browser"></a><a data-type="indexterm" data-primary="browser" data-secondary="notifications in" id="ix_browser_notif"></a><a data-type="indexterm" data-primary="web apps/APIs" data-secondary="notifications in desktop browser" id="ix_web_apps_notif"></a>You need a way to notify a user that an event has occurred or a long-running process is finished, even if your site isn’t open in an active tab.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475131862488">
        <h2>Solution</h2>
        
        <p>Use the Web Notifications API.</p>
        
        <p><a data-type="indexterm" data-primary="Web Notifications API" id="ix_web_notif"></a>This API provides a relatively simple technique to pop up a notification window outside of the browser, so that if a person is currently looking at a web page in another tab, they’ll still see the notification.</p>
        
        <p><a data-type="indexterm" data-primary="permissions, Web Notification" id="idm45475131859080"></a>To use a Web Notification, you do need to get permission. In the following code, Notification permission is requested when a user clicks a button. If permission is granted, a notification is displayed:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">notificationButton</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'notification-button'</code><code class="p">);</code>
        
        <code class="kr">const</code> <code class="nx">showNotification</code> <code class="o">=</code> <code class="nx">permission</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="c1">// if the user didn't grant permission, exit the function</code>
          <code class="k">if</code> <code class="p">(</code><code class="nx">permission</code> <code class="o">!==</code> <code class="s1">'granted'</code><code class="p">)</code> <code class="k">return</code><code class="p">;</code>
        
          <code class="c1">// content of the notification</code>
          <code class="kr">const</code> <code class="nx">notification</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Notification</code><code class="p">(</code><code class="s1">'Title'</code><code class="p">,</code> <code class="p">{</code>
            <code class="nx">body</code><code class="o">:</code> <code class="s1">'Check out this super cool thing'</code>
          <code class="p">});</code>
        
          <code class="c1">// optional: action to take when a user clicks the notification</code>
          <code class="nx">notification</code><code class="p">.</code><code class="nx">onclick</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="nb">window</code><code class="p">.</code><code class="nx">open</code><code class="p">(</code><code class="s1">'https://example.com'</code><code class="p">);</code>
          <code class="p">};</code>
        <code class="p">};</code>
        
        <code class="kr">const</code> <code class="nx">notificationCheck</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="c1">// if notifications aren't supported return</code>
          <code class="c1">// alternately you could perform a different action</code>
          <code class="c1">// like redirect the user to email signup</code>
          <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nb">window</code><code class="p">.</code><code class="nx">Notification</code><code class="p">)</code> <code class="k">return</code><code class="p">;</code>
        
          <code class="c1">// request permission from the user</code>
          <code class="nx">Notification</code><code class="p">.</code><code class="nx">requestPermission</code><code class="p">().</code><code class="nx">then</code><code class="p">(</code><code class="nx">showNotification</code><code class="p">);</code>
        <code class="p">};</code>
        
        <code class="c1">// on click, call the `notificationCheck` function</code>
        <code class="nx">notificationButton</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code> <code class="nx">notificationCheck</code><code class="p">);</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475131855688">
        <h2>Discussion</h2>
        
        <p>Mobile environments have notifications that let you know when you’ve received a new “Like” on a Facebook post or a new email in your email client.  Traditionally, we didn’t have this capability in a desktop environment, though some might say this is a good thing.</p>
        
        <p>Still, as we create more sophisticated web applications, it may help to have this functionality, particularly when our applications may take a significant amount of time. Instead of forcing people to hang around looking at a “working” icon on our pages, the web page visitor can view other web pages in other tabs, and know they’ll get notified when the long-running process is finished.</p>
        
        <p>In the solution, the first time the code creates a new notification, it gets permission from the web page visitor. If your application is created as a standalone web application, you can specify permissions in the manifest file, but for web pages, you have to ask permission.</p>
        
        <p>Prior to the Notification permission request, you can also test to see if Notification exists, so an error is not thrown if it’s not supported:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="k">if</code> <code class="p">(</code><code class="nb">window</code><code class="p">.</code><code class="nx">Notification</code><code class="p">)</code> <code class="p">{</code>
          <code class="nx">Notification</code><code class="p">.</code><code class="nx">requestPermission</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="nx">setTimeout</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
              <code class="kr">const</code> <code class="nx">notification</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Notification</code><code class="p">(</code><code class="s1">'hey wake up'</code><code class="p">,</code> <code class="p">{</code>
                <code class="nx">body</code><code class="o">:</code> <code class="s1">'your process is done'</code><code class="p">,</code>
                <code class="nx">tag</code><code class="o">:</code> <code class="s1">'loader'</code><code class="p">,</code>
                <code class="nx">icon</code><code class="o">:</code> <code class="s1">'favicon.ico'</code>
              <code class="p">});</code>
              <code class="nx">notification</code><code class="p">();</code>
            <code class="p">},</code> <code class="mi">5000</code><code class="p">);</code>
          <code class="p">});</code>
        <code class="p">}</code></pre>
        
        <p>The Notification takes two arguments—a title string and an object with options:</p>
        <dl>
        <dt><code>body</code></dt>
        <dd>
        <p>The text message in the body of the notification</p>
        </dd>
        <dt><code>tag</code></dt>
        <dd>
        <p>A tag to help identify notifications for global changes</p>
        </dd>
        <dt><code>icon</code></dt>
        <dd>
        <p>A custom icon</p>
        </dd>
        <dt><code>lang</code></dt>
        <dd>
        <p>Language of notification</p>
        </dd>
        <dt><code>dir</code></dt>
        <dd>
        <p>Direction of the language</p>
        </dd>
        </dl>
        
        <p>You can also code four event handlers:</p>
        
        <ul>
        <li>
        <p><code>onerror</code></p>
        </li>
        <li>
        <p><code>onclose</code></p>
        </li>
        <li>
        <p><code>onshow</code></p>
        </li>
        <li>
        <p><code>onclose</code></p>
        </li>
        </ul>
        
        <p>And you can programatically close the notification with <code>Notification.close()</code>, though Safari and Firefox automatically close the notification in a few seconds. All browsers provide a window close (<em>x</em>) option in the notification.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Extra: Web Notifications and the Page Visibility API"><div class="sect2" id="idm45475131855096">
        <h2>Extra: Web Notifications and the Page Visibility API</h2>
        
        <p><a data-type="indexterm" data-primary="Page Visibility API" id="idm45475131726264"></a><a data-type="indexterm" data-primary="web apps/APIs" data-secondary="Page Visibility API" id="idm45475131725560"></a>You can combine Web Notifications with the Page Visibility API to display the Notification only when the web page visitor isn’t actively looking at the web page.</p>
        
        <p><a data-type="indexterm" data-primary="events" data-secondary="visibilitychange" id="idm45475131724056"></a><a data-type="indexterm" data-primary="visibilitychange event" id="idm45475131723080"></a>The Page Visibility API has broad support in modern browsers. It adds support for one event, <code>visibilitychange</code>, which is fired when the visibility of the tab page changes. It also supports a couple of new properties—<code>document.hidden</code> returns true if the tab page isn’t visible, and <code>document.visibilityState</code>, which has one of the following four values:<a data-type="indexterm" data-primary="hidden property" id="idm45475131720696"></a></p>
        
        <ul>
        <li>
        <p><code>visible</code>: When the tab page is visible</p>
        </li>
        <li>
        <p><code>hidden</code>: When the tag page is hidden</p>
        </li>
        <li>
        <p><code>prerender</code>: The page is being rendered but not yet visible (browser support is <span class="keep-together">optional)</span></p>
        </li>
        <li>
        <p><code>unloaded</code>: The page is being unloaded from memory (browser support is optional)</p>
        </li>
        </ul>
        
        <p><a data-type="indexterm" data-primary="visibilityState property" id="idm45475131714056"></a>To modify the solution so that the notification only fires when the tabbed page is hidden, modify the code to check for <code>visbilityState</code>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="k">if</code> <code class="p">(</code><code class="nb">window</code><code class="p">.</code><code class="nx">Notification</code><code class="p">)</code> <code class="p">{</code>
          <code class="nx">Notification</code><code class="p">.</code><code class="nx">requestPermission</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="nx">setTimeout</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
              <code class="k">if</code> <code class="p">(</code><code class="nb">document</code><code class="p">.</code><code class="nx">visibilityState</code> <code class="o">===</code> <code class="s1">'hidden'</code><code class="p">)</code> <code class="p">{</code>
                <code class="kr">const</code> <code class="nx">notification</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Notification</code><code class="p">(</code><code class="s1">'hey wake up'</code><code class="p">,</code> <code class="p">{</code>
                  <code class="nx">body</code><code class="o">:</code> <code class="s1">'your process is done'</code><code class="p">,</code>
                  <code class="nx">icon</code><code class="o">:</code> <code class="s1">'favicon.ico'</code>
                <code class="p">});</code>
                <code class="nx">notification</code><code class="p">();</code>
              <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>
                <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'result'</code><code class="p">).</code><code class="nx">innerHTML</code> <code class="o">=</code> <code class="s1">'your process is done'</code><code class="p">;</code>
              <code class="p">}</code>
            <code class="p">},</code> <code class="mi">5000</code><code class="p">);</code>
          <code class="p">});</code>
        <code class="p">}</code></pre>
        
        <p>Before creating the Notification, the code tests to see if the page is hidden. If it is, then the Notification is created. If it isn’t, then a message is written out to the page instead.<a data-type="indexterm" data-primary="" data-startref="ix_web_apps_notif" id="idm45475131709672"></a><a data-type="indexterm" data-primary="" data-startref="ix_notif_browser" id="idm45475131521480"></a><a data-type="indexterm" data-primary="" data-startref="ix_browser_notif" id="idm45475131520568"></a><a data-type="indexterm" data-primary="" data-startref="ix_web_notif" id="idm45475131519624"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Loading a File Locally in the Browser"><div class="sect1" id="idm45475131518552">
        <h1>Loading a File Locally in the Browser</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475131517576">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="web apps/APIs" data-secondary="loading files locally" id="ix_web_app_local_file"></a><a data-type="indexterm" data-primary="browser" data-secondary="local file loading" id="ix_browser_local_file"></a>You want to open an image file and output the metadata in the browser.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475131513528">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="web apps/APIs" data-secondary="File API" id="ix_web_apps_file_api"></a><a data-type="indexterm" data-primary="files" data-secondary="loading locally in browsers" id="ix_file_local_load"></a><a data-type="indexterm" data-primary="File API" id="ix_file_api"></a>Use the File API:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">inputElement</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'file'</code><code class="p">);</code>
        
        <code class="kd">function</code> <code class="nx">handleFile</code><code class="p">()</code> <code class="p">{</code>
          <code class="c1">// read the contents of the file</code>
          <code class="kr">const</code> <code class="nx">file</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">files</code><code class="p">[</code><code class="mi">0</code><code class="p">];</code>
          <code class="kr">const</code> <code class="nx">reader</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">FileReader</code><code class="p">();</code>
          <code class="c1">// add 'load' event listener</code>
          <code class="nx">reader</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'load'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="c1">// once loaded do something with the contents of the file</code>
          <code class="p">});</code>
          <code class="nx">reader</code><code class="p">.</code><code class="nx">readAsDataURL</code><code class="p">(</code><code class="nx">file</code><code class="p">);</code>
        <code class="p">}</code>
        
        <code class="nx">inputElement</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'change'</code><code class="p">,</code> <code class="nx">handleFile</code><code class="p">,</code> <code class="kc">false</code><code class="p">);</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475131507464">
        <h2>Discussion</h2>
        
        <p>The File API bolts onto the existing input element <code>file</code> type, used for file uploading. In addition to the capability of uploading the file to the server via a form upload, you can now access the file directly in JavaScript, and either work with it locally or upload the file to a server.</p>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>For more on <code>FileReader</code>, check out MDN’s <a href="http://mzl.la/1ya0o1k">page on the API</a>, and a <a href="http://mzl.la/1ya0qGs">related tutorial</a>.</p>
        </div>
        
        <p><a data-type="indexterm" data-primary="FileList object" id="idm45475131396712"></a><a data-type="indexterm" data-primary="File object" id="idm45475131396008"></a><a data-type="indexterm" data-primary="FileReader object" id="idm45475131395336"></a>There are three objects in the File API:</p>
        <dl>
        <dt><code>FileList</code></dt>
        <dd>
        <p>A list of files to upload via <code>input type="file"</code></p>
        </dd>
        <dt><code>File</code></dt>
        <dd>
        <p>Information about a specific file</p>
        </dd>
        <dt><code>FileReader</code></dt>
        <dd>
        <p>Object to asynchronously upload the file for client-side access</p>
        </dd>
        </dl>
        
        <p>Each object has associated properties and events, including being able to track the progress of a file upload (and provide a custom progress bar), as well as signaling when the upload is finished. The <code>File</code> object can provide information about the file, including  the filename, size, and MIME type. The <code>FileList</code> object provides a list of <code>File</code> objects, because more than one file can be specified if the input element has the <code>multiple</code> attribute set. The <code>FileReader</code> is the object that does the actual file upload.</p>
        
        <p><a data-type="xref" href="#loading_an_image">Example&nbsp;16-3</a> shows an application that uploads an image, embeds it in the web page, and displays some information about the image. The result is shown in <a data-type="xref" href="#using_the_files_api_to_read_a_chapter_of">Figure&nbsp;16-7</a>.</p>
        <div id="loading_an_image" data-type="example">
        <h5><span class="label">Example 16-3. </span>Loading an image and metadata</h5>
        
        <pre data-type="programlisting" data-code-language="html"><code class="cp">&lt;!DOCTYPE html&gt;</code>
        <code class="nt">&lt;head&gt;</code>
          <code class="nt">&lt;title&gt;</code>Image Reader<code class="nt">&lt;/title&gt;</code>
          <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"utf-8"</code> <code class="nt">/&gt;</code>
          <code class="nt">&lt;style&gt;</code>
            <code class="nf">#result</code> <code class="p">{</code>
              <code class="k">width</code><code class="o">:</code> <code class="m">500px</code><code class="p">;</code>
              <code class="k">margin</code><code class="o">:</code> <code class="m">30px</code><code class="p">;</code>
            <code class="p">}</code>
          <code class="nt">&lt;/style&gt;</code>
        <code class="nt">&lt;/head&gt;</code>
        <code class="nt">&lt;body&gt;</code>
          <code class="nt">&lt;h1&gt;</code>Image Reader<code class="nt">&lt;/h1&gt;</code>
          <code class="nt">&lt;form&gt;</code>
            <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"file"</code><code class="nt">&gt;</code>File:<code class="nt">&lt;/label&gt;</code> <code class="nt">&lt;br</code> <code class="nt">/&gt;</code>
            <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"file"</code> <code class="na">id=</code><code class="s">"file"</code> <code class="na">accept=</code><code class="s">".jpg, .jpeg, .png"</code> <code class="nt">/&gt;</code>
          <code class="nt">&lt;/form&gt;</code>
          <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"result"</code><code class="nt">&gt;</code>
            <code class="nt">&lt;ul&gt;</code>
              <code class="nt">&lt;li&gt;</code>Image name: <code class="nt">&lt;span</code> <code class="na">id=</code><code class="s">"name"</code><code class="nt">&gt;&lt;/span&gt;&lt;/li&gt;</code>
              <code class="nt">&lt;li&gt;</code>Image type: <code class="nt">&lt;span</code> <code class="na">id=</code><code class="s">"type"</code><code class="nt">&gt;&lt;/span&gt;&lt;/li&gt;</code>
            <code class="nt">&lt;/ul&gt;</code>
          <code class="nt">&lt;/div&gt;</code>
        
          <code class="nt">&lt;script&gt;</code>
            <code class="kr">const</code> <code class="nx">inputElement</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'file'</code><code class="p">);</code>
            <code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'result'</code><code class="p">);</code>
            <code class="kr">const</code> <code class="nx">nameEl</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'name'</code><code class="p">);</code>
            <code class="kr">const</code> <code class="nx">typeEl</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'type'</code><code class="p">);</code>
        
            <code class="kd">function</code> <code class="nx">handleFile</code><code class="p">()</code> <code class="p">{</code>
              <code class="c1">// read the contents of the file</code>
              <code class="kr">const</code> <code class="nx">file</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">files</code><code class="p">[</code><code class="mi">0</code><code class="p">];</code>
              <code class="kr">const</code> <code class="nx">reader</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">FileReader</code><code class="p">();</code>
              <code class="c1">// add 'load' event listener</code>
              <code class="nx">reader</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'load'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>
                <code class="c1">// create the image element and display it within the result div</code>
                <code class="kr">const</code> <code class="nx">img</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="s1">'img'</code><code class="p">);</code>
                <code class="nx">img</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s1">'src'</code><code class="p">,</code> <code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">result</code><code class="p">);</code>
                <code class="nx">img</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s1">'width'</code><code class="p">,</code> <code class="s1">'250'</code><code class="p">);</code>
                <code class="nx">result</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">img</code><code class="p">);</code>
                <code class="c1">// display the image name and file type</code>
                <code class="kr">const</code> <code class="nx">name</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createTextNode</code><code class="p">(</code><code class="nx">file</code><code class="p">.</code><code class="nx">name</code><code class="p">);</code>
                <code class="kr">const</code> <code class="nx">type</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createTextNode</code><code class="p">(</code><code class="nx">file</code><code class="p">.</code><code class="nx">type</code><code class="p">);</code>
                <code class="nx">nameEl</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">name</code><code class="p">);</code>
                <code class="nx">typeEl</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">type</code><code class="p">);</code>
              <code class="p">});</code>
              <code class="nx">reader</code><code class="p">.</code><code class="nx">readAsDataURL</code><code class="p">(</code><code class="nx">file</code><code class="p">);</code>
            <code class="p">}</code>
        
            <code class="nx">inputElement</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'change'</code><code class="p">,</code> <code class="nx">handleFile</code><code class="p">,</code> <code class="kc">false</code><code class="p">);</code>
          <code class="nt">&lt;/script&gt;</code>
        <code class="nt">&lt;/body&gt;</code></pre></div>
        
        <figure class="no-frame"><div id="using_the_files_api_to_read_a_chapter_of" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492055747/files/assets/jsc3_1607.png" alt="jsc3 1607" width="1445" height="942">
        <h6><span class="label">Figure 16-7. </span>Using the File API to read an image</h6>
        </div></figure>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>The File API is a W3C effort. For more information, you can read the <a href="http://.w3.org/TR/FileAPI">latest draft</a> or <a href="http://mzl.la/1ya0qGs">Mozilla’s coverage</a>.<a data-type="indexterm" data-primary="" data-startref="ix_browser_local_file" id="idm45475131370664"></a><a data-type="indexterm" data-primary="" data-startref="ix_web_app_local_file" id="idm45475131076408"></a><a data-type="indexterm" data-primary="" data-startref="ix_file_api" id="idm45475131075464"></a><a data-type="indexterm" data-primary="" data-startref="ix_web_apps_file_api" id="idm45475131074520"></a><a data-type="indexterm" data-primary="" data-startref="ix_file_local_load" id="idm45475131073576"></a></p>
        </div>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Extending the Possible with Web Components"><div class="sect1" id="idm45475131072376">
        <h1>Extending the Possible with Web Components</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475131071400">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="HTML5" data-secondary="Web Components and" id="ix_html5_web_comp"></a><a data-type="indexterm" data-primary="Web Components" id="ix_web_comp"></a>You need a component that encapsulates a specific look, feel, and behavior, and that you can include as easily as you’d include an HTML element, but don’t want to use a web framework.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475131067416">
        <h2>Solution</h2>
        
        <p>Consider Web Components, which allow you to create custom and reusable HTML elements. Web Components consist of a Template, custom elements, and shadow DOM. Each will be covered in the discussion.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475131065656">
        <h2>Discussion</h2>
        
        <p>Think of a web page widget that’s completely self-contained and you have some resemblance to Web Components, but only in the most shallow sense. Web Components, as a term, encompasses several different constructs. In the following sections, I’ll cover each, provide examples, discuss polyfills, and what to expect in the future.</p>
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="HTML templates"><div class="sect3" id="idm45475131063608">
        <h3>HTML templates</h3>
        
        <p><a data-type="indexterm" data-primary="HTML5" data-secondary="template element" id="idm45475131062168"></a><a data-type="indexterm" data-primary="template element" id="idm45475131060968"></a>The <code>template</code> element is now part of the HTML5 specification. Currently it’s <a href="https://oreil.ly/SJZDC">supported in most modern browsers</a>. Within the <code>template</code> element, we include HTML that we want to group as a whole that isn’t instantiated until it is <em>cloned</em>. It is parsed when loaded, to ensure it’s valid, but it doesn’t exist. Yet.</p>
        
        <p>Working with templates is very intuitive. Consider a common practice with today’s single-page JavaScript applications: taking returned data from a web service and formatting it as an unordered list (<code>ul</code>) (or new paragraph, or table, or whatever). Typically, we’d use the DOM methods to query for the existing <code>ul</code> element, create each list item (<code>li</code>) in the list, append text to the item, and append the item to the list.</p>
        
        <p>What if we could cut out some of the steps? We could with the <code>template</code>. Given the following HTML:</p>
        
        <pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;template</code> <code class="na">id=</code><code class="s">"hello-world"</code><code class="nt">&gt;</code>
          <code class="nt">&lt;p&gt;</code>Hello world!<code class="nt">&lt;/p&gt;</code>
        <code class="nt">&lt;/template&gt;</code></pre>
        
        <p>This is the JavaScript to add our “Hello World” template to a page:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">template</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'hello-world'</code><code class="p">);</code>
        <code class="kr">const</code> <code class="nx">templateContent</code> <code class="o">=</code> <code class="nx">template</code><code class="p">.</code><code class="nx">content</code><code class="p">;</code>
        <code class="nb">document</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">templateContent</code><code class="p">);</code></pre>
        
        <p><a data-type="indexterm" data-primary="appendChild() method" id="idm45475131005016"></a>In the example we access the <code>template</code> element, access the HTML element’s content, and then append it to the HTML document using <code>appendChild()</code>. As I noted, templates are very intuitive, but you might be wondering, what’s the point? All we’ve done is add more code for a process that’s already simple, but templates are important for their use in Custom Elements, discussed in <a data-type="xref" href="#custom_elements">“Custom elements”</a>, as well as the <a data-type="xref" href="#shadow_dom">“Shadow DOM”</a>.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="Custom elements"><div class="sect3" id="custom_elements">
        <h3>Custom elements</h3>
        
        <p><a data-type="indexterm" data-primary="HTML5" data-secondary="custom elements" id="idm45475130994440"></a><a data-type="indexterm" data-primary="custom elements in HTML" id="idm45475130993464"></a>The Web Components construct that has generated the most interest is the custom element. Instead of having to deal with existing HTML elements and their default behaviors and appearance, we create a custom element, package in its styling and behavior, and just attach it to the web page. A custom element can either extend an existing element or be “autonomous,” meaning it is a completely new element.  In the following example, I will extend the HTML <code>&lt;p&gt;</code> element to create a new element named <code>&lt;hello-world&gt;</code>. To do so, I will first need to define a class with any special methods for the element:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">class</code> <code class="nx">CustomGreeting</code> <code class="kr">extends</code> <code class="nx">HTMLParagraphElement</code> <code class="p">{</code>
          <code class="nx">constructor</code><code class="p">()</code> <code class="p">{</code>
            <code class="c1">// always call super first in constructor</code>
            <code class="kr">super</code><code class="p">();</code>
        
            <code class="c1">// any additional element functionality can be written here</code>
          <code class="p">}</code>
        <code class="p">}</code></pre>
        
        <p>Once the class is defined, I can register my element. Note that the element name must contain a hyphen to avoid any potential conflicts with existing HTML elements:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">customElements</code><code class="p">.</code><code class="nx">define</code><code class="p">(</code><code class="s2">"custom-greeting"</code><code class="p">,</code> <code class="nx">CustomGreeting</code><code class="p">);</code></pre>
        
        <p>Now I can use my element in my HTML page:</p>
        
        <pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;custom-greeting&gt;</code>Hello world!<code class="nt">&lt;/custom-greeting&gt;</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="Shadow DOM"><div class="sect3" id="shadow_dom">
        <h3>Shadow DOM</h3>
        
        <p><a data-type="indexterm" data-primary="DOM (Document Object Model)" data-secondary="shadow DOM" id="idm45475130978872"></a><a data-type="indexterm" data-primary="shadow DOM" id="idm45475130976344"></a>I can’t see <em>shadow DOM</em> without thinking of the fictional character “The Shadow.”  What a great character, and appropriate, too. Only The Shadow knew what evil lurked in the minds of men, and only the shadow DOM knows what lurks in its element’s DOM.</p>
        
        <p>Dragging ourselves away from fictional distraction, the shadow DOM is the most twisty of the Web Components. But intriguing, too.</p>
        
        <p>First, the nonmysterious bits. The shadow DOM is a DOM, a tree of nodes just like we’re used to when we access elements from the <code>document</code> element. The primary difference is that it doesn’t exist, not in a way we know a DOM existing. <a data-type="indexterm" data-primary="shadow root of HTML element" id="idm45475130938936"></a>When we create a <em>shadow root</em> of an element, then it comes into existence. But then, whatever the element used to have, is gone. That’s the key to remember about the shadow DOM: creating it replaces the element’s existing DOM.</p>
        
        <p><a data-type="indexterm" data-primary="attachShadow() method" id="idm45475130937208"></a>By using the <code>attachShadow</code> method, you can attach a shadow root to any element:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">shadow</code> <code class="o">=</code> <code class="nx">element</code><code class="p">.</code><code class="nx">attachShadow</code><code class="p">({</code><code class="nx">mode</code><code class="o">:</code> <code class="s1">'open'</code><code class="p">});</code></pre>
        
        <p>The <code>attachShadow</code> method takes one parameter (<code>mode</code>), which accepts a value of either <code>open</code> or <code>closed</code>.  Setting the value to <code>open</code> allows you to access the shadow DOM in the context of the page, like any other element. The most common shadow DOM use case is attaching a shadow DOM to a custom element as part of its constructor:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">class</code> <code class="nx">CustomGreeting</code> <code class="kr">extends</code> <code class="nx">HTMLElement</code> <code class="p">{</code>
          <code class="nx">constructor</code><code class="p">()</code> <code class="p">{</code>
            <code class="kr">super</code><code class="p">();</code>
            <code class="kr">const</code> <code class="nx">shadow</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">attachShadow</code><code class="p">({</code><code class="nx">mode</code><code class="o">:</code> <code class="s1">'open'</code><code class="p">});</code>
            <code class="kr">const</code> <code class="nx">greeting</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s1">'greeting'</code><code class="p">)</code> <code class="o">||</code> <code class="s1">'world'</code>
            <code class="nx">shadow</code><code class="p">.</code><code class="nx">innerHTML</code> <code class="o">=</code> <code class="sb">`&lt;p&gt;</code>
        <code class="sb">      Hello, &lt;span class="greeting"&gt;</code><code class="si">${</code><code class="nx">greeting</code><code class="si">}</code><code class="sb">&lt;/span&gt;</code>
        <code class="sb">    &lt;/p&gt;`</code><code class="p">;</code>
          <code class="p">}</code>
        <code class="p">}</code></pre>
        
        <p><a data-type="indexterm" data-primary="CSS (Cascading Style Sheet)" data-secondary="shadow DOM element" id="idm45475130779944"></a><a data-type="indexterm" data-primary="elements" data-secondary="DOM" id="idm45475130746920"></a>Though the above example contains two HTML elements, global CSS styles will not apply to a shadow DOM element. To style a custom element with a shadow DOM, we would create a style element within the custom element class and apply the styles:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">class</code> <code class="nx">CustomGreeting</code> <code class="kr">extends</code> <code class="nx">HTMLElement</code> <code class="p">{</code>
          <code class="nx">constructor</code><code class="p">()</code> <code class="p">{</code>
            <code class="kr">super</code><code class="p">();</code>
            <code class="kr">const</code> <code class="nx">shadow</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">attachShadow</code><code class="p">({</code><code class="nx">mode</code><code class="o">:</code> <code class="s1">'open'</code><code class="p">});</code>
            <code class="kr">const</code> <code class="nx">greeting</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s1">'greeting'</code><code class="p">)</code> <code class="o">||</code> <code class="s1">'world'</code>
            <code class="nx">shadow</code><code class="p">.</code><code class="nx">innerHTML</code> <code class="o">=</code> <code class="sb">`&lt;p class="wrapper"&gt;</code>
        <code class="sb">      Hello, &lt;span class="greeting"&gt;</code><code class="si">${</code><code class="nx">greeting</code><code class="si">}</code><code class="sb">&lt;/span&gt;</code>
        <code class="sb">    &lt;/p&gt;`</code><code class="p">;</code>
        
            <code class="c1">// add css styles</code>
            <code class="kr">const</code> <code class="nx">style</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="s1">'style'</code><code class="p">);</code>
        
            <code class="nx">style</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="sb">`</code>
        <code class="sb">      .wrapper {</code>
        <code class="sb">        color: pink;</code>
        <code class="sb">      }</code>
        
        <code class="sb">      .greeting {</code>
        <code class="sb">        color: green;</code>
        <code class="sb">        font-weight: bold;</code>
        <code class="sb">      }</code>
        <code class="sb">    `</code><code class="p">;</code>
          <code class="p">}</code>
        <code class="p">}</code></pre>
        <div data-type="tip"><h6>Tip</h6>
        <p><a data-type="indexterm" data-primary="Polymer Project" id="idm45475130743416"></a>The <a href="https://oreil.ly/874AX">Polymer Project</a> is a collection of libraries and tools for working with web components.</p>
        </div>
        
        <p>Web components are a very interesting part of the web standards ecosystem with great potential. HTML templates, custom HTML elements, and the shadow DOM provide a means for creating small, reusable UI components. This idea of lightweight components has been reflected in JavaScript libraries such as React and Vue.<a data-type="indexterm" data-primary="" data-startref="ix_web_comp" id="idm45475130642536"></a><a data-type="indexterm" data-primary="" data-startref="ix_html5_web_comp" id="idm45475130641560"></a></p>
        </div></section>
        
        
        
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Choosing a Front-End Framework"><div class="sect1" id="idm45475130640488">
        <h1>Choosing a Front-End Framework</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475130639272">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="frontend frameworks" id="ix_frontend_frame"></a><a data-type="indexterm" data-primary="web apps/APIs" data-secondary="frontend framework" id="ix_web_app_frontend_frame"></a>You are building a complex web application that requires a JavaScript framework. How do you choose the right framework?</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475130635304">
        <h2>Solution</h2>
        
        <p>There was a time when JavaScript frameworks seemingly came in and out of style faster than a fashion week runway. Thankfully, over the past few years the framework wars have slowed down and we have been left with a handful of excellent choices. Despite the slowdown of new development, it can still be challenging to choose the best framework for you and your project. When evaluating frameworks for a project, I recommend asking yourself the following questions:</p>
        <dl>
        <dt>Do I need a JavaScript framework?</dt>
        <dd>
        <p>Don’t always reach for a framework by default. Oftentimes, simple sites and applications may be easier to write and maintain without a framework, while being more performant for a user.</p>
        </dd>
        <dt>What is the type of project I’ll be developing?</dt>
        <dd>
        <p>Is this a personal project? A project for a client? An enterprise project with long-term support needs? An open source project? Consider the maintainers of your project and what will best meet their needs.</p>
        </dd>
        <dt>What is the level of community adoption and the longevity of the project?</dt>
        <dd>
        <p>Consider the long-term support of the framework. Is it still an active project? Will it be supported by a large community to answer questions and fix bugs?</p>
        </dd>
        <dt>How well documented is the framework?</dt>
        <dd>
        <p>Ensure that the documentation is easy to understand and complete.</p>
        </dd>
        <dt>What does the developer ecosystem for the framework look like?</dt>
        <dd>
        <p>Evaluate the tooling, plug-ins, and metaframeworks.</p>
        </dd>
        <dt>Am I familiar with the framework?</dt>
        <dd>
        <p>Is the framework something that you already know or have familiarity with or is this a learning project?</p>
        </dd>
        <dt>What will be the impact on my users?</dt>
        <dd>
        <p>Perhaps the most important question of all. Determine if a framework will impact the performance, accessibility, or usability of your project.</p>
        </dd>
        </dl>
        
        <p>While this is far from an exhaustive list, the authors of this book recommend looking at the following frameworks: React, Vue, Svelte, and Angular.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="React"><div class="sect2" id="idm45475130622136">
        <h2>React</h2>
        
        <p><a href="https://reactjs.org">React</a> is a UI-driven JavaScript framework developed and released by Facebook. React focuses on small visual components and commonly makes use of <code>jsx</code>, an XML syntax within JavaScript for rendering HTML components. <a data-type="indexterm" data-primary="React framework" id="idm45475130619672"></a>React makes updates to the page more efficient by using a representation of the DOM, referred to as the <a href="https://oreil.ly/oK21x">virtual DOM</a>.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Vue"><div class="sect2" id="idm45475130617800">
        <h2>Vue</h2>
        
        <p><a href="https://vuejs.org">Vue</a> is a community-focused, UI-driven framework. <a data-type="indexterm" data-primary="Vue framework" id="idm45475130615816"></a>Like React, Vue makes use of a virtual DOM to make page updates instantaneous. Many view Vue as an alternative to React. The feature set is similar, but Vue makes use of a more HTML-friendly template syntax and is community backed, rather than supported by Facebook. I’d recommend giving both React and Vue a spin to see which best matches you and your team’s development style.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Svelte"><div class="sect2" id="idm45475130614328">
        <h2>Svelte</h2>
        
        <p><a href="https://svelte.dev">Svelte</a> takes a different approach from the other JS frameworks here. <a data-type="indexterm" data-primary="Svelte framework" id="idm45475130612472"></a>Similar to React and Vue, it is a UI-focused library, but rather than doing the bulk of the work in the user’s browser, Svelte focuses on a compile step at development build time. The goal is to limit the tax on the user’s browser so that developers can build performant <span class="keep-together">
        applications</span>.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Angular"><div class="sect2" id="idm45475130610440">
        <h2>Angular</h2>
        
        <p><a href="https://angular.io">Angular</a> is a full-featured JavaScript framework, developed and released by Google. <a data-type="indexterm" data-primary="Angular framework" id="idm45475130608520"></a>Angular survived the first wave of “framework” wars and has adapted to a component-based architecture that is similar to modern libraries. Unlike React, Vue, and Svelte, Angular is a fully featured framework out of the box, with in-app navigation, data and state management, and testing built into the framework. <a data-type="indexterm" data-primary="" data-startref="ix_web_apps_ch16" id="idm45475130607352"></a><a data-type="indexterm" data-primary="" data-startref="ix_web_app_frontend_frame" id="idm45475130606408"></a><a data-type="indexterm" data-primary="" data-startref="ix_frontend_frame" id="idm45475130605448"></a>For many, particularly enterprise-focused teams, this can be a useful feature as it limits decision making when building new applications or adding features.</p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        </div></section></div></div><link rel="stylesheet" href="/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="/api/v2/epubs/urn:orm:book:9781492055747/files/epub.css" crossorigin="anonymous"></div></div></section>
</div>

https://learning.oreilly.com