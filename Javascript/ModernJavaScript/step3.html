<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
    
</style>
<link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492092506/files/epub.css" crossorigin="anonymous">
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><section epub:type="chapter">
        <h2 class="ch2" id="ch03"><span epub:type="pagebreak" id="page_50"></span>Chapter 3. Functions and Functional Programming</h2>
        <figure class="image-1">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/squirrel.jpg" alt="Images" width="119" height="119">
        </figure>
        <div class="outline">
        <p class="outh">Topics in This Chapter</p>
        <p class="chap-lev1"><a href="#ch03lev1sec1">3.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Declaring Functions</a></p>
        <p class="chap-lev1"><a href="#ch03lev1sec2">3.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Higher-Order Functions</a></p>
        <p class="chap-lev1"><a href="#ch03lev1sec3">3.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Function Literals</a></p>
        <p class="chap-lev1"><a href="#ch03lev1sec4">3.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Arrow Functions</a></p>
        <p class="chap-lev1"><a href="#ch03lev1sec5">3.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Functional Array Processing</a></p>
        <p class="chap-lev1"><a href="#ch03lev1sec6">3.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Closures</a></p>
        <p class="chap-lev1ia"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/queenc.jpg" alt="Images" width="24" height="24"></span>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ch03lev1sec7">3.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hard Objects</a></p>
        <p class="chap-lev1"><a href="#ch03lev1sec8">3.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Strict Mode</a></p>
        <p class="chap-lev1"><a href="#ch03lev1sec9">3.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Testing Argument Types</a></p>
        <p class="chap-lev1a"><a href="#ch03lev1sec10">3.10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Supplying More or Fewer Arguments</a></p>
        <p class="chap-lev1a"><a href="#ch03lev1sec11">3.11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Default Arguments</a></p>
        <p class="chap-lev1a"><a href="#ch03lev1sec12">3.12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rest Parameters and the Spread Operator</a></p>
        <p class="chap-lev1i"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/catc.jpg" alt="Images" width="23" height="23"></span>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ch03lev1sec13">3.13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Simulating Named Arguments with Destructuring</a></p>
        <p class="chap-lev1i"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/jokerc.jpg" alt="Images" width="27" height="27"></span>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ch03lev1sec14">3.14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hoisting</a></p>
        <p class="chap-lev1a"><a href="#ch03lev1sec15">3.15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Throwing Exceptions</a></p>
        <p class="chap-lev1i"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/queenc.jpg" alt="Images" width="24" height="24"></span>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ch03lev1sec16">3.16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Catching Exceptions</a></p>
        <p class="chap-lev1i"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/catc.jpg" alt="Images" width="23" height="23"></span>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ch03lev1sec17">3.17&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The <code>finally</code> Clause</a></p>
        <p class="chap-lev1a"><a href="#ch03lev1sec18">Exercises</a></p>
        </div>
        <p class="noindent"><span epub:type="pagebreak" id="page_51"></span>In this chapter, you will learn how to write functions in JavaScript. JavaScript is a “functional” programming language. Functions are “first-class” values, just like numbers or strings. Functions can consume and produce other functions. Mastering a functional programming style is essential for working with modern JavaScript.</p>
        <p class="noindent">This chapter also covers the JavaScript parameter passing and scope rules, as well as the details of throwing and catching exceptions.</p>
        <section>
        <h3 class="h3" id="ch03lev1sec1">3.1 Declaring Functions</h3>
        <p class="noindent">In JavaScript, you declare a function by providing</p>
        <ol class="order">
        <li><p class="list">The name of the function</p></li>
        <li><p class="list">The names of the parameters</p></li>
        <li><p class="list">The body of the function, which computes and returns the function result</p></li>
        </ol>
        <p class="noindent">You do not specify the types of the function parameters or result. Here is an example:</p>
        <p class="codelink"><a id="rch03pr01" href="ch03_images.xhtml#ch03pr01">Click here to view code image</a></p>
        <pre class="pre">function average(x, y) {
          return (x + y) / 2
        }</pre>
        <p class="noindent"><span epub:type="pagebreak" id="page_52"></span>The <code>return</code> statement yields the value that the function returns.</p>
        <p class="noindent">To call this function, simply pass the desired arguments:</p>
        <p class="codelink"><a id="rch03pr02" href="ch03_images.xhtml#ch03pr02">Click here to view code image</a></p>
        <pre class="pre">let result = average(6, 7) // <span class="cite"><code>result</code> is set to <code>6.5</code></span></pre>
        <p class="noindent">What if you pass something other than a number? Whatever happens, happens. For example:</p>
        <p class="codelink"><a id="rch03pr03" href="ch03_images.xhtml#ch03pr03">Click here to view code image</a></p>
        <pre class="pre">result = average('6', '7') // <span class="cite"><code>result</code> is set to <code>33.5</code></span></pre>
        <p class="noindent">When you pass strings, the <code>+</code> in the function body concatenates them. The resulting string <code>'67'</code> is converted to a number before the division by 2.</p>
        <p class="noindent">That looks rather casual to a Java, C#, or C++ programmer who is used to compile-time type checking. Indeed, if you mess up argument types, you only find out when something strange happens at runtime. On the flip side, you can write functions that work with arguments of multiple types, which can be convenient.</p>
        <p class="noindent">The <code>return</code> statement returns immediately, abandoning the remainder of the function. Consider this example—an <code>indexOf</code> function that computes the index of a value in an array:</p>
        <p class="codelink"><a id="rch03pr04" href="ch03_images.xhtml#ch03pr04">Click here to view code image</a></p>
        <pre class="pre">function indexOf(arr, value) {
          for (let i in arr) {
            if (arr[i] === value) <strong>return i</strong>
          }
          <strong>return -1</strong>
        }</pre>
        <p class="noindent">As soon as a match is found, the index is returned and the function terminates.</p>
        <p class="noindent">A function may choose not to specify a return value. If the function body exits without a <code>return</code> statement, or a <code>return</code> keyword isn’t followed by an expression, the function returns the <code>undefined</code> value. This usually happens when a function is solely called for a side effect.</p>
        <div class="tip">
        <p class="tip-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/tip.jpg" alt="Images" width="36" height="33"></span> Tip</p>
        <p class="noindent">If a function sometimes returns a result, and sometimes you don’t want to return anything, be explicit:</p>
        <pre class="pre">return undefined</pre>
        </div>
        <div class="note">
        <p class="note-caption"><span epub:type="pagebreak" id="page_53"></span><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">As mentioned in <a href="ch02.xhtml#ch02">Chapter 2</a>, a <code>return</code> statement must always have at least one token before the end of the line, to avoid automatic semicolon insertion. For example, if a function returns an object, put at least the opening brace on the same line:</p>
        <p class="codelink"><a id="rch03pr05" href="ch03_images.xhtml#ch03pr05">Click here to view code image</a></p>
        <pre class="pre">return <strong>{</strong>
          average: (x + y) / 2,
          max: Math.max(x, y),
          . . .
        }</pre>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec2">3.2 Higher-Order Functions</h3>
        <p class="noindent">JavaScript is a functional programming language. Functions are values that you can store in variables, pass as arguments, or return as function results.</p>
        <p class="noindent">For example, we can store the <code>average</code> function in a variable:</p>
        <pre class="pre">let f = average</pre>
        <p class="noindent">Then you can call the function:</p>
        <pre class="pre">let result = f(6, 7)</pre>
        <p class="noindent">When the expression <code>f(6, 7)</code> is executed, the contents of <code>f</code> is found to be a function. That function is called with arguments <code>6</code> and <code>7</code>.</p>
        <p class="noindent">We can later put another function into the variable <code>f</code>:</p>
        <pre class="pre">f = Math.max</pre>
        <p class="noindent">Now when you compute <code>f(6, 7)</code>, the answer becomes <code>7</code>, the result of calling <code>Math.max</code> with the provided arguments.</p>
        <p class="noindent">Here is an example of passing a function as an argument. If <code>arr</code> is an array, the method call</p>
        <pre class="pre">arr.map(someFunction)</pre>
        <p class="noindent">applies the provided function to all elements, and returns an array of the collected results (without modifying the original array). For example,</p>
        <pre class="pre">result = [0, 1, 2, 4].map(Math.sqrt)</pre>
        <p class="noindent">sets <code>result</code> to</p>
        <pre class="pre">[0, 1, 1.4142135623730951, 2]</pre>
        <p class="noindent">The <code>map</code> method is sometimes called a <em>higher-order function</em>: a function that consumes another function.</p>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec3"><span epub:type="pagebreak" id="page_54"></span>3.3 Function Literals</h3>
        <p class="noindent">Let us continue the example of the preceding section. Suppose we want to multiply all array elements by 10. Of course, we can write a function</p>
        <p class="codelink"><a id="rch03pr06" href="ch03_images.xhtml#ch03pr06">Click here to view code image</a></p>
        <pre class="pre">function multiplyBy10(x) { return x * 10 }</pre>
        <p class="noindent">Now we can call:</p>
        <p class="codelink"><a id="rch03pr07" href="ch03_images.xhtml#ch03pr07">Click here to view code image</a></p>
        <pre class="pre">result = [0, 1, 2, 4].map(multiplyBy10)</pre>
        <p class="noindent">But it seems a waste to declare a new function just to use it once.</p>
        <p class="noindent">It is better to use a <em>function literal</em>. JavaScript has two syntactical variants. Here is the first one:</p>
        <p class="codelink"><a id="rch03pr08" href="ch03_images.xhtml#ch03pr08">Click here to view code image</a></p>
        <pre class="pre">result = [0, 1, 2, 4].map(<strong>function (x) { return 10 * x }</strong>)</pre>
        <p class="noindent">The syntax is straightforward. You use the same <code>function</code> syntax as before, but now you omit the name. The function literal is a value that denotes the function with the specified action. That value is passed to the <code>map</code> method.</p>
        <p class="noindent">By itself, the function literal doesn’t have a name, just like the array literal <code>[0, 1, 2, 4]</code> doesn’t have a name. If you want to give the function a name, do what you always do when you want to give something a name—store it in a variable:</p>
        <p class="codelink"><a id="rch03pr09" href="ch03_images.xhtml#ch03pr09">Click here to view code image</a></p>
        <pre class="pre">const average = function (x, y) { return (x + y) / 2 }</pre>
        <div class="tip">
        <p class="tip-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/tip.jpg" alt="Images" width="36" height="33"></span> Tip</p>
        <p class="noindent">Think of anonymous function literals as the “normal” case. A named function is a shorthand for declaring a function literal and then giving it a name.</p>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec4">3.4 Arrow Functions</h3>
        <p class="noindent">In the preceding section, you saw how to declare function literals with the <code>function</code> keyword. There is a second, more concise form that uses the <code>=&gt;</code> operator, usually called “arrow”:</p>
        <p class="codelink"><a id="rch03pr10" href="ch03_images.xhtml#ch03pr10">Click here to view code image</a></p>
        <pre class="pre">const average = (x, y) <strong>=&gt;</strong> (x + y) / 2</pre>
        <p class="noindent">You provide the parameter variables to the left of the arrow and the return value to the right.</p>
        <p class="noindent">If there is a single parameter, you don’t need to enclose it in parentheses:</p>
        <p class="codelink"><a id="rch03pr11" href="ch03_images.xhtml#ch03pr11">Click here to view code image</a></p>
        <pre class="pre">const multiplyBy10 = <strong>x</strong> =&gt; x * 10</pre>
        <p class="noindent"><span epub:type="pagebreak" id="page_55"></span>If the function has no parameters, use an empty set of parentheses:</p>
        <p class="codelink"><a id="rch03pr12" href="ch03_images.xhtml#ch03pr12">Click here to view code image</a></p>
        <pre class="pre">const dieToss = <strong>()</strong> =&gt; Math.trunc(Math.random() * 6) + 1</pre>
        <p class="noindent">Note that <code>dieToss</code> is a function, not a number. Each time you call <code>dieToss()</code>, you get a random integer between 1 and 6.</p>
        <p class="noindent">If an arrow function is more complex, place its body inside a block statement. Use the <code>return</code> keyword to return a value out of the block:</p>
        <p class="codelink"><a id="rch03pr13" href="ch03_images.xhtml#ch03pr13">Click here to view code image</a></p>
        <pre class="pre">const indexOf = (arr, value) =&gt; <strong>{</strong>
            for (let i in arr) {
              if (arr[i] === value) <strong>return i</strong>
            }
            <strong>return -1</strong>
          <strong>}</strong></pre>
        <div class="tip">
        <p class="tip-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/tip.jpg" alt="Images" width="36" height="33"></span> Tip</p>
        <p class="noindent">The <code>=&gt;</code> token must be on the same line as the parameters:</p>
        <p class="codelink"><a id="rch03pr14" href="ch03_images.xhtml#ch03pr14">Click here to view code image</a></p>
        <pre class="pre">const average = (x, y) <strong>=&gt;</strong> // <span class="cite">OK</span>
          (x + y) / 2
        const distance  = (x, y) // <span class="cite">Error</span>
          <strong>=&gt;</strong> Math.abs(x - y)</pre>
        <p class="noindent">If you write an arrow function on more than one line, it is clearer to use braces:</p>
        <p class="codelink"><a id="rch03pr15" href="ch03_images.xhtml#ch03pr15">Click here to view code image</a></p>
        <pre class="pre">const average = (x, y) =&gt; <strong>{</strong>
          return (x + y) / 2
        <strong>}</strong></pre>
        </div>
        <div class="caution">
        <p class="caution-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/caution.jpg" alt="Images" width="36" height="36"></span> Caution</p>
        <p class="noindent">If an arrow function does nothing but returns an object literal, then you must enclose the object in parentheses:</p>
        <p class="codelink"><a id="rch03pr16" href="ch03_images.xhtml#ch03pr16">Click here to view code image</a></p>
        <pre class="pre">const stats = (x, y) =&gt; <strong>(</strong>{
            average: (x + y) / 2,
            distance: Math.abs(x - y)
          }<strong>)</strong></pre>
        <p class="noindent">Otherwise, the braces would be parsed as a block.</p>
        </div>
        <div class="tip">
        <p class="tip-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/tip.jpg" alt="Images" width="36" height="33"></span> Tip</p>
        <p class="noindent">As you will see in <a href="ch04.xhtml#ch04">Chapter 4</a>, arrow functions have more regular behavior than functions declared with the <code>function</code> keyword. Many JavaScript programmers prefer to use the arrow syntax for anonymous and nested functions. Some programmers use the arrow syntax for all functions, while others prefer to declare top-level functions with <code>function</code>. This is purely a matter of taste.</p>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec5"><span epub:type="pagebreak" id="page_56"></span>3.5 Functional Array Processing</h3>
        <p class="noindent">Instead of iterating over an array with a <code>for of</code> or <code>for in</code> loop, you can use the <code>forEach</code> method. Pass a function that processes the elements and index values:</p>
        <p class="codelink"><a id="rch03pr17" href="ch03_images.xhtml#ch03pr17">Click here to view code image</a></p>
        <pre class="pre">arr.forEach((element, index) =&gt; { console.log(`${index}: ${element}`) })</pre>
        <p class="noindent">The function is called for each array element, in increasing index order.</p>
        <p class="noindent">If you only care about the elements, you can pass a function with one parameter:</p>
        <p class="codelink"><a id="rch03pr18" href="ch03_images.xhtml#ch03pr18">Click here to view code image</a></p>
        <pre class="pre">arr.forEach(element =&gt; { console.log(`${element}`) })</pre>
        <p class="noindent">The <code>forEach</code> method will call this function with both the element and the index, but in this example, the index is ignored.</p>
        <p class="noindent">The <code>forEach</code> method doesn’t produce a result. Instead, the function that you pass to it must have some side effect—printing a value or making an assignment. It is even better if you can avoid side effects altogether and use methods such as <code>map</code> and <code>filter</code> that transform arrays into their desired form.</p>
        <p class="noindent">In <a href="ch03.xhtml#ch03lev1sec2">Section 3.2</a>, “<a href="ch03.xhtml#ch03lev1sec2">Higher-Order Functions</a>” (<a href="ch03.xhtml#page_53">page 53</a>), you saw the <code>map</code> method that transforms an array, applying a function to each element. Here is a practical example. Suppose you want to build an HTML list of items in an array. You can first enclose each of the items in a <code>li</code> element:</p>
        <p class="codelink"><a id="rch03pr19" href="ch03_images.xhtml#ch03pr19">Click here to view code image</a></p>
        <pre class="pre">const enclose = (tag, contents) =&gt; `&lt;${tag}&gt;${contents}&lt;/${tag}&gt;`
        const listItems = items.map(i =&gt; enclose('li', i))</pre>
        <p class="noindent">Actually, it is safer to first escape <code>&amp;</code> and <code>&lt;</code> characters in the items. Let’s suppose we have an <code>htmlEscape</code> function for this purpose. (You will find an implementation in the book’s companion code.) Then we can first transform the items to make them safe, and then enclose them:</p>
        <p class="codelink"><a id="rch03pr20" href="ch03_images.xhtml#ch03pr20">Click here to view code image</a></p>
        <pre class="pre">const listItems = items
          .map(htmlEscape)
          .map(i =&gt; enclose('li', i))</pre>
        <p class="noindent">Now the result is an array of <code>li</code> elements. Next, we concatenate all strings with the <code>Array.join</code> method (see <a href="ch07.xhtml#ch07">Chapter 7</a>), and enclose the resulting string in a <code>ul</code> element:</p>
        <p class="codelink"><a id="rch03pr21" href="ch03_images.xhtml#ch03pr21">Click here to view code image</a></p>
        <pre class="pre">const list = enclose('ul',
          items
          .map(htmlEscape)
          .map(i =&gt; enclose('li', i))
          .join(''))</pre>
        <p class="noindent">Another useful array method is <code>filter</code>. It receives a <em>predicate</em> function—a function that returns a Boolean (or Boolish) value. The result is an array of all elements <span epub:type="pagebreak" id="page_57"></span>that fulfill the predicate. Continuing the preceding example, we don’t want to include empty strings in the list. We can remove them like this:</p>
        <p class="codelink"><a id="rch03pr22" href="ch03_images.xhtml#ch03pr22">Click here to view code image</a></p>
        <pre class="pre">const list = enclose('ul',
          items
          <strong>.filter(i =&gt; i.trim() !== '')</strong>
          .map(htmlEscape)
          .map(i =&gt; enclose('li', i))
          .join(''))</pre>
        <p class="noindent">This processing pipeline is a good example of a high-level “what, not how” style of programming. What do we want? Throw away empty strings, escape HTML, enclose items in <code>li</code> elements, and join them. How is this done? Ultimately, by a sequence of loops and branches, but that is an implementation detail.</p>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec6">3.6 Closures</h3>
        <p class="noindent">The <code>setTimeout</code> function takes two arguments: a function to execute later, when a timeout has elapsed, and the duration of the timeout in milliseconds. For example, this call says “Goodbye” in ten seconds:</p>
        <p class="codelink"><a id="rch03pr23" href="ch03_images.xhtml#ch03pr23">Click here to view code image</a></p>
        <pre class="pre">setTimeout(() =&gt; console.log('Goodbye'), 10000)</pre>
        <p class="noindent">Let’s make this more flexible:</p>
        <p class="codelink"><a id="rch03pr24" href="ch03_images.xhtml#ch03pr24">Click here to view code image</a></p>
        <pre class="pre">const sayLater = (text, when) =&gt; {
          let task = () =&gt; console.log(text)
          setTimeout(task, when)
        }</pre>
        <p class="noindent">Now we can call:</p>
        <p class="codelink"><a id="rch03pr25" href="ch03_images.xhtml#ch03pr25">Click here to view code image</a></p>
        <pre class="pre">sayLater('Hello', 1000)
        sayLater('Goodbye', 10000)</pre>
        <p class="noindent">Look at the variable <code>text</code> inside the arrow function <code>() =&gt; console.log(<strong>text</strong>)</code>. If you think about it, something nonobvious is going on. The code of the arrow function runs long after the call to <code>sayLater</code> has returned. How does the <code>text</code> variable stay around? And how can it be first <code>'Hello'</code> and then <code>'Goodbye'</code>?</p>
        <p class="noindent">To understand what is happening, we need to refine our understanding of a function. A function has three ingredients:</p>
        <ol class="order">
        <li><p class="list">A block of code</p></li>
        <li><p class="list">Parameters</p></li>
        <li><p class="list">The free variables—that is, the variables that are used in the code but are not declared as parameters or local variables</p></li>
        </ol>
        <p class="noindent"><span epub:type="pagebreak" id="page_58"></span>A function with free variables is called a <em>closure</em>.</p>
        <p class="noindent">In our example, <code>text</code> is a free variable of the arrow function. The data structure representing the closure stores a reference to the variable when the function is created. We say that the variable is <em>captured</em>. That way, its value is available when the function is later called.</p>
        <p class="noindent">In fact, the arrow function <code>() =&gt; console.log(text)</code> also captures a second variable, namely <code>console</code>.</p>
        <p class="noindent">But how does <code>text</code> get to have two different values? Let’s do this in slow motion. The first call to <code>sayLater</code> creates a closure that captures the <code>text</code> parameter variable holding the value <code>'Hello'</code>. When the <code>sayLater</code> method exits, that variable does not go away because it is still used by the closure. When <code>sayLater</code> is called again, a second closure is created that captures a different <code>text</code> parameter variable, this time holding <code>'Goodbye'</code>.</p>
        <p class="noindent">In JavaScript, a captured variable is a reference to another variable, not its current value. If you change the contents of the captured variable, the change is visible in the closure. Consider this case:</p>
        <p class="codelink"><a id="rch03pr26" href="ch03_images.xhtml#ch03pr26">Click here to view code image</a></p>
        <pre class="pre">let text = 'Goodbye'
        setTimeout(() =&gt; console.log(text), 10000)
        text = 'Hello'</pre>
        <p class="noindent">In ten seconds, the string <code>'Hello'</code> is printed, even though <code>text</code> contained <code>'Goodbye'</code> when the closure was created.</p>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">The lambda expressions and inner classes in Java can also capture variables from enclosing scopes. But in Java, a captured local variable must be effectively <code>final</code>—that is, its value can never change.</p>
        <p class="noindent">Capturing mutable variables complicates the implementation of closures in JavaScript. A JavaScript closure remembers not just the initial value but the location of the captured variable. And the captured variable is kept alive for as long as the closure exists—even if it is a local variable of a terminated method.</p>
        </div>
        <p class="noindent">The fundamental idea of a closure is very simple: A free variable inside a function means exactly what it means outside. However, the consequences are profound. It is very useful to capture variables and have them accessible indefinitely. The next section provides a dramatic illustration, by implementing objects and methods entirely with closures.</p>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec7"><span epub:type="pagebreak" id="page_59"></span>3.7 Hard Objects</h3>
        <figure class="image-1">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/queen.jpg" alt="Images" width="85" height="85">
        </figure>
        <p class="noindent">Let’s say we want to implement bank account objects. Each bank account has a balance. We can deposit and withdraw money.</p>
        <p class="noindent">We want to keep the object state private, so that nobody can modify it except through methods that we provide. Here is an outline of a factory function:</p>
        <p class="codelink"><a id="rch03pr27" href="ch03_images.xhtml#ch03pr27">Click here to view code image</a></p>
        <pre class="pre">const createAccount = () =&gt; {
          . . .
          return {
            deposit: amount =&gt; { . . . },
            withdraw: amount =&gt; { . . . },
            getBalance: () =&gt; . . .
          }
        }</pre>
        <p class="noindent">Then we can construct as many accounts as we like:</p>
        <p class="codelink"><a id="rch03pr28" href="ch03_images.xhtml#ch03pr28">Click here to view code image</a></p>
        <pre class="pre">const harrysAccount = createAccount()
        const sallysAccount = createAccount()
        sallysAccount.deposit(500)</pre>
        <p class="noindent">Note that an account object contains only methods, not data. After all, if we added the balance to the account object, anyone could modify it. There are no “private” properties in JavaScript.</p>
        <p class="noindent">Where do we store the data? It’s simple—as local variables in the factory function:</p>
        <p class="codelink"><a id="rch03pr29" href="ch03_images.xhtml#ch03pr29">Click here to view code image</a></p>
        <pre class="pre">const createAccount = () =&gt; {
          let <strong>balance</strong> = 0
          return {
            . . .
          }
        }</pre>
        <p class="noindent">We capture the local data in the methods:</p>
        <p class="codelink"><a id="rch03pr30" href="ch03_images.xhtml#ch03pr30">Click here to view code image</a></p>
        <pre class="pre">const createAccount = () =&gt; {
          . . .
          return {
            deposit: amount =&gt; {
              <strong>balance</strong> += amount
            },
            withdraw: amount =&gt; {
              if (balance &gt;= amount)
                <strong>balance</strong> -= amount
            },
            getBalance: () =&gt; <strong>balance</strong>
          }
        }</pre>
        <p class="noindent"><span epub:type="pagebreak" id="page_60"></span>Each account has <em>its own</em> captured <code>balance</code> variable, namely the one that was created when the factory function was called.</p>
        <p class="noindent">You can provide parameters in the factory function:</p>
        <p class="codelink"><a id="rch03pr31" href="ch03_images.xhtml#ch03pr31">Click here to view code image</a></p>
        <pre class="pre">const createAccount = (initialBalance) =&gt; {
          let balance = initialBalance + 10 // <span class="cite">Bonus for opening the account</span>
          return {
            . . .
          }
        }</pre>
        <p class="noindent">You can even capture the parameter variable instead of a local variable:</p>
        <p class="codelink"><a id="rch03pr32" href="ch03_images.xhtml#ch03pr32">Click here to view code image</a></p>
        <pre class="pre">const createAccount = (<strong>balance</strong>) =&gt; {
          balance += 10 // <span class="cite">Bonus for opening the account</span>
          return {
            deposit: amount =&gt; {
              <strong>balance</strong> += amount
            },
            . . .
          }
        }</pre>
        <p class="noindent">At first glance, this looks like an odd way of producing objects. But these objects have two significant advantages. The state, consisting solely of captured local variables of the factory function, is automatically encapsulated. And you avoid the <code>this</code> parameter, which, as you will see in <a href="ch04.xhtml#ch04">Chapter 4</a>, is not straightforward in JavaScript.</p>
        <p class="noindent">This technique is sometimes called the “closure pattern” or “factory class pattern,” but I like the term that Douglas Crockford uses in his book <em>How JavaScript Works</em>. He calls them “hard objects.”</p>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">To further harden the object, you can use the <code>Object.freeze</code> method that yields an object whose properties cannot be modified or removed, and to which no new properties can be added.</p>
        <p class="codelink"><a id="rch03pr33" href="ch03_images.xhtml#ch03pr33">Click here to view code image</a></p>
        <pre class="pre">const createAccount = (balance) =&gt; {
          return <strong>Object.freeze</strong>({
            deposit: amount =&gt; {
              <code>balance</code> += amount
            },
            . . .
          })
        }</pre>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec8"><span epub:type="pagebreak" id="page_61"></span>3.8 Strict Mode</h3>
        <p class="noindent">As you have seen, JavaScript has its share of unusual features, some of which have proven to be poorly suited for large-scale software development. <em>Strict mode</em> outlaws some of these features. You should always use strict mode.</p>
        <p class="noindent">To enable strict mode, place the line</p>
        <pre class="pre">'use strict'</pre>
        <p class="noindent">as the first non-comment line in your file. (Double quotes instead of single quotes are OK, as is a semicolon.)</p>
        <p class="noindent">If you want to force strict mode in the Node.js REPL, start it with</p>
        <pre class="pre">node --use-strict</pre>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">In a browser console, you need to prefix each line that you want to execute in strict mode with <code>'use strict';</code> or <code>'use strict'</code> followed by Shift+Enter. That is not very convenient.</p>
        </div>
        <p class="noindent">You can apply strict mode to individual functions:</p>
        <p class="codelink"><a id="rch03pr34" href="ch03_images.xhtml#ch03pr34">Click here to view code image</a></p>
        <pre class="pre">function strictInASeaOfSloppy() {
          'use strict'
          . . .
        }</pre>
        <p class="noindent">There is no good reason to use per-function strict mode with modern code. Apply strict mode to the entire file.</p>
        <p class="noindent">Finally, strict mode is enabled inside classes (see <a href="ch04.xhtml#ch04">Chapter 4</a>) and ECMAScript modules (see <a href="ch10.xhtml#ch10">Chapter 10</a>).</p>
        <p class="noindent">For the record, here are the key features of strict mode:</p>
        <ul class="bullet">
        <li><p class="list-item">Assigning a value to a previously undeclared variable is an error and does not create a global variable. You must use <code>let</code>, <code>const</code>, or <code>var</code> for all variable declarations.</p></li>
        <li><p class="list-item">You cannot assign a new value to a read-only global property such as <code>NaN</code> or <code>undefined</code>. (Sadly, you can still declare local variables that shadow them.)</p></li>
        <li><p class="list-item">Functions can only be declared at the top level of a script or function, not in a nested block.</p></li>
        <li><p class="list-item">The <code>delete</code> operator cannot be applied to “unqualified identifiers.” For example, <code>delete parseInt</code> is a syntax error. Trying to <code>delete</code> a property that is not “configurable” (such as <code>delete 'Hello'.length</code>) causes a runtime error.<span epub:type="pagebreak" id="page_62"></span></p></li>
        <li><p class="list">You cannot have duplicate function parameters (<code>function average(x, x)</code>). Of course, you never wanted those, but they are legal in the “sloppy” (non-strict) mode.</p></li>
        <li><p class="list">You cannot use octal literals with a <code>0</code> prefix: <code>010</code> is a syntax error, not an octal 10 (which is 8 in decimal). If you want octal, use <code>0o10</code>.</p></li>
        <li><p class="list">The <code>with</code> statement (which is not discussed in this book) is prohibited.</p></li>
        </ul>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">In strict mode, reading the value of an undeclared variable throws a <code>ReferenceError</code>. If you need to find out whether a variable has been declared (and initialized), you can’t check</p>
        <p class="codelink"><a id="rch03pr35" href="ch03_images.xhtml#ch03pr35">Click here to view code image</a></p>
        <pre class="pre">possiblyUndefinedVariable !== undefined</pre>
        <p class="noindent">Instead, use the condition</p>
        <p class="codelink"><a id="rch03pr36" href="ch03_images.xhtml#ch03pr36">Click here to view code image</a></p>
        <pre class="pre">typeof possiblyUndefinedVariable !== 'undefined'</pre>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec9">3.9 Testing Argument Types</h3>
        <p class="noindent">In JavaScript, you do not specify the types of function arguments. Therefore, you can allow callers to supply an argument of one type or another, and handle that argument according to its actual type.</p>
        <p class="noindent">As a somewhat contrived example, the <code>average</code> function may accept either numbers or arrays.</p>
        <p class="codelink"><a id="rch03pr37" href="ch03_images.xhtml#ch03pr37">Click here to view code image</a></p>
        <pre class="pre">const average = (x, y) =&gt; {
          let sum = 0
          let n = 0
          if (Array.isArray(x)) {
            for (const value of x) { sum += value; n++ }
          } else {
            sum = x; n = 1
          }
          if (Array.isArray(y)) {
            for (const value of y) { sum += value }
          } else {
            sum += y; n++
          }
          return n === 0 ? 0 : sum / n
        }</pre>
        <p class="noindent">Now you can call:</p>
        <p class="codelink"><a id="rch03pr38" href="ch03_images.xhtml#ch03pr38">Click here to view code image</a></p>
        <pre class="pre">result = average(1, 2)
        result = average([1, 2, 3], 4)
        result = average(1, [2, 3, 4])
        result = average([1, 2], [3, 4, 5])</pre>
        <p class="noindent"><span epub:type="pagebreak" id="page_63"></span><a href="#ch03tbl01">Table 3-1</a> shows how to test whether an argument <code>x</code> conforms to a given type.</p>
        <figure class="table" id="ch03tbl01">
        <figcaption><p class="table-title"><strong>Table 3-1</strong>&nbsp;&nbsp;&nbsp;&nbsp;Type Tests</p></figcaption>
        <table class="tabletb">
        <thead>
        <tr>
        <th style="width: 33%;"><p class="tableth">Type</p></th>
        <th style="width: 34%;"><p class="tableth">Test</p></th>
        <th style="width: 33%;"><p class="tableth">Notes</p></th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p class="tabletd">String</p></td>
        <td><p class="codelink"><a id="rch03pr39" href="ch03_images.xhtml#ch03pr39">Click here to view code image</a></p>
        <pre class="pre">typeof x === 'string' ||
          x instanceof String</pre></td>
        <td><p class="tabletd"><code>x</code> might be constructed as <code>new String(. . .)</code></p></td>
        </tr>
        <tr>
        <td><p class="tabletd">Regular expression</p></td>
        <td><p class="tabletd"><code>x instanceof RegExp</code></p></td>
        <td><p class="tabletd">&nbsp;</p></td>
        </tr>
        <tr>
        <td><p class="tabletd">Number</p></td>
        <td><p class="codelink"><a id="rch03pr40" href="ch03_images.xhtml#ch03pr40">Click here to view code image</a></p>
        <pre class="pre">typeof x === 'number' ||
          x instanceof Number</pre></td>
        <td><p class="tabletd"><code>x</code> might be constructed as <code>new Number(. . .)</code></p></td>
        </tr>
        <tr>
        <td><p class="tabletd">Anything that can be converted to a number</p></td>
        <td><p class="tabletd"><code>typeof +x === 'number'</code></p></td>
        <td><p class="tabletd">Obtain the numeric value as <code>+x</code></p></td>
        </tr>
        <tr>
        <td><p class="tabletd">Array</p></td>
        <td><p class="tabletd"><code>Array.isArray(x)</code></p></td>
        <td><p class="tabletd">&nbsp;</p></td>
        </tr>
        <tr>
        <td><p class="tabletd">Function</p></td>
        <td><p class="tabletd"><code>typeof x === 'function'</code></p></td>
        <td><p class="tabletd">&nbsp;</p></td>
        </tr>
        </tbody>
        </table>
        </figure>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">Some programmers write functions that turn any argument values into numbers, such as</p>
        <p class="codelink"><a id="rch03pr41" href="ch03_images.xhtml#ch03pr41">Click here to view code image</a></p>
        <pre class="pre">const average = (x, y) =&gt; {
          return (+x + +y) / 2
        }</pre>
        <p class="noindent">Then one can call</p>
        <pre class="pre">average('3', [4])</pre>
        <p class="noindent">Is that degree of flexibility useful, harmless, or a harbinger of trouble? I don’t recommend it.</p>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec10">3.10 Supplying More or Fewer Arguments</h3>
        <p class="noindent">Suppose a function is declared with a particular number of parameters, for example:</p>
        <p class="codelink"><a id="rch03pr42" href="ch03_images.xhtml#ch03pr42">Click here to view code image</a></p>
        <pre class="pre">const average = (x, y) =&gt; (x + y) / 2</pre>
        <p class="noindent">It appears as if you must supply two arguments when you call the function. However, that is not the JavaScript way. You can call the function with more arguments—they are silently ignored:</p>
        <p class="codelink"><a id="rch03pr43" href="ch03_images.xhtml#ch03pr43">Click here to view code image</a></p>
        <pre class="pre">let result = average(3, 4, 5) // <span class="cite"><code>3.5</code>—the last argument is ignored</span></pre>
        <p class="noindent"><span epub:type="pagebreak" id="page_64"></span>Conversely, if you supply fewer arguments, then the missing ones are set to <code>undefined</code>. For example, <code>average(3)</code> is <code>(3 + undefined) / 2</code>, or <code>NaN</code>. If you want to support that call with a meaningful result, you can:</p>
        <p class="codelink"><a id="rch03pr44" href="ch03_images.xhtml#ch03pr44">Click here to view code image</a></p>
        <pre class="pre">const average = (x, y) =&gt; y === undefined ? x : (x + y) / 2</pre>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec11">3.11 Default Arguments</h3>
        <p class="noindent">In the preceding section, you saw how to implement a function that is called with fewer arguments than parameters. Instead of manually checking for <code>undefined</code> argument values, you can provide default arguments in the function declaration. After the parameter, put an <code>=</code> and an expression for the default—that is, the value that should be used if no argument was passed.</p>
        <p class="noindent">Here is another way of making the <code>average</code> function work with one argument:</p>
        <p class="codelink"><a id="rch03pr45" href="ch03_images.xhtml#ch03pr45">Click here to view code image</a></p>
        <pre class="pre">const average = (x, y <strong>= x</strong>) =&gt; (x + y) / 2</pre>
        <p class="noindent">If you call <code>average(3)</code>, then <code>y</code> is set to <code>x</code>—that is, <code>3</code>—and the correct return value is computed.</p>
        <p class="noindent">You can provide multiple default values:</p>
        <p class="codelink"><a id="rch03pr46" href="ch03_images.xhtml#ch03pr46">Click here to view code image</a></p>
        <pre class="pre">const average = (x <strong>= 0</strong>, y <strong>= x</strong>) =&gt; (x + y) / 2</pre>
        <p class="noindent">Now <code>average()</code> returns zero.</p>
        <p class="noindent">You can even provide a default for the first parameter and not the others:</p>
        <p class="codelink"><a id="rch03pr47" href="ch03_images.xhtml#ch03pr47">Click here to view code image</a></p>
        <pre class="pre">const average = (x <strong>= 0</strong>, y) =&gt; y === undefined ? x : (x + y) / 2</pre>
        <p class="noindent">If no argument (or an explicit <code>undefined</code>) is supplied, the parameter is set to the default or, if none is provided, to <code>undefined</code>:</p>
        <p class="codelink"><a id="rch03pr48" href="ch03_images.xhtml#ch03pr48">Click here to view code image</a></p>
        <pre class="pre">average(3) // average(3, undefined)
        average() // average(0, undefined)
        average(undefined, 3) // average(0, 3)</pre>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec12">3.12 Rest Parameters and the Spread Operator</h3>
        <p class="noindent">As you have seen, you can call a JavaScript function with any number of arguments. To process them all, declare the last parameter of the function as a “rest” parameter by prefixing it with the <code>...</code> token:</p>
        <p class="codelink"><a id="rch03pr49" href="ch03_images.xhtml#ch03pr49">Click here to view code image</a></p>
        <pre class="pre">const average = (first = 0, ...following) =&gt; {
          let sum = first
          for (const value of following) { sum += value }
          return sum / (1 + following.length)
        }</pre>
        <p class="noindent"><span epub:type="pagebreak" id="page_65"></span>When the function is called, the <code>following</code> parameter is an array that holds all arguments that have not been used to initialize the preceding parameters. For example, consider the call:</p>
        <pre class="pre">average(1, 7, 2, 9)</pre>
        <p class="noindent">Then <code>first</code> is <code>1</code> and <code>following</code> is the array <code>[7, 2, 9]</code>.</p>
        <p class="noindent">Many functions and methods accept variable arguments. For example, the <code>Math.max</code> method yields the largest of its arguments, no matter how many:</p>
        <p class="codelink"><a id="rch03pr50" href="ch03_images.xhtml#ch03pr50">Click here to view code image</a></p>
        <pre class="pre">let result = Math.max(3, 1, 4, 1, 5, 9, 2, 6) // <span class="cite">Sets <code>result</code> to <code>9</code></span></pre>
        <p class="noindent">What if the values are already in an array?</p>
        <p class="codelink"><a id="rch03pr51" href="ch03_images.xhtml#ch03pr51">Click here to view code image</a></p>
        <pre class="pre">let numbers = [1, 7, 2, 9]
        result = Math.max(numbers) // <span class="cite">Yields</span> <code>NaN</code></pre>
        <p class="noindent">That doesn’t work. The <code>Math.max</code> method receives an array with one element—the array <code>[1, 7, 2, 9]</code>.</p>
        <p class="noindent">Instead, use the “spread” operator—the <code>...</code> token placed before an array <em>argument</em>:</p>
        <p class="codelink"><a id="rch03pr52" href="ch03_images.xhtml#ch03pr52">Click here to view code image</a></p>
        <pre class="pre">result = Math.max(...numbers) // <span class="cite">Yields <code>9</code></span></pre>
        <p class="noindent">The spread operator spreads out the elements as if they had been provided separately in the call.</p>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">Even though the spread operator and rest declaration look the same, their actions are the exact opposites of each other.</p>
        <p class="noindent">First, note that the spread operator is used with an argument, and the rest syntax applies to a variable declaration.</p>
        <p class="codelink"><a id="rch03pr53" href="ch03_images.xhtml#ch03pr53">Click here to view code image</a></p>
        <pre class="pre">Math.max(...numbers) // <span class="cite">Spread operator—argument in function call</span>
        const max = (...values) =&gt; { /* <span class="var">body</span> */}
          // <span class="cite">Rest declaration of parameter variable</span></pre>
        <p class="noindent">The spread operator turns an array (or, in fact, any iterable) into a sequence of values. The rest declaration causes a sequence of values to be placed into an array.</p>
        </div>
        <p class="noindent">Note that you can use the spread operator even if the function that you call doesn’t have any rest parameters. For example, consider the <code>average</code> function of the preceding section that has two parameters. If you call</p>
        <pre class="pre">result = average(...numbers)</pre>
        <p class="noindent">then all elements of <code>numbers</code> are passed as arguments to the function. The function uses the first two arguments and ignores the others.</p>
        <div class="note">
        <p class="note-caption"><span epub:type="pagebreak" id="page_66"></span><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">You can also use the spread operator in an array initializer:</p>
        <p class="codelink"><a id="rch03pr54" href="ch03_images.xhtml#ch03pr54">Click here to view code image</a></p>
        <pre class="pre">let moreNumbers = [1, 2, 3, ...numbers] // <span class="cite">Spread operator</span></pre>
        <p class="noindent">Don’t confuse this with the rest declaration used with destructuring. The rest declaration applies to a variable:</p>
        <p class="codelink"><a id="rch03pr55" href="ch03_images.xhtml#ch03pr55">Click here to view code image</a></p>
        <pre class="pre">let [first, ...following] = numbers // <span class="cite">Rest declaration</span></pre>
        </div>
        <div class="tip">
        <p class="tip-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/tip.jpg" alt="Images" width="36" height="33"></span> Tip</p>
        <p class="noindent">Since strings are iterable, you can use the spread operator with a string:</p>
        <p class="codelink"><a id="rch03pr56" href="ch03_images.xhtml#ch03pr56">Click here to view code image</a></p>
        <pre class="pre">let greeting = 'Hello <span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/bcircle.jpg" alt="Images" width="16" height="16"></span>'
        let characters = [...greeting]</pre>
        <p class="noindent">The <code>characters</code> array contains the strings <code>'H'</code>, <code>'e'</code>, <code>'l'</code>, <code>'l'</code>, <code>'o'</code>, <code>' '</code>, and <code>'<span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/bcircle.jpg" alt="Images" width="16" height="16"></span>'</code>.</p>
        </div>
        <p class="noindent">The syntax for default arguments and rest parameters are equally applicable to the <code>function</code> syntax:</p>
        <p class="codelink"><a id="rch03pr57" href="ch03_images.xhtml#ch03pr57">Click here to view code image</a></p>
        <pre class="pre">function average(first <strong>= 0</strong>, <strong>...</strong>following) { . . . }</pre>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec13">3.13 Simulating Named Arguments with Destructuring</h3>
        <figure class="image-1">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/cat.jpg" alt="Images" width="85" height="85">
        </figure>
        <p class="noindent">JavaScript has no “named argument” feature where you provide the parameter names in the call. But you can easily simulate named arguments by passing an object literal:</p>
        <p class="codelink"><a id="rch03pr58" href="ch03_images.xhtml#ch03pr58">Click here to view code image</a></p>
        <pre class="pre">const result = mkString(values, { leftDelimiter: '(', rightDelimiter: ')' })</pre>
        <p class="noindent">That is easy enough for the caller of the function. Now, let’s turn to the function implementation. You can look up the object properties and supply defaults for missing values.</p>
        <p class="codelink"><a id="rch03pr59" href="ch03_images.xhtml#ch03pr59">Click here to view code image</a></p>
        <pre class="pre">const mkString = (array, config) =&gt; {
          let separator = config.separator === undefined ? ',' : config.separator
          . . .
        }</pre>
        <p class="noindent">However, that is tedious. It is easier to use destructured parameters with defaults. (See <a href="ch01.xhtml#ch01">Chapter 1</a> for the destructuring syntax.)<span epub:type="pagebreak" id="page_67"></span></p>
        <p class="codelink"><a id="rch03pr60" href="ch03_images.xhtml#ch03pr60">Click here to view code image</a></p>
        <pre class="pre">const mkString = (array, <strong>{
            separator = ',',
            leftDelimiter = '[',
            rightDelimiter = ']'
          }</strong>) =&gt; {
          . . .
        }</pre>
        <p class="noindent">The destructuring syntax <code>{ <strong>separator</strong> = ',', <strong>leftDelimiter</strong> = '[', <strong>rightDelimiter</strong> = ']' }</code> declares three parameter variables <code>separator</code>, <code>leftDelimiter</code>, and <code>rightDelimiter</code> that are initialized from the properties with the same names. The defaults are used if the properties are absent or have <code>undefined</code> values.</p>
        <p class="noindent">It is a good idea to provide a default <code>{}</code> for the configuration object:</p>
        <p class="codelink"><a id="rch03pr61" href="ch03_images.xhtml#ch03pr61">Click here to view code image</a></p>
        <pre class="pre">const mkString = (array, {
            separator = ',',
            leftDelimiter = '[',
            rightDelimiter = ']'
          } <strong>= {}</strong>) =&gt; {
          . . .
        }</pre>
        <p class="noindent">Now the function can be called without any configuration object:</p>
        <p class="codelink"><a id="rch03pr62" href="ch03_images.xhtml#ch03pr62">Click here to view code image</a></p>
        <pre class="pre">const result = mkString(values) // <span class="cite">The second argument defaults to <code>{}</code></span></pre>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec14">3.14 Hoisting</h3>
        <figure class="image-1">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/joker.jpg" alt="Images" width="103" height="103">
        </figure>
        <p class="noindent">In this “mad hatter” section, we take up another complex subject that you can easily avoid by following three simple rules. They are:</p>
        <ul class="bullet">
        <li><p class="list-item">Don’t use <code>var</code></p></li>
        <li><p class="list-item">Use strict mode</p></li>
        <li><p class="list-item">Declare variables and functions before using them</p></li>
        </ul>
        <p class="noindent">If you want to understand what happens when you don’t follow these rules, read on.</p>
        <p class="noindent">JavaScript has an unusual mechanism for determining the <em>scope</em> of a variable—that is, is the region of a program where the variable can be accessed. Consider a local variable, declared inside a function. In programming languages such as Java, C#, or C++, the scope extends from the point where the variable is declared until the end of the enclosing block. In JavaScript, a local variable declared with <code>let</code> appears to have the same behavior:<span epub:type="pagebreak" id="page_68"></span></p>
        <p class="codelink"><a id="rch03pr63" href="ch03_images.xhtml#ch03pr63">Click here to view code image</a></p>
        <pre class="pre">function doStuff() { // <span class="cite">Start of block</span>
          . . . // <span class="cite">Attempting to access <code>someVariable</code> throws a <code>ReferenceError</code></span>
          let someVariable // <span class="cite">Scope starts here</span>
          . . . // <span class="cite">Can access <code>someVariable</code>, value is <code>undefined</code></span>
          someVariable = 42
          . . . // <span class="cite">Can access <code>someVariable</code>, value is <code>42</code></span>
        } // <span class="cite">End of block, scope ends here</span></pre>
        <p class="noindent">However, it is not quite so simple. You <em>can</em> access local variables in functions whose declarations precede the variable declaration:</p>
        <p class="codelink"><a id="rch03pr64" href="ch03_images.xhtml#ch03pr64">Click here to view code image</a></p>
        <pre class="pre">function doStuff() {
          function localWork() {
            console.log(someVariable) // <span class="cite">OK to access variable</span>
            . . .
          }
          let someVariable = 42
        
          localWork() // <span class="cite">Prints <code>42</code></span>
        }</pre>
        <p class="noindent">In JavaScript, every declaration is <em>hoisted</em> to the top of its scope. That is, the variable or function is known to exist even before its declaration, and space is reserved to hold its value.</p>
        <p class="noindent">Inside a nested function, you can reference hoisted variables or functions. Consider the <code>localWork</code> function in the preceding example. The function knows the location of <code>someVariable</code> because it is hoisted to the top of the body of <code>doStuff</code>, even though that variable is declared after the function.</p>
        <p class="noindent">Of course, it can then happen that you access a variable before executing the statement that declares it. With <code>let</code> and <code>const</code> declarations, accessing a variable before it is declared throws a <code>ReferenceError</code>. The variable is in the “temporal dead zone” until its declaration is executed.</p>
        <p class="noindent">However, if a variable is declared with the archaic <code>var</code> keyword, then its value is simply <code>undefined</code> until the variable is initialized.</p>
        <div class="tip">
        <p class="tip-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/tip.jpg" alt="Images" width="36" height="33"></span> Tip</p>
        <p class="noindent">Do not use <code>var</code>. It declares variables whose scope is the entire function, not the enclosing block. That is too broad:</p>
        <p class="codelink"><a id="rch03pr65" href="ch03_images.xhtml#ch03pr65">Click here to view code image</a></p>
        <pre class="pre">function someFunction(arr) {
          // <span class="cite"><code>i</code>, <code>element</code> already in scope but undefined</span>
          for (var i = 0; i &lt; arr.length; i++) {
            var element = arr[i]
            . . .
          }
          // <span class="cite"><code>i</code>, <code>element</code> still in scope</span>
        }</pre>
        <p class="noindent">Moreover, <code>var</code> doesn’t play well with closures—see <a href="#ch03ex10">Exercise 10</a>.</p>
        </div>
        <p class="noindent"><span epub:type="pagebreak" id="page_69"></span>Since functions are hoisted, you can call a function before it is declared. In particularly, you can declare mutually recursive functions:</p>
        <p class="codelink"><a id="rch03pr66" href="ch03_images.xhtml#ch03pr66">Click here to view code image</a></p>
        <pre class="pre">function isEven(n) { return n === 0 ? true : <strong>isOdd</strong>(n -1) }
        function isOdd(n) { return n === 0 ? false : isEven(n -1) }</pre>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">In strict mode, named functions can only be declared at the top level of a script or function, not inside a nested block. In non-strict mode, nested named functions are hoisted to the top of their enclosing function. <a href="#ch03ex12">Exercise 12</a> shows why this is a bad idea.</p>
        </div>
        <p class="noindent">As long as you use strict mode and avoid <code>var</code> declarations, the hoisting behavior is unlikely to result in programming errors. However, it is a good idea to structure your code so that you declare variables and functions before they are used.</p>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">In ancient times, JavaScript programmers used “immediately invoked functions” to limit the scope of <code>var</code> declarations and functions:</p>
        <p class="codelink"><a id="rch03pr67" href="ch03_images.xhtml#ch03pr67">Click here to view code image</a></p>
        <pre class="pre">(function () {
          var someVariable = 42
          function someFunction(. . .) { . . . }
          . . .
        })() // <span class="cite">Function is called here—note the <code>()</code></span>
        // <span class="cite"><code>someVariable</code>, <code>someFunction</code> no longer in scope</span></pre>
        <p class="noindent">After the anonymous function is called, it is never used again. The sole purpose is to encapsulate the declarations.</p>
        <p class="noindent">This device is no longer necessary. Simply use:</p>
        <p class="codelink"><a id="rch03pr68" href="ch03_images.xhtml#ch03pr68">Click here to view code image</a></p>
        <pre class="pre">{
          let someVariable = 42
          const someFunction = (. . .) =&gt; { . . . }
          . . .
        }</pre>
        <p class="noindent">The declarations are confined to the block.</p>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec15">3.15 Throwing Exceptions</h3>
        <p class="noindent">If a function is unable to compute a result, it can throw an exception. Depending on the kind of failure, this can be a better strategy than returning an error value such as <code>NaN</code> or <code>undefined</code>.</p>
        <p class="noindent"><span epub:type="pagebreak" id="page_70"></span>Use a <code>throw</code> statement to throw an exception:</p>
        <pre class="pre">throw value</pre>
        <p class="noindent">The exception value can be a value of any type, but it is conventional to throw an error object. The <code>Error</code> function produces such an object with a given string describing the reason.</p>
        <p class="codelink"><a id="rch03pr69" href="ch03_images.xhtml#ch03pr69">Click here to view code image</a></p>
        <pre class="pre">let reason = `Element ${elem} not found`
        throw Error(reason)</pre>
        <p class="noindent">When the <code>throw</code> statement executes, the function is terminated immediately. No return value is produced, not even <code>undefined</code>. Execution does not continue in the function call but instead in the nearest <code>catch</code> or <code>finally</code> clause, as described in the following sections.</p>
        <div class="tip">
        <p class="tip-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/tip.jpg" alt="Images" width="36" height="33"></span> Tip</p>
        <p class="noindent">Exception handling is a good mechanism for unpredictable situations that the caller might not be able to handle. It is not so suitable for situations where failure is expected. Consider parsing user input. It is exceedingly likely that some users provide unsuitable input. In JavaScript, it is easy to return a “bottom” value such as <code>undefined</code>, <code>null</code>, or <code>NaN</code> (provided, of course, those could not be valid inputs). Or you can return an object that describes success or failure. For example, in <a href="ch09.xhtml#ch09">Chapter 9</a>, you will see a method that yields objects of the form <code>{ status: 'fulfilled', value: <span class="var">result</span> }</code> or <code>{ status: 'rejected', reason: <span class="var">exception</span> }</code>.</p>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec16">3.16 Catching Exceptions</h3>
        <figure class="image-1">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/queen.jpg" alt="Images" width="85" height="85">
        </figure>
        <p class="noindent">To catch an exception, use a <code>try</code> statement. In <a href="ch02.xhtml#ch02">Chapter 2</a>, you saw how to catch an exception if you are not interested in the exception value. If you want to examine the exception value, add a variable to the <code>catch</code> clause:</p>
        <p class="codelink"><a id="rch03pr70" href="ch03_images.xhtml#ch03pr70">Click here to view code image</a></p>
        <pre class="pre">try {
          // <span class="cite">Do work</span>
          . . .
        } catch (e) {
          // <span class="cite">Handle exceptions</span>
          . . .
        }</pre>
        <p class="noindent"><span epub:type="pagebreak" id="page_71"></span>The variable in the <code>catch</code> clause (here, <code>e</code>) contains the exception value. As you saw in the preceding section, an exception value is conventionally an error object. Such an object has two properties: <code>name</code> and <code>message</code>. For example, if you call</p>
        <pre class="pre">JSON.parse('{ age: 42 }')</pre>
        <p class="noindent">an exception is thrown with the name <code>'SyntaxError'</code> and message <code>'Unexpected token a in JSON at position 2'</code>. (The string in this example is invalid JSON because the <code>age</code> key is not enclosed in double quotes.)</p>
        <p class="noindent">The name of an object produced with the <code>Error</code> function is <code>'Error'</code>. The JavaScript virtual machine throws errors with names <code>'SyntaxError'</code>, <code>'TypeError'</code>, <code>'RangeError'</code>, <code>'ReferenceError'</code>, <code>'URIError'</code>, or <code>'InternalError'</code>.</p>
        <p class="noindent">In the handler, you can record that information in a suitable place. However, in JavaScript it is not usually productive to analyze the error object in detail, as you might in languages such as Java or C++.</p>
        <p class="noindent">When you log an error object on the console, JavaScript execution environments typically display the <em>stack trace</em>—the function and method calls between the throw and catch points. Unfortunately, there is no standard way of accessing the stack trace for logging it elsewhere.</p>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">In Java and C++, you can catch exceptions by their type. Then you can handle errors of certain types at a low level and others at a higher level. Such strategies are not easily implemented in JavaScript. A <code>catch</code> clause catches <em>all</em> exceptions, and the exception objects carry limited information. In JavaScript, exception handlers typically carry out generic recovery or cleanup, without trying to analyze the cause of failure.</p>
        </div>
        <p class="noindent">When the <code>catch</code> clause is entered, the exception is deemed to be handled. Processing resumes normally, executing the statements in the <code>catch</code> clause. The <code>catch</code> clause can exit with a <code>return</code> or <code>break</code> statement, or it can be completed by executing its last statement. In that case, execution moves to the next statement after the <code>catch</code> clause.</p>
        <p class="noindent">If you log exceptions at one level of your code but deal with failure at a higher level, then you want to <em>rethrow</em> the exception after logging it:<span epub:type="pagebreak" id="page_72"></span></p>
        <p class="codelink"><a id="rch03pr71" href="ch03_images.xhtml#ch03pr71">Click here to view code image</a></p>
        <pre class="pre">try {
          // <span class="cite">Do work</span>
          . . .
        } catch (e) {
          console.log(e)
          throw e // <span class="cite">Rethrow to a handler that deals with the failure</span>
        }</pre>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec17">3.17 The <code>finally</code> Clause</h3>
        <figure class="image-1">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/cat.jpg" alt="Images" width="85" height="85">
        </figure>
        <p class="noindent">A <code>try</code> statement can optionally have a <code>finally</code> clause. The code in the <code>finally</code> clause executes whether or not an exception occurred.</p>
        <p class="noindent">Let us first look at the simplest case: a <code>try</code> statement with a <code>finally</code> clause but no <code>catch</code> clause:</p>
        <p class="codelink"><a id="rch03pr72" href="ch03_images.xhtml#ch03pr72">Click here to view code image</a></p>
        <pre class="pre">try {
          // <span class="cite">Acquire resources</span>
          . . .
          // <span class="cite">Do work</span>
          . . .
        } finally {
          // <span class="cite">Relinquish resources</span>
          . . .
        }</pre>
        <p class="noindent">The <code>finally</code> clause is executed in all of the following cases:</p>
        <ul class="bullet">
        <li><p class="list-item">If all statements in the <code>try</code> clause completed without throwing an exception</p></li>
        <li><p class="list-item">If a <code>return</code> or <code>break</code> statement was executed in the <code>try</code> clause</p></li>
        <li><p class="list-item">If an exception occurred in any of the statements of the <code>try</code> clause</p></li>
        </ul>
        <p class="noindent">You can also have a <code>try</code> statement with <code>catch</code> and <code>finally</code> clauses:</p>
        <p class="codelink"><a id="rch03pr73" href="ch03_images.xhtml#ch03pr73">Click here to view code image</a></p>
        <pre class="pre">try {
          . . .
        } catch (e) {
          . . .
        } finally {
          . . .
        }</pre>
        <p class="noindent">Now there is an additional pathway. If an exception occurs in the <code>try</code> clause, the <code>catch</code> clause is executed. No matter how the <code>catch</code> clause exits (normally or through a <code>return</code>/<code>break</code>/<code>throw</code>), the <code>finally</code> clause is executed afterwards.</p>
        <p class="noindent">The purpose of the <code>finally</code> clause is to have a single location for relinquishing resources (such as file handles or database connections) that were acquired in the <code>try</code> clause, whether or not an exception occurred.</p>
        <div class="caution">
        <p class="caution-caption"><span epub:type="pagebreak" id="page_73"></span><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/caution.jpg" alt="Images" width="36" height="36"></span> Caution</p>
        <p class="noindent">It is legal, but confusing, to have <code>return</code>/<code>break</code>/<code>throw</code> statements in the <code>finally</code> clause. These statements take precedence over any statements in the <code>try</code> and <code>catch</code> clauses. For example:</p>
        <p class="codelink"><a id="rch03pr74" href="ch03_images.xhtml#ch03pr74">Click here to view code image</a></p>
        <pre class="pre">try {
          // <span class="cite">Do work</span>
          . . .
          return true
        } finally {
          . . .
          return false
        }</pre>
        <p class="noindent">If the <code>try</code> block is successful and <code>return true</code> is executed, the <code>finally</code> clause follows. Its <code>return false</code> masks the prior <code>return</code> statement.</p>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch03lev1sec18">Exercises</h3>
        <ol class="ol-exe">
        <li><p class="list" id="ch03ex01">What does the <code>indexOf</code> function of <a href="ch03.xhtml#ch03lev1sec1">Section 3.1</a>, “<a href="ch03.xhtml#ch03lev1sec1">Declaring Functions</a>” (<a href="ch03.xhtml#page_51">page 51</a>), do when an object is passed instead of an array?</p></li>
        <li><p class="list" id="ch03ex02">Rewrite the <code>indexOf</code> function of <a href="ch03.xhtml#ch03lev1sec1">Section 3.1</a>, “<a href="ch03.xhtml#ch03lev1sec1">Declaring Functions</a>” (<a href="ch03.xhtml#page_51">page 51</a>), so that it has a single return at the end.</p></li>
        <li><p class="list" id="ch03ex03">Write a function <code>values(f, low, high)</code> that yields an array of function values <code>[f(low), f(low + 1), . . ., f(high)]</code>.</p></li>
        <li><p class="list" id="ch03ex04">The <code>sort</code> method for arrays can take an argument that is a comparison function with two parameters—say, <code>x</code> and <code>y</code>. The function returns a negative integer if <code>x</code> should come before <code>y</code>, zero if <code>x</code> and <code>y</code> are indistinguishable, and a positive integer if <code>x</code> should come after <code>y</code>. Write calls, using arrow functions, that sort:</p>
        <ul class="bullet">
        <li><p class="list-item">An array of positive integers by decreasing order</p></li>
        <li><p class="list-item">An array of people by increasing age</p></li>
        <li><p class="list-item">An array of strings by increasing length</p></li>
        </ul></li>
        <li><p class="list" id="ch03ex05">Using the “hard objects” technique of <a href="ch03.xhtml#ch03lev1sec7">Section 3.7</a>, “<a href="ch03.xhtml#ch03lev1sec7">Hard Objects</a>” (<a href="ch03.xhtml#page_59">page 59</a>), implement a <code>constructCounter</code> method that produces counter objects whose <code>count</code> method increments a counter and yields the new value. The initial value and an optional increment are passed as parameters. (The default increment is 1.)</p>
        <p class="codelink"><a id="rch03pr75" href="ch03_images.xhtml#ch03pr75">Click here to view code image</a></p>
        <pre class="pre">const myFirstCounter = constructCounter(0, 2)
        console.log(myFirstCounter.count()) // 0
        console.log(myFirstCounter.count()) // 2<span epub:type="pagebreak" id="page_74"></span></pre></li>
        <li><p class="list" id="ch03ex06">A programmer thinks that “named parameters are almost implemented in JavaScript, but order still has precedence,” offering the following “evidence” in the browser console:</p>
        <p class="codelink"><a id="rch03pr76" href="ch03_images.xhtml#ch03pr76">Click here to view code image</a></p>
        <pre class="pre">function f(a=1, b=2){ console.log(`a=${a}, b=${b}`) }
        f() // a=1, b=2
        f(a=5) // a=5, b=2
        f(a=7, b=10) // a=7, b=10
        f(b=10, a=7) // <span class="cite">Order is required:</span> a=10, b=7</pre>
        <p class="noindent">What is actually going on? (Hint: It has nothing to do with named parameters. Try it in strict mode.)</p></li>
        <li><p class="list" id="ch03ex07">Write a function <code>average</code> that computes the average of an arbitrary sequence of numbers, using a rest parameter.</p></li>
        <li><p class="list" id="ch03ex08">What happens when you pass a string argument to a rest parameter <code>...str</code>? Come up with a useful example to take advantage of your observation.</p></li>
        <li><p class="list" id="ch03ex09">Complete the <code>mkString</code> function of <a href="ch03.xhtml#ch03lev1sec13">Section 3.13</a>, “<a href="ch03.xhtml#ch03lev1sec13">Simulating Named Arguments with Destructuring</a>” (<a href="ch03.xhtml#page_66">page 66</a>).</p></li>
        <li><p class="list" id="ch03ex10">The archaic <code>var</code> keyword interacts poorly with closures. Consider this example:</p>
        <p class="codelink"><a id="rch03pr77" href="ch03_images.xhtml#ch03pr77">Click here to view code image</a></p>
        <pre class="pre">for (var i = 0; i &lt; 10; i++) {
          setTimeout(() =&gt; console.log(i), 1000 * i)
        }</pre>
        <p class="noindent">What does this code snippet print? Why? (Hint: What is the scope of the variable <code>i</code>?) What simple change can you make to the code to print the numbers 0, 1, 2, . . . , 9 instead?</p></li>
        <li><p class="list" id="ch03ex11">Consider this declaration of the factorial function:</p>
        <p class="codelink"><a id="rch03pr78" href="ch03_images.xhtml#ch03pr78">Click here to view code image</a></p>
        <pre class="pre">const fac = n =&gt; n &gt; 1 ? n * fac(n - 1) : 1</pre>
        <p class="noindent">Explain why this only works because of variable hoisting.</p></li>
        <li><p class="list" id="ch03ex12">In sloppy (non-strict) mode, functions can be declared inside a nested block, and they are hoisted to the enclosing function or script. Try out the following example a few times:</p>
        <p class="codelink"><a id="rch03pr79" href="ch03_images.xhtml#ch03pr79">Click here to view code image</a></p>
        <pre class="pre">if (Math.random() &lt; 0.5) {
          say('Hello')
          function say(greeting) { console.log(`${greeting}!`) }
        }
        say('Goodbye')</pre>
        <p class="noindent">Depending on the result of <code>Math.random</code>, what is the outcome? What is the scope of <code>say</code>? When is it initialized? What happens when you activate strict mode?<span epub:type="pagebreak" id="page_75"></span></p></li>
        <li><p class="list" id="ch03ex13">Implement an <code>average</code> function that throws an exception if any of its arguments is not a number.</p></li>
        <li><p class="list" id="ch03ex14">Some programmers are confused by statements that contain all three of <code>try</code>/<code>catch</code>/<code>finally</code> because there are so many possible pathways of control. Show how you can always rewrite such a statement using a <code>try</code>/<code>catch</code> statement and a <code>try</code>/<code>finally</code> statement.</p></li>
        </ol>
        </section>
        </section>
        </div></div><link rel="stylesheet" href="/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="/api/v2/epubs/urn:orm:book:9780136502166/files/9780136502142.css" crossorigin="anonymous"></div></div></section>
</div>

https://learning.oreilly.com