<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
    
</style>
<link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492092506/files/epub.css" crossorigin="anonymous">
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><section epub:type="chapter">
        <h2 class="ch2" id="ch04"><span epub:type="pagebreak" id="page_76"></span>Chapter 4. Object-Oriented Programming</h2>
        <figure class="image-1">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/squirrel.jpg" alt="Images" width="119" height="119">
        </figure>
        <div class="outline">
        <p class="outh">Topics in This Chapter</p>
        <p class="chap-lev1"><a href="#ch04lev1sec1">4.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Methods</a></p>
        <p class="chap-lev1"><a href="#ch04lev1sec2">4.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Prototypes</a></p>
        <p class="chap-lev1"><a href="#ch04lev1sec3">4.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Constructors</a></p>
        <p class="chap-lev1"><a href="#ch04lev1sec4">4.4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The Class Syntax</a></p>
        <p class="chap-lev1ia"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/queenc.jpg" alt="Images" width="24" height="24"></span>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ch04lev1sec5">4.5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Getters and Setters</a></p>
        <p class="chap-lev1ia"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/queenc.jpg" alt="Images" width="24" height="24"></span>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ch04lev1sec6">4.6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Instance Fields and Private Methods</a></p>
        <p class="chap-lev1i"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/catc.jpg" alt="Images" width="23" height="23"></span>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ch04lev1sec7">4.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Static Methods and Fields</a></p>
        <p class="chap-lev1"><a href="#ch04lev1sec8">4.8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subclasses</a></p>
        <p class="chap-lev1"><a href="#ch04lev1sec9">4.9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Overriding Methods</a></p>
        <p class="chap-lev1a"><a href="#ch04lev1sec10">4.10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subclass Construction</a></p>
        <p class="chap-lev1i"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/catc.jpg" alt="Images" width="23" height="23"></span>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ch04lev1sec11">4.11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Class Expressions</a></p>
        <p class="chap-lev1i"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/jokerc.jpg" alt="Images" width="27" height="27"></span>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ch04lev1sec12">4.12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The <code>this</code> Reference</a></p>
        <p class="chap-lev1a"><a href="#ch04lev1sec13">Exercises</a></p>
        </div>
        <p class="noindent"><span epub:type="pagebreak" id="page_77"></span>As you know, JavaScript has objects, but they don’t look like the objects you have seen in object-oriented programming languages such as Java or C++. In a JavaScript object, all properties are public, and they don’t seem to belong to any class other than <code>Object</code>. It is not obvious how you might have methods or classes or inheritance.</p>
        <p class="noindent">You <em>can</em> have all that in JavaScript, and this chapter shows you how. Current versions of JavaScript provide syntax for declaring classes that looks very similar to Java, but the underlying mechanism is completely different. You really need to understand what goes on under the hood. For that reason, I first show you how to declare methods and constructor functions by hand, and then you will see how those constructs map to the class syntax.</p>
        <section>
        <h3 class="h3" id="ch04lev1sec1">4.1 Methods</h3>
        <p class="noindent">JavaScript, unlike most object-oriented programming languages, lets you work with objects without first having to declare classes. You have already seen how to produce objects:</p>
        <p class="codelink"><a id="rch04pr01" href="ch04_images.xhtml#ch04pr01">Click here to view code image</a></p>
        <pre class="pre">let harry = { name: 'Harry Smith', salary: 90000 }</pre>
        <p class="noindent">According to the classic definition, an object has identity, state, and behavior. The object that you just saw certainly has identity—it is different from any <span epub:type="pagebreak" id="page_78"></span>other object. The object’s state is provided by the properties. Let’s add behavior in the form of a “method”—that is, a function-valued property:</p>
        <p class="codelink"><a id="rch04pr02" href="ch04_images.xhtml#ch04pr02">Click here to view code image</a></p>
        <pre class="pre">harry = {
          name: 'Harry Smith',
          salary: 90000,
          raiseSalary: function(percent) {
            this.salary *= 1 + percent / 100
          }
        }</pre>
        <p class="noindent">Now we can raise the employee’s salary with the familiar dot notation:</p>
        <pre class="pre">harry.raiseSalary(10)</pre>
        <p class="noindent">Note that <code>raiseSalary</code> is a function declared in the <code>harry</code> object. That function looks like an ordinary function, except for one twist: In the body, we refer to <code>this.salary</code>. When the function is called, <code>this</code> refers to the object to the left of the dot operator.</p>
        <p class="noindent">There is a shortcut syntax for declaring methods. Simply omit the colon and the <code>function</code> keyword:</p>
        <p class="codelink"><a id="rch04pr03" href="ch04_images.xhtml#ch04pr03">Click here to view code image</a></p>
        <pre class="pre">harry = {
          name: 'Harry Smith',
          salary: 90000,
          <strong>raiseSalary(percent)</strong> {
            this.salary *= 1 + percent / 100
          }
        }</pre>
        <p class="noindent">This looks similar to a method declaration in Java or C++, but it is just “syntactic sugar” for a function-valued property.</p>
        <div class="caution">
        <p class="caution-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/caution.jpg" alt="Images" width="36" height="36"></span> Caution</p>
        <p class="noindent">The <code>this</code> reference only works in functions declared with <code>function</code> or the shortcut syntax that omits <code>function</code>, <em>not</em> with arrow functions. See <a href="ch04.xhtml#ch04lev1sec12">Section 4.12</a>, “<a href="ch04.xhtml#ch04lev1sec12">The <code>this</code> Reference</a>” (<a href="ch04.xhtml#page_92">page 92</a>), for more details.</p>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch04lev1sec2">4.2 Prototypes</h3>
        <p class="noindent">Suppose you have many employee objects similar to the one in the preceding section. Then you need to make a <code>raiseSalary</code> property for each of them. You can write a factory function to automate that task:<span epub:type="pagebreak" id="page_79"></span></p>
        <p class="codelink"><a id="rch04pr04" href="ch04_images.xhtml#ch04pr04">Click here to view code image</a></p>
        <pre class="pre">function createEmployee(name, salary) {
          return {
            name: name,
            salary: salary,
            raiseSalary: function(percent) {
              this.salary *= 1 + percent / 100
            }
          }
        }</pre>
        <p class="noindent">Still, each employee object has its own <code>raiseSalary</code> property, even though the property value is the same function for all employees (see <a href="#ch04fig01">Figure 4-1</a>). It would be better if all employees could share one function.</p>
        <figure class="figure" id="ch04fig01">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/pg79_Image_235.jpg" alt="Images" width="542" height="385">
        <figcaption><p class="fig-title"><strong>Figure 4-1</strong>&nbsp;&nbsp;&nbsp;&nbsp;Objects with replicated methods</p></figcaption>
        </figure>
        <p class="noindent">That is where <em>prototypes</em> come in. A prototype collects properties that are common to multiple objects. Here is a prototype object that holds the shared methods:</p>
        <p class="codelink"><a id="rch04pr05" href="ch04_images.xhtml#ch04pr05">Click here to view code image</a></p>
        <pre class="pre">const employeePrototype = {
          raiseSalary: function(percent) {
            this.salary *= 1 + percent / 100
          }
        }</pre>
        <p class="noindent">When creating an employee object, we set its prototype. The prototype is an “internal slot” of the object. That is the technical term used in the ECMAScript language specification to denote an attribute of an object that is manipulated <span epub:type="pagebreak" id="page_80"></span>internally without being exposed to JavaScript programmers as a property. You can read and write the [[Property]] internal slot (as it is called in the specification) with the methods <code>Object.getPrototypeOf</code> and <code>Object.setPrototypeOf</code>. This function creates an employee object and sets the prototype:</p>
        <p class="codelink"><a id="rch04pr06" href="ch04_images.xhtml#ch04pr06">Click here to view code image</a></p>
        <pre class="pre">function createEmployee(name, salary) {
          const result = { name, salary }
          Object.setPrototypeOf(result, employeePrototype)
          return result
        }</pre>
        <p class="noindent"><a href="#ch04fig02">Figure 4-2</a> shows the result of creating multiple employee objects that share the same prototype. In the figure, the prototype slot is denoted [[Prototype]], as in the ECMAScript specification.</p>
        <figure class="figure" id="ch04fig02">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/pg80_Image_238.jpg" alt="Images" width="729" height="324">
        <figcaption><p class="fig-title"><strong>Figure 4-2</strong>&nbsp;&nbsp;&nbsp;&nbsp;Objects with the same prototype</p></figcaption>
        </figure>
        <div class="caution">
        <p class="caution-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/caution.jpg" alt="Images" width="36" height="36"></span> Caution</p>
        <p class="noindent">In many JavaScript implementations, you can access the prototype of an object as <code>obj.__proto__</code>. This is not a standard notation, and you should use the <code>Object.getPrototypeOf</code> and <code>Object.setPrototypeOf</code> methods instead.</p>
        </div>
        <p class="noindent">Now consider a method call</p>
        <pre class="pre">harry.raiseSalary(5)</pre>
        <p class="noindent">When looking up <code>harry.raiseSalary</code>, no match is found in the <code>harry</code> object itself. Therefore, the property is searched in the prototype. Since <code>harry.</code>[[Prototype]] has a <code>raiseSalary</code> property, its value is the value of <code>harry.raiseSalary</code>.</p>
        <p class="noindent"><span epub:type="pagebreak" id="page_81"></span>As you will see later in this chapter, prototypes can be chained. If the prototype doesn’t have a property, its prototype is searched, until the prototype chain ends.</p>
        <p class="noindent">The prototype lookup mechanism is completely general. Here, we used it to look up a method, but it works for any property. If a property isn’t found in an object, then the prototype chain is searched, and the first match is the property value.</p>
        <p class="noindent">Prototype lookup is a simple concept which it is very important in JavaScript. Prototypes are used to implement classes and inheritance, and to modify the behavior of objects after they have been instantiated.</p>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">Lookup in the prototype chain is only used for <em>reading</em> property values. If you write to a property, the value is always updated in the object itself.</p>
        <p class="noindent">For example, suppose you change the <code>harry.raiseSalary</code> method:</p>
        <p class="codelink"><a id="rch04pr07" href="ch04_images.xhtml#ch04pr07">Click here to view code image</a></p>
        <pre class="pre">harry.raiseSalary = function(rate) { this.salary = Number.MAX_VALUE }</pre>
        <p class="noindent">This adds a new property directly to the <code>harry</code> object. It does not modify the prototype. All other employees retain the original <code>raiseSalary</code> property.</p>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch04lev1sec3">4.3 Constructors</h3>
        <p class="noindent">In the preceding section, you saw how to write a factory function that creates new object instances with a shared prototype. There is special syntax for invoking such functions, using the <code>new</code> operator.</p>
        <p class="noindent">By convention, functions that construct objects are named after what would be the class in a class-based language. In our example, let’s call the function <code>Employee</code>, as follows:</p>
        <p class="codelink"><a id="rch04pr08" href="ch04_images.xhtml#ch04pr08">Click here to view code image</a></p>
        <pre class="pre">function Employee(name, salary) {
          this.name = name
          this.salary = salary
        }</pre>
        <p class="noindent">When you call</p>
        <p class="codelink"><a id="rch04pr09" href="ch04_images.xhtml#ch04pr09">Click here to view code image</a></p>
        <pre class="pre">new Employee('Harry Smith', 90000)</pre>
        <p class="noindent">the <code>new</code> operator creates a new empty object and then calls the constructor function. The <code>this</code> parameter points to that newly created object. The body of the <code>Employee</code> function sets the object properties by using the <code>this</code> parameter. The newly created object becomes the value of the <code>new</code> expression.</p>
        <div class="caution">
        <p class="caution-caption"><span epub:type="pagebreak" id="page_82"></span><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/caution.jpg" alt="Images" width="36" height="36"></span> Caution</p>
        <p class="noindent">Do not return any result from a constructor function. Otherwise the value of the <code>new</code> expression is that returned value, not the newly created object.</p>
        </div>
        <p class="noindent">In addition to invoking the constructor function, the <code>new</code> expression carries out another important step: It sets the object’s [[Prototype]] internal slot.</p>
        <p class="noindent">The [[Prototype]] internal slot is set to a specific object, which is attached to the constructor function. Recall that a function is an object, so it can have properties. Each JavaScript <em>function</em> has a <code>prototype</code> property whose value is an object.</p>
        <p class="noindent">That object gives you a ready-made place for adding methods, like this:</p>
        <p class="codelink"><a id="rch04pr10" href="ch04_images.xhtml#ch04pr10">Click here to view code image</a></p>
        <pre class="pre"><strong>Employee.prototype</strong>.raiseSalary = function(percent) {
          this.salary *= 1 + percent / 100
        }</pre>
        <p class="noindent">As you can see, there is a lot going on. Let us have another look at the call:</p>
        <p class="codelink"><a id="rch04pr11" href="ch04_images.xhtml#ch04pr11">Click here to view code image</a></p>
        <pre class="pre">const harry = new Employee('Harry Smith', 90000)</pre>
        <p class="noindent">Here are the steps in detail:</p>
        <ol class="order">
        <li><p class="list">The <code>new</code> operator creates a new object.</p></li>
        <li><p class="list">The [[Prototype]] internal slot of that object is set to the <code>Employee.prototype</code> object.</p></li>
        <li><p class="list">The <code>new</code> operator calls the constructor function with three parameters: <code>this</code> (pointing to the newly created object), <code>name</code>, and <code>salary</code>.</p></li>
        <li><p class="list">The body of the <code>Employee</code> function sets the object properties by using the <code>this</code> parameter.</p></li>
        <li><p class="list">The constructor returns, and the value of the <code>new</code> operator is the now fully initialized object.</p></li>
        <li><p class="list">The variable <code>harry</code> is initialized with the object reference. <a href="#ch04fig03">Figure 4-3</a> shows the result.</p></li>
        </ol>
        <figure class="figure" id="ch04fig03">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/pg83_Image_243.jpg" alt="Images" width="726" height="387">
        <figcaption><p class="fig-title"><strong>Figure 4-3</strong>&nbsp;&nbsp;&nbsp;&nbsp;Objects created with a constructor</p></figcaption>
        </figure>
        <p class="noindent">As you can see in <a href="#ch04fig03">Figure 4-3</a>, the <code>Employee.prototype</code> object has as its prototype the <code>Object.prototype</code> object which contributes the <code>toString</code> method and a few other methods.</p>
        <p class="noindent">The upshot of all this magic is that the <code>new</code> operator looks just like a constructor call in Java, C#, or C++. However, <code>Employee</code> isn’t a class. It’s just a function.</p>
        <p class="noindent">Then again, what is a class? In the textbook definition, a class is a set of objects with the same behavior, as provided by the methods. All objects that are obtained by calling <code>new Employee(. . .)</code> have the same set of methods. In <span epub:type="pagebreak" id="page_83"></span>JavaScript, constructor functions are the equivalent of classes in class-based programming languages.</p>
        <p class="noindent">You won’t often need to worry about the difference between traditional classes and the prototype-based system of JavaScript. As you will see in the following section, modern JavaScript syntax closely follows the conventions of class-based languages. However, every once in a while, you should remind yourself that a JavaScript class is nothing more than a constructor function, and that the common behavior is achieved with prototypes.</p>
        </section>
        <section>
        <h3 class="h3" id="ch04lev1sec4">4.4 The Class Syntax</h3>
        <p class="noindent">Nowadays, JavaScript has a class syntax that bundles up a constructor function and prototype methods in a familiar form. Here is the class syntax for the example of the preceding section:</p>
        <p class="codelink"><a id="rch04pr12" href="ch04_images.xhtml#ch04pr12">Click here to view code image</a></p>
        <pre class="pre">class Employee {
          constructor(name, salary) {
            this.name = name
            this.salary = salary
          }
          raiseSalary(percent) {
            this.salary *= 1 + percent / 100
          }
        }</pre>
        <p class="noindent"><span epub:type="pagebreak" id="page_84"></span>This syntax does <em>exactly</em> the same as that of the preceding section. There still is no actual class. Behind the scenes, the <code>class</code> declaration merely declares a constructor function <code>Employee</code>. The <code>constructor</code> keyword declares the body of the <code>Employee</code> constructor function. The <code>raiseSalary</code> method is added to <code>Employee.prototype</code>.</p>
        <p class="noindent">As in the preceding section, you construct an object by calling the constructor function with the <code>new</code> operator:</p>
        <p class="codelink"><a id="rch04pr13" href="ch04_images.xhtml#ch04pr13">Click here to view code image</a></p>
        <pre class="pre">const harry = new Employee('Harry Smith', 90000)</pre>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">As mentioned in the preceding sections, the <code>constructor</code> should not return any value. However, if it does, it is ignored, and the <code>new</code> expression still returns the newly created object.</p>
        </div>
        <p class="noindent">You should definitely use the <code>class</code> syntax. (This is the golden rule #4 in the preface.) The syntax gets a number of fiddly details right that you do not want to manage manually. Just realize that a JavaScript <code>class</code> is syntactic sugar for a constructor function and a prototype object holding the methods.</p>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">A class can have at most one <code>constructor</code>.</p>
        <p class="noindent">If you declare a class without a <code>constructor</code>, it automatically gets a constructor function with an empty body.</p>
        </div>
        <div class="caution">
        <p class="caution-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/caution.jpg" alt="Images" width="36" height="36"></span> Caution</p>
        <p class="noindent">Unlike in an object literal, in a <code>class</code> declaration you do not use commas to separate the method declarations.</p>
        </div>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">Classes, unlike functions, are not hoisted. You need to declare a class before you can construct an instance.</p>
        </div>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">The body of a class is executed in strict mode.</p>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch04lev1sec5"><span epub:type="pagebreak" id="page_85"></span>4.5 Getters and Setters</h3>
        <figure class="image-1">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/queen.jpg" alt="Images" width="85" height="85">
        </figure>
        <p class="noindent">A <em>getter</em> is a method with no parameters that is declared with the keyword <code>get</code>:</p>
        <p class="codelink"><a id="rch04pr14" href="ch04_images.xhtml#ch04pr14">Click here to view code image</a></p>
        <pre class="pre">class Person {
          constructor(last, first) {
            this.last = last;
            this.first = first
          }
          <strong>get</strong> fullName() { return `${this.last}, ${this.first}` }
        }</pre>
        <p class="noindent">You call the getter without parentheses, as if you accessed a property value:</p>
        <p class="codelink"><a id="rch04pr15" href="ch04_images.xhtml#ch04pr15">Click here to view code image</a></p>
        <pre class="pre">const harry = new Person('Smith', 'Harry')
        const harrysName = <strong>harry.fullName</strong> // 'Smith, Harry'</pre>
        <p class="noindent">The <code>harry</code> object does not have a <code>fullName</code> property, but the getter method is invoked. You can think of a getter as a dynamically computed property.</p>
        <p class="noindent">You can also provide a <em>setter</em>, a method with one parameter:</p>
        <p class="codelink"><a id="rch04pr16" href="ch04_images.xhtml#ch04pr16">Click here to view code image</a></p>
        <pre class="pre">class Person {
          . . .
          <strong>set</strong> fullName(value) {
            const parts = value.split(/,\s*/)
            this.last = parts[0]
            this.first = parts[1]
          }
        }</pre>
        <p class="noindent">The setter is invoked when assigning to <code>fullName</code>:</p>
        <pre class="pre">harry.fullName = 'Smith, Harold'</pre>
        <p class="noindent">When you provide getters and setters, users of your class have the illusion of using properties, but you control the property values and any attempts to modify them.</p>
        </section>
        <section>
        <h3 class="h3" id="ch04lev1sec6">4.6 Instance Fields and Private Methods</h3>
        <figure class="image-1">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/queen.jpg" alt="Images" width="85" height="85">
        </figure>
        <p class="noindent">You can dynamically set an object property in the constructor or any method by assigning to <code>this.<span class="var">propertyName</span></code>. These properties work the same way as instance fields in a class-based language.</p>
        <p class="codelink"><a id="rch04pr17" href="ch04_images.xhtml#ch04pr17">Click here to view code image</a></p>
        <pre class="pre">class BankAccount {
          constructor() { <strong>this.balance = 0</strong> }
          deposit(amount) { this.balance += amount }
          . . .
        }</pre>
        <p class="noindent"><span epub:type="pagebreak" id="page_86"></span>Three proposals for alternative notations are in stage 3 in early 2020. You can list the names and initial values of the fields in the class declaration, like this:</p>
        <p class="codelink"><a id="rch04pr18" href="ch04_images.xhtml#ch04pr18">Click here to view code image</a></p>
        <pre class="pre">class BankAccount {
          <strong>balance = 0</strong>
          deposit(amount) { this.balance += amount }
          . . .
        }</pre>
        <p class="noindent">A field is <em>private</em> (that is, inaccessible outside the methods of the class) when its name starts with <code>#</code>:</p>
        <p class="codelink"><a id="rch04pr19" href="ch04_images.xhtml#ch04pr19">Click here to view code image</a></p>
        <pre class="pre">class BankAccount {
          <strong>#balance</strong> = 0
          deposit(amount) { this.<strong>#balance</strong> += amount }
          . . .
        }</pre>
        <p class="noindent">A method is private if its name starts with a <code>#</code>.</p>
        </section>
        <section>
        <h3 class="h3" id="ch04lev1sec7">4.7 Static Methods and Fields</h3>
        <figure class="image-1">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/cat.jpg" alt="Images" width="85" height="85">
        </figure>
        <p class="noindent">In a <code>class</code> declaration, you can declare a method as <code>static</code>. Such a method does not operate on any object. It is a plain function that is a property of the class. Here is an example:</p>
        <p class="codelink"><a id="rch04pr20" href="ch04_images.xhtml#ch04pr20">Click here to view code image</a></p>
        <pre class="pre">class BankAccount {
          . . .
          static percentOf(amount, rate) { return amount * rate / 100 }
          . . .
          addInterest(rate) {
            this.balance += <strong>BankAccount.percentOf</strong>(this.balance, rate)
          }
        }</pre>
        <p class="noindent">To call a static method, whether inside or outside the class, add the class name, as in the example above.</p>
        <p class="noindent">Behind the scenes, the static method is a property of the constructor. In the olden days, one had to do that by hand:</p>
        <p class="codelink"><a id="rch04pr21" href="ch04_images.xhtml#ch04pr21">Click here to view code image</a></p>
        <pre class="pre">BankAccount.percentOf = function(amount, rate) {
          return amount * rate / 100
        }</pre>
        <p class="noindent">In the same way, you can define the equivalent of static fields:</p>
        <p class="codelink"><a id="rch04pr22" href="ch04_images.xhtml#ch04pr22">Click here to view code image</a></p>
        <pre class="pre">BankAccount.OVERDRAFT_FEE = 30</pre>
        <p class="noindent">In early 2020, a class-based syntax for static fields is in proposal stage 3:<span epub:type="pagebreak" id="page_87"></span></p>
        <p class="codelink"><a id="rch04pr23" href="ch04_images.xhtml#ch04pr23">Click here to view code image</a></p>
        <pre class="pre">class BankAccount {
          <strong>static</strong> OVERDRAFT_FEE = 30
          . . .
          withdraw(amount) {
            if (this.balance &lt; amount) {
              this.balance -= BankAccount.OVERDRAFT_FEE
            }
            . . .
          }
        }</pre>
        <p class="noindent">A static field simply becomes a property of the constructor function. As with static methods, you access the field through the class name, as <code>BankAccount.OVERDRAFT_FEE</code>.</p>
        <p class="noindent">Private static fields and methods (prefixed with <code>#</code>) are also currently in proposal stage 3.</p>
        <p class="noindent">You can declare getters and setters as static methods. As always, the setter can do error checking:</p>
        <p class="codelink"><a id="rch04pr24" href="ch04_images.xhtml#ch04pr24">Click here to view code image</a></p>
        <pre class="pre">class BankAccount {
          . . .
          static get OVERDRAFT_FEE() {
            return this.#OVERDRAFT_FEE // <span class="cite">In a static method, <code>this</code> is the constructor function</span>
          }
          static set OVERDRAFT_FEE(newValue) {
            if (newValue &gt; this.#OVERDRAFT_FEE) {
              this.#OVERDRAFT_FEE = newValue
            }
          }
        }</pre>
        </section>
        <section>
        <h3 class="h3" id="ch04lev1sec8">4.8 Subclasses</h3>
        <p class="noindent">A key concept in object-oriented programming is inheritance. A class specifies behavior for its instances. You can form a subclass of a given class (called the superclass) whose instances behave differently in some respect, while inheriting other behavior from the superclass.</p>
        <p class="noindent">A standard teaching example is an inheritance hierarchy with a superclass <code>Employee</code> and a subclass <code>Manager</code>. While employees are expected to complete their assigned tasks in return for receiving their salary, managers get bonuses on top of their base salary if they actually achieve what they are supposed to do.</p>
        <p class="noindent">In JavaScript, as in Java, you use the <code>extends</code> keyword to express this relationship among the <code>Employee</code> and <code>Manager</code> classes:<span epub:type="pagebreak" id="page_88"></span></p>
        <p class="codelink"><a id="rch04pr25" href="ch04_images.xhtml#ch04pr25">Click here to view code image</a></p>
        <pre class="pre">class Employee {
          constructor(name, salary) { . . . }
          raiseSalary(percent) { . . . }
          . . .
        }
        
        class Manager extends Employee {
          getSalary() { return this.salary + this.bonus }
          . . .
        }</pre>
        <p class="noindent">Behind the scenes, a prototype chain is established—see <a href="#ch04fig04">Figure 4-4</a>. The prototype of <code>Manager.prototype</code> is set to <code>Employee.prototype</code>. That way, any method that is not declared in the subclass is looked up in the superclass.</p>
        <figure class="figure" id="ch04fig04">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/pg88_Image_260.jpg" alt="Images" width="726" height="469">
        <figcaption><p class="fig-title"><strong>Figure 4-4</strong>&nbsp;&nbsp;&nbsp;&nbsp;Prototype chain for inheritance</p></figcaption>
        </figure>
        <p class="noindent">For example, you can call the <code>raiseSalary</code> on a manager object:</p>
        <p class="codelink"><a id="rch04pr26" href="ch04_images.xhtml#ch04pr26">Click here to view code image</a></p>
        <pre class="pre">const boss = new Manager(. . .)
        boss.raiseSalary(10) // <span class="cite">Calls <code>Employee.prototype.raiseSalary</code></span></pre>
        <p class="noindent">Prior to the <code>extends</code> syntax, JavaScript programmers had to establish such a prototype chain themselves.</p>
        <p class="noindent"><span epub:type="pagebreak" id="page_89"></span>The <code>instanceof</code> operator checks whether an object belongs to a class or one of its subclasses. Technically, the operator visits the prototype chain of an object and checks whether it contains the prototype of a given constructor function. For example,</p>
        <pre class="pre">boss instanceof Employee</pre>
        <p class="noindent">is <code>true</code> since <code>Employee.prototype</code> is in the prototype chain of <code>boss</code>.</p>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">In Java, the <code>extends</code> keyword is used to extend a fixed class. In JavaScript, <code>extends</code> is more dynamic. The right hand side of <code>extends</code> can be any expression that yields a function (or <code>null</code> to produce a class that doesn’t extend <code>Object</code>). <a href="ch04.xhtml#ch04lev1sec11">Section 4.11</a>, “<a href="ch04.xhtml#ch04lev1sec11">Class Expressions</a>” (<a href="ch04.xhtml#page_91">page 91</a>), has an example.</p>
        </div>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">In Java and C++, it is common to define abstract superclasses or interfaces so that you can invoke methods that will be defined in subclasses. In JavaScript, there is no compile-time checking for method applications, and therefore, there is no need for abstract methods.</p>
        <p class="noindent">For example, suppose you model employees and contractors, and need to get salaries from objects of both classes. In a statically typed language, you would introduce a <code>Salaried</code> superclass or interface with an abstract <code>getSalary</code> method. In JavaScript, you simply call <code>person.getSalary()</code>.</p>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch04lev1sec9">4.9 Overriding Methods</h3>
        <p class="noindent">Suppose both the superclass and the subclass have a <code>getSalary</code> method:</p>
        <p class="codelink"><a id="rch04pr27" href="ch04_images.xhtml#ch04pr27">Click here to view code image</a></p>
        <pre class="pre">class Employee {
          . . .
          getSalary() { return this.salary }
        }
        
        class Manager extends Employee {
          . . .
          getSalary() { return this.salary + this.bonus }
        }</pre>
        <p class="noindent">Now consider a method call:</p>
        <p class="codelink"><a id="rch04pr28" href="ch04_images.xhtml#ch04pr28">Click here to view code image</a></p>
        <pre class="pre">const empl = . . .
        const salary = empl.getSalary()</pre>
        <p class="noindent">If <code>empl</code> is a reference to a lowly employee, then the <code>Employee.prototype.getSalary</code> method is called. If, on the other hand, <code>empl</code> refers to a manager, the <span epub:type="pagebreak" id="page_90"></span><code>Manager.prototype.getSalary</code> method is invoked. This phenomenon—where the invoked method depends on the actual object that is being referenced—is called <em>polymorphism</em>. In JavaScript, polymorphism is a simple consequence of prototype chain lookup.</p>
        <p class="noindent">In this situation, we say that the <code>getSalary</code> method in the <code>Manager</code> class <em>overrides</em> the <code>getSalary</code> method of the <code>Employee</code> class.</p>
        <p class="noindent">Sometimes, you want to invoke the superclass method from the subclass. For example:</p>
        <p class="codelink"><a id="rch04pr29" href="ch04_images.xhtml#ch04pr29">Click here to view code image</a></p>
        <pre class="pre">class Manager extends Employee {
          . . .
          getSalary() { return super.getSalary() + this.bonus }
        }</pre>
        <p class="noindent">In a method, <code>super</code> starts the lookup with the parent of the prototype object in which the method was declared. In our example, the call <code>super.getSalary</code> bypasses <code>Manager.prototype</code>, which is just as well because otherwise there would be an infinite recursion. Instead, the <code>getSalary</code> method in <code>Employee.prototype</code> is invoked.</p>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">In this section, we used the <code>getSalary</code> method as an example for method overriding. You can also override getters and setters:</p>
        <p class="codelink"><a id="rch04pr30" href="ch04_images.xhtml#ch04pr30">Click here to view code image</a></p>
        <pre class="pre">class Manager extends Employee {
          . . .
          get salary() { return super.salary + this.bonus }
        }</pre>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch04lev1sec10">4.10 Subclass Construction</h3>
        <p class="noindent">In a subclass constructor, you <em>must</em> invoke the superclass constructor. Use the syntax <code>super(. . .)</code>, just like in Java. Inside the parentheses, place the arguments that you want to pass to the superclass constructor:</p>
        <p class="codelink"><a id="rch04pr31" href="ch04_images.xhtml#ch04pr31">Click here to view code image</a></p>
        <pre class="pre">class Manager extends Employee {
          constructor(name, salary, bonus) {
            <strong>super(name, salary)</strong> // <span class="cite"><em>Must</em> call superclass constructor</span>
            this.bonus = bonus // <span class="cite">Afterwards, <code>this</code> is valid</span>
          }
          . . .
        }</pre>
        <p class="noindent">You can only use the <code>this</code> reference after the call to <code>super</code>.</p>
        <p class="noindent">However, if you do not supply a subclass constructor, a constructor is automatically provided. That automatically provided constructor passes all <span epub:type="pagebreak" id="page_91"></span>arguments to the superclass constructor. (This is much more useful than in Java or C++, where the no-argument constructor of the superclass is called.)</p>
        <p class="codelink"><a id="rch04pr32" href="ch04_images.xhtml#ch04pr32">Click here to view code image</a></p>
        <pre class="pre">class Manager extends Employee {
          // <span class="cite">No constructor</span>
          getSalary() { . . . }
        }
        
        const boss = new Manager('Mary Lee', 180000) // <span class="cite">Calls <code>Employee('Mary Lee', 180000)</code></span></pre>
        <p class="noindent">Before the <code>extends</code> and <code>super</code> keywords were added to JavaScript, it was quite a bit more challenging to implement a subclass constructors that invokes the superclass constructor. This process—which is no longer necessary—requires advanced tools that are introduced in <a href="ch11.xhtml#ch11">Chapter 11</a>.</p>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">As you know, JavaScript doesn’t really have classes. A class is just a constructor function. A subclass is a constructor function that calls a superclass constructor.</p>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch04lev1sec11">4.11 Class Expressions</h3>
        <figure class="image-1">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/cat.jpg" alt="Images" width="85" height="85">
        </figure>
        <p class="noindent">You can declare anonymous classes, just like you can declare anonymous functions:</p>
        <p class="codelink"><a id="rch04pr33" href="ch04_images.xhtml#ch04pr33">Click here to view code image</a></p>
        <pre class="pre">const Employee = class {
          constructor(name, salary) {
            this.name = name
            this.salary = salary
          }
          raiseSalary(percent) {
            this.salary *= 1 + percent / 100
          }
        }</pre>
        <p class="noindent">Recall that <code>class</code> yields a constructor function. This function is now stored in the variable <code>Employee</code>. In this example, there is no benefit over the named class notation <code>class Employee { . . . }</code>.</p>
        <p class="noindent">Here is a more useful application. You can provide methods that “mix in“ a capability into an existing class:</p>
        <p class="codelink"><a id="rch04pr34" href="ch04_images.xhtml#ch04pr34">Click here to view code image</a></p>
        <pre class="pre">const withToString = base =&gt;
          class extends base {
            toString() {
              let result = '{'
              for (const key in this) {
                if (result !== '{') result += ', '
                result += `${key}=${this[key]}`<span epub:type="pagebreak" id="page_92"></span>
              }
              return result + '}'
            }
          }</pre>
        <p class="noindent">Call this function with a class (that is, a constructor function) in order to obtain an augmented class:</p>
        <p class="codelink"><a id="rch04pr35" href="ch04_images.xhtml#ch04pr35">Click here to view code image</a></p>
        <pre class="pre">const PrettyPrintingEmployee = withToString(Employee) // <span class="cite">A new class</span>
        e = new PrettyPrintingEmployee('Harry Smith', 90000) // <span class="cite">An instance of the new class</span>
        console.log(e.toString())
          // <span class="cite">Prints <code>{name=Harry Smith, salary=90000}</code>, not <code>[object Object]</code></span></pre>
        </section>
        <section>
        <h3 class="h3" id="ch04lev1sec12">4.12 The <code>this</code> Reference</h3>
        <figure class="image-1">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/joker.jpg" alt="Images" width="103" height="103">
        </figure>
        <p class="noindent">In this “mad hatter” section, we will have a closer look at the <code>this</code> reference. You can safely skip the section if you only use <code>this</code> in constructors, methods, and arrow functions, not inside named functions.</p>
        <p class="noindent">To see where <code>this</code> can be troublesome, first consider the <code>new</code> operator. What happens if you call a constructor function without <code>new</code>? If you make a call such as</p>
        <p class="codelink"><a id="rch04pr36" href="ch04_images.xhtml#ch04pr36">Click here to view code image</a></p>
        <pre class="pre">let e = Employee('Harry Smith', 90000) // <span class="cite">Forgot <code>new</code></span></pre>
        <p class="noindent">in strict mode, then the <code>this</code> variable is set to <code>undefined</code>.</p>
        <p class="noindent">Fortunately, this problem only arises with an old-style constructor function declaration. If you use the <code>class</code> syntax, it is illegal to call the constructor without <code>new</code>.</p>
        <div class="caution">
        <p class="caution-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/caution.jpg" alt="Images" width="36" height="36"></span> Caution</p>
        <p class="noindent">If you don’t use the <code>class</code> syntax, it is possible to declare constructor functions so that they do double duty, working with or without <code>new</code>. An example is the <code>Number</code> function:</p>
        <p class="codelink"><a id="rch04pr37" href="ch04_images.xhtml#ch04pr37">Click here to view code image</a></p>
        <pre class="pre">const price = Number('19.95')
          // <span class="cite">Parses the string and returns a primitive number, not an object</span>
        const aZeroUnlikeAnyOther = new Number(0)
          // <span class="cite">Constructs a new object</span></pre>
        <p class="noindent">Calling a constructor without <code>new</code> is not common in modern JavaScript usage.</p>
        </div>
        <p class="noindent">Here is another potential problem. It is possible to invoke a method without an object. In that case, <code>this</code> is <code>undefined</code>:</p>
        <p class="codelink"><a id="rch04pr38" href="ch04_images.xhtml#ch04pr38">Click here to view code image</a></p>
        <pre class="pre">const doLater = (what, arg) =&gt; { setTimeout(() =&gt; what(arg), 1000) }
        doLater(BankAccount.prototype.deposit, 500) // <span class="cite">Error</span></pre>
        <p class="noindent"><span epub:type="pagebreak" id="page_93"></span>When the expression <code>what(arg)</code> is evaluated after one second, the <code>deposit</code> method is invoked. The method fails when accessing <code>this.balance</code> since <code>this</code> is <code>undefined</code>.</p>
        <p class="noindent">If you want to deposit money in a specific account, just provide the account:</p>
        <p class="codelink"><a id="rch04pr39" href="ch04_images.xhtml#ch04pr39">Click here to view code image</a></p>
        <pre class="pre">doLater(amount =&gt; harrysAccount.deposit(amount), 500)</pre>
        <p class="noindent">Next, consider nested functions. Inside a nested function that is declared with the <code>function</code> keyword, <code>this</code> is <code>undefined</code>. You can run into grief when you use <code>this</code> in a callback function:</p>
        <p class="codelink"><a id="rch04pr40" href="ch04_images.xhtml#ch04pr40">Click here to view code image</a></p>
        <pre class="pre">class BankAccount {
          . . .
          spreadTheWealth(accounts) {
            accounts.forEach(function(account) {
              account.deposit(<strong>this.balance</strong> / accounts.length)
                // <span class="cite">Error—<code>this</code> is <code>undefined</code> inside the nested <code>function</code></span>
            })
            this.balance = 0
          }
        }</pre>
        <p class="noindent">Here, <code>this.balance</code> does <em>not</em> refer to the balance of the bank account. It is <code>undefined</code> since it occurs in a nested function.</p>
        <p class="noindent">The best remedy is to use an arrow function for the callback:</p>
        <p class="codelink"><a id="rch04pr41" href="ch04_images.xhtml#ch04pr41">Click here to view code image</a></p>
        <pre class="pre">class BankAccount {
          . . .
          spreadTheWealth(accounts) {
            accounts.forEach(account =&gt; {
              account.deposit(<strong>this.balance</strong> / accounts.length) // <span class="cite"><code>this</code> correctly bound</span>
            })
            this.balance = 0
          }
        }</pre>
        <p class="noindent">In an arrow function, <code>this</code> is statically bound to whatever <code>this</code> means outside the arrow function—in the example, to the <code>BankAccount</code> object invoking the <code>spreadTheWealth</code> method.</p>
        <div class="note">
        <p class="note-caption"><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/note.jpg" alt="Images" width="42" height="42"></span> Note</p>
        <p class="noindent">Before there were arrow functions, JavaScript programmers used a workaround—they initialized another variable with <code>this</code>:</p>
        <p class="codelink"><a id="rch04pr42" href="ch04_images.xhtml#ch04pr42">Click here to view code image</a></p>
        <pre class="pre">spreadTheWealth(accounts) {
           const that = this
           accounts.forEach(function(account) {
             account.deposit(<strong>that.balance</strong> / accounts.length)
          })
          this.balance = 0
        }</pre>
        </div>
        <p class="noindent"><span epub:type="pagebreak" id="page_94"></span>Here is another obscure example. Any method call <code>obj.method(args)</code> can also be written as <code>obj['method'](args)</code>. For that reason, <code>this</code> is set to <code>obj</code> if you make a call <code>obj[index](args)</code>, where <code>obj[index]</code> is a function, even though there is no dot operator in sight.</p>
        <p class="noindent">Let us construct such a situation, with an array of callbacks:</p>
        <p class="codelink"><a id="rch04pr43" href="ch04_images.xhtml#ch04pr43">Click here to view code image</a></p>
        <pre class="pre">class BankAccount {
          constructor() {
            this.balance = 0
            this.observers = []
          }
          addObserver(f) {
            this.observers.push(f)
          }
          notifyObservers() {
            for (let i = 0; i &lt; this.observers.length; i++) {
              <strong>this.observers[i]()</strong>
            }
          }
          deposit(amount) {
            this.balance += amount
            this.notifyObservers()
          }
          . . .
        }</pre>
        <p class="noindent">Now suppose you have a bank account:</p>
        <pre class="pre">const acct = new BankAccount()</pre>
        <p class="noindent">And you add an observer:</p>
        <p class="codelink"><a id="rch04pr44" href="ch04_images.xhtml#ch04pr44">Click here to view code image</a></p>
        <pre class="pre">class UserInterface {
          log(message) {
            . . .
          }
          start() {
            acct.addObserver(function() { <strong>this</strong>.log('More money!') })
            acct.deposit(1000)
          }
        }</pre>
        <p class="noindent">What is <code>this</code> when the function passed to <code>addObserver</code> is called? It is <em>the array of observers!</em> That’s what it was set to in the call <code>this.observers[i]()</code>. Since the array has no <code>log</code> method, a runtime error occurs. Again, the remedy is to use an arrow function:</p>
        <p class="codelink"><a id="rch04pr45" href="ch04_images.xhtml#ch04pr45">Click here to view code image</a></p>
        <pre class="pre">acct.addObserver(() =&gt; { this.log('More money!') })</pre>
        <div class="tip">
        <p class="tip-caption"><span epub:type="pagebreak" id="page_95"></span><span class="middle"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9780136502166/files/graphics/tip.jpg" alt="Images" width="36" height="33"></span> Tip</p>
        <p class="noindent">Having <code>this</code> dynamically set, subject to an arcane set of rules, is problematic. To avoid trouble, don’t use <code>this</code> inside functions defined with <code>function</code>. It is safe to use <code>this</code> in methods and constructors, and in arrow functions that are defined inside methods and constructors. That is the golden rule #5.</p>
        </div>
        </section>
        <section>
        <h3 class="h3" id="ch04lev1sec13">Exercises</h3>
        <ol class="ol-exe">
        <li><p class="list" id="ch04ex01">Implement a function <code>createPoint</code> that creates a point in the plane with a given <em>x</em> and <em>y</em> coordinates. Provide methods <code>getX</code>, <code>getY</code>, <code>translate</code>, and <code>scale</code>. The <code>translate</code> method moves the point by a given amount in <em>x</em> and <em>y</em> direction. The scale method scales both coordinates by a given factor. Use only the techniques of <a href="ch04.xhtml#ch04lev1sec1">Section 4.1</a>, “<a href="ch04.xhtml#ch04lev1sec1">Methods</a>” (<a href="ch04.xhtml#page_77">page 77</a>).</p></li>
        <li><p class="list" id="ch04ex02">Repeat the preceding exercise, but now implement a constructor function and use prototypes, as in <a href="ch04.xhtml#ch04lev1sec2">Section 4.2</a>, “<a href="ch04.xhtml#ch04lev1sec2">Prototypes</a>” (<a href="ch04.xhtml#page_78">page 78</a>).</p></li>
        <li><p class="list" id="ch04ex03">Repeat the preceding exercise, but now use the <code>class</code> syntax.</p></li>
        <li><p class="list" id="ch04ex04">Repeat the preceding exercise, but provide getters and setters for the <em>x</em> and <em>y</em> coordinates. In the setter, make sure the argument is a number.</p></li>
        <li><p class="list" id="ch04ex05">Consider this function that makes a string “greetable” by adding a <code>greet</code> method:</p>
        <p class="codelink"><a id="rch04pr46" href="ch04_images.xhtml#ch04pr46">Click here to view code image</a></p>
        <pre class="pre">function createGreetable(str) {
          const result = new String(str)
          result.greet = function(greeting) { return `${greeting}, ${this}!` }
          return result
        }</pre>
        <p class="noindent">Typical usage:</p>
        <p class="codelink"><a id="rch04pr47" href="ch04_images.xhtml#ch04pr47">Click here to view code image</a></p>
        <pre class="pre">const g = createGreetable('World')
        console.log(g.greet('Hello'))</pre>
        <p class="noindent">This function has a drawback: each greetable string has its own copy of the <code>greet</code> method. Have <code>createGreetable</code> yield an object whose prototype contains the <code>greet</code> method. Make sure that you can still invoke all string methods.</p></li>
        <li><p class="list" id="ch04ex06">Provide a method <code>withGreeter</code> that adds the <code>greet</code> method to any <em>class</em>, yielding a new class:</p>
        <p class="codelink"><a id="rch04pr48" href="ch04_images.xhtml#ch04pr48">Click here to view code image</a></p>
        <pre class="pre">const GreetableEmployee = withGreeter(Employee)
        const e = new GreetableEmployee('Harry Smith', 90000)
        console.log(e.greet('Hello'))</pre>
        <p class="noindent">Hint: <a href="ch04.xhtml#ch04lev1sec11">Section 4.11</a>, “<a href="ch04.xhtml#ch04lev1sec11">Class Expressions</a>” (<a href="ch04.xhtml#page_91">page 91</a>).<span epub:type="pagebreak" id="page_96"></span></p></li>
        <li><p class="list" id="ch04ex07">Rewrite the <code>Employee</code> class using private instance fields, as shown in <a href="ch04.xhtml#ch04lev1sec6">Section 4.6</a>, “<a href="ch04.xhtml#ch04lev1sec6">Instance Fields and Private Methods</a>” (<a href="ch04.xhtml#page_85">page 85</a>).</p></li>
        <li><p class="list" id="ch04ex08">A classic example for an abstract class is a tree node. There are two kinds of nodes: those with children (parents) and those without (leaves).</p>
        <p class="codelink"><a id="rch04pr49" href="ch04_images.xhtml#ch04pr49">Click here to view code image</a></p>
        <pre class="pre">class Node {
          depth() { throw Error("abstract method") }
        }
        class Parent extends Node {
          constructor(value, children) { . . . }
          depth() { return 1 + Math.max(...children.map(n =&gt; n.depth())) }
        }
        class Leaf extends Node {
          constructor(value) { . . . }
          depth() { return 1 }
        }</pre>
        <p class="noindent">This is how you would model tree nodes in Java or C++. But in JavaScript, you don’t need an abstract class to be able to invoke <code>n.depth()</code>. Rewrite the classes without inheritance and provide a test program.</p></li>
        <li><p class="list" id="ch04ex09">Provide a class <code>Random</code> with static methods</p>
        <p class="codelink"><a id="rch04pr50" href="ch04_images.xhtml#ch04pr50">Click here to view code image</a></p>
        <pre class="pre">Random.nextDouble(low, high)
        Random.nextInt(low, high)
        Random.nextElement(array)</pre>
        <p class="noindent">that produce a random number between <code>low</code> (inclusive) and <code>high</code> (exclusive), or a random element from the given array.</p></li>
        <li><p class="list" id="ch04ex10">Provide a class <code>BankAccount</code> and subclasses <code>SavingsAccount</code> and <code>CheckingAccount</code>. A savings account has an instance field for the interest and an <code>addInterest</code> method that adds it. A checking account charges a fee for each withdrawal. Do not manipulate the superclass state directly but use the superclass methods.</p></li>
        <li><p class="list" id="ch04ex11">Draw a diagram of <code>SavingsAccount</code> and <code>CheckingAccount</code> objects from the preceding exercise, similar to <a href="#ch04fig04">Figure 4-4</a>.</p></li>
        <li><p class="list" id="ch04ex12">Harry tries this code to toggle a CSS class when a button is clicked:</p>
        <p class="codelink"><a id="rch04pr51" href="ch04_images.xhtml#ch04pr51">Click here to view code image</a></p>
        <pre class="pre">const button = document.getElementById('button1')
        button.addEventListener('click', function () {
          this.classList.toggle('clicked')
        })</pre>
        <p class="noindent">It doesn’t work. Why?</p>
        <p class="noindent">Sally, after searching the wisdom of the Internet, suggests:<span epub:type="pagebreak" id="page_97"></span></p>
        <p class="codelink"><a id="rch04pr52" href="ch04_images.xhtml#ch04pr52">Click here to view code image</a></p>
        <pre class="pre">button.addEventListener('click', event =&gt; {
          event.target.classList.toggle('clicked')
        })</pre>
        <p class="noindent">This works, but Harry feels it is cheating a bit. What if the listener hadn’t produced the button as <code>event.target</code>? Fix the code so that you use neither <code>this</code> nor the <code>event</code> parameter.</p></li>
        <li><p class="list" id="ch04ex13">In <a href="ch04.xhtml#ch04lev1sec12">Section 4.12</a>, “<a href="ch04.xhtml#ch04lev1sec12">The <code>this</code> Reference</a>” (<a href="ch04.xhtml#page_92">page 92</a>), you saw that the following doesn’t work:</p>
        <p class="codelink"><a id="rch04pr53" href="ch04_images.xhtml#ch04pr53">Click here to view code image</a></p>
        <pre class="pre">const action = BankAccount.prototype.deposit
        action(1000)</pre>
        <p class="noindent">Can you make it work by getting the action method from an instance, like this:</p>
        <p class="codelink"><a id="rch04pr54" href="ch04_images.xhtml#ch04pr54">Click here to view code image</a></p>
        <pre class="pre">const harrysAccount = new BankAccount()
        const action = harrysAccount.deposit
        action(1000)</pre>
        <p class="noindent">Why or why not?</p></li>
        <li><p class="list" id="ch04ex14">In the preceding exercise, we defined an <code>action</code> function that deposits money into <code>harrysAccount</code>. It seemed a bit pointless, so let’s add some context. The function below invokes a given function after a delay, passing the delay as an argument.</p>
        <p class="codelink"><a id="rch04pr55" href="ch04_images.xhtml#ch04pr55">Click here to view code image</a></p>
        <pre class="pre">function invokeLater(f, delay) {
          setTimeout(() =&gt; f(delay), delay)
        }</pre>
        <p class="noindent">That’s perfect for Harry to earn $1000 after 1000 milliseconds:</p>
        <p class="codelink"><a id="rch04pr56" href="ch04_images.xhtml#ch04pr56">Click here to view code image</a></p>
        <pre class="pre">invokeLater(amount =&gt; harrysAccount.deposit(amount), 1000)</pre>
        <p class="noindent">But what about Sally? Make a general function <code>depositInto</code> so that one can call</p>
        <p class="codelink"><a id="rch04pr57" href="ch04_images.xhtml#ch04pr57">Click here to view code image</a></p>
        <pre class="pre">invokeLater(depositInto(sallysAccount), 1000)</pre></li>
        </ol>
        </section>
        </section>
        </div></div><link rel="stylesheet" href="/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="/api/v2/epubs/urn:orm:book:9780136502166/files/9780136502142.css" crossorigin="anonymous"></div></div></section>
</div>

https://learning.oreilly.com