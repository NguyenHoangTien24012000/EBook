<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
    
</style>
<link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492092506/files/epub.css" crossorigin="anonymous">
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content" class="noOutline" tabindex="-1"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><div class="chapter" title="Chapter&nbsp;9.&nbsp;Handling events"><div class="titlepage"><div><div><h1 class="title"><a id="asynchronous_coding_handling_events"></a>Chapter&nbsp;9.&nbsp;Handling events</h1></div><div><h3 class="subtitle">Asynchronous Coding</h3></div></div></div><div class="informalfigure"><a id="med_id00658a"></a><div class="mediaobject"><a id="med_id00658"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113608.png.jpg" alt="image with no caption" width="521" height="417"></div></div><p><span class="strong"><strong>After this chapter you’re going to realize you aren’t in Kansas anymore.</strong></span> Up until now, you’ve been writing code that typically executes from top to bottom—sure, your code might be a little more complex than that, and make use of a few functions, objects and methods, but at some point the code just runs its course. Now, we’re awfully sorry to break this to you this late in the book, but that’s <span class="strong"><strong>not how you typically write JavaScript code</strong></span>. Rather, most JavaScript is written to <span class="strong"><strong>react to events</strong></span>. What kind of events? Well, how about a user clicking on your page, data arriving from the network, timers expiring in the browser, changes happening in the DOM and that’s just a few examples. In fact, all kinds of events are happening <span class="strong"><strong>all the time</strong></span>, behind the scenes, in your browser. In this chapter we’re going rethink our approach to JavaScript coding, and learn how and why we should write code that reacts to events.</p><div class="note" title="Brain Power"><h3 class="title"><a id="ch09note01"></a>Brain Power</h3><p><a id="iddle1117" class="indexterm"></a><a id="iddle1617" class="indexterm"></a><a id="iddle1990" class="indexterm"></a>You know what a browser does, right? It retrieves a page and all that page’s contents and then renders the page. But the browser’s doing a lot more than just that. What else is it doing? Choose any of the tasks below you suspect the browser is doing behind the scenes. If you aren’t sure just make your best guess.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00076"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Knows when the page is fully loaded and displayed.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00077"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Keeps track of all the clicks you make to the page, be it on a button, link or elsewhere.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00078"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Knows when a user submits a form.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00079"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Knows when the user presses keys on a keyboard.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00080"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Knows when an element gets user interface focus.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00081"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Watches all mouse movement.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00082"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Watches the clock and manages timers and timed events.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00083"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Retrieves additional data for your page.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00084"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Tracks when the page has been resized or scrolled.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00085"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="" valign="top"><p>Knows when the cookies are finished baking.</p></td></tr></tbody></table></div></div><div class="sidebar"><a id="sharpen_your_pencil-id00133"></a><p class="title">Sharpen your pencil</p><p>Pick two of the events above. If the browser could notify your code when these events occurred, what cool or interesting code might you write?</p><div class="note" title="Note"><h3 class="title"><a id="ch09note02"></a>Note</h3><p>No, you can’t use the cookie event as one of your examples!</p></div></div><div class="sect1" title="What are events?"><div class="titlepage"><div><div><h1 class="title"><a id="what_are_eventsquestion_mark"></a>What are events?</h1></div></div></div><p><a id="iddle1099" class="indexterm"></a><a id="iddle1101" class="indexterm"></a><a id="iddle1249" class="indexterm"></a><a id="iddle1607" class="indexterm"></a><a id="iddle1962" class="indexterm"></a><a id="iddle1974" class="indexterm"></a><a id="iddle1991" class="indexterm"></a><a id="iddle3056" class="indexterm"></a>We’re sure you know by now that after the browser retrieves and displays your page, it doesn’t just sit there. Behind the scenes, a lot is going on: users are clicking buttons, the mouse location is being tracked, additional data is becoming available on the network, windows are getting resized, timers are going off, the browser’s location could be changing, and so on. All these things cause <span class="emphasis"><em>events</em></span> to be triggered.</p><div class="note" title="Note"><h3 class="title"><a id="ch09note03"></a>Note</h3><p>A browser’s geo-location, as well as a number of other advanced types of events, is something we cover in Head First HTML5 Programming. In this book we’ll stick to the bread &amp; butter foundational types of events.</p></div><p>Whenever there’s an event, there is an opportunity for your code to <span class="emphasis"><em>handle it</em></span>; that is, to supply some code that will be invoked when the event occurs. Now, you’re not required to handle any of these events, but you’ll need to handle them if you want interesting things to happen when they occur—like, say, when the button click event happens, you might want to add a new song to a playlist; when new data arrives you might want to process it and display it on your page; when a timer fires you might want to tell a user the hold on a front row concert ticket is going to expire, and so on.</p><div class="informalfigure"><a id="med_id00659a"></a><div class="mediaobject"><a id="med_id00659"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113610.png.jpg" alt="image with no caption" width="724" height="552"></div></div><p>Whenever there’s an <span class="underline">event</span>, there is an opportunity for your code to <span class="underline">handle</span> it.</p></div><div class="sect1" title="What’s an event handler?"><div class="titlepage"><div><div><h1 class="title"><a id="whatapostrophes_an_event_handlerquestion"></a>What’s an event handler?</h1></div></div></div><p><a id="iddle1574" class="indexterm"></a><a id="iddle2188" class="indexterm"></a>We write <span class="emphasis"><em>handlers</em></span> to handle events. Handlers are typically small pieces of code that know what to do when an event occurs. In terms of code, a handler is just a function. When an event occurs, its handler function is called.</p><div class="note" title="Note"><h3 class="title"><a id="ch09note04"></a>Note</h3><p>You might also hear developers use the name callback or listener instead of handler.</p></div><p>To have your handler called when an event occurs, you first need to <span class="emphasis"><em>register it</em></span>. As you’ll see, there are a few different ways to do that depending on what kind of event it is. We’ll get into all that, but for now let’s get started with a simple example, one you’ve seen before: the event that’s generated when a page is fully loaded.</p><div class="informalfigure"><a id="med_id00660a"></a><div class="mediaobject"><a id="med_id00660"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113612.png.jpg" alt="image with no caption" width="711" height="646"></div></div></div><div class="sect1" title="How to create your first event handler"><div class="titlepage"><div><div><h1 class="title"><a id="how_to_create_your_first_event_handler"></a>How to create your first event handler</h1></div></div></div><p><a id="iddle1105" class="indexterm"></a><a id="iddle1579" class="indexterm"></a><a id="iddle1589" class="indexterm"></a><a id="iddle1964" class="indexterm"></a><a id="iddle1978" class="indexterm"></a><a id="iddle2200" class="indexterm"></a><a id="iddle2554" class="indexterm"></a><a id="iddle2572" class="indexterm"></a><a id="iddle3093" class="indexterm"></a>There’s no better way to understand events than by writing a handler and wiring it up to handle a real, live event. Now, remember, you’ve already seen a couple of examples of handling events—including the page load event—but we’ve never fully explained how event handling works. The page load event is triggered when the browser has fully loaded and displayed all the content in your page (and built out the DOM representing the page).</p><p>Let’s step through what it takes to write the handler and to make sure it gets invoked when the page load event is triggered:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>First we need to write a function that can handle the page load event when it occurs. In this case, the function is going to announce to the world “I’m alive!” when it knows the page is fully loaded.</p><div class="informalfigure"><a id="med_id00661a"></a><div class="mediaobject"><a id="med_id00661"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113614.png.jpg" alt="image with no caption" width="648" height="200"></div></div></li><li class="listitem"><p>Now that we have a handler written and ready to go, we need to wire things up so the browser knows there’s a function it should invoke when the load event occurs. To do that we use the onload property of the window object, like this:</p><div class="informalfigure"><a id="med_id00662a"></a><div class="mediaobject"><a id="med_id00662"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113616.png.jpg" alt="image with no caption" width="713" height="174"></div></div></li><li class="listitem"><p>That’s it! Now, with this code written, we can sit back and know that the browser will invoke the function assigned to the window.onload property when the page is loaded.</p></li></ol></div></div><div class="sect1" title="Test drive your event"><div class="titlepage"><div><div><h1 class="title"><a id="test_drive_your_event"></a>Test drive your event <span class="inlinemediaobject"><a id="inline_id00086"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112336.png.jpg" alt="" width="144" height="47"></span></h1></div></div></div><p>Go ahead and create a new file, “event.html”, and add the code to test your load event handler. Load the page into the browser and make sure you see the alert.</p><div class="informalfigure"><a id="med_id00663a"></a><div class="mediaobject"><a id="med_id00663"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113618.png.jpg" alt="image with no caption" width="815" height="606"></div></div><div class="note" title="Brain Power"><h3 class="title"><a id="ch09note05"></a>Brain Power</h3><p>If we didn’t have functions, could we have event handlers?</p></div><div class="informalfigure"><a id="med_id00664a"></a><div class="mediaobject"><a id="med_id00664"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113620.png.jpg" alt="image with no caption" width="571" height="470"></div></div><p><a id="iddle1120" class="indexterm"></a><a id="iddle1642" class="indexterm"></a><a id="iddle1994" class="indexterm"></a>As we already mentioned, up until now you’ve taken a rather, let’s say, linear approach to writing code: you took an algorithm, like computing the best bubble solution, or generating the 99 bottles song, and wrote the code stepwise, top to bottom.</p><p>But remember the Battleship game? The code for that game didn’t quite fit the linear model—sure, you wrote some code that set up the game, initialized the model, and all that—but then the main part of the game operated in a <span class="emphasis"><em>different way</em></span>. Each time you wanted to fire at another ship you entered your guess into a form input element and pressed the “Fire” button. That button then caused a whole sequence of actions that resulted in the next move of the game being executed. In that case your code was <span class="emphasis"><em>reacting</em></span> to the user input.</p><p>Organizing code around reacting to events is a different way of thinking about how you write your code. To write code this way, you need to consider the events that can happen, and how your code should react. Computer science types like to say that this kind of code is <span class="emphasis"><em>asynchronous</em></span>, because we’re writing code to be invoked <span class="emphasis"><em>later</em></span>, <span class="emphasis"><em>if</em></span> and <span class="emphasis"><em>when</em></span> an event occurs. This kind of coding also changes your perspective from one of encoding an algorithm step-by-step into code, into one of gluing together an application that is composed of many handlers handling many different kinds of events.</p></div><div class="sect1" title="Getting your head around events... by creating a game"><div class="titlepage"><div><div><h1 class="title"><a id="getting_your_head_around_eventshellip_by"></a>Getting your head around events... by creating a game</h1></div></div></div><p><a id="iddle1125" class="indexterm"></a><a id="iddle1466" class="indexterm"></a><a id="iddle1529" class="indexterm"></a><a id="iddle1613" class="indexterm"></a><a id="iddle1918" class="indexterm"></a><a id="iddle1999" class="indexterm"></a><a id="iddle2061" class="indexterm"></a>The best way to understand events is with experience, so let’s get some more by writing a simple game. The game works like this: you load a page and are presented with an image. Not just any image, but a really blurred image. Your job is to guess what the image is. And, to check your answer, you click on the image to unblur it.</p><div class="informalfigure"><a id="med_id00665a"></a><div class="mediaobject"><a id="med_id00665"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113622.png.jpg" alt="image with no caption" width="820" height="387"></div></div><p>Let’s start with the markup. We’ll use two JPG images. One is blurred and the other isn’t. We’ve named them “zeroblur.jpg” and “zero.jpg” respectively. Here’s the markup:</p><div class="informalfigure"><a id="med_id00666a"></a><div class="mediaobject"><a id="med_id00666"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113624.png.jpg" alt="image with no caption" width="733" height="246"></div></div></div><div class="sect1" title="Implementing the game"><div class="titlepage"><div><div><h1 class="title"><a id="implementing_the_game"></a>Implementing the game</h1></div></div></div><p><a id="iddle1489" class="indexterm"></a><a id="iddle1810" class="indexterm"></a><a id="iddle1831" class="indexterm"></a><a id="iddle1832" class="indexterm"></a><a id="iddle2090" class="indexterm"></a><a id="iddle2201" class="indexterm"></a><a id="iddle2571" class="indexterm"></a><a id="iddle2573" class="indexterm"></a><a id="iddle3094" class="indexterm"></a>Go ahead and load this markup in your browser and you’ll see the blurred image. To implement the game, we need to react to a click on the image in order to display the unblurred version of the image.</p><div class="informalfigure"><a id="med_id00667a"></a><div class="mediaobject"><a id="med_id00667"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113626.png.jpg" alt="image with no caption" width="351" height="406"></div></div><p>Lucky for us, every time an HTML element in the page is clicked (or touched on a mobile device), an event is generated. Your job is to create a handler for that event, and in it write the code to display the unblurred version of the image. Here’s how you’re going to do that:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p><span class="strong"><strong>Access the image object in the DOM and assign a handler to its onclick property.</strong></span></p></li><li class="listitem"><p><span class="strong"><strong>In your handler, write the code to change the image src attribute from the blurred image to the unblurred one.</strong></span></p></li></ol></div><p>Let’s walk through these steps and write the code.</p><div class="sect2" title="Step 1: access the image in the DOM"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_access_the_image_in_the_dom"></a>Step 1: access the image in the DOM</h2></div></div></div><p>Getting access to the image is old hat for you; we just need to use our old friend, the <code class="literal">getElementById</code> method, to get a reference to it.</p><div class="informalfigure"><a id="med_id00668a"></a><div class="mediaobject"><a id="med_id00668"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113628.png.jpg" alt="image with no caption" width="651" height="66"></div></div><p>Oh, but we also need this code to run only <span class="emphasis"><em>after</em></span> the DOM for the page has been created, so let’s use the window’s <code class="literal">onload</code> property to ensure that. We’ll place our code into a function, <code class="literal">init</code>, that we’ll assign to the <code class="literal">onload</code> property.</p><div class="note" title="Note"><h3 class="title"><a id="ch09note05a"></a>Note</h3><p>Remember, we can’t get the image from the DOM until the page has finished loading.</p></div><div class="informalfigure"><a id="med_id00669a"></a><div class="mediaobject"><a id="med_id00669"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113630.png.jpg" alt="image with no caption" width="639" height="183"></div></div></div><div class="sect2" title="Step 2: add the handler, and update the image"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_add_the_handlercomma_and_update_t"></a>Step 2: add the handler, and update the image</h2></div></div></div><p><a id="iddle1123" class="indexterm"></a><a id="iddle1623" class="indexterm"></a><a id="iddle1638" class="indexterm"></a><a id="iddle1997" class="indexterm"></a><a id="iddle2059" class="indexterm"></a><a id="iddle2562" class="indexterm"></a><a id="iddle2813" class="indexterm"></a>To add a handler to deal with clicks on the image, we simply assign a function to the image’s <code class="literal">onclick</code> property. Let’s call that function <code class="literal">showAnswer</code>, and we’ll define it next.</p><div class="informalfigure"><a id="med_id00670a"></a><div class="mediaobject"><a id="med_id00670"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113632.png.jpg" alt="image with no caption" width="665" height="136"></div></div><p>Now we need to write the <code class="literal">showAnswer</code> function, which unblurs the image by resetting the image element’s <code class="literal">src</code> property to the unblurred image:</p><div class="informalfigure"><a id="med_id00671a"></a><div class="mediaobject"><a id="med_id00671"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113634.png.jpg" alt="image with no caption" width="720" height="212"></div></div></div></div><div class="sect1" title="Test drive"><div class="titlepage"><div><div><h1 class="title"><a id="test_drive-id00134"></a>Test drive <span class="inlinemediaobject"><a id="inline_id00087"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112336.png.jpg" alt="" width="144" height="47"></span></h1></div></div></div><p>Let’s take this simple game for a test drive. Make sure you’ve got all the HTML, CSS and JavaScript typed into a file named “image.html”, and that you’ve got the images you downloaded from <a class="ulink" href="http://wickedlysmart.com/hfjs">http://wickedlysmart.com/hfjs</a> in the same folder. Once all that’s done, load up the file in your browser and give it a try!</p><div class="informalfigure"><a id="med_id00672a"></a><div class="mediaobject"><a id="med_id00672"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113636.png.jpg" alt="image with no caption" width="641" height="390"></div></div><div class="informalfigure"><a id="med_id00673a"></a><div class="mediaobject"><a id="med_id00673"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113638.png.jpg" alt="image with no caption" width="453" height="494"></div></div><p><a id="iddle1916" class="indexterm"></a><a id="iddle1948" class="indexterm"></a><a id="iddle2788" class="indexterm"></a><a id="iddle2814" class="indexterm"></a><a id="iddle2996" class="indexterm"></a><span class="strong"><strong>Ah, yes. It can get tricky to follow the flow of execution in code with a lot of event handlers.</strong></span> Remember, the <code class="literal">init</code> function is called when the page is loaded. But the <code class="literal">showAnswer</code> function isn’t called until later, when you click the image. So these two event handlers get called at two different times.</p><p>In addition, remember your scope rules. In the <code class="literal">init</code> function we’re
putting the object returned by <code class="literal">getElementById</code> into a <span class="emphasis"><em>local</em></span>
variable <code class="literal">image</code>, which means when that function completes, the variable falls out
of scope and is destroyed. So later, when the <code class="literal">showAnswer</code> function is called, we
have to get the image object again from the DOM. Sure, we could have put this in a global variable,
but overuse of globals can lead to confusing and buggy code, which we’d like to avoid.</p><div class="sidebar"><a id="there_are_no_dumb_questions-id00135"></a><p class="title">There are No Dumb Questions</p><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table border="0" width="100%" summary="Q and A Set"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa1qe1"></a><a id="ch09qa1q1"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: Is setting the src property of the image the same as setting the src attribute using setAttribute?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa1q1a1"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> In this case, yes, it is. When you get an HTML element from the DOM using getElementById, you’re getting an element object that has several methods and properties. All element objects come with a property, id, that is set to the id of the HTML element (if you’ve given it one in your HTML). The image element object also comes with a src property that is set to the image file specified in the src attribute of the &lt;img&gt; element.</p><p>Not all attributes come with corresponding object properties, however, so you will need to use setAttribute and getAttribute for those. And in the case of src and id, you can use either the properties or get/set them using getAttribute and setAttribute and it does the same thing.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa1qe2"></a><a id="ch09qa1q2"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: So do we have a handler called within a handler?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa1q2a2"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Not really. The load handler is the code that is called when the page is fully loaded. When the load handler is called, we assign a handler to the image’s onclick property, but it won’t be called until you actually click on the image. When you do that (potentially a long time after the page has loaded), the showAnswer click handler is called. So the two handlers get called at different times.</p></td></tr></tbody></table></div></blockquote></div></div><div class="sidebar"><a id="be_the_browser-id00136"></a><p class="title">BE the Browser</p><div class="informalfigure"><a id="med_id00674a"></a><div class="mediaobject"><a id="med_id00674"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112372.png.jpg" alt="image with no caption" width="136" height="156"></div></div><p><a id="iddle2206" class="indexterm"></a><a id="iddle2579" class="indexterm"></a><a id="iddle3100" class="indexterm"></a><span class="strong"><strong>Below, you’ll find your game code. Your job is to play like you’re the browser and to figure out what you need to do after each event. After you’ve done the exercise, look at the end of the chapter to see if you got everything. We’ve done the first bit for you.</strong></span></p><div class="informalfigure"><a id="med_id00675a"></a><div class="mediaobject"><a id="med_id00675"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113640.png.jpg" alt="image with no caption" width="679" height="611"></div></div></div><div class="note" title="Brain Power"><h3 class="title"><a id="ch09note06"></a>Brain Power</h3><p><a id="iddle1121" class="indexterm"></a><a id="iddle1124" class="indexterm"></a><a id="iddle1621" class="indexterm"></a><a id="iddle1624" class="indexterm"></a><a id="iddle1639" class="indexterm"></a><a id="iddle1995" class="indexterm"></a><a id="iddle1998" class="indexterm"></a><a id="iddle2057" class="indexterm"></a><a id="iddle2060" class="indexterm"></a><a id="iddle2563" class="indexterm"></a>What if you had an entire page of images that could each be individually deblurred by clicking? How would you design your code to handle this? Make some notes. What might be the naive way of implementing this? Is there a way to implement this with minimal code changes to what you’ve already written?</p></div><div class="informalfigure"><a id="med_id00676a"></a><div class="mediaobject"><a id="med_id00676"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113642.png.jpg" alt="image with no caption" width="221" height="297"></div></div><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Hey guys. So far the image guessing game works great. But we really should expand the game to include more images on the page.</p><p title="Jim:"><span class="title"><strong><span class="strong"><strong>Jim:</strong></span></strong></span>&nbsp;Sure, Judy, that’s exactly what I was thinking.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;Hey, I’ve already got a bunch of images ready to go, we just need the code. I’ve followed the naming convention of “zero.jpg”, “zeroblur. jpg”, “one.jpg”, “oneblur.jpg”, and so on...</p><p title="Jim:"><span class="title"><strong><span class="strong"><strong>Jim:</strong></span></strong></span>&nbsp;Are we going to need to write a new click event handler for each image? That’s going to be a lot of repetitive code. After all, every event handler’s going to do exactly the same thing: replace the blurred image with its unblurred version, right?</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;That’s true. But I’m not sure I know how to use the same event handler for multiple images. Is that even possible?</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;What we can do is assign the same handler, which really means the same function, to the <code class="literal">onclick</code> property of every image in the game.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;So the same function gets called for every image that is clicked on?</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Right. We’ll use <code class="literal">showAnswer</code> as the handler for every image’s click event.</p><p title="Jim:"><span class="title"><strong><span class="strong"><strong>Jim:</strong></span></strong></span>&nbsp;Hmm, but how will we know which image to deblur?</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;What do you mean? Won’t the click handler know?</p><p title="Jim:"><span class="title"><strong><span class="strong"><strong>Jim:</strong></span></strong></span>&nbsp;How will it know? Right now, our <code class="literal">showAnswer</code> function assumes we clicked on the image with the id “zero”. But if we’re calling <code class="literal">showAnswer</code> for every image’s click event, then our code needs to work for any of the images.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;Oh... right... so how do we know which image was clicked?</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Actually I’ve been reading up on events, and I think there is a way for the click handler to know the element the user clicked on. But let’s deal with that part later. First let’s add some more images to the game, and see how to set the same event handler for all of them... then we’ll figure out how to determine which image the user clicked.</p><p title="Joe, Jim:"><span class="title"><strong><span class="strong"><strong>Joe, Jim:</strong></span></strong></span>&nbsp;Sounds good!</p></div><div class="sect1" title="Let’s add some more images"><div class="titlepage"><div><div><h1 class="title"><a id="letapostrophes_add_some_more_images"></a>Let’s add some more images</h1></div></div></div><p><a id="iddle2207" class="indexterm"></a><a id="iddle2580" class="indexterm"></a><a id="iddle3101" class="indexterm"></a>We’ve got a whole set of new images, so let’s start by adding them to the page. We’ll add five more images for a total of six. We’ll also modify the CSS to add a little whitespace between the images:</p><div class="note" title="Get the images"><h3 class="title"><a id="ch09note07"></a>Get the images</h3><div class="informalfigure"><a id="med_id00677a"></a><div class="mediaobject"><a id="med_id00677"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113644.png.jpg" alt="image with no caption" width="81" height="65"></div></div><p>You’ll find all the images in the <a class="xref" href="ch09.html" title="Chapter&nbsp;9.&nbsp;Handling events">Chapter&nbsp;9</a> folder you downloaded from <a class="ulink" href="http://wickedlysmart.com/hfjs">http://wickedlysmart.com/hfjs</a>.</p></div><div class="informalfigure"><a id="med_id00678a"></a><div class="mediaobject"><a id="med_id00678"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113646.png.jpg" alt="image with no caption" width="817" height="781"></div></div></div><div class="sect1" title="Now we need to assign the same event handler to each image’s onclick property"><div class="titlepage"><div><div><h1 class="title"><a id="now_we_need_to_assign_the_same_event_han"></a>Now we need to assign the same event handler to each image’s onclick property</h1></div></div></div><p>Now we have more images in the page, but we have more work to do. Right now you can click on the first image (of the <span class="emphasis"><em>Mona Lisa</em></span>) and see the unblurred image, but what about the other images?</p><p>We <span class="emphasis"><em>could</em></span> write a new, separate handler function for each image, but, from the discussion so far you know that would be tedious and wasteful. Here, have a look:</p><div class="informalfigure"><a id="med_id00679a"></a><div class="mediaobject"><a id="med_id00679"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113648.png.jpg" alt="image with no caption" width="749" height="371"></div></div><div class="note" title="Brain Power"><h3 class="title"><a id="ch09note08"></a>Brain Power</h3><p>What are the disadvantages of writing a separate handler for each image? Check all that apply:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col><col></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00088"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Lots of redundant code in each handler.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00089"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>If we need to change the code in one handler, we’re probably going to have to change them all.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00090"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Generates a lot of code.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00091"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Hard to keep track of all the images and handlers.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00092"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Hard to generalize for an arbitrary number of images.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p><span class="inlinemediaobject"><a id="inline_id00093"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112508.png.jpg" alt="" width="25" height="24"></span></p></td><td style="" valign="top"><p>Harder for others to work on the code.</p></td></tr></tbody></table></div></div></div><div class="sect1" title="How to reuse the same handler for all the images"><div class="titlepage"><div><div><h1 class="title"><a id="how_to_reuse_the_same_handler_for_all_th"></a>How to reuse the same handler for all the images</h1></div></div></div><p><a id="iddle1122" class="indexterm"></a><a id="iddle1303" class="indexterm"></a><a id="iddle1622" class="indexterm"></a><a id="iddle1933" class="indexterm"></a><a id="iddle1996" class="indexterm"></a><a id="iddle2058" class="indexterm"></a>Clearly writing a handler for each image isn’t a good way to solve this problem. So what we’re going to do instead is use our existing handler, <code class="literal">showAnswer</code>, to handle all of the click events for all the images. Of course, we’ll need to modify <code class="literal">showAnswer</code> a little bit to make this work. To use <code class="literal">showAnswer</code> for all the images we need to do two things:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p><span class="strong"><strong>Assign the showAnswer click handler function to every image on the page.</strong></span></p></li><li class="listitem"><p><span class="strong"><strong>Rework showAnswer to handle unblurring any image, not just zero.jpg.</strong></span></p></li></ol></div><p>And we’d like to do both these things in a generalized way that works even if we add more images to the page. In other words, if we write the code right, we should be able to add images to the page (or delete images from the page) without any code changes. Let’s get started.</p><div class="sect2" title="Assigning the click handler to all images on the page"><div class="titlepage"><div><div><h2 class="title"><a id="assigning_the_click_handler_to_all_image"></a>Assigning the click handler to all images on the page</h2></div></div></div><p>Here’s our first hurdle: in the current code we use the <code class="literal">getElementById</code> method to grab a reference to image “zero”, and assign the <code class="literal">showAnswer</code> function to its <code class="literal">onclick</code> property. Rather than hardcoding a call to <code class="literal">getElementById</code> for each image, we’re going to show you an easier way: we’ll grab all the images at once, iterate through them, and set up the click handler for each one. To do that we’ll use a DOM method you haven’t seen yet: <code class="literal">document.getElementsByTagName</code>. This method takes a tag name, like <code class="literal">img</code> or <code class="literal">p</code> or <code class="literal">div</code>, and returns a list of elements that match it. Let’s put it to work:</p><div class="informalfigure"><a id="med_id00680a"></a><div class="mediaobject"><a id="med_id00680"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113650.png.jpg" alt="image with no caption" width="792" height="345"></div></div><div class="sidebar"><a id="documentdotgetelementsbytagname_up_close"></a><p class="title">document.getElementsByTagName Up Close</p><div class="informalfigure"><a id="med_id00681a"></a><div class="mediaobject"><a id="med_id00681"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112734.png.jpg" alt="image with no caption" width="170" height="130"></div></div><p><a id="iddle1481" class="indexterm"></a><a id="iddle1505" class="indexterm"></a><a id="iddle1528" class="indexterm"></a><a id="iddle1934" class="indexterm"></a><a id="iddle2186" class="indexterm"></a><a id="iddle2187" class="indexterm"></a><a id="iddle2329" class="indexterm"></a>The <code class="literal">document.getElementsByTagName</code> method works a lot like <code class="literal">document.getElementById</code>, except that instead of getting an element by its id, we’re getting elements by tag name, in this case the tag name “img”. Of course, your HTML can include many <code class="literal">&lt;img&gt;</code> elements, so this method may return many elements, or one element, or even zero elements, depending on how many images we have in our page. In our image game example, we have six <code class="literal">&lt;img&gt;</code> elements, so we’ll get back a list of six image objects.</p><div class="informalfigure"><a id="med_id00682a"></a><div class="mediaobject"><a id="med_id00682"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113652.png.jpg" alt="image with no caption" width="707" height="206"></div></div></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00137"></a><p class="title">There are No Dumb Questions</p><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table border="0" width="100%" summary="Q and A Set"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa2qe1"></a><a id="ch09qa2q1"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: You said getElementsByTagName returns a list. Do you mean an array?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa2q1a1"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> It returns an object that you can treat like an array, but it’s actually an object called a NodeList. A NodeList is a collection of Nodes, which is just a technical name for the element objects that you see in the DOM tree. You can iterate over this collection by getting its length using the length property, and then access each item in the NodeList using an index with the bracket notation, just like an array. But that’s pretty much where the similarities of a NodeList and an array end, so beyond this, you’ll need to be careful in how you deal with the NodeList object. You typically won’t need to know more about NodeList until you want to start adding and removing elements to and from the DOM.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa2qe2"></a><a id="ch09qa2q2"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: So I can assign a click handler to any element?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa2q2a2"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Pretty much. Take any element on the page, get access to it, and assign a function to its onclick property. Done. As you’ve seen, that handler might be specific to that one element, or you might reuse a handler for events on many elements. Of course elements that don’t have a visual presence in your page, like the &lt;script&gt; and &lt;head&gt; elements, won’t support events like the click event.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa2qe3"></a><a id="ch09qa2q3"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: Do handler functions ever get passed any arguments?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa2q3a3"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Ah, good question, and very timely. They do, and we’re just about to look at the event object that gets passed to some handlers.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa2qe4"></a><a id="ch09qa2q4"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: Do elements support other types of events? Or is the click the only one?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa2q4a4"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> There are quite a few others; in fact, you’ve already seen another one in the code of the battleship game: the keypress event. There, an event handler function was called whenever the user pressed Enter from the form input. We’ll take a look at a few other event types in this chapter.</p></td></tr></tbody></table></div></blockquote></div></div><div class="informalfigure"><a id="med_id00683a"></a><div class="mediaobject"><a id="med_id00683"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113654.png.jpg" alt="image with no caption" width="668" height="347"></div></div><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;<a id="iddle1539" class="indexterm"></a><a id="iddle2855" class="indexterm"></a>Yes I do. Whenever the click event handler is called, it’s passed an <span class="emphasis"><em>event object.</em></span> You can use that object to find out details about the event.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;Like which image was clicked on?</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Well, more generally, the element on which the event occurred, which is known as the <span class="emphasis"><em>target</em></span>.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;What’s the target?</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Like I said, it’s the element that generated the event. Like if you click on a specific image, the target will be that image.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;So if I click on the image with the id “zero”, then the target will be set to that image?</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;More precisely, the element object that represents that image.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;Come again?</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Think of the element object as exactly the same thing you get if you call <code class="literal">document.getElementById</code> with a value of “zero”. It’s the object that represents the image in the DOM.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;Okay, so how do we get this target? It sounds like that’s what we need to know which image was clicked on.</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;The target is just a property of the event object.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;Great. That sounds perfect for <code class="literal">showAnswer</code>. We’ll be done in a snap... Wait, so <code class="literal">showAnswer</code> is passed the event object?</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;That’s right.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;So how did our code for the <code class="literal">showAnswer</code> function work up until now? It’s being passed this event object, but we don’t have a parameter defined for the event object in the function!</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Remember, JavaScript lets you ignore parameters if you want.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;Oh, right.</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Now Joe, don’t forget, you’ll need to figure out how to change the <code class="literal">src</code> of the image to the correct name for the unblurred version. Right now we’re assuming the name of the unblurred image is “zero.jpg”, but that won’t work any more.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;Maybe we can use the <code class="literal">id</code> attribute of the image to figure out the unblurred image name. The ids of all the images match the names of the unblurred version of each image.</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Sounds like a plan!</p></div></div><div class="sect1" title="How the event object works"><div class="titlepage"><div><div><h1 class="title"><a id="how_the_event_object_works"></a>How the event object works</h1></div></div></div><p><a id="iddle1114" class="indexterm"></a><a id="iddle1259" class="indexterm"></a><a id="iddle1499" class="indexterm"></a><a id="iddle1591" class="indexterm"></a><a id="iddle1601" class="indexterm"></a><a id="iddle1604" class="indexterm"></a><a id="iddle1988" class="indexterm"></a><a id="iddle2052" class="indexterm"></a><a id="iddle2108" class="indexterm"></a><a id="iddle2488" class="indexterm"></a><a id="iddle2491" class="indexterm"></a><a id="iddle3065" class="indexterm"></a>When the click handler is called, it’s passed an <span class="emphasis"><em>event object</em></span>—and in fact, for most of the events associated with the document object model (DOM) you’ll be passed an event object. The event object contains general information about the event, such as what element generated the event and what time the event happened. In addition, you’ll get information specific to the event, so if there was a mouse click, for instance, you’ll get the coordinates of the click.</p><div class="note" title="Note"><h3 class="title"><a id="ch09note09"></a>Note</h3><p>There are other kinds of events too (that is, other than DOM events), and we’ll see an example later in the chapter...</p></div><p>Let’s step through how event objects work:</p><div class="informalfigure"><a id="med_id00684a"></a><div class="mediaobject"><a id="med_id00684"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113656.png.jpg" alt="image with no caption" width="776" height="491"></div></div><p>So, what is <span class="emphasis"><em>in</em></span> an event object? Like we said, both general and specific
information about the event. The specific information depends on the type of the event, and
we’ll come back to that a bit later. The general information includes the
<code class="literal">target</code> property that holds a reference to the object that generated the event.
So, if you click on a page element, like an image, that’s the target, and we can access it
like this:</p><div class="informalfigure"><a id="med_id00685a"></a><div class="mediaobject"><a id="med_id00685"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113658.png.jpg" alt="image with no caption" width="467" height="79"></div></div><div class="note" title="Watch it!"><h3 class="title"><a id="ch09note10"></a>Watch it!</h3><p><span class="strong"><strong>If you’re running IE8 or older, check the appendix.</strong></span></p><p><span class="emphasis"><em>With older versions of IE, you need to set up the event object a little differently.</em></span></p></div><div class="sidebar"><a id="who_does_whatquestion_mark-id00138"></a><p class="title">Who Does What?</p><p>You’ve already seen that the event object (for DOM events) has properties that give you more information about the event that just happened. Below you’ll find other properties that the event object can have. Match each event object property to what it does.</p><div class="informalfigure"><a id="med_id00686a"></a><div class="mediaobject"><a id="med_id00686"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113660.png.jpg" alt="image with no caption" width="600" height="551"></div></div></div></div><div class="sect1" title="Putting the event object to work"><div class="titlepage"><div><div><h1 class="title"><a id="putting_the_event_object_to_work"></a>Putting the event object to work</h1></div></div></div><p><a id="iddle1540" class="indexterm"></a><a id="iddle1603" class="indexterm"></a><a id="iddle2490" class="indexterm"></a><a id="iddle2856" class="indexterm"></a>So, now that we’ve learned a little more about events—or more specifically, how the event object is passed to the click handler—let’s figure out how to use the information in the event object to deblur any image on the page. We’ll start by revisiting the HTML markup.</p><div class="informalfigure"><a id="med_id00687a"></a><div class="mediaobject"><a id="med_id00687"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113662.png.jpg" alt="image with no caption" width="731" height="269"></div></div><p>Notice that the value of each image’s id corresponds to the name of the unblurred image (minus the “.jpg” extension). Now, if we can access this id, then we can simply take that name and add on “.jpg” to create the name of the corresponding unblurred image. Once we have that we can change the image <code class="literal">src</code> property to the unblurred version of the image. Let’s see how:</p><div class="informalfigure"><a id="med_id00688a"></a><div class="mediaobject"><a id="med_id00688"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113664.png.jpg" alt="image with no caption" width="635" height="367"></div></div></div><div class="sect1" title="Test drive the event object and target"><div class="titlepage"><div><div><h1 class="title"><a id="test_drive_the_event_object_and_target"></a>Test drive the event object and target <span class="inlinemediaobject"><a id="inline_id00094"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112336.png.jpg" alt="" width="144" height="47"></span></h1></div></div></div><p><a id="iddle2548" class="indexterm"></a><a id="iddle2568" class="indexterm"></a><a id="iddle3087" class="indexterm"></a>Make sure you’ve updated all the code in your “image.html” file, and take it for a test drive. Guess the image, click, and see the unblurred version be revealed. Think about how this app is designed not as a top-to-bottom running program, but purely as a set of actions that result from an event being generated when you click on an image. Also think about how you handled the events on all the images with one piece of code that’s smart enough to know which image was clicked on. Play around. What happens if you click twice? Anything at all?</p><div class="informalfigure"><a id="med_id00689a"></a><div class="mediaobject"><a id="med_id00689"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113666.png.jpg" alt="image with no caption" width="496" height="473"></div></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00139"></a><p class="title">There are No Dumb Questions</p><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table border="0" width="100%" summary="Q and A Set"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa3qe1"></a><a id="ch09qa3q1"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: Does the onload event handler get passed an event object too?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa3q1a1"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> It does, and it includes information like the target, which is the window object, the time it happened, and the type of the event, which is just the type “load”. It’s safe to say you don’t typically see the event object used much in load handlers because there really isn’t anything that is useful in it for this kind of event. You’re going to find that sometimes the event object will be useful to you, and sometimes it won’t, depending on the type of event. If you’re unsure what the event object contains for a specific kind of event, just grab a JavaScript reference.</p></td></tr></tbody></table></div></blockquote></div></div><div class="note" title="Brain Power"><h3 class="title"><a id="ch09note11"></a>Brain Power</h3><p>What if you want to have an image become blurred again a few seconds after you’ve revealed the answer. How might that work?</p></div><div class="sidebar"><a id="events_exposed"></a><p class="title">Events Exposed</p><p><a id="iddle1250" class="indexterm"></a><a id="iddle1119" class="indexterm"></a><a id="iddle1628" class="indexterm"></a><a id="iddle1993" class="indexterm"></a><a id="iddle3057" class="indexterm"></a><span class="strong"><strong>This week’s interview: Talking to the browser about events</strong></span></p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;Hey Browser, it’s always good to have your time. We know how busy you are.</p><p title="Browser:"><span class="title"><strong><span class="strong"><strong>Browser:</strong></span></strong></span>&nbsp;My pleasure, and you’re right, managing all these events keeps me on my toes.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;Just how do you manage them anyway? Give us a behind-the-scenes look at the magic.</p><p title="Browser:"><span class="title"><strong><span class="strong"><strong>Browser:</strong></span></strong></span>&nbsp;As you know, events are almost continually happening. The user moves the mouse around, or makes a gesture on a mobile device; things arrive over the network; timers go off... it’s like Grand Central. That’s a lot to manage.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;I would have assumed you don’t need to do much unless there happens to be a handler defined somewhere for an event?</p><p title="Browser:"><span class="title"><strong><span class="strong"><strong>Browser:</strong></span></strong></span>&nbsp;Even if there’s no handler, there’s still work to do. Someone has to grab the event, interpret it, and see if there is a handler waiting for it. If there is, I have to make sure that handler gets executed.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;So how do you keep track of all these events? What if lots of events are happening at the same time? There’s only one of you after all.</p><p title="Browser:"><span class="title"><strong><span class="strong"><strong>Browser:</strong></span></strong></span>&nbsp;Well, yes, lots of events can happen over a very short amount of time, sometimes too fast for me to handle all in real time. So what I do is throw them all on a queue as they come in. Then I go through the queue and execute handlers where necessary.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;Boy, that sounds like my days as a short-order cook!</p><p title="Browser:"><span class="title"><strong><span class="strong"><strong>Browser:</strong></span></strong></span>&nbsp;Sure, if you had orders coming in every millisecond or so!</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;You have go through the queue one by one?</p><p title="Browser:"><span class="title"><strong><span class="strong"><strong>Browser:</strong></span></strong></span>&nbsp;I sure do, and that’s an important thing to know about JavaScript: there’s one queue and one “thread of control,” meaning there is only one of me going through the events one at a time.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;What does that really mean for our readers learning JavaScript?</p><p title="Browser:"><span class="title"><strong><span class="strong"><strong>Browser:</strong></span></strong></span>&nbsp;Well, say you write a handler and it requires a lot of computation—that is, something that takes a long time to compute. As long as your handler is chugging along computing, I’m sitting around waiting until it’s done. Only then can I continue with the queue.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;Oh wow. Does that happen a lot, that is, you end up waiting on slow code?</p><p title="Browser:"><span class="title"><strong><span class="strong"><strong>Browser:</strong></span></strong></span>&nbsp;It happens, but it also doesn’t take long for a web developer to figure out the page or app isn’t responsive because the handlers are slow. So, it’s not a common problem as long as the web developers know how event queues work.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;And now all our readers do! Now, back to events, are there lots of different kinds of events?</p><p title="Browser:"><span class="title"><strong><span class="strong"><strong>Browser:</strong></span></strong></span>&nbsp;There are. We’ve got network-based events, timer events, DOM events related to the page and a few others. Some kinds of events, like DOM events, generate event objects that contain a lot more detail about the event—like a mouse click event will have information about where the user clicked, and a keypress event will have information about which key was pressed, and so on.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;So, you spend a lot of time dealing with events. Is that really the best use of your time? After all, you’ve got to deal with retrieving, parsing and rendering pages and all that.</p><p title="Browser:"><span class="title"><strong><span class="strong"><strong>Browser:</strong></span></strong></span>&nbsp;Oh, it’s very important. These days you’ve got to write code that makes your pages interactive and engaging, and for that you need events.</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;Oh for sure, the days of simple pages are gone.</p><p title="Browser:"><span class="title"><strong><span class="strong"><strong>Browser:</strong></span></strong></span>&nbsp;Exactly. Oh shoot, this queue is about to overflow. Gotta run!</p><p title="Head First:"><span class="title"><strong><span class="strong"><strong>Head First:</strong></span></strong></span>&nbsp;Okay... until next time!</p></div></div><div class="sect1" title="Events and queues"><div class="titlepage"><div><div><h1 class="title"><a id="events_and_queues"></a>Events and queues</h1></div></div></div><p><a id="iddle1116" class="indexterm"></a><a id="iddle1241" class="indexterm"></a><a id="iddle1641" class="indexterm"></a><a id="iddle2744" class="indexterm"></a><a id="iddle3048" class="indexterm"></a>You already know that the browser maintains a queue of events. And that behind the scenes the browser is constantly taking events off that queue and processing them by calling the appropriate event handler for them, if there is one.</p><div class="informalfigure"><a id="med_id00690a"></a><div class="mediaobject"><a id="med_id00690"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113668.png.jpg" alt="image with no caption" width="788" height="637"></div></div><p>It’s important to know that the browser processes these events one at a time, so, where possible, you need to keep your handlers short and efficient. If you don’t, the whole event queue could stack up with waiting events, and the browser will get backed up dealing with them all. The downside to you? Your interface could really start to become slow and unresponsive.</p><div class="note" title="Note"><h3 class="title"><a id="ch09note12"></a>Note</h3><p>If things get really bad you’ll get the slow script dialog box, which means the browser is giving up!</p></div><div class="sidebar"><a id="exercise-id00140"></a><p class="title">Exercise</p><div class="informalfigure"><a id="med_id00691a"></a><div class="mediaobject"><a id="med_id00691"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113670.png.jpg" alt="image with no caption" width="217" height="319"></div></div><p><a id="iddle1633" class="indexterm"></a><a id="iddle2304" class="indexterm"></a><a id="iddle2584" class="indexterm"></a><a id="iddle2880" class="indexterm"></a>Ahoy matey! You’ve got a treasure map in your possession and we need your help in determining the coordinates of the treasure. To do that you’re going to write a bit of code that displays the coordinates on the map as you pass the mouse over the map. We’ve got some of the code on the next page, but you’ll have to help finish it.</p><div class="informalfigure"><a id="med_id00692a"></a><div class="mediaobject"><a id="med_id00692"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113672.png.jpg" alt="image with no caption" width="712" height="413"></div></div><div class="note" title="The mousemove event"><h3 class="title"><a id="ch09note13"></a>The mousemove event</h3><div class="informalfigure"><a id="med_id00693a"></a><div class="mediaobject"><a id="med_id00693"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112734.png.jpg" alt="image with no caption" width="170" height="130"></div></div><p>The mousemove event notifies your handler when a mouse moves over a particular element. You set up your handler using the element’s <span class="strong"><strong>onmousemove</strong></span> property. Once you’ve done that you’ll be passed an event object that provides these properties:</p><p><span class="strong"><strong>clientX, clientY:</strong></span> the x (and y) position in pixels of your mouse from the left side (and top) of the browser window.</p><p><span class="strong"><strong>screenX, screenY:</strong></span> the x (and y) position in pixels of your mouse from the left side (and top) of the user’s screen.</p><p><span class="strong"><strong>pageX, pageY:</strong></span> the x (and y) position in pixels of your mouse from the left side (and top) of the browser’s page.</p></div></div><div class="sidebar"><a id="exercise-id00141"></a><p class="title">Exercise</p><div class="informalfigure"><a id="med_id00694a"></a><div class="mediaobject"><a id="med_id00694"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113674.png.jpg" alt="image with no caption" width="195" height="195"></div></div><p><a id="iddle2208" class="indexterm"></a><a id="iddle2581" class="indexterm"></a><a id="iddle3102" class="indexterm"></a>Blimey! The code is below. So far it includes the map in the page and creates a paragraph element to display the coordinates. You need to make all the event code work. Good luck. We don’t want to see you go to Davy Jones’ locker anytime soon...</p><div class="informalfigure"><a id="med_id00695a"></a><div class="mediaobject"><a id="med_id00695"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113676.png.jpg" alt="image with no caption" width="617" height="611"></div></div></div></div><div class="sect1" title="Even more events"><div class="titlepage"><div><div><h1 class="title"><a id="even_more_events"></a>Even more events</h1></div></div></div><div class="informalfigure"><a id="med_id00696a"></a><div class="mediaobject"><a id="med_id00696"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113678.png.jpg" alt="image with no caption" width="291" height="312"></div></div><p><a id="iddle1103" class="indexterm"></a><a id="iddle1110" class="indexterm"></a><a id="iddle1113" class="indexterm"></a><a id="iddle1300" class="indexterm"></a><a id="iddle1576" class="indexterm"></a><a id="iddle1577" class="indexterm"></a><a id="iddle1584" class="indexterm"></a><a id="iddle1587" class="indexterm"></a><a id="iddle1597" class="indexterm"></a><a id="iddle1600" class="indexterm"></a><a id="iddle1610" class="indexterm"></a><a id="iddle1644" class="indexterm"></a><a id="iddle1647" class="indexterm"></a><a id="iddle1877" class="indexterm"></a><a id="iddle1883" class="indexterm"></a><a id="iddle1963" class="indexterm"></a><a id="iddle1970" class="indexterm"></a><a id="iddle1973" class="indexterm"></a><a id="iddle1976" class="indexterm"></a><a id="iddle1984" class="indexterm"></a><a id="iddle1987" class="indexterm"></a><a id="iddle2007" class="indexterm"></a><a id="iddle2559" class="indexterm"></a><a id="iddle2796" class="indexterm"></a><a id="iddle2869" class="indexterm"></a><a id="iddle2870" class="indexterm"></a><a id="iddle3109" class="indexterm"></a>So far we’ve seen three types of events: the load event, which occurs when the browser has loaded the page; the click event, which occurs when a user clicks on an element in the page and the mousemove event, which occurs when a user moves the mouse over an element. You’re likely to run into many other kinds of events too, like events for data arriving over the network, events about the geolocation of your browser, and time-based events (just to name a few).</p><p>For all the events you’ve seen, to wire up a handler, you’ve always assigned the handler to some property, like <code class="literal">onload</code>, <code class="literal">onmouseover</code> or <code class="literal">onclick</code>. But not all events work like this—for example, with time-based events, rather than assigning a handler to a property, you call a function, <code class="literal">setTimeout</code>, instead and pass it your handler.</p><p>Here’s an example: say you want your code to wait five seconds before doing something. Here’s how you do that using <code class="literal">setTimeout</code> and a handler:</p><div class="informalfigure"><a id="med_id00697a"></a><div class="mediaobject"><a id="med_id00697"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113680.png.jpg" alt="image with no caption" width="757" height="345"></div></div><div class="note" title="Brain Power"><h3 class="title"><a id="ch09note14"></a>Brain Power</h3><p>How would you make the alert appear every 5 seconds, over and over?</p></div><div class="sect2" title="Test drive your timer"><div class="titlepage"><div><div><h2 class="title"><a id="test_drive_your_timer"></a>Test drive your timer</h2></div></div></div><p>Don’t just sit there! It’s time to test this code! Throw this code into a basic HTML page, and load the page. At first you won’t see anything, but after five seconds you’ll see the alert.</p><div class="informalfigure"><a id="med_id00698a"></a><div class="mediaobject"><a id="med_id00698"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113682.png.jpg" alt="image with no caption" width="683" height="186"></div></div></div></div><div class="sect1" title="How setTimeout works"><div class="titlepage"><div><div><h1 class="title"><a id="how_settimeout_works"></a>How setTimeout works</h1></div></div></div><p>Let’s step through what just happened.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>When the page loads we do two things: we define a handler named timerHandler, and we call setTimeout to create a time event that will be generated in 5000 milliseconds. When the time event happens, the handler will be executed.</p></li><li class="listitem"><p>The browser continues its normal job as the timer counts down in milliseconds.</p><div class="informalfigure"><a id="med_id00699a"></a><div class="mediaobject"><a id="med_id00699"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113684.png.jpg" alt="image with no caption" width="476" height="545"></div></div></li><li class="listitem"><p>When the browser’s countdown gets to zero, the browser calls the handler.</p><div class="informalfigure"><a id="med_id00700a"></a><div class="mediaobject"><a id="med_id00700"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113686.png.jpg" alt="image with no caption" width="827" height="420"></div></div></li><li class="listitem"><p>The handler has been called. I’m finished with that timer.</p><div class="informalfigure"><a id="med_id00701a"></a><div class="mediaobject"><a id="med_id00701"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113688.png.jpg" alt="image with no caption" width="892" height="168"></div></div></li></ol></div><div class="informalfigure"><a id="med_id00702a"></a><div class="mediaobject"><a id="med_id00702"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113690.png.jpg" alt="image with no caption" width="428" height="559"></div></div><p><a id="iddle1846" class="indexterm"></a><span class="strong"><strong>Good catch!</strong></span> Remember we said up front that in this chapter you’re going to feel like you aren’t in Kansas anymore? Well this is that point in the movie where everything goes from black and white to color. Back to your question; yes, we defined a function and then took that function, and passed it to <code class="literal">setTimeout</code> (which is actually a method).</p><div class="informalfigure"><a id="med_id00703a"></a><div class="mediaobject"><a id="med_id00703"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113692.png.jpg" alt="image with no caption" width="357" height="87"></div></div><p>Why would we do this and what does it mean? Let’s think through this: the <code class="literal">setTimeout</code> function essentially creates a countdown timer and associates a handler with that timer. That handler is called when the timer hits zero. Now to tell <code class="literal">setTimeout</code> what handler to call, we need to pass it a <span class="emphasis"><em>reference to the handler function</em></span>. <code class="literal">setTimeout</code> stores the reference away to use later when the timer has expired.</p><p>If you’re saying “That makes sense,” then great. On the other hand, you might be saying “Excuse me? Pass a function to a function? Say what?” In that case, you probably have experience with a language like C or Java, where <span class="emphasis"><em>you don’t just go around passing functions to other functions like this</em></span>... well, in JavaScript, you do, and in fact, being able to pass functions around is incredibly powerful, especially when we’re writing code that reacts to events.</p><p>More likely at this point you’re saying, “I think I sort of get it, but I’m not sure.” If so, no worries. For now, just think of this as giving <code class="literal">setTimeout</code> a reference to the handler it’s going to need to invoke when the timer expires. We’re going to be talking a lot more about functions and what you can do with them (like passing them to other functions) in the next chapter. So just go with it for now.</p><div class="sidebar"><a id="exercise-id00142"></a><p class="title">Exercise</p><p><a id="iddle1111" class="indexterm"></a><a id="iddle1585" class="indexterm"></a><a id="iddle1598" class="indexterm"></a><a id="iddle1649" class="indexterm"></a><a id="iddle1873" class="indexterm"></a><a id="iddle1878" class="indexterm"></a><a id="iddle1971" class="indexterm"></a><a id="iddle1985" class="indexterm"></a><a id="iddle2005" class="indexterm"></a><a id="iddle2202" class="indexterm"></a><a id="iddle2574" class="indexterm"></a><a id="iddle2789" class="indexterm"></a><a id="iddle2793" class="indexterm"></a><a id="iddle3095" class="indexterm"></a>Take a look at the code below and see if you can figure out what <code class="literal">setInterval</code> does. It’s similar to <code class="literal">setTimeout</code>, but with a slight twist. Check your answer at the end of the chapter.</p><div class="informalfigure"><a id="med_id00704a"></a><div class="mediaobject"><a id="med_id00704"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113694.png.jpg" alt="image with no caption" width="270" height="299"></div></div><div class="note" title="JavaScript console"><h3 class="title"><a id="ch09note07a"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">Tick</code></strong></span></p><p><span class="strong"><strong><code class="literal">Tick</code></strong></span></p><p><span class="strong"><strong><code class="literal">Tick</code></strong></span></p><p><span class="strong"><strong><code class="literal">Tick</code></strong></span></p><p><span class="strong"><strong><code class="literal">Tick</code></strong></span></p><p><span class="strong"><strong><code class="literal">Tick</code></strong></span></p><p><span class="strong"><strong><code class="literal">Tick</code></strong></span></p><p><span class="strong"><strong><code class="literal">Tick</code></strong></span></p><div class="blockquote"><blockquote class="blockquote"><p>Here’s the output.</p></blockquote></div></div></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00143"></a><p class="title">There are No Dumb Questions</p><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table border="0" width="100%" summary="Q and A Set"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa4qe1"></a><a id="ch09qa4q1"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: Is there a way to stop setInterval?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa4q1a1"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> There is. When you call setInterval, it returns a timer object. You can pass that timer object to another function, clearInterval, to stop the timer.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa4qe2"></a><a id="ch09qa4q2"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: You said setTimeout was a method, but it looks like a function. Where’s the object it’s a method of?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa4q2a2"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Good catch. Technically we could write window.setTimeout, but because the window object is considered the global object, we can omit the object name, and just use setTimeout, which we’ll see a lot in practice.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa4qe3"></a><a id="ch09qa4q3"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: Can I omit window on the window.onload property too?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa4q3a3"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> You can, but most people don’t because they are worried onload is a common enough property name (other elements can have the onload property too) that not specifying which onload property might be confusing.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa4qe4"></a><a id="ch09qa4q4"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: With onload I’m assigning one handler to an event. But with setTimeout, I seem to be able to assign as many handlers as I want to as many timers as I want?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa4q4a4"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Exactly. When you call setTimeout, you are creating a timer and associating a handler with it. You can create as many timers as you like. The browser keeps track of associating each timer with its handler.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa4qe5"></a><a id="ch09qa4q5"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: Are there other examples of passing functions to functions?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa4q5a5"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Lots of them. In fact, you’ll find that passing around functions is fairly common in JavaScript. Not only do lots of built-in functions, like setTimeout and setInterval, make use of function passing, but you’ll also discover there’s a lot code you’ll write yourself that accepts functions as arguments. But that’s only part of the story, and in the next chapter we’re going to dive deep into this topic and discover that you can do all sort of interesting things with functions in JavaScript.</p></td></tr></tbody></table></div></blockquote></div></div><div class="informalfigure"><a id="med_id00705a"></a><div class="mediaobject"><a id="med_id00705"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113696.png.jpg" alt="image with no caption" width="459" height="482"></div></div><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;<a id="iddle1126" class="indexterm"></a><a id="iddle1625" class="indexterm"></a><a id="iddle2000" class="indexterm"></a><a id="iddle2062" class="indexterm"></a>That sounds cool... I bet you’re using <code class="literal">setTimeout</code>?</p><p title="Frank:"><span class="title"><strong><span class="strong"><strong>Frank:</strong></span></strong></span>&nbsp;That’s my plan, although I’m not sure how to know which image to reblur.</p><p title="Jim:"><span class="title"><strong><span class="strong"><strong>Jim:</strong></span></strong></span>&nbsp;What do you mean?</p><p title="Frank:"><span class="title"><strong><span class="strong"><strong>Frank:</strong></span></strong></span>&nbsp;I have my code so that when you click on an image and reveal it, I set up a timer that fires in two seconds. When the timeout event fires, it calls a new handler I wrote called <code class="literal">reblur</code>.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;And in <code class="literal">reblur</code>, you need to know which image to reblur?</p><p title="Frank:"><span class="title"><strong><span class="strong"><strong>Frank:</strong></span></strong></span>&nbsp;Right. I’m not passing any arguments to the handler, it’s just being called by the browser when the time expires, and so I have no way to tell my handler the correct image to reblur. I’m kinda stuck.</p><p title="Jim:"><span class="title"><strong><span class="strong"><strong>Jim:</strong></span></strong></span>&nbsp;Have you looked at the <code class="literal">setTimeout</code> documentation?</p><p title="Frank:"><span class="title"><strong><span class="strong"><strong>Frank:</strong></span></strong></span>&nbsp;No, I know only what Judy told me: that <code class="literal">setTimeout</code> takes a function and a time duration in milliseconds.</p><p title="Jim:"><span class="title"><strong><span class="strong"><strong>Jim:</strong></span></strong></span>&nbsp;You can add an argument to the call to <code class="literal">setTimeout</code> that is passed on to the handler when the time event fires.</p><p title="Frank:"><span class="title"><strong><span class="strong"><strong>Frank:</strong></span></strong></span>&nbsp;Oh that’s perfect. So I can just pass in a reference to the correct image to reblur and that will get passed on to the handler when it is called?</p><p title="Jim:"><span class="title"><strong><span class="strong"><strong>Jim:</strong></span></strong></span>&nbsp;You got it.</p><p title="Frank:"><span class="title"><strong><span class="strong"><strong>Frank:</strong></span></strong></span>&nbsp;See what a little talking through code gets ya Joe?</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;Oh for sure. Let’s give this a try...</p></div><div class="sect1" title="Finishing the image game"><div class="titlepage"><div><div><h1 class="title"><a id="finishing_the_image_game"></a>Finishing the image game</h1></div></div></div><p>Now it’s time to put the final polish on the image game. What we want is for an image to automatically reblur a few seconds after it’s revealed. And, as we just learned, we can pass along an argument for the event handler when we call <code class="literal">setTimeout</code>. Let’s check out how to do this:</p><div class="informalfigure"><a id="med_id00706a"></a><div class="mediaobject"><a id="med_id00706"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113698.png.jpg" alt="image with no caption" width="731" height="697"></div></div><div class="note" title="Watch it!"><h3 class="title"><a id="ch09note15"></a>Watch it!</h3><p><span class="strong"><strong>setTimeout does not support extra arguments in IE8 and earlier.</strong></span></p><p><span class="emphasis"><em>That’s right. This code is not going to work for you or your users if you’re using IE8 or earlier. But you shouldn’t be using IE8 for this book anyway! That said, you’ll see another way to do this a little later in the book that will take care of this for IE8 (and earlier).</em></span></p></div></div><div class="sect1" title="Test driving the timer"><div class="titlepage"><div><div><h1 class="title"><a id="test_driving_the_timer"></a>Test driving the timer <span class="inlinemediaobject"><a id="inline_id00095"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112336.png.jpg" alt="" width="144" height="47"></span></h1></div></div></div><p><a id="iddle1027" class="indexterm"></a><a id="iddle1501" class="indexterm"></a><a id="iddle1609" class="indexterm"></a><a id="iddle1614" class="indexterm"></a><a id="iddle1629" class="indexterm"></a><a id="iddle1874" class="indexterm"></a><a id="iddle2013" class="indexterm"></a><a id="iddle2124" class="indexterm"></a><a id="iddle2133" class="indexterm"></a><a id="iddle2790" class="indexterm"></a><a id="iddle2799" class="indexterm"></a>That wasn’t much code to add, but it sure makes a big difference in how the image game works. Now when you click, behind the scenes, the browser (through the timer events) is tracking when it needs to call the <code class="literal">reblur</code> handler, which blurs the image again. Note how <span class="emphasis"><em>asynchronous</em></span> this feels—you’re in control of when the images are clicked, but behind-the-scenes code is being invoked at various times based on the click event and on timer events. There’s no über algorithm driving things here, controlling what gets called and when; it’s just a lot of little pieces of code that set up, create and react to events.</p><div class="informalfigure"><a id="med_id00707a"></a><div class="mediaobject"><a id="med_id00707"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113700.png.jpg" alt="image with no caption" width="754" height="331"></div></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00144"></a><p class="title">There are No Dumb Questions</p><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table border="0" width="100%" summary="Q and A Set"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa5qe1"></a><a id="ch09qa5q1"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: Can I pass just one argument to the setTimeout handler?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa5q1a1"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> No you can actually pass as many as you like: zero, one or more.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa5qe2"></a><a id="ch09qa5q2"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: What about the event object? Why doesn’t setTimeout pass the event handler one?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa5q2a2"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> The event object is mostly used with DOM-related event handlers. setTimeout doesn’t pass any kind of event object to its handler, because it doesn’t occur on a specific element.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa5qe3"></a><a id="ch09qa5q3"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: showAnswer is a handler, and yet it sets up a new handler, reblur,
in its code. Is that right?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa5q3a3"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> You’ve got it. You’ll actually see this fairly often in JavaScript. It’s perfectly normal to see a handler set up additional event handlers for various events. And this is the style of programming we were referring to in the beginning of the chapter: <span class="emphasis"><em>asynchronous programming</em></span>. To create the image game we didn’t just translate an algorithm that runs top down. Rather we’re hooking up event handlers to handle the execution of the game as events occur. Trace through a few different examples of clicking on images and the various calls that get made to reveal and reblur the image.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch09qa5qe4"></a><a id="ch09qa5q4"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: So there are DOM-based events, and timer events</strong></span>... <span class="strong"><strong>are there lots of different kinds of events?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch09qa5q4a4"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Many of the events you deal with in JavaScript are DOM
events (like when you click on an element), or timer events (created with setTimeout or
setInterval). There are also API-specific events, like events generated by JavaScript APIs including
Geolocation, LocalStorage, Web Workers, and so on (see <span class="emphasis"><em>Head First HTML5
Programming</em></span> for more on these). And finally, there is a whole category of events related
to I/O: like when you request data from a web service using XmlHttpRequest (again, see
<span class="emphasis"><em>Head First HTML5 Programming</em></span> for more), or Web Sockets.</p></td></tr></tbody></table></div></blockquote></div></div><div class="informalfigure"><a id="med_id00708a"></a><div class="mediaobject"><a id="med_id00708"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113702.png.jpg" alt="image with no caption" width="431" height="413"></div></div><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;<a id="iddle2585" class="indexterm"></a><a id="iddle2588" class="indexterm"></a>To make this work you’ll want to make use of the mouseover event. You can set a handler for this event on any element with the <code class="literal">onmouseover</code> property:</p><a id="pro_id00099"></a><pre class="programlisting"><span class="strong"><strong>myElement.onmouseover = myHandler;</strong></span></pre><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Also, the mouseout event tells you when the mouse leaves your element. You can set its handler with the <code class="literal">onmouseout</code> property.</p><div class="sidebar"><a id="exercise-id00145"></a><p class="title">Exercise</p><p>Rework your code so that an image is revealed and reblurred by moving your mouse over and out of the image elements. Be sure to test your code, and check your answer at the end of the chapter:</p><div class="note" title="Note"><h3 class="title"><a id="ch09note16"></a>Note</h3><p>JavaScript code goes here.</p></div></div><div class="sidebar"><a id="exercise-id00146"></a><p class="title">Exercise</p><div class="informalfigure"><a id="med_id00709a"></a><div class="mediaobject"><a id="med_id00709"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113704.png.jpg" alt="image with no caption" width="292" height="400"></div></div><p><a id="iddle1129" class="indexterm"></a><a id="iddle1619" class="indexterm"></a><a id="iddle2003" class="indexterm"></a><a id="iddle2555" class="indexterm"></a><a id="iddle2590" class="indexterm"></a><a id="iddle3105" class="indexterm"></a>With the image game complete, Judy wrote some code to review in the weekly team meeting. In fact, she started a little contest, awarding the first person to describe what the code does with lunch. Who wins? Jim, Joe, Frank? Or you?</p><a id="pro_id00100"></a><pre class="programlisting"><span class="strong"><strong>&lt;!doctype html&gt;</strong></span>
<span class="strong"><strong>&lt;html lang="en"&gt;</strong></span>
<span class="strong"><strong>&lt;head&gt;</strong></span>
<span class="strong"><strong>&lt;meta charset="utf-8"&gt;</strong></span>
<span class="strong"><strong>&lt;title&gt;Don't resize me, I'm ticklish!&lt;/title&gt;</strong></span>
<span class="strong"><strong>&lt;script&gt;</strong></span>
    <span class="strong"><strong>function resize() {</strong></span>
        <span class="strong"><strong>var element = document.getElementById("display");</strong></span>
        <span class="strong"><strong>element.innerHTML = element.innerHTML + " that tickles!";</strong></span>
    <span class="strong"><strong>}</strong></span>
<span class="strong"><strong>&lt;/script&gt;</strong></span>
<span class="strong"><strong>&lt;/head&gt;</strong></span>
<span class="strong"><strong>&lt;body&gt;</strong></span>
<span class="strong"><strong>&lt;p id="display"&gt;</strong></span>
    <span class="strong"><strong>Whatever you do, don't resize this window! I'm warning you!</strong></span>
<span class="strong"><strong>&lt;/p&gt;</strong></span>
<span class="strong"><strong>&lt;script&gt;</strong></span>
    <span class="strong"><strong>window.onresize = resize;</strong></span>
<span class="strong"><strong>&lt;/script&gt;</strong></span>
<span class="strong"><strong>&lt;/body&gt;</strong></span>
<span class="strong"><strong>&lt;/html&gt;</strong></span></pre><div class="note" title="Note"><h3 class="title"><a id="ch09note17"></a>Note</h3><p>Put your notes here describing what this code does. What events are involved? How is the handler set up? And when does the event happen? Don’t just make notes, give this a try in your browser.</p></div></div><div class="sidebar"><a id="code_laboratory"></a><p class="title">Code Laboratory</p><p>We’ve found some highly suspicious code we need your help testing. While we’ve already done an initial analysis on the code and it looks like 100% standard JavaScript, something about it looks odd. Below you’ll find two code specimens. For each specimen you’ll need to identify what seems odd about the code, test to make sure the code works, and then try to analyze what exactly it does. Go ahead and make your notes on this page. You’ll find our analysis on the next page.</p><div class="informalfigure"><a id="med_id00710a"></a><div class="mediaobject"><a id="med_id00710"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113706.png.jpg" alt="image with no caption" width="855" height="789"></div></div></div><div class="sidebar"><a id="code_laboratory_analysis"></a><p class="title">Code Laboratory: Analysis</p><div class="informalfigure"><a id="med_id00711a"></a><div class="mediaobject"><a id="med_id00711"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113708.png.jpg" alt="image with no caption" width="408" height="545"></div></div><p>At first glance this code appears to simply define a function that adds the number one to any parameter and return it.</p><p>Looking closer, this isn’t a normal function definition. Rather, we are declaring a variable and assigning to it a function that appears to be missing its name.</p><p>Further, we’re invoking the function with the variable name, not a name associated with the function as part of its definition.</p><p>Odd indeed (although it reminds us a bit of how object methods are defined).</p><p>Here we appear to have something similar. Instead of defining a function separately and assigning its name to the window. onload property, we’re assigning a function directly to that property. And again, the function doesn’t define its own name.</p><p>We added this code to an HTML page and tested it. The code appears to work as you might expect. With specimen #1, when the function assigned to addOne is invoked, we get a result that is one greater than the number we pass in, which seems right. With specimen #2, when we load the page, we get the alert “The page is loaded!”.</p><p>From these tests it would appear as if functions can be defined without names, and used in places where you’d expect an expression.</p></div><div class="informalfigure"><a id="med_id00712a"></a><div class="mediaobject"><a id="med_id00712"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113710.png.jpg" alt="image with no caption" width="366" height="377"></div></div><div class="sidebar"><a id="bullet_points-id00147"></a><p class="title">Bullet Points</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Most JavaScript code is written to react to <span class="strong"><strong>events</strong></span>.</p></li><li class="listitem"><p>There are many different kinds of events your code can react to.</p></li><li class="listitem"><p>To react to an event, you write an <span class="strong"><strong>event handler</strong></span> function, and register it. For instance, to register a handler for the click event, you assign the handler function to the onclick property of an element.</p></li><li class="listitem"><p>You’re not required to handle any specific event. You choose to handle the events you’re interested in.</p></li><li class="listitem"><p><span class="strong"><strong>Functions</strong></span> are used for handlers because functions allow us to package up code to be executed later (when the event occurs).</p></li><li class="listitem"><p>Code written to handle events is different from code that executes top to bottom and then completes. Event handlers can run at any time and in any order: they are <span class="strong"><strong>asynchronous</strong></span>.</p></li><li class="listitem"><p>Events that occur on elements in the DOM (DOM events) cause an event object to be passed to the event handler.</p></li><li class="listitem"><p>The <span class="strong"><strong>event object</strong></span> contains properties with extra information about the event, including the type (like “click” or “load”) and the target (the object on which the event occurred).</p></li><li class="listitem"><p>Older versions of IE (IE 8 and older) have a different event model from other browsers. See the appendix for more details.</p></li><li class="listitem"><p>Many events can happen very close together. When too many events happen for the browser to handle them as they occur, the events are stored in an <span class="strong"><strong>event queue</strong></span> (in the order in which they occurred) so the browser can execute the event handlers for each event in turn.</p></li><li class="listitem"><p>If an event handler is computationally complex, it will slow down the handling of the events in the queue because only one event handler can execute at a time.</p></li><li class="listitem"><p>The functions <span class="strong"><strong>setTimeout</strong></span> and <span class="strong"><strong>setInterval</strong></span> are used to generate time-based events after a certain time has passed.</p></li><li class="listitem"><p>The method <span class="strong"><strong>getElementsByTagName</strong></span> returns zero, one or more element objects in a NodeList (which is array-like, so you can iterate over it).</p></li></ul></div></div><div class="sidebar"><a id="event_soup"></a><p class="title">Event Soup</p><div class="informalfigure"><a id="med_id00713a"></a><div class="mediaobject"><a id="med_id00713"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113712.png.jpg" alt="image with no caption" width="779" height="837"></div></div></div><div class="sidebar"><a id="javascript_cross-id00148"></a><p class="title">JavaScript cross</p><p><a id="iddle1301" class="indexterm"></a><a id="iddle1521" class="indexterm"></a><a id="iddle1523" class="indexterm"></a><a id="iddle1608" class="indexterm"></a><a id="iddle1611" class="indexterm"></a><a id="iddle1615" class="indexterm"></a><a id="iddle1616" class="indexterm"></a><a id="iddle1630" class="indexterm"></a><a id="iddle1631" class="indexterm"></a><a id="iddle1632" class="indexterm"></a><a id="iddle1634" class="indexterm"></a><a id="iddle1636" class="indexterm"></a><a id="iddle1637" class="indexterm"></a><a id="iddle1640" class="indexterm"></a><a id="iddle1643" class="indexterm"></a><a id="iddle1645" class="indexterm"></a><a id="iddle1646" class="indexterm"></a><a id="iddle1648" class="indexterm"></a><a id="iddle2168" class="indexterm"></a><a id="iddle2189" class="indexterm"></a><a id="iddle2199" class="indexterm"></a><a id="iddle2305" class="indexterm"></a><a id="iddle2307" class="indexterm"></a><a id="iddle2308" class="indexterm"></a><a id="iddle2619" class="indexterm"></a><a id="iddle2772" class="indexterm"></a><a id="iddle2876" class="indexterm"></a><a id="iddle2877" class="indexterm"></a><a id="iddle2927" class="indexterm"></a>Practice your event reaction time by doing this crossword.</p><div class="informalfigure"><a id="med_id00714a"></a><div class="mediaobject"><a id="med_id00714"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113714.png" alt="image with no caption" width="711" height="548"></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Across</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>Down</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; " valign="top"><p>1. Use this property of the event object to know when an event happened.</p>
<p>3. When you click your mouse, you’ll generate a _______ event.</p>
<p>8. Events are handled ______________.</p>
<p>12. 5000 milliseconds is _______ seconds.</p>
<p>13. Use this method to get multiple elements from the DOM using a tag name.</p>
<p>14. A function designed to react to an event is called an event _______.</p>
<p>15. The setTimeout method is used to create a ______ event.</p>
<p>16. The browser has only one _________ of control.</p>
<p>17. The browser can only execute one event __________ at a time.</p>
<p>19. The event object for a mouseover event has this property for the X position of the mouse
from the left side of the browser window.</p>
<p>20. The event _______ is passed to an event handler for DOM events.</p>
<p>21. To pass an argument to a timer event handler, pass it as the ________ argument to
setTimeout.</p></td><td style="" valign="top"><p>1. You’ll generate this event if you touch your touch screen device.</p>
<p>2. zero.jpg is the ________.</p>
<p>4. When you begin programming with events, you might feel like you’re not in _________ any more.</p>
<p>5. JavaScript allows you to pass a _______ to a function.</p>
<p>6. If too many events happen close together, the browser stores the events in an event ________.</p>
<p>7. Events are generated for lots of things, but not for baking __________.</p>
<p>9. To make a time event happen over and over, use _________.</p>
<p>10. The window ______ property is for handling a page loaded event.</p>
<p>11. _____ is super ticklish.</p>
<p>14. To assign an event handler for a time event, pass the _______ to setTimeout as the first argument.</p>
<p>15. How you know which image was clicked on in the image game.</p>
<p>18. A program with code to handle events is not this.</p></td></tr></tbody></table></div></div><div class="sidebar"><a id="sharpen_your_pencil_solution-id00149"></a><p class="title">Sharpen your pencil Solution</p><p><a id="iddle1118" class="indexterm"></a><a id="iddle1618" class="indexterm"></a><a id="iddle1992" class="indexterm"></a>Pick two of the events above. If the browser could notify your code when these events occurred, what cool or interesting code might you write?</p><p>Let’s take an event that notifies us when a user submits a form. If we’re notified of this event, then we could get all the data the user filled into the form and check to make sure it’s valid (e.g. the user put something that looks like a phone number into a phone number field, or filled out the required fields). Once we’ve done that check, then we could submit the form to the server.</p><p>How about the mouse movement event? If we’re notified whenever a user moves the mouse, then we could create a drawing application right in the browser.</p><p>If we’re notified when the user scrolls down the page, we could do interesting things like reveal an image as they scroll down.</p></div><div class="sidebar"><a id="be_the_browser_solution-id00150"></a><p class="title">BE the Browser Solution</p><div class="informalfigure"><a id="med_id00715a"></a><div class="mediaobject"><a id="med_id00715"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112372.png.jpg" alt="image with no caption" width="136" height="156"></div></div><p><a id="iddle1127" class="indexterm"></a><a id="iddle1626" class="indexterm"></a><a id="iddle2001" class="indexterm"></a><a id="iddle2063" class="indexterm"></a><a id="iddle2209" class="indexterm"></a><a id="iddle2582" class="indexterm"></a><a id="iddle3103" class="indexterm"></a><span class="strong"><strong>Below, you’ll find the image game code. Your job is to play like you’re the browser and to figure out what you need to do after each event. After you’ve done the exercise look at the end of the chapter to see if you got everything. Here’s our solution.</strong></span></p><a id="pro_id00101"></a><pre class="programlisting"><span class="strong"><strong>window.onload = init;</strong></span>
<span class="strong"><strong>function init() {</strong></span>
    <span class="strong"><strong>var image = document.getElementById("zero");</strong></span>
    <span class="strong"><strong>image.onclick = showAnswer;</strong></span>
<span class="strong"><strong>}</strong></span>

<span class="strong"><strong>function showAnswer() {</strong></span>
    <span class="strong"><strong>var image = document.getElementById("zero");</strong></span>
    <span class="strong"><strong>image.src = "zero.jpg";</strong></span>
<span class="strong"><strong>}</strong></span></pre><div class="informalfigure"><a id="med_id00716a"></a><div class="mediaobject"><a id="med_id00716"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113716.png.jpg" alt="image with no caption" width="586" height="281"></div></div></div><div class="sidebar"><a id="who_does_whatquestion_mark_solut-id00151"></a><p class="title">Who Does What? Solution</p><p><a id="iddle1115" class="indexterm"></a><a id="iddle1500" class="indexterm"></a><a id="iddle1592" class="indexterm"></a><a id="iddle1602" class="indexterm"></a><a id="iddle1989" class="indexterm"></a><a id="iddle2489" class="indexterm"></a>You’ve already seen that the event object (for DOM events) has properties that give you more information about the event that just happened. Below you’ll find other properties that the event object can have. Match each event object property to what it does.</p><div class="informalfigure"><a id="med_id00717a"></a><div class="mediaobject"><a id="med_id00717"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113718.png.jpg" alt="image with no caption" width="641" height="546"></div></div></div><div class="sidebar"><a id="exercise_solution-id00152"></a><p class="title">Exercise Solution</p><div class="informalfigure"><a id="med_id00718a"></a><div class="mediaobject"><a id="med_id00718"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113720.png.jpg" alt="image with no caption" width="187" height="188"></div></div><p><a id="iddle1635" class="indexterm"></a><a id="iddle2306" class="indexterm"></a><a id="iddle2586" class="indexterm"></a><a id="iddle2881" class="indexterm"></a>Ahoy matey! You’ve got a treasure map in your possession and we need your help in determining the coordinates of the treasure. To do that you’re going to write a bit of code that displays the coordinates on the map as you pass the mouse over the map.</p><p>Blimey! The code is below. So far it includes the map in the page and creates a paragraph element to display the coordinates. You need to make all the event-based code works. Good luck. We don’t want to see you go to Davy Jones’ locker anytime soon... And here’s our solution.</p><div class="informalfigure"><a id="med_id00719a"></a><div class="mediaobject"><a id="med_id00719"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113722.png.jpg" alt="image with no caption" width="177" height="155"></div></div><div class="informalfigure"><a id="med_id00720a"></a><div class="mediaobject"><a id="med_id00720"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113724.png.jpg" alt="image with no caption" width="637" height="524"></div></div></div><div class="sidebar"><a id="exercise_solution-id00153"></a><p class="title">Exercise Solution</p><p><a id="iddle1112" class="indexterm"></a><a id="iddle1586" class="indexterm"></a><a id="iddle1599" class="indexterm"></a><a id="iddle1650" class="indexterm"></a><a id="iddle1875" class="indexterm"></a><a id="iddle1972" class="indexterm"></a><a id="iddle1986" class="indexterm"></a><a id="iddle2006" class="indexterm"></a><a id="iddle2791" class="indexterm"></a>Take a look at the code below and see if you can figure out what <code class="literal">setInterval</code> does. It’s similar to <code class="literal">setTimeout</code>, but with a slight twist. Here’s our solution:</p><div class="informalfigure"><a id="med_id00721a"></a><div class="mediaobject"><a id="med_id00721"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113726.png.jpg" alt="image with no caption" width="727" height="763"></div></div></div><div class="sidebar"><a id="exercise_solution-id00154"></a><p class="title">Exercise Solution</p><p><a id="iddle1128" class="indexterm"></a><a id="iddle1627" class="indexterm"></a><a id="iddle2002" class="indexterm"></a><a id="iddle2064" class="indexterm"></a><a id="iddle2587" class="indexterm"></a><a id="iddle2589" class="indexterm"></a>Rework your code so that you can reveal and reblur an image by passing your mouse over and out of the image elements. Be sure to test your code. Here’s our solution:</p><div class="informalfigure"><a id="med_id00722a"></a><div class="mediaobject"><a id="med_id00722"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113728.png.jpg" alt="image with no caption" width="680" height="664"></div></div></div><div class="sidebar"><a id="exercise_solution-id00155"></a><p class="title">Exercise Solution</p><div class="informalfigure"><a id="med_id00723a"></a><div class="mediaobject"><a id="med_id00723"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113730.png.jpg" alt="image with no caption" width="265" height="365"></div></div><p><a id="iddle1130" class="indexterm"></a><a id="iddle1620" class="indexterm"></a><a id="iddle2004" class="indexterm"></a><a id="iddle2556" class="indexterm"></a><a id="iddle2591" class="indexterm"></a><a id="iddle3106" class="indexterm"></a>With the image game complete, Judy wrote some code to review in the weekly team meeting. In fact, she started a little contest, awarding the first person to describe what the code does with lunch. Who wins? Jim, Joe, Frank? Or you?</p><div class="informalfigure"><a id="med_id00724a"></a><div class="mediaobject"><a id="med_id00724"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113732.png.jpg" alt="image with no caption" width="919" height="846"></div></div></div><div class="sidebar"><a id="javascript_cross_solution-id00156"></a><p class="title">JavaScript cross Solution</p><p>Practice your event reaction time by doing this crossword. Here’s our solution.</p><div class="informalfigure"><a id="med_id00725a"></a><div class="mediaobject"><a id="med_id00725"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2113734.png" alt="image with no caption" width="716" height="551"></div></div></div></div></div></div></div><link rel="stylesheet" href="/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="/api/v2/epubs/urn:orm:book:9781449340124/files/core.css" crossorigin="anonymous"></div></div></section>
</div>

https://learning.oreilly.com