<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
    
</style>
<link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492092506/files/epub.css" crossorigin="anonymous">
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content" class="noOutline" tabindex="-1"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><div class="chapter" title="Chapter&nbsp;13.&nbsp;Extra strength objects"><div class="titlepage"><div><div><h1 class="title"><a id="using_prototypes_extra_strength_objects"></a>Chapter&nbsp;13.&nbsp;Extra strength objects</h1></div><div><h3 class="subtitle">Using Prototypes</h3></div></div></div><div class="informalfigure"><a id="med_id00921a"></a><div class="mediaobject"><a id="med_id00921"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114154.png.jpg" alt="image with no caption" width="345" height="424"></div></div><p><span class="strong"><strong>Learning how to create objects was just the beginning.</strong></span> It’s time to put some muscle on our objects. We need more ways to create <span class="strong"><strong>relationships</strong></span> between objects and to <span class="strong"><strong>share code</strong></span> among them. And, we need ways to extend and enhance existing objects. In other words, we need more tools. In this chapter, you’re going to see that JavaScript has a very powerful <span class="strong"><strong>object model</strong></span>, but one that is a bit different than the status quo object-oriented language. Rather than the typical class-based object-oriented system, JavaScript instead opts for a more powerful <span class="strong"><strong>prototype</strong></span> model, where objects can inherit and extend the behavior of other objects. What is that good for? You’ll see soon enough. Let’s get started...</p><div class="informalfigure"><a id="med_id00922a"></a><div class="mediaobject"><a id="med_id00922"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114156.png.jpg" alt="image with no caption" width="619" height="501"></div></div><p><a id="iddle1297" class="indexterm"></a><a id="iddle2130" class="indexterm"></a><a id="iddle2393" class="indexterm"></a><span class="strong"><strong>If you’re used to Java, C++, or any language based on classical object-oriented programming let’s have a quick chat.</strong></span></p><p>And if you aren’t... what, you got a date? Take a seat, and go along for the ride—you might just learn something as well.</p><p>We’ll give it to you straight: JavaScript doesn’t have a classical object-oriented model, where you create objects from classes. In fact, <span class="emphasis"><em>JavaScript doesn’t have classes at all</em></span>. In JavaScript, objects inherit behavior <span class="emphasis"><em>from other objects</em></span>, which we call <span class="emphasis"><em>prototypal inheritance</em></span>, or inheritance based on prototypes.</p><div class="note" title="Note"><h3 class="title"><a id="ch13note01"></a>Note</h3><p>This may change in the future: the next version of JavaScript may add classes. So keep an eye out on wickedlysmart.com/hfjs for the latest on this.</p></div><p>JavaScript gets a lot of groans (and confused looks) from those trained in object-oriented programming, but know this: prototype-based languages are more general than classical object oriented ones. They’re more flexible, efficient and expressive. So expressive that if you wanted to, you could use JavaScript to implement classical inheritance.</p><div class="note" title="Note"><h3 class="title"><a id="ch13note02"></a>Note</h3><p>Left to the reader as an exercise.</p></div><p>So, if you are trained in the art of classical object-oriented programming, sit back, relax, open your mind and be ready for something a little different. And if you have no idea what we’re talking about when we say “classical object-oriented programming,” that just means you’re starting fresh, which is often a very good thing.</p><div class="sect1" title="Hey, before we get started, we’ve got a better way to diagram our objects"><div class="titlepage"><div><div><h1 class="title"><a id="heycomma_before_we_get_startedcomma_weap"></a>Hey, before we get started, we’ve got a better way to diagram our objects</h1></div></div></div><p><a id="iddle1457" class="indexterm"></a><a id="iddle2474" class="indexterm"></a>The object diagrams we’ve been using are cute and all that, but this is the <span class="emphasis"><em>serious objects chapter,</em></span> so we’re going to get more serious about our object diagrams. Actually, we really like the old ones, but the object diagrams in this chapter get complicated enough we just can’t squeeze everything we need to into them.</p><p>So, without further ado, let us present the new format:</p><div class="informalfigure"><a id="med_id00923a"></a><div class="mediaobject"><a id="med_id00923"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114158.png.jpg" alt="image with no caption" width="777" height="281"></div></div><div class="sidebar"><a id="sharpen_your_pencil-id00225"></a><p class="title">Sharpen your pencil</p><p>Do a little practice just to make sure you’ve got the new format down. Take the object below and redo it in the new and improved object diagram.</p><div class="informalfigure"><a id="med_id00924a"></a><div class="mediaobject"><a id="med_id00924"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114160.png.jpg" alt="image with no caption" width="652" height="222"></div></div></div></div><div class="sect1" title="Revisiting object constructors: we’re reusing code, but are we being efficient?"><div class="titlepage"><div><div><h1 class="title"><a id="revisiting_object_constructors_weapostro"></a>Revisiting object constructors: we’re reusing code, but are we being efficient?</h1></div></div></div><p><a id="iddle1384" class="indexterm"></a><a id="iddle2360" class="indexterm"></a>Remember the Dog constructor we created in the last chapter? Let’s take another quick look and review what we’re getting out of using the constructor:</p><div class="informalfigure"><a id="med_id00925a"></a><div class="mediaobject"><a id="med_id00925"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114162.png.jpg" alt="image with no caption" width="590" height="201"></div></div><p>So by using the constructor we get a nice, consistent dog object that we can customize to our liking, and, we also can leverage the methods that are defined in it (in this case there’s only one, <code class="literal">bark</code>). Further, every dog gets the same code from the constructor, saving us lots of code headaches if things change in the future. That’s all great, but let’s look at what happens at runtime when we evaluate the code below:</p><a id="pro_id00139"></a><pre class="programlisting"><span class="strong"><strong>var fido = new Dog("Fido", "Mixed", 38);</strong></span>
<span class="strong"><strong>var fluffy = new Dog("Fluffy", "Poodle", 30);</strong></span>
<span class="strong"><strong>var spot = new Dog("Spot", "Chihuahua", 10);</strong></span></pre><p>This code causes three dog objects to be created. Let’s use our new object diagrams to see what that looks like:</p><div class="informalfigure"><a id="med_id00926a"></a><div class="mediaobject"><a id="med_id00926"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114164.png.jpg" alt="image with no caption" width="809" height="293"></div></div><div class="informalfigure"><a id="med_id00927a"></a><div class="mediaobject"><a id="med_id00927"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114166.png.jpg" alt="image with no caption" width="883" height="1000"></div></div><div class="informalfigure"><a id="med_id00928a"></a><div class="mediaobject"><a id="med_id00928"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114168.png.jpg" alt="image with no caption" width="445" height="312"></div></div></div><div class="sect1" title="Is duplicating methods really a problem?"><div class="titlepage"><div><div><h1 class="title"><a id="is_duplicating_methods_really_a_problemq"></a>Is duplicating methods really a problem?</h1></div></div></div><p><a id="iddle2263" class="indexterm"></a><a id="iddle2402" class="indexterm"></a><a id="iddle2447" class="indexterm"></a><a id="iddle2692" class="indexterm"></a>Actually, it is. In general we don’t want a new set of methods being created every time you instantiate an object with a constructor. Doing so hurts the performance of your application and impacts resources on your computer, which can be a big deal, particularly on mobile devices. And, as you’re going to see, there are more flexible and powerful ways to craft your JavaScript objects.</p><p>Let’s take a step back and think about one of the main reasons we used constructors in the first place: we were trying to <span class="emphasis"><em>reuse behavior</em></span>. For instance, remember that we had a bunch of dog objects and we wanted all those objects to use the same <code class="literal">bark</code> method. By using a constructor we achieved this at a code level by placing the <code class="literal">bark</code> method in one place—inside the Dog constructor—and so we reused the same <code class="literal">bark</code> code each time we instantiated an object. But, our solution doesn’t look as promising at runtime because every dog instance is getting its own copy of the <code class="literal">bark</code> method.</p><div class="note" title="Note"><h3 class="title"><a id="ch13note03"></a>Note</h3><p>Typically when we talk about an object’s “behavior” we’re referring to the set of methods it supports.</p></div><p>Now the reason we’re running into this problem is because we aren’t taking full advantage of JavaScript’s object model, which is based on the idea of <span class="emphasis"><em>prototypes</em></span>. In this model, we can create objects that are extensions of other objects—that is, of prototype objects.</p><p>To demonstrate prototypes, hmm... if only we had a <span class="emphasis"><em>dog prototype</em></span> around that we could work from...</p></div><div class="sect1" title="What are prototypes?"><div class="titlepage"><div><div><h1 class="title"><a id="what_are_prototypesquestion_mark"></a>What are prototypes?</h1></div></div></div><p><a id="iddle2080" class="indexterm"></a><a id="iddle2411" class="indexterm"></a><a id="iddle2421" class="indexterm"></a><a id="iddle2495" class="indexterm"></a><a id="iddle2684" class="indexterm"></a><a id="iddle2701" class="indexterm"></a><a id="iddle2711" class="indexterm"></a>JavaScript objects can inherit properties and behavior from other objects. More specifically, JavaScript uses what is known as <span class="emphasis"><em>prototypal inheritance</em></span>, and the object you’re inheriting behavior from is called the <span class="emphasis"><em>prototype</em></span>. The whole point of this scheme is to inherit and reuse existing properties (including methods), while extending those properties in your brand new object. That’s all quite abstract so let’s work through an example.</p><div class="note" title="Note"><h3 class="title"><a id="ch13note04"></a>Note</h3><p>When an object inherits from another, it gains access to all its methods and properties.</p></div><p>We’ll start with a prototype for a dog object. Here’s what it might look like:</p><div class="informalfigure"><a id="med_id00929a"></a><div class="mediaobject"><a id="med_id00929"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114170.png.jpg" alt="image with no caption" width="695" height="432"></div></div><p>So now that we have a good dog prototype, we can create dog objects that inherit properties from that prototype. Our dog objects will also extend the prototype properties with dog-specific properties or behaviors. For example, we know we’ll be adding a name, breed and weight to each dog.</p><p>You’ll see that if any of these dogs needs to bark, run or wag their tails, they can rely on the prototype for those behaviors, because they inherit them from the prototype. So, let’s create a few dog objects so you can see how this all works.</p></div><div class="sect1" title="Inheriting from a prototype"><div class="titlepage"><div><div><h1 class="title"><a id="inheriting_from_a_prototype"></a>Inheriting from a prototype</h1></div></div></div><p><a id="iddle1458" class="indexterm"></a><a id="iddle2475" class="indexterm"></a>First, we need to create object diagrams for the Fido, Fluffy and Spot dog objects and have them inherit from the new dog prototype. We’ll show inheritance by drawing a set of dashed lines from the dog instances to the prototype. And remember, we put only the methods and properties that are common to <span class="emphasis"><em>all</em></span> dogs in the dog prototype, because <span class="emphasis"><em>all</em></span> the dogs will inherit them. All the properties specific to an actual dog, like the dog’s name, go into the dog instances, because they are different for each dog.</p><div class="informalfigure"><a id="med_id00930a"></a><div class="mediaobject"><a id="med_id00930"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114172.png.jpg" alt="image with no caption" width="766" height="769"></div></div></div><div class="sect1" title="How inheritance works"><div class="titlepage"><div><div><h1 class="title"><a id="how_inheritance_works"></a>How inheritance works</h1></div></div></div><p><a id="iddle2671" class="indexterm"></a>How do we make dogs bark if the <code class="literal">bark</code> method isn’t in the individual dog instances, but rather is in the prototype? That’s where inheritance comes in. When you call a method on an object instance, and that method isn’t found in the instance, you check the prototype for that method. Here’s how.</p><div class="informalfigure"><a id="med_id00931a"></a><div class="mediaobject"><a id="med_id00931"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114174.png.jpg" alt="image with no caption" width="807" height="512"></div></div><p>Properties work the same way. If we write code that needs <code class="literal">fido.name</code>, the value will come from the <code class="literal">fido</code> object. But if we want the value of <code class="literal">fido.species</code>, we first check the <code class="literal">fido</code> object, but when it isn’t found there, we check the dog prototype (and find it).</p><div class="informalfigure"><a id="med_id00932a"></a><div class="mediaobject"><a id="med_id00932"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114176.png.jpg" alt="image with no caption" width="791" height="641"></div></div><p>Now that you understand how to use inheritance we can create a large number of dogs. All the dogs can all still bark, but now they’re relying on the dog prototype object to supply that <code class="literal">bark</code> method. We have code reuse, not just by having our code written in one place, but by having all dog instances use the <span class="emphasis"><em>same</em></span> bark method at runtime, which means we aren’t causing lots of runtime overhead.</p><div class="informalfigure"><a id="med_id00933a"></a><div class="mediaobject"><a id="med_id00933"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114178.png.jpg" alt="image with no caption" width="365" height="290"></div></div><p>You’re going to see that by using prototypes, you’ll be able to quickly assemble objects that reuse code, and that can be extended with new behavior and properties.</p></div><div class="sect1" title="Overriding the prototype"><div class="titlepage"><div><div><h1 class="title"><a id="overriding_the_prototype"></a>Overriding the prototype</h1></div></div></div><p><a id="iddle2428" class="indexterm"></a><a id="iddle2718" class="indexterm"></a>Just because you inherit something from the prototype doesn’t mean you’re stuck with it. We can always <span class="emphasis"><em>override</em></span> properties and methods by supplying them in the object instance. That works because JavaScript always looks in the object instance—that is, the specific dog object—for a property <span class="emphasis"><em>before</em></span> it looks in the prototype. So, if you want to use a custom <code class="literal">bark</code> method for <code class="literal">spot</code>, all you have to do is put that custom <code class="literal">bark</code> method in the <code class="literal">spot</code> object. Once you do that, when JavaScript looks for the <code class="literal">bark</code> method to invoke, it will find the method in <code class="literal">spot</code>, and won’t bother looking in the prototype.</p><p>Let’s see what it looks like when we override Spot’s <code class="literal">bark</code> method to give him the ability to have a big “WOOF” bark.</p><div class="informalfigure"><a id="med_id00934a"></a><div class="mediaobject"><a id="med_id00934"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114180.png.jpg" alt="image with no caption" width="342" height="373"></div></div><div class="informalfigure"><a id="med_id00935a"></a><div class="mediaobject"><a id="med_id00935"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114182.png.jpg" alt="image with no caption" width="743" height="527"></div></div><div class="sidebar"><a id="code_magnets-id00226"></a><p class="title">Code Magnets</p><div class="informalfigure"><a id="med_id00936a"></a><div class="mediaobject"><a id="med_id00936"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112316.png.jpg" alt="image with no caption" width="124" height="184"></div></div><p><a id="iddle2419" class="indexterm"></a><a id="iddle2709" class="indexterm"></a>We had an object diagram on the fridge, and then someone came and messed it up. Can you help put it back together? To reassemble it, we need two instances of the robot prototype. One is Robby, created in 1956, owned by Dr. Morbius, has an on/off switch and runs to Starbucks for coffee. We’ve also got Rosie, created in 1962, who cleans house and is owned by George Jetson. Good luck (oh, and there might be some extra magnets below)!</p><div class="informalfigure"><a id="med_id00937a"></a><div class="mediaobject"><a id="med_id00937"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114184.png.jpg" alt="image with no caption" width="736" height="152"></div></div><div class="informalfigure"><a id="med_id00938a"></a><div class="mediaobject"><a id="med_id00938"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114186.png.jpg" alt="image with no caption" width="648" height="256"></div></div></div><div class="sect2" title="So where do you get a prototype?"><div class="titlepage"><div><div><h2 class="title"><a id="so_where_do_you_get_a_prototypequestion"></a>So where do you get a prototype?</h2></div></div></div><p><a id="iddle2427" class="indexterm"></a><a id="iddle2430" class="indexterm"></a><a id="iddle2717" class="indexterm"></a><a id="iddle2720" class="indexterm"></a>We’ve talked a lot about the dog prototype, and at this point, you’re probably ready to see an example that uses code rather than diagrams. So, how do we create or get a hold of a dog prototype? Well, it turns out, you’ve actually had one all along. You just didn’t know it.</p><p>And here’s how you access it in code:</p><div class="informalfigure"><a id="med_id00939a"></a><div class="mediaobject"><a id="med_id00939"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114188.png.jpg" alt="image with no caption" width="518" height="61"></div></div><p>Now, if you take this <code class="literal">prototype</code> property...</p><div class="informalfigure"><a id="med_id00940a"></a><div class="mediaobject"><a id="med_id00940"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114190.png.jpg" alt="image with no caption" width="613" height="557"></div></div><p><span class="strong"><strong>Don’t look at the man behind the curtain!</strong></span> Just kidding; you’re right. We were trying to gloss over that point (and we really still intend to, for now). Here’s the short story: functions are objects in JavaScript. In fact, in JavaScript just about everything is an object underneath, even arrays if you haven’t figured that one out yet.</p><p>But, for now, we don’t want to get sidetracked on this. Just know that functions, in addition to doing everything you already know they can do, can also have properties, and in this case, the constructor always has a <span class="strong"><strong>prototype</strong></span> property. More on functions and other things that are objects later, we promise.</p></div></div><div class="sect1" title="How to set up the prototype"><div class="titlepage"><div><div><h1 class="title"><a id="how_to_set_up_the_prototype"></a>How to set up the prototype</h1></div></div></div><p>As we were saying, you can access the prototype object through the Dog constructor’s <code class="literal">prototype</code> property. But what properties and methods are in the prototype object? Well, until you set it up yourself, not much. In other words it’s your job to add properties and methods to the prototype. We typically do that before we start using the constructor.</p><p>So, let’s set up the dog prototype. First we need a constructor to work from, so let’s look at our object diagram to see how to make that:</p><div class="informalfigure"><a id="med_id00941a"></a><div class="mediaobject"><a id="med_id00941"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114192.png.jpg" alt="image with no caption" width="783" height="204"></div></div><p>Okay, now that we have a constructor, let’s set up our dog prototype. We want it to have the <code class="literal">species</code> property and the <code class="literal">bark</code>, <code class="literal">run</code> and <code class="literal">wag</code> methods. Here’s how we do that:</p><div class="informalfigure"><a id="med_id00942a"></a><div class="mediaobject"><a id="med_id00942"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114194.png.jpg" alt="image with no caption" width="744" height="342"></div></div><div class="note" title="Serious Coding"><h3 class="title"><a id="ch13note05"></a>Serious Coding</h3><p>Don’t forget about chaining:</p><div class="informalfigure"><a id="med_id00943a"></a><div class="mediaobject"><a id="med_id00943"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114196.png.jpg" alt="image with no caption" width="351" height="104"></div></div></div><div class="sect2" title="Test drive the prototype with some dogs"><div class="titlepage"><div><div><h2 class="title"><a id="test_drive_the_prototype_with_some_dogs"></a>Test drive the prototype with some dogs <span class="inlinemediaobject"><a id="inline_id00150"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114198.png.jpg" alt="" width="130" height="51"></span></h2></div></div></div><p>Go ahead and get this code typed into a file (“dog.html”) and loaded into your browser for testing. We’ve reproduced all the code after the changes we made on the previous page, and added a bit of testing code. Make sure all your dogs bark, run and wag like they should.</p><div class="informalfigure"><a id="med_id00944a"></a><div class="mediaobject"><a id="med_id00944"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114200.png.jpg" alt="image with no caption" width="696" height="719"></div></div><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note21a"></a>JavaScript console</h3><div class="blockquote"><blockquote class="blockquote"><p>But wait a second, didn’t Spot want his bark to be WOOF!?</p></blockquote></div><p><span class="strong"><strong><code class="literal">Fido says Woof!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Run!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Wag!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Fluffy says Woof!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Run!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Wag!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Spot says Yip!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Run!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Wag!</code></strong></span></p><div class="blockquote"><blockquote class="blockquote"><p>Each dog is barking, running and wagging. Good.</p></blockquote></div></div><div class="informalfigure"><a id="med_id00945a"></a><div class="mediaobject"><a id="med_id00945"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114202.png.jpg" alt="image with no caption" width="426" height="284"></div></div></div><div class="sect2" title="Give Spot his WOOF! in code"><div class="titlepage"><div><div><h2 class="title"><a id="give_spot_his_woofexclamation_mark_in_co"></a>Give Spot his WOOF! in code</h2></div></div></div><p><a id="iddle2429" class="indexterm"></a><a id="iddle2719" class="indexterm"></a>Don’t worry, we didn’t forget about Spot. Spot requested a bigger WOOF! so we need to override the prototype to give him his own custom <code class="literal">bark</code> method. Let’s update the code:</p><div class="informalfigure"><a id="med_id00946a"></a><div class="mediaobject"><a id="med_id00946"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114204.png.jpg" alt="image with no caption" width="593" height="335"></div></div></div><div class="sect2" title="Test drive the custom bark method"><div class="titlepage"><div><div><h2 class="title"><a id="test_drive_the_custom_bark_method"></a>Test drive the custom bark method <span class="inlinemediaobject"><a id="inline_id00151"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114206.png.jpg" alt="" width="98" height="50"></span></h2></div></div></div><p>Add the new code above and take it for a quick test drive...</p><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note21b"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">Fido says Woof!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Run!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Wag!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Fluffy says Woof!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Run!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Wag!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Spot says WOOF!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Run!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Wag!</code></strong></span></p><div class="blockquote"><blockquote class="blockquote"><p>Spot gets the WOOF! he wanted.</p></blockquote></div></div><div class="sidebar"><a id="exercise-id00227"></a><p class="title">Exercise</p><p><a id="iddle2405" class="indexterm"></a><a id="iddle2695" class="indexterm"></a>Remember our object diagram for the Robby and Rosie robots? We’re going to implement that now. We’ve already written a Robot constructor for you along with some test code. Your job is to set up the robot prototype and to implement the two robots. Make sure you run them through the test code.</p><div class="informalfigure"><a id="med_id00947a"></a><div class="mediaobject"><a id="med_id00947"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114208.png.jpg" alt="image with no caption" width="626" height="615"></div></div></div><div class="informalfigure"><a id="med_id00948a"></a><div class="mediaobject"><a id="med_id00948"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114210.png.jpg" alt="image with no caption" width="585" height="479"></div></div><p><a id="iddle2531" class="indexterm"></a><a id="iddle2865" class="indexterm"></a><span class="strong"><strong>Good question.</strong></span> When we didn’t have prototypes this was easy because we know <code class="literal">this</code> gets set to the object whose method was called. When we are calling the <code class="literal">bark</code> method in the prototype, you might think that <code class="literal">this</code> is now set to the prototype object. Well, that’s not how it works.</p><p>When you call an object’s method, <code class="literal">this</code> is set to the object whose method was called. If the method is not found in that object, and is found in the prototype, that doesn’t change the value of <code class="literal">this</code>. <code class="literal">this</code> always refers to the original object—that is, the object whose method was called—even if the method is in the prototype. So, if we find the <code class="literal">bark</code> method in the prototype, then we call the method, with <code class="literal">this</code> set to the original dog object, giving us the result we want, like “Fluffy says Woof!”.</p></div><div class="sect2" title="Teaching a new trick"><div class="titlepage"><div><div><h2 class="title"><a id="teaching_a_new_trick"></a>Teaching <span class="inlinemediaobject"><a id="inline_id00152"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114212.png.jpg" alt="" width="100" height="80"></span>a new trick</h2></div></div></div><p><a id="iddle2258" class="indexterm"></a><a id="iddle2422" class="indexterm"></a><a id="iddle2712" class="indexterm"></a>It’s time to teach our dogs a new trick. That’s right we said “dogs” plural, not dog. You see, now that we have a prototype, if we add any methods to that prototype, even after we’ve already created dog objects, all dogs inheriting from the prototype immediately and automatically get this new behavior.</p><p>Let’s say we want to teach all our dogs to sit. What we do is add a method to the prototype for sitting.</p><div class="informalfigure"><a id="med_id00949a"></a><div class="mediaobject"><a id="med_id00949"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114214.png.jpg" alt="image with no caption" width="610" height="104"></div></div><p>We’ll give this a try with Barnaby:</p><div class="informalfigure"><a id="med_id00950a"></a><div class="mediaobject"><a id="med_id00950"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114216.png.jpg" alt="image with no caption" width="717" height="116"></div></div><div class="sidebar"><a id="closer_look"></a><p class="title">A Closer Look</p><div class="informalfigure"><a id="med_id00951a"></a><div class="mediaobject"><a id="med_id00951"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112734.png.jpg" alt="image with no caption" width="170" height="130"></div></div><p>Let’s take a closer look at how this works. Make sure you follow the sequence 1, 2, 3, 4.</p><div class="informalfigure"><a id="med_id00952a"></a><div class="mediaobject"><a id="med_id00952"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114218.png.jpg" alt="image with no caption" width="769" height="368"></div></div></div></div></div><div class="sect1" title="Prototypes are dynamic"><div class="titlepage"><div><div><h1 class="title"><a id="prototypes_are_dynamic"></a>Prototypes are dynamic</h1></div></div></div><p><a id="iddle2424" class="indexterm"></a><a id="iddle2426" class="indexterm"></a><a id="iddle2661" class="indexterm"></a><a id="iddle2714" class="indexterm"></a><a id="iddle2716" class="indexterm"></a>We’re glad to see Barnaby can now sit. But it turns out that now <span class="emphasis"><em>all</em></span> our dogs can sit, because once you add a method to a prototype, any objects that inherit from that prototype can make use of that method:</p><div class="note" title="Note"><h3 class="title"><a id="ch13note06"></a>Note</h3><p>This works for properties too, of course.</p></div><div class="informalfigure"><a id="med_id00953a"></a><div class="mediaobject"><a id="med_id00953"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114220.png.jpg" alt="image with no caption" width="811" height="495"></div></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00228"></a><p class="title">There are No Dumb Questions</p><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table border="0" width="100%" summary="Q and A Set"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe1"></a><a id="ch13qa1q1"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: So when I add a new method or property to a prototype, all the object instances that inherit from it immediately see it?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch13qa1q1a1"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> If by “see it” you mean that they inherit that method or property, you are correct. Notice that this gives you a way to extend or change the behavior of all your instances at runtime by simply changing their prototype.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe2"></a><a id="ch13qa1q2"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: I see how adding a new property to a prototype makes that property available to all the objects that inherit from the prototype. What if I</strong></span> <span class="emphasis"><em><span class="strong"><strong>change</strong></span></em></span> <span class="strong"><strong>an existing property in the prototype; does that affect those objects in the same way? Like if I change the property species to “Feline” instead of “Canine”, does that mean all existing dogs are now “Feline” species?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch13qa1q2a2"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Yes. If you change any property in the prototype, it affects all the objects that inherit from that prototype, unless that object has overridden that property.</p></td></tr></tbody></table></div></blockquote></div></div><div class="sidebar"><a id="exercise-id00229"></a><p class="title">Exercise</p><p><a id="iddle2406" class="indexterm"></a><a id="iddle2696" class="indexterm"></a>Robby and Rosie are being used in a Robot game. You’ll find the code for them below. In this game, whenever a player reaches level 42, a new robot capability is unlocked: the laser beam capability. Finish the code below so that at level 42 both Robby and Rosie get their laser beams. Check your answer at the end of the chapter before you go on.</p><a id="pro_id00140"></a><pre class="programlisting"><span class="strong"><strong>function Game() {</strong></span>
    <span class="strong"><strong>this.level = 0;</strong></span>
<span class="strong"><strong>}</strong></span>

<span class="strong"><strong>Game.prototype.play = function() {</strong></span>
    <span class="strong"><strong>// player plays game here</strong></span>
    <span class="strong"><strong>this.level++;</strong></span>
    <span class="strong"><strong>console.log("Welcome to level " + this.level);</strong></span>
    <span class="strong"><strong>this.unlock();</strong></span>
<span class="strong"><strong>};</strong></span>

<span class="strong"><strong>Game.prototype.unlock = function() {</strong></span>





<span class="strong"><strong>};</strong></span>

<span class="strong"><strong>function Robot(name, year, owner) {</strong></span>
    <span class="strong"><strong>this.name = name;</strong></span>
    <span class="strong"><strong>this.year = year;</strong></span>
    <span class="strong"><strong>this.owner = owner;</strong></span>
<span class="strong"><strong>}</strong></span>

<span class="strong"><strong>var game = new Game();</strong></span>
<span class="strong"><strong>var robby = new Robot("Robby", 1956, "Dr. Morbius");</strong></span>
<span class="strong"><strong>var rosie = new Robot("Rosie", 1962, "George Jetson");</strong></span>

<span class="strong"><strong>while (game.level &lt; 42) {</strong></span>
     <span class="strong"><strong>game.play();</strong></span>
<span class="strong"><strong>}</strong></span>

<span class="strong"><strong>robby.deployLaser();</strong></span>
<span class="strong"><strong>rosie.deployLaser();</strong></span></pre><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note07"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">Welcome to level 1</code></strong></span></p><p><span class="strong"><strong><code class="literal">Welcome to level 2</code></strong></span></p><p><span class="strong"><strong><code class="literal">Welcome to level 3</code></strong></span></p><p><span class="strong"><strong><code class="literal">...</code></strong></span></p><p><span class="strong"><strong><code class="literal">Welcome to level 41</code></strong></span></p><p><span class="strong"><strong><code class="literal">Welcome to level 42</code></strong></span></p><p><span class="strong"><strong><code class="literal">Robby is blasting you with laser beams.</code></strong></span></p><p><span class="strong"><strong><code class="literal">Rosie is blasting you with laser beams.</code></strong></span></p><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>A sample of our output. When you finish your code, give it a play and see which robot wins and gets to blast its laser beams!</strong></span></p></blockquote></div></div><div class="informalfigure"><a id="med_id00954a"></a><div class="mediaobject"><a id="med_id00954"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114222.png.jpg" alt="image with no caption" width="600" height="142"></div></div></div></div><div class="sect1" title="A more interesting implementation of the sit method"><div class="titlepage"><div><div><h1 class="title"><a id="more_interesting_implementation_of_the_s"></a>A more interesting implementation of the sit method</h1></div></div></div><p><a id="iddle2259" class="indexterm"></a><a id="iddle2423" class="indexterm"></a><a id="iddle2713" class="indexterm"></a>Let’s make the <code class="literal">sit</code> method a little more interesting: dogs will start in a state of not sitting (in other words, standing up). So, when <code class="literal">sit</code> is called, if a dog isn’t sitting, we’ll make him sit. Otherwise, we’ll let the user know he’s already sitting. To do this we’re going to need an extra property, <code class="literal">sitting</code>, to keep track of whether the dog is sitting or not. Let’s write the code:</p><div class="informalfigure"><a id="med_id00955a"></a><div class="mediaobject"><a id="med_id00955"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114224.png.jpg" alt="image with no caption" width="883" height="392"></div></div><p>The interesting thing about this code is that when a dog instance starts out life, it inherits a default value of false for <code class="literal">sitting</code>. But, as soon as the <code class="literal">sit</code> method is called, the dog instance adds its own value for sitting, which results in a property being created in the instance. This overrides the inherited <code class="literal">sitting</code> property in the prototype. This gives us a way to have a default for all dogs, and then to specialize each dog if we need to.</p><div class="sect2" title="Test drive the new sit method"><div class="titlepage"><div><div><h2 class="title"><a id="test_drive_the_new_sit_method"></a>Test drive the new sit method</h2></div></div></div><p>Let’s give this a try for real. Go ahead and update your code, adding the new property and implementation of <code class="literal">sit</code>. Now when we test drive this code, you can see that we can make <code class="literal">barnaby</code> sit, and then make <code class="literal">spot</code> sit, and each dog keeps track of whether it is sitting separately:</p><div class="informalfigure"><a id="med_id00956a"></a><div class="mediaobject"><a id="med_id00956"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114226.png.jpg" alt="image with no caption" width="505" height="196"></div></div></div></div><div class="sect1" title="One more time: how the sitting property works"><div class="titlepage"><div><div><h1 class="title"><a id="one_more_time_how_the_sitting_property_w"></a>One more time: how the sitting property works</h1></div></div></div><p><a id="iddle2425" class="indexterm"></a><a id="iddle2662" class="indexterm"></a><a id="iddle2715" class="indexterm"></a>Let’s make sure we’ve got this down, because if you go too fast on this implementation you might miss the key details. Here’s the key: the first time we get the value of <code class="literal">sitting</code>, we’re getting it from the prototype. But then when we set <code class="literal">sitting</code> to true, that happens in the object instance, not the prototype. And after that property has been added to the object instance, every subsequent time we get the value of <code class="literal">sitting</code>, we’re getting it from the object instance because it is overriding the value in the prototype. Let’s step through it one more time:</p><div class="informalfigure"><a id="med_id00957a"></a><div class="mediaobject"><a id="med_id00957"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114228.png.jpg" alt="image with no caption" width="795" height="372"></div></div><div class="informalfigure"><a id="med_id00958a"></a><div class="mediaobject"><a id="med_id00958"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114230.png.jpg" alt="image with no caption" width="717" height="381"></div></div><div class="informalfigure"><a id="med_id00959a"></a><div class="mediaobject"><a id="med_id00959"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114232.png.jpg" alt="image with no caption" width="468" height="382"></div></div><p><a id="iddle2008" class="indexterm"></a><a id="iddle2399" class="indexterm"></a><a id="iddle2664" class="indexterm"></a><a id="iddle2689" class="indexterm"></a><span class="strong"><strong>Yes, there is.</strong></span> You can use the <code class="literal">hasOwnProperty</code> method that every object has. The <code class="literal">hasOwnProperty</code> method returns true if a property is defined in an object instance. If it’s not, but you can access that property, then you can assume the property must be defined in the object’s prototype.</p><p>Let’s try it on <code class="literal">fido</code> and <code class="literal">spot</code>. First, we know that the species property is implemented only in the dog prototype, and neither <code class="literal">spot</code> nor <code class="literal">fido</code> has overridden this property. So if we call the <code class="literal">hasOwnProperty</code> method and pass in the property name, “species”, as a string, we get back false for both:</p><div class="informalfigure"><a id="med_id00960a"></a><div class="mediaobject"><a id="med_id00960"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114234.png.jpg" alt="image with no caption" width="538" height="84"></div></div><p>Now let’s try it for the <code class="literal">sitting</code> property. We know that the <code class="literal">sitting</code> property is defined in the prototype and initialized to false. So we assign the value true to <code class="literal">spot.sitting</code>, which overrides the <code class="literal">sitting</code> property in the prototype and defines sitting in the <code class="literal">spot</code> instance. Then we’ll ask both <code class="literal">spot</code> and <code class="literal">fido</code> if they have their own <code class="literal">sitting</code> property defined:</p><div class="informalfigure"><a id="med_id00961a"></a><div class="mediaobject"><a id="med_id00961"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114236.png.jpg" alt="image with no caption" width="512" height="316"></div></div><div class="sidebar"><a id="exercise-id00230"></a><p class="title">Exercise</p><p><a id="iddle2769" class="indexterm"></a>We’ve added a new capability to our robots, Robby and Rosie: they can now report when they have an error through the reportError method. Trace the code below, paying particular attention to where this method gets its error information, and to whether it’s coming from the prototype of the robot instance.</p><p>Below give the output of this code:</p><div class="informalfigure"><a id="med_id00962a"></a><div class="mediaobject"><a id="med_id00962"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114238.png.jpg" alt="image with no caption" width="586" height="586"></div></div></div><div class="sidebar"><a id="best_dog_in_show"></a><p class="title">Best Dog in Show</p><p><a id="iddle1403" class="indexterm"></a><a id="iddle2378" class="indexterm"></a><a id="iddle2437" class="indexterm"></a><a id="iddle2727" class="indexterm"></a>All your hard work in this chapter has already paid off. The Webville Kennel Club saw your work on the dog objects and they immediately knew they’d found the right person to implement their dog show simulator. The only thing is they need you to update the Dog constructor to make show dogs. After all, show dogs aren’t ordinary dogs—they don’t just run, they gait. They don’t go through the trash, they show a tendency towards scent articles; they don’t beg for treats, they show a desire for bait.</p><p>More specifically, here’s what they’re looking for:</p><div class="informalfigure"><a id="med_id00963a"></a><div class="mediaobject"><a id="med_id00963"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114240.png.jpg" alt="image with no caption" width="561" height="529"></div></div></div></div><div class="sect1" title="How to approach the design of the show dogs"><div class="titlepage"><div><div><h1 class="title"><a id="how_to_approach_the_design_of_the_show_d"></a>How to approach the design of the show dogs</h1></div></div></div><p>So how are we going to design this? Clearly we’d like to make use of our existing dog code. After all, that’s why Webville Kennel came to us in the first place. But how? Let’s get some thoughts on the ways we could approach this:</p><div class="informalfigure"><a id="med_id00964a"></a><div class="mediaobject"><a id="med_id00964"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114242.png.jpg" alt="image with no caption" width="816" height="771"></div></div><div class="informalfigure"><a id="med_id00965a"></a><div class="mediaobject"><a id="med_id00965"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114244.png.jpg" alt="image with no caption" width="400" height="503"></div></div><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;More than one prototype? What does that even mean?</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Think about it like your own inheritance.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;What inheritance? If I had an inheritance I wouldn’t be working here! Just kidding...</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Well, you don’t just inherit qualities from your parents, right? You inherit a little from your grandparents and your great-grandparents and so on.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;Yeah, got that.</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Well, with JavaScript you can set up a chain of prototypes that your object inherits from.</p><p title="Frank:"><span class="title"><strong><span class="strong"><strong>Frank:</strong></span></strong></span>&nbsp;An example might help.</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Say you have a bird prototype that knows how to do all things most birds do, like fly.</p><p title="Frank:"><span class="title"><strong><span class="strong"><strong>Frank:</strong></span></strong></span>&nbsp;Easy enough, that’s like our dog prototype.</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Now say you need to implement a whole set of ducks—mallards, red-headed ducks...</p><p><span class="strong"><strong>Frank</strong></span>: ...don’t forget the black-bellied-whistling duck.</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Why, thank you Frank.</p><p title="Frank:"><span class="title"><strong><span class="strong"><strong>Frank:</strong></span></strong></span>&nbsp;No problem. I was just reading about all those ducks in that <span class="emphasis"><em>Head First Design Patterns</em></span> book.</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Okay, but ducks are a different kind of bird. They swim, and we don’t want to put that into the bird prototype. But with JavaScript we can create a duck prototype that inherits from the bird prototype.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;So let me see if I have this right. We’d have a Duck constuctor that points to a duck prototype. But that prototype—that is the duck prototype—would itself point to the bird prototype?</p><p title="Frank:"><span class="title"><strong><span class="strong"><strong>Frank:</strong></span></strong></span>&nbsp;Whoa, shift back into first gear.</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Think of it like this, Frank. Say you create a duck and you call its <code class="literal">fly</code> method. What happens if you look in the duck and there’s no such method? You look in the duck prototype, still no fly method. So you look at the prototype the duck inherits from, bird, and you find <code class="literal">fly</code> there.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;And, if we call <code class="literal">swim</code>, then we look in the duck instance, nothing there. We look in the duck prototype, and we find it.</p><p title="Judy:"><span class="title"><strong><span class="strong"><strong>Judy:</strong></span></strong></span>&nbsp;Right... so we’re not just reusing the behavior of the duck prototype, we’re following a chain up to the bird prototype, when necessary, to use that as well.</p><p title="Joe:"><span class="title"><strong><span class="strong"><strong>Joe:</strong></span></strong></span>&nbsp;That sounds perfect for extending our dog prototype into a show dog. Let see what we can do with this.</p></div><div class="sect1" title="Setting up a chain of prototypes"><div class="titlepage"><div><div><h1 class="title"><a id="setting_up_a_chain_of_prototypes"></a>Setting up a chain of prototypes</h1></div></div></div><p><a id="iddle1289" class="indexterm"></a><a id="iddle1397" class="indexterm"></a><a id="iddle2372" class="indexterm"></a><a id="iddle2398" class="indexterm"></a><a id="iddle2431" class="indexterm"></a><a id="iddle2688" class="indexterm"></a><a id="iddle2721" class="indexterm"></a>Let’s start thinking in terms of a <span class="emphasis"><em>chain of prototypes</em></span>. Rather than having an instance that inherits properties from just one prototype, there might be a chain of one or more prototypes your instance can inherit from. It’s not that big a logical step from the way we’ve been thinking about this already.</p><p>Let’s say we want a show dog prototype for our show dogs, and we want that prototype to rely on our original dog prototype for the <code class="literal">bark</code>, <code class="literal">run</code>, and <code class="literal">wag</code> methods. Let’s set that up to get a feel for how it all works together:</p><div class="informalfigure"><a id="med_id00966a"></a><div class="mediaobject"><a id="med_id00966"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114246.png.jpg" alt="image with no caption" width="727" height="722"></div></div></div><div class="sect1" title="How inheritance works in a prototype chain"><div class="titlepage"><div><div><h1 class="title"><a id="how_inheritance_works_in_a_prototype_cha"></a>How inheritance works in a prototype chain</h1></div></div></div><p><a id="iddle1288" class="indexterm"></a><a id="iddle2078" class="indexterm"></a><a id="iddle2266" class="indexterm"></a><a id="iddle2396" class="indexterm"></a><a id="iddle2400" class="indexterm"></a><a id="iddle2409" class="indexterm"></a><a id="iddle2665" class="indexterm"></a><a id="iddle2668" class="indexterm"></a><a id="iddle2686" class="indexterm"></a><a id="iddle2690" class="indexterm"></a><a id="iddle2699" class="indexterm"></a>We’ve set up the prototype chain for the show dogs, so let’s see how inheritance works in this context. Check out the properties and methods at the bottom of the page, and then trace them up the prototype chain to the object where they are defined.</p><div class="informalfigure"><a id="med_id00967a"></a><div class="mediaobject"><a id="med_id00967"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114248.png.jpg" alt="image with no caption" width="860" height="880"></div></div><div class="sidebar"><a id="code_magnets-id00231"></a><p class="title">Code Magnets</p><div class="informalfigure"><a id="med_id00968a"></a><div class="mediaobject"><a id="med_id00968"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112316.png.jpg" alt="image with no caption" width="124" height="184"></div></div><p>We had another object diagram on the fridge, and then someone came and messed it up. Again!! Can you help put it back together? To reassemble it we need a new line of Space Robots that inherit properties from Robots. These new Space Robots override the Robot’s speaking functionality, and extend Robots with piloting functionality and a new property, homePlanet. Good luck (there might be some extra magnets below)!</p><div class="informalfigure"><a id="med_id00969a"></a><div class="mediaobject"><a id="med_id00969"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114250.png.jpg" alt="image with no caption" width="821" height="418"></div></div><div class="informalfigure"><a id="med_id00970a"></a><div class="mediaobject"><a id="med_id00970"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114252.png.jpg" alt="image with no caption" width="835" height="270"></div></div></div></div><div class="sect1" title="Creating the show dog prototype"><div class="titlepage"><div><div><h1 class="title"><a id="creating_the_show_dog_prototype"></a>Creating the show dog prototype</h1></div></div></div><p><a id="iddle1401" class="indexterm"></a><a id="iddle2081" class="indexterm"></a><a id="iddle2376" class="indexterm"></a><a id="iddle2412" class="indexterm"></a><a id="iddle2435" class="indexterm"></a><a id="iddle2702" class="indexterm"></a><a id="iddle2725" class="indexterm"></a>When we created the dog prototype we didn’t have to do anything—there was already an empty object supplied by the Dog constructor’s <code class="literal">prototype</code> property. So we took that and added the properties and methods we wanted our dog instances to inherit.</p><p>But with the show dog prototype we have more work to do because we need a prototype object that inherits from another prototype (the dog prototype). To do that we’re going to have to create an object that inherits from the dog prototype and then explicitly wire things up ourselves.</p><p>Right now we have a dog prototype and a bunch of dog instances that inherit from that prototype. And what we want is a show dog prototype (that inherits from dog prototype), and a bunch of show dog instances that inherit from the show dog prototype.</p><p>Setting this up will take a few steps, so we’ll take it one at a time.</p><div class="informalfigure"><a id="med_id00971a"></a><div class="mediaobject"><a id="med_id00971"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114254.png.jpg" alt="image with no caption" width="791" height="533"></div></div><div class="sect2" title="First, we need an object that inherits from the dog prototype"><div class="titlepage"><div><div><h2 class="title"><a id="firstcomma_we_need_an_object_that_inheri"></a>First, we need an object that inherits from the dog prototype</h2></div></div></div><p>We’ve established that the show dog prototype is an object that inherits from the dog prototype. But, what’s the best way to create an object that inherits from the dog prototype? Well, it’s something you’ve already been doing as you’ve created instances of dog. Remember? Like this:</p><div class="informalfigure"><a id="med_id00972a"></a><div class="mediaobject"><a id="med_id00972"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114256.png.jpg" alt="image with no caption" width="550" height="134"></div></div><p>So this code creates an object that inherits from the dog prototype. We know this because it’s exactly the same as how we created all our dog instances, except this time, we didn’t supply any arguments to the constructor. That’s because at the moment, we don’t care about the specifics of the dog; we just need the dog to inherit from the dog prototype.</p><div class="informalfigure"><a id="med_id00973a"></a><div class="mediaobject"><a id="med_id00973"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114258.png.jpg" alt="image with no caption" width="728" height="394"></div></div><p>Now, what we really need is a show dog prototype. Like our dog instance, that’s just an object that inherits from the dog prototype. So let’s see how we can use our empty dog instance to make the show dog prototype we need.</p></div><div class="sect2" title="Next, turning our dog instance into a show dog prototype"><div class="titlepage"><div><div><h2 class="title"><a id="nextcomma_turning_our_dog_instance_into"></a>Next, turning our dog instance into a show dog prototype</h2></div></div></div><p>Okay, so we have a dog instance, but how do we make that our show dog prototype object? We do this by assigning the dog instance to the <code class="literal">prototype</code> property of our ShowDog constructor. Oh wait; we don’t have a ShowDog constructor yet... so let’s make one:</p><div class="informalfigure"><a id="med_id00974a"></a><div class="mediaobject"><a id="med_id00974"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114260.png.jpg" alt="image with no caption" width="532" height="138"></div></div><p>Now that we have a constructor, we can set its <code class="literal">prototype</code> property to a new dog instance:</p><div class="informalfigure"><a id="med_id00975a"></a><div class="mediaobject"><a id="med_id00975"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114262.png.jpg" alt="image with no caption" width="718" height="88"></div></div><p>So, let’s think about where we are: we have a ShowDog constructor, with which we can make show dog instances, and we now have a show dog prototype, which is a dog instance.</p><p>Let’s make sure our object diagram accurately reflects the roles these objects are playing by changing the label “Dog” to “ShowDog Prototype”. But keep in mind, the show dog prototype <span class="emphasis"><em>is still a dog instance.</em></span></p><div class="informalfigure"><a id="med_id00976a"></a><div class="mediaobject"><a id="med_id00976"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114264.png.jpg" alt="image with no caption" width="588" height="338"></div></div><p>Now that we’ve got a ShowDog constructor and we’ve set up the show dog prototype object, we need to go back and fill in some details. We’ll take a closer look at the constructor, and we’ve also got some properties and methods to add to the prototype so our show dogs have the additional show dog behavior we want them to have.</p></div><div class="sect2" title="Now it’s time to fill in the prototype"><div class="titlepage"><div><div><h2 class="title"><a id="now_itapostrophes_time_to_fill_in_the_pr"></a>Now it’s time to fill in the prototype</h2></div></div></div><p>We’ve got the show dog prototype set up (which at the moment is just an empty instance of dog). Now, it’s time to fill it with properties and behaviors that will make it look more like a show dog prototype.</p><p>Here are some properties and methods that are specific to show dogs we can add:</p><div class="informalfigure"><a id="med_id00977a"></a><div class="mediaobject"><a id="med_id00977"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114266.png.jpg" alt="image with no caption" width="647" height="475"></div></div><p>With these additions our show dog prototype is starting to look like a show dog. Let’s update our object diagram again, and then it’s probably time to do a big test run of the show dogs. We’re guessing Webville Kennel is going to be pretty excited to see these in action.</p><div class="informalfigure"><a id="med_id00978a"></a><div class="mediaobject"><a id="med_id00978"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114268.png.jpg" alt="image with no caption" width="506" height="315"></div></div></div></div><div class="sect1" title="Creating a show dog instance"><div class="titlepage"><div><div><h1 class="title"><a id="creating_a_show_dog_instance"></a>Creating a show dog instance</h1></div></div></div><p>Now we just have one more thing to do: create an instance of ShowDog. This instance will inherit show dog properties and methods from our show dog prototype, and because our show dog prototype is an instance of Dog, the show dog will also inherit all its doggy behavior and properties from the dog prototype, so he’ll be able to bark and run and wag with the rest of the dogs.</p><p>Here’s all the code so far, and the code to create the instance:</p><div class="informalfigure"><a id="med_id00979a"></a><div class="mediaobject"><a id="med_id00979"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114270.png.jpg" alt="image with no caption" width="425" height="741"></div></div><div class="informalfigure"><a id="med_id00980a"></a><div class="mediaobject"><a id="med_id00980"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114272.png.jpg" alt="image with no caption" width="666" height="601"></div></div><div class="sect2" title="Test drive the show dog"><div class="titlepage"><div><div><h2 class="title"><a id="test_drive_the_show_dog"></a>Test drive the show dog <span class="inlinemediaobject"><a id="inline_id00153"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114274.png.jpg" alt="" width="93" height="36"></span></h2></div></div></div><p>Take all your the code on the previous page, and add to it the quality assurance code below, just to give scotty a good testing. Hey, and while you’re at it, add a few dogs of your own and test them:</p><a id="pro_id00141"></a><pre class="programlisting"><span class="strong"><strong>scotty.stack();</strong></span>
<span class="strong"><strong>scotty.bark();</strong></span>
<span class="strong"><strong>console.log(scotty.league);</strong></span>
<span class="strong"><strong>console.log(scotty.species);</strong></span></pre><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note21c"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">Stack</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty says Yip!</code></strong></span></p><p><span class="strong"><strong><code class="literal">Webville</code></strong></span></p><p><span class="strong"><strong><code class="literal">Canine</code></strong></span></p><div class="blockquote"><blockquote class="blockquote"><p>Here’s what we got.</p></blockquote></div></div><div class="sidebar"><a id="exercise-id00232"></a><p class="title">Exercise</p><p>Your turn. Add a SpaceRobot line of robots to the ObjectsRUs line of robots. These robots should of course be able to do everything that robots can do, plus some extra behavior for space robots. We’ve started the code below, so finish it up and then test it. Check your answer at the end of the chapter before moving on.</p><a id="pro_id00142"></a><pre class="programlisting"><span class="strong"><strong>function SpaceRobot(name, year, owner, homePlanet) {</strong></span>


<span class="strong"><strong>}</strong></span>

<span class="strong"><strong>SpaceRobot.prototype = new ____________;</strong></span>

<span class="strong"><strong>___________________.speak = function() {</strong></span>
    <span class="strong"><strong>alert(this.name + " says Sir, If I may venture an opinion...");</strong></span>
<span class="strong"><strong>};</strong></span>

<span class="strong"><strong>___________________.pilot = function() {</strong></span>
    <span class="strong"><strong>alert(this.name + " says Thrusters? Are they important?");</strong></span>
<span class="strong"><strong>};</strong></span>

<span class="strong"><strong>var c3po = new SpaceRobot("C3PO", 1977, "Luke Skywalker", "Tatooine");</strong></span>
<span class="strong"><strong>c3po.speak();</strong></span>
<span class="strong"><strong>c3po.pilot();</strong></span>
<span class="strong"><strong>console.log(c3po.name + " was made by " + c3po.maker);</strong></span>

<span class="strong"><strong>var simon = new SpaceRobot("Simon", 2009, "Carla Diana", "Earth");</strong></span>
<span class="strong"><strong>simon.makeCoffee();</strong></span>
<span class="strong"><strong>simon.blinkLights();</strong></span>
<span class="strong"><strong>simon.speak();</strong></span></pre></div><div class="sidebar"><a id="exercise-id00233"></a><p class="title">Exercise</p><p><a id="iddle1400" class="indexterm"></a><a id="iddle2375" class="indexterm"></a><a id="iddle2434" class="indexterm"></a><a id="iddle2724" class="indexterm"></a>Let’s take a closer look at all these dogs we’re creating. We’ve tested Fido before and we know he’s truly a dog. But let’s see if he’s a show dog as well (we don’t think he should be). And what about Scotty? We figure he should be a show dog for sure, but is he a dog too? We’re not sure. And we’ll test Fido and Scotty’s constructors while we’re at it...</p><div class="informalfigure"><a id="med_id00981a"></a><div class="mediaobject"><a id="med_id00981"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114276.png.jpg" alt="image with no caption" width="699" height="687"></div></div></div></div><div class="sect2" title="Examining the exercise results"><div class="titlepage"><div><div><h2 class="title"><a id="examining_the_exercise_results"></a>Examining the exercise results</h2></div></div></div><p>Here’s the output from that last test run:</p><div class="informalfigure"><a id="med_id00982a"></a><div class="mediaobject"><a id="med_id00982"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114278.png.jpg" alt="image with no caption" width="838" height="356"></div></div><p>Let’s think about these results for a minute. First, Fido is apparently just a dog and not a show dog—actually, that is totally what we thought would happen; after all, Fido was created with the Dog constructor, which has nothing to do with show dogs.</p><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note22a"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">Fido is a Dog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty is a Dog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty is a ShowDog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Fido constructor is function Dog...</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty constructor is function Dog...</code></strong></span></p></div><p>Next, Scotty is a dog <span class="emphasis"><em>and</em></span> a show dog. That makes sense too, but how did this happen? Well, <span class="strong"><strong>instanceof</strong></span> doesn’t just look at what kind of object you are, it also takes into account all the objects you inherit from. So, Scotty was created as a show dog, but a show dog inherits from a dog, so Scotty is a dog too.</p><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note22b"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">Fido is a Dog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty is a Dog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty is a ShowDog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Fido constructor is function Dog...</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty constructor is function Dog...</code></strong></span></p></div><p>Next up, Fido has a Dog constuctor, and that makes sense, because that is how we created him.</p><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note22c"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">Fido is a Dog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty is a Dog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty is a ShowDog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Fido constructor is function Dog...</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty constructor is function Dog...</code></strong></span></p></div><p>And finally, Scotty has a Dog constructor too. That doesn’t make sense, because Scotty was created by the ShowDog constructor. What’s going on here? Well, first let’s think about where this constructor comes from: we’re looking at the <code class="literal">scotty.constructor</code> property, and this is something we’ve never setup. So we must be inheriting it from the dog prototype (again, because we haven’t explicitly set it up for a show dog).</p><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note22d"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">Fido is a Dog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty is a Dog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty is a ShowDog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Fido constructor is function Dog...</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty constructor is function Dog...</code></strong></span></p></div><p>So why is this happening? Honestly, it’s a loose end that we need to cleanup. You see, if we don’t take care of setting the show dog prototype’s <code class="literal">constructor</code> property, no one else will. Now, keep in mind everything is working fine without it; but not setting it could lead to confusion if you or someone else tries to use <code class="literal">scotty.constructor</code> expecting to get show dog.</p><p>But don’t worry, we’ll fix it.</p></div></div><div class="sect1" title="A final cleanup of show dogs"><div class="titlepage"><div><div><h1 class="title"><a id="final_cleanup_of_show_dogs"></a>A final cleanup of show dogs</h1></div></div></div><p>Our code is just about ready to ship to Webville Kennel, but we need to make one final pass to polish it. There are two small issues to clean up.</p><div class="informalfigure"><a id="med_id00983a"></a><div class="mediaobject"><a id="med_id00983"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114280.png.jpg" alt="image with no caption" width="241" height="296"></div></div><p>The first, we’ve already seen: that instances of ShowDog don’t have their constructor property set correctly. They’re inheriting the Dog constructor property. Now, just to be clear, all our code works fine as is, but setting the right constructor on our objects is a best practice, and some day another developer may end up with your code and be confused when they examine a show dog object.</p><p>To fix the constructor property, we need to make sure it is set up correctly in the show dog prototype. That way, when a show dog is constructed it will inherit the right constructor property. Here’s how we do that:</p><div class="informalfigure"><a id="med_id00984a"></a><div class="mediaobject"><a id="med_id00984"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114282.png.jpg" alt="image with no caption" width="755" height="287"></div></div><div class="sidebar"><a id="exercise-id00234"></a><p class="title">Exercise</p><p>Quickly rerun the tests from the previous exercise and make sure your Scotty show dog instance has the correct constructor.</p><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note23a"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">Fido is a Dog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty is a Dog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty is a ShowDog</code></strong></span></p><p><span class="strong"><strong><code class="literal">Fido constructor is function Dog...</code></strong></span></p><p><span class="strong"><strong><code class="literal">Scotty constructor is function ShowDog...</code></strong></span></p><div class="blockquote"><blockquote class="blockquote"><p>Here’s what we got. Note that Scotty’s constructor is now ShowDog.</p></blockquote></div></div></div><div class="sect2" title="A little more cleanup"><div class="titlepage"><div><div><h2 class="title"><a id="little_more_cleanup"></a>A little more cleanup</h2></div></div></div><p><a id="iddle1280" class="indexterm"></a><a id="iddle1513" class="indexterm"></a><a id="iddle1524" class="indexterm"></a>There’s another place we could use some cleanup: in the ShowDog constructor code. Let’s look again at the constructor:</p><div class="informalfigure"><a id="med_id00985a"></a><div class="mediaobject"><a id="med_id00985"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114284.png.jpg" alt="image with no caption" width="552" height="110"></div></div><p>As you’ve seen in this book, anytime we see duplicated code, the warning bells go off. In this case, the Dog constructor already knows how to do this work, so why not let the constructor do it? Further, while our example has simple code, at times constructors can have complex code to compute initial values for properties, and we don’t want to start reproducing code everytime we create a new constructor that inherits from another prototype. So let’s fix this. We’ll rewrite the code first, and step you through it:</p><div class="note" title="Note"><h3 class="title"><a id="ch13note08"></a>Note</h3><p>This idea of eliminating duplicate code even has an acronym: DRY. “Don’t Repeat Yourself” as all the cool coders say.</p></div><div class="informalfigure"><a id="med_id00986a"></a><div class="mediaobject"><a id="med_id00986"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114286.png.jpg" alt="image with no caption" width="710" height="152"></div></div><p>As you can see we’ve replaced the redundant code in the ShowDog constructor with a call to a method named <code class="literal">Dog.call</code>. Here’s how it works: <code class="literal">call</code> is a builtin method that you can use on any function (and remember Dog is a function). <code class="literal">Dog.call</code> invokes the Dog function and passes it the object to use as <code class="literal">this</code>, along with all the arguments for the Dog function. Let’s break this down:</p><div class="informalfigure"><a id="med_id00987a"></a><div class="mediaobject"><a id="med_id00987"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114288.png.jpg" alt="image with no caption" width="777" height="232"></div></div></div></div><div class="sect1" title="Stepping through Dog.call"><div class="titlepage"><div><div><h1 class="title"><a id="stepping_through_dogdotcall"></a>Stepping through Dog.call</h1></div></div></div><p>Using <code class="literal">Dog.call</code> to call Dog is a bit tricky to wrap your head around so we’ll walk through it again, starting with the reworked code.</p><div class="informalfigure"><a id="med_id00988a"></a><div class="mediaobject"><a id="med_id00988"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114290.png.jpg" alt="image with no caption" width="638" height="186"></div></div><p>Here’s how to think about how this works. First, we call ShowDog with the <code class="literal">new</code> operator. Remember that the <code class="literal">new</code> operator makes a new, empty object, and assigns it to the variable <code class="literal">this</code> in the body of ShowDog.</p><a id="pro_id00143"></a><pre class="programlisting"><span class="strong"><strong>var scotty = <span class="underline">new</span> ShowDog("Scotty", "Scottish Terrier", 15, "Cookie");</strong></span></pre><p>Then, we execute the body of the ShowDog constructor function. The first thing we do is call Dog, using the <code class="literal">call</code> method. That calls Dog, passing in <code class="literal">this</code>, and the <code class="literal">name</code>, <code class="literal">breed</code>, and <code class="literal">weight</code> parameters as arguments.</p><div class="informalfigure"><a id="med_id00989a"></a><div class="mediaobject"><a id="med_id00989"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114292.png.jpg" alt="image with no caption" width="698" height="357"></div></div><p>Once the Dog function completes (and remember, it is not going to return anything because we didn’t call it with <code class="literal">new</code>), we complete the code in ShowDog, assigning the value of the parameter <code class="literal">handler</code> to the <code class="literal">this.handler</code> property. Then, because we used <code class="literal">new</code> to call ShowDog, an instance of ShowDog is returned, complete with its name, breed, weight, and handler.</p><div class="informalfigure"><a id="med_id00990a"></a><div class="mediaobject"><a id="med_id00990"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114294.png.jpg" alt="image with no caption" width="338" height="193"></div></div><div class="sect2" title="The final test drive"><div class="titlepage"><div><div><h2 class="title"><a id="final_test_drive-id00235"></a>The final test drive <span class="inlinemediaobject"><a id="inline_id00154"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114274.png.jpg" alt="" width="93" height="36"></span></h2></div></div></div><div class="informalfigure"><a id="med_id00991a"></a><div class="mediaobject"><a id="med_id00991"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114296.png.jpg" alt="image with no caption" width="373" height="308"></div></div><p>Well done, you’ve created a fantastic design that we’re sure Webville Kennel is going to love. Take all your dogs for one final test run so they can show off all their doggy capabilities.</p><div class="informalfigure"><a id="med_id00992a"></a><div class="mediaobject"><a id="med_id00992"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114298.png.jpg" alt="image with no caption" width="851" height="870"></div></div><div class="sidebar"><a id="there_are_no_dumb_questions-id00236"></a><p class="title">There are No Dumb Questions</p><div class="blockquote"><blockquote class="blockquote"><div class="qandaset" title="Frequently Asked Questions"><table border="0" width="100%" summary="Q and A Set"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa2qe1"></a><a id="ch13qa2q1"></a><p>Q:</p></td><td align="left" valign="top"><p><a id="iddle1398" class="indexterm"></a><a id="iddle2082" class="indexterm"></a><a id="iddle2373" class="indexterm"></a><a id="iddle2413" class="indexterm"></a><a id="iddle2432" class="indexterm"></a><a id="iddle2703" class="indexterm"></a><a id="iddle2722" class="indexterm"></a><span class="strong"><strong>Q: When we made the dog instance we used for the show dog prototype, we called the Dog constructor with no arguments. Why?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch13qa2q1a1"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Because all we need from that dog instance is the fact that it inherits from the dog prototype. That dog instance isn’t a specific dog (like Fido or Fluffy); it’s simply a generic dog instance that inherits from the dog prototype.</p><p>Also, all the dogs that inherit from the show dog prototype define their own name, breed, and weight. So even if that dog instance did have values for those properties, we’d never see them because the show dog instances will always override them.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa2qe2"></a><a id="ch13qa2q2"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: So what happens to those properties in the dog instance we use for the show dog prototype?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch13qa2q2a2"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> They never get assigned values, so they are all undefined.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa2qe3"></a><a id="ch13qa2q3"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: If we never set the ShowDog’s prototype property to a dog instance, what happens?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch13qa2q3a3"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Your show dogs will work fine, but they won’t inherit any behavior from the dog prototype. That means they won’t be able to bark, run, or wag, nor will they have the “Canine” species property. Give it a try yourself. Comment out the line of code where we set ShowDog.prototype to new Dog() and then try making Scotty bark. What happens?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa2qe4"></a><a id="ch13qa2q4"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: Could I create an object literal and use that as the prototype?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch13qa2q4a4"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Yes. You can use any object as the prototype for ShowDog. Of course, if you do that, your show dogs won’t inherit anything from the dog prototype. They’ll inherit the properties and methods you put in your object literal instead.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa2qe5"></a><a id="ch13qa2q5"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: I accidentally put the line of code to assign ShowDog.prototype to the instance of dog below where I created my scotty instance, and my code didn’t work. Why?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch13qa2q5a5"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Because when you create scotty (an instance of ShowDog), it gets the prototype that’s assigned to ShowDog.prototype at the time when you create it. So if you don’t assign the dog instance object to the prototype until after you create scotty, then scotty will have a different object as its prototype (the object you get by default with the ShowDog constructor). And that object doesn’t have any of the Dog prototype’s properties. You should assign the show dog prototype first thing after you create the constructor, but before you add anything to the prototype, or create any instances of ShowDog.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa2qe6"></a><a id="ch13qa2q6"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: If I change a property in the dog prototype, like changing species from “Canine” to “Feline”, will that affect the show dogs I’ve created?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch13qa2q6a6"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Yes, anything you change in the prototype will affect any instances that inherit from that prototype in the chain, no matter how many links you have in your chain.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa2qe7"></a><a id="ch13qa2q7"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: Is there a limit to how long my prototype chains can be?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch13qa2q7a7"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Theoretically, no, but in practice, maybe. The longer your prototype chain, the more work it is to resolve a method or property. That said, runtime systems are often quite good at optimizing these lookups.</p><p>In general, you’re not going to need designs that require that many levels of inheritance. If you do, you’ll probably want to take another look at your design.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa2qe8"></a><a id="ch13qa2q8"></a><p>Q:</p></td><td align="left" valign="top"><p><span class="strong"><strong>Q: What if I have another category of dogs, like competition dogs. Can I create a competition dog prototype that inherits from the same dog prototype as the show dog prototype does?</strong></span></p></td></tr><tr class="answer"><td align="left" valign="top"><a id="ch13qa2q8a8"></a><p>A:</p></td><td align="left" valign="top"><p><span class="strong"><strong>A:</strong></span> Yes, you can. You’ll need to create a separate dog instance to act as your competition dog prototype, but once you’ve done that you’ll be good to go. Just follow the same steps we used here to create the show dog prototype.</p><div class="informalfigure"><a id="med_id00993a"></a><div class="mediaobject"><a id="med_id00993"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114300.png.jpg" alt="image with no caption" width="510" height="581"></div></div></td></tr></tbody></table></div></blockquote></div></div></div></div><div class="sect1" title="The chain doesn’t end at dog"><div class="titlepage"><div><div><h1 class="title"><a id="chain_doesnapostrophet_end_at_dog"></a>The chain doesn’t end at dog</h1></div></div></div><p><a id="iddle2009" class="indexterm"></a><a id="iddle2350" class="indexterm"></a><a id="iddle2351" class="indexterm"></a><a id="iddle2416" class="indexterm"></a><a id="iddle2417" class="indexterm"></a><a id="iddle2706" class="indexterm"></a><a id="iddle2707" class="indexterm"></a><a id="iddle2875" class="indexterm"></a>You’ve already seen a couple of prototype chains—we have the original dog prototype that our dog objects inherit from, and we have the more specialized show dog instances that inherit first from the show dog prototype, and the dog prototype.</p><p>But in both cases, is dog the end of the chain? Actually it isn’t, because dog has its own prototype, Object.</p><p>In fact, every prototype chain you ever create will end in Object. That’s because the default prototype for any instance you create (assuming you don’t change it) is Object.</p><div class="sect2" title="What is Object?"><div class="titlepage"><div><div><h2 class="title"><a id="what_is_objectquestion_mark"></a>What is Object?</h2></div></div></div><p>Think of Object like the primordial object. It’s the object that all objects initially inherit from. And Object implements a few key methods that are a core part of the JavaScript object system. Many of these you won’t use on a daily basis, but there are some methods you’ll see commonly used.</p><p>One of those you’ve already seen in this chapter: <code class="literal">hasOwnProperty</code>, which is inherited by every object (again, because every object ultimately inherits from Object). Remember, <code class="literal">hasOwnProperty</code> is the method we used earlier to determine if a property is in an object instance or in one of its prototypes.</p><p>Another method inherited from Object is the <code class="literal">toString</code> method, which is commonly overridden by instances. This method returns a String representation of any object. We’ll see in a bit how we can override this method to provide a more accurate description of our own objects.</p></div><div class="sect2" title="Object as a prototype"><div class="titlepage"><div><div><h2 class="title"><a id="object_as_a_prototype"></a>Object as a prototype</h2></div></div></div><p>So whether you realized it or not, every object you’ve ever created has had a prototype, and it’s been Object. You can set an object’s prototype to another kind of object, like we did with the show dog prototype, but ultimately, all prototype chains eventually lead to Object.</p><div class="informalfigure"><a id="med_id00994a"></a><div class="mediaobject"><a id="med_id00994"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114302.png.jpg" alt="image with no caption" width="361" height="897"></div></div></div></div><div class="sect1" title="Using inheritance to your advantage... by overriding built-in behavior"><div class="titlepage"><div><div><h1 class="title"><a id="using_inheritance_to_your_advantagehelli"></a>Using inheritance to your advantage... by overriding built-in behavior</h1></div></div></div><p><a id="iddle1267" class="indexterm"></a><a id="iddle1375" class="indexterm"></a><a id="iddle2084" class="indexterm"></a><a id="iddle2352" class="indexterm"></a><a id="iddle2415" class="indexterm"></a><a id="iddle2418" class="indexterm"></a><a id="iddle2451" class="indexterm"></a><a id="iddle2705" class="indexterm"></a><a id="iddle2708" class="indexterm"></a>If you’re inheriting from a built-in object you can override methods in those objects. One common example is the <code class="literal">toString</code> method of Object. All objects inherit from Object, so all objects can use the <code class="literal">toString</code> method to get a simple string representation of any object. For instance, you might use it with <code class="literal">console.log</code> to display your object in the console:</p><a id="pro_id00144"></a><pre class="programlisting"><span class="strong"><strong>function Robot(name, year, owner) {</strong></span>
    <span class="strong"><strong>this.name = name;</strong></span>
    <span class="strong"><strong>this.year = year;</strong></span>
    <span class="strong"><strong>this.owner = owner;</strong></span>
<span class="strong"><strong>}</strong></span>

<span class="strong"><strong>var toy = new Robot("Toy", 2013, "Avary");</strong></span>

<span class="strong"><strong>console.log(toy.toString());</strong></span></pre><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note24"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">[Object object]</code></strong></span></p><div class="blockquote"><blockquote class="blockquote"><p>The toString method we’re inheriting from Object doesn’t do a very good job.</p></blockquote></div></div><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note25"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">Toy Robot belonging to Avary</code></strong></span></p><div class="blockquote"><blockquote class="blockquote"><p>Much better! Now we’re using our own toString method.</p></blockquote></div></div><p>As you can see, the <code class="literal">toString</code> method doesn’t do a very good job of converting the toy robot into a string. So we can override the <code class="literal">toString</code> method and write one that creates a string specifically for Robot objects:</p><a id="pro_id00145"></a><pre class="programlisting"><span class="strong"><strong>function Robot(name, year, owner) {</strong></span>
     <span class="strong"><strong>// same code here</strong></span>
<span class="strong"><strong>}</strong></span>
<span class="gray-background"><span class="strong"><strong>Robot.prototype.toString = function() {                    </strong></span></span>
    <span class="gray-background"><span class="strong"><strong>return this.name + " Robot belonging to " + this.owner;</strong></span></span>
<span class="gray-background"><span class="strong"><strong>};                                                         </strong></span></span>
<span class="strong"><strong>var toy = new Robot("Toy", 2013, "Avary");</strong></span>


<span class="strong"><strong>console.log(toy.toString());</strong></span></pre><p>Notice that the <code class="literal">toString</code> method can be invoked even if you’re not calling it directly yourself. For instance, if you use the + operator to concatenate a string and an object, JavaScript will use the <code class="literal">toString</code> method to convert your object to a string before concatenating it with the other string.</p><div class="informalfigure"><a id="med_id00995a"></a><div class="mediaobject"><a id="med_id00995"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114304.png.jpg" alt="image with no caption" width="393" height="289"></div></div><div class="informalfigure"><a id="med_id00996a"></a><div class="mediaobject"><a id="med_id00996"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114306.png.jpg" alt="image with no caption" width="507" height="99"></div></div><div class="sidebar"><a id="danger_zone-id00237"></a><p class="title">Danger Zone</p><div class="informalfigure"><a id="med_id00997a"></a><div class="mediaobject"><a id="med_id00997"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114058.png.jpg" alt="image with no caption" width="150" height="194"></div></div><p>Once you start overriding properties and methods, it’s easy to get a little carried away. It’s especially important to be careful when overriding properties and methods in built-in objects, because you don’t want to change the behavior of other code that might rely on these properties to do certain things.</p><div class="informalfigure"><a id="med_id00998a"></a><div class="mediaobject"><a id="med_id00998"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114308.png.jpg" alt="image with no caption" width="217" height="400"></div></div><p>So if you’re thinking of overriding properties in Object, read this Safety Guide first. Otherwise, you might end up blowing up your code in unexpected ways. (Translation: you’ll have bugs that are really hard to track down.)</p><p><span class="strong"><strong>DO NOT OVERRIDE</strong></span></p><p>The constructor property points to the constructor function connected to the prototype.</p><div class="informalfigure"><a id="med_id00999a"></a><div class="mediaobject"><a id="med_id00999"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114310.png.jpg" alt="image with no caption" width="670" height="229"></div></div><p><span class="strong"><strong>OKAY TO OVERRIDE</strong></span></p><p>Here are the properties in Object that you can override now that you know your way around prototypes, and know how to override safely:</p><div class="informalfigure"><a id="med_id01000a"></a><div class="mediaobject"><a id="med_id01000"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114312.png.jpg" alt="image with no caption" width="721" height="167"></div></div></div></div><div class="sect1" title="Using inheritance to your advantage... by extending a built-in object"><div class="titlepage"><div><div><h1 class="title"><a id="using_inheritance_to_your_advant-id00238"></a>Using inheritance to your advantage... by extending a built-in object</h1></div></div></div><p><a id="iddle1299" class="indexterm"></a><a id="iddle2070" class="indexterm"></a><a id="iddle2077" class="indexterm"></a><a id="iddle2264" class="indexterm"></a><a id="iddle2403" class="indexterm"></a><a id="iddle2408" class="indexterm"></a><a id="iddle2693" class="indexterm"></a><a id="iddle2698" class="indexterm"></a><a id="iddle2825" class="indexterm"></a>You already know that by adding methods to a prototype, you can add new functionality to all instances of that prototype. This applies not only to your own objects, but also to built-in objects.</p><div class="note" title="Note"><h3 class="title"><a id="ch13note25a"></a>Note</h3><p>Remember that while we usually think of strings as primitive types, they also have an object form. JavaScript takes care of converting a string to an object whenever necessary.</p></div><p>Take the String object for instance—you’ve used String methods like <code class="literal">substring</code> in your code, but what if you want to add your own method so that any instance of String could make use of it? We can use the same technique of extending objects through the prototype on Strings too.</p><p>Let’s say we want to extend the String prototype with a method, <code class="literal">cliche</code>, that returns true if the string contains a known cliché. Here’s how we’d do that:</p><div class="informalfigure"><a id="med_id01001a"></a><div class="mediaobject"><a id="med_id01001"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114314.png.jpg" alt="image with no caption" width="725" height="332"></div></div><p>Now let’s write some code to test the method:</p><div class="informalfigure"><a id="med_id01002a"></a><div class="mediaobject"><a id="med_id01002"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114316.png.jpg" alt="image with no caption" width="660" height="260"></div></div><div class="sect2" title="Test driving the cliché machine"><div class="titlepage"><div><div><h2 class="title"><a id="test_driving_the_clicheacute_machine"></a>Test driving the cliché machine <span class="inlinemediaobject"><a id="inline_id00155"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112336.png.jpg" alt="" width="144" height="47"></span></h2></div></div></div><p>Get the code into a HTML file, open your browser and load it up. Check your console and you should see this output:</p><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note09"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">CLICHE ALERT: Let's touch base in the morning and see where
we are.</code></strong></span></p><p><span class="strong"><strong><code class="literal">CLICHE ALERT: We don't want to open the kimono, we just want to inform them.</code></strong></span></p><div class="blockquote"><blockquote class="blockquote"><p><span class="strong"><strong>Works great. If only we could convince Corporate America to install this code!</strong></span></p></blockquote></div></div><div class="note" title="Watch it!"><h3 class="title"><a id="ch13note10"></a>Watch it!</h3><p><span class="strong"><strong>Be careful when you extend built-in objects like String with your own methods.</strong></span></p><p><span class="emphasis"><em>Make sure the name you choose for your method doesn’t conflict with an existing method in the object. And if you link to other code, be aware of other custom extensions that code may have (and again, watch for name clashes). And finally, some built-in objects aren’t designed to be extended (like Array). So do your homework before you start adding methods to built-in objects.</em></span></p></div><div class="sidebar"><a id="exercise-id00239"></a><p class="title">Exercise</p><p>Your turn. Write a method, palindrome, that returns true if a string reads the same forwards and backwards. (Just one word, don’t worry about palindrome phrases.) Add the method to the String.prototype and test. Check your answer at the end of the chapter.</p></div></div></div><div class="sect1" title="Grand Unified Theory of"><div class="titlepage"><div><div><h1 class="title"><a id="grand_unified_theory_of"></a>Grand Unified Theory of <span class="inlinemediaobject"><a id="inline_id00156"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114318.png.jpg" alt="" width="166" height="73"></span></h1></div></div></div><p><a id="iddle1752" class="indexterm"></a><a id="iddle2139" class="indexterm"></a><a id="iddle2395" class="indexterm"></a><a id="iddle2448" class="indexterm"></a><a id="iddle2494" class="indexterm"></a>Congratulations. You’ve taken on the task of learning an entirely new programming language (maybe your first language) and you’ve done it. Assuming you’ve made it this far, you now know more JavaScript than pretty much everyone.</p><div class="note" title="Note"><h3 class="title"><a id="ch13note11"></a>Note</h3><p>We’re using the logic that about 5.9 billion people don’t know JavaScript at all, and so those who do are pretty much a rounding error, which means you know more JavaScript than just about anyone.</p></div><p>More seriously, if you’ve made it this far in the book, you are well on your way to becoming a JavaScript expert. Now all you need is more experience designing and coding web applications (or any kind of JavaScript application for that matter).</p></div><div class="sect1" title="Better living through objects"><div class="titlepage"><div><div><h1 class="title"><a id="better_living_through_objects"></a>Better living through objects</h1></div></div></div><p>When you’re learning a complex topic like JavaScript, it’s hard to see the forest for the trees. But, once you understand most of JavaScript, it’s easier to step back and check out the forest.</p><p>When you’re learning JavaScript, you learn about pieces of it at a time: you learn about primitives (that can, at any moment, be used like an object), arrays (which kinda act like objects at times), functions (which, oddly, have properties and methods like objects), constructors (which feel like part function, part object) and well... objects themselves. It all seems rather complex.</p><p>Well, with the knowledge you have now, you can sit back, relax, take a cleansing breath, and meditate on the mantra “everything is an object.”</p><p>Because you see, everything <span class="emphasis"><em>is</em></span> an object—oh, sure we have a few primitives, like booleans, numbers and strings, but we already know that we can treat those as objects anytime we need to. We have some built-in types too, like Date, Math and RegEx, but those are just objects too. Even arrays are objects, and as you saw, the only reason they look different is because JavaScript provides some nice “syntactic sugar” we can use to make creating and accessing objects easier. And of course we have objects themselves, with the simplicity of object literals and the power of the prototypal object system.</p><div class="informalfigure"><a id="med_id01003a"></a><div class="mediaobject"><a id="med_id01003"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114320.png.jpg" alt="image with no caption" width="301" height="494"></div></div><p>But what about functions? Are they really objects? Let’s find out:</p><a id="pro_id00146"></a><pre class="programlisting"><span class="strong"><strong>function meditate() {</strong></span>
    <span class="strong"><strong>console.log("Everything is an object...");</strong></span>
<span class="strong"><strong>}</strong></span>
<span class="strong"><strong>alert(meditate instanceof Object);</strong></span></pre><p><a id="iddle2014" class="indexterm"></a>So it’s true: functions are just objects. But, really, this shouldn’t be a big surprise at this point. After all we can assign functions to variables (like objects), pass them as arguments (like objects), return them from functions (like objects), and we’ve even seen they have properties, like this one:</p><div class="informalfigure"><a id="med_id01004a"></a><div class="mediaobject"><a id="med_id01004"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114322.png.jpg" alt="image with no caption" width="253" height="92"></div></div><div class="informalfigure"><a id="med_id01005a"></a><div class="mediaobject"><a id="med_id01005"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114324.png.jpg" alt="image with no caption" width="398" height="218"></div></div><p>And there’s nothing stopping you from adding your own properties to a function should that come in handy. And, by the way, just to bring it all full circle, have you considered that a method is just a property in an object that is set to an anonymous function expression?</p></div><div class="sect1" title="Putting it all together"><div class="titlepage"><div><div><h1 class="title"><a id="putting_it_all_together-id00240"></a>Putting it all together</h1></div></div></div><p>A lot of JavaScript’s power and flexibility comes from the interplay between how we use functions and objects, and the fact that we can treat them as first class values. If you think about the powerful programming concepts we’ve studied—constructors, closures, creating objects with behavior that we can reuse and extend, parameterizing the behavior of functions, and so on—all these techniques have relied on your understanding of advanced objects and functions.</p><p>Well, now you’re in a position to take this all even further...</p></div><div class="sect1" title="What’s next?"><div class="titlepage"><div><div><h1 class="title"><a id="whatapostrophes_nextquestion_mark"></a>What’s next?</h1></div></div></div><p>Now that you’ve got all the fundamentals down, it’s time to take it all further. Now you’re ready to really put your experience to use with the browser and its programming interfaces. You can do that by picking up <span class="emphasis"><em>Head First HTML5 Programming</em></span>, which will take you through how to add geolocation, canvas drawing capabilities, local storage, web workers and more into your applications. But before you put this book down, be sure to read the appendix for a great list of other topics to explore.</p><div class="informalfigure"><a id="med_id01006a"></a><div class="mediaobject"><a id="med_id01006"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114326.png.jpg" alt="image with no caption" width="512" height="466"></div></div><div class="sidebar"><a id="bullet_points-id00241"></a><p class="title">Bullet Points</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>JavaScript’s object system uses <span class="strong"><strong>prototypal inheritance</strong></span>.</p></li><li class="listitem"><p>When you create an instance of an object from a constructor, the instance has its own customized properties and a copy of the methods in the constructor.</p></li><li class="listitem"><p>If you add properties to a constructor’s prototype, all instances created from that constructor <span class="strong"><strong>inherit</strong></span> those properties.</p></li><li class="listitem"><p>Putting properties in a prototype can reduce runtime code duplication in objects.</p></li><li class="listitem"><p>To <span class="strong"><strong>override</strong></span> properties in the prototype, simply add the property to an instance.</p></li><li class="listitem"><p>A constructor function comes with a default <span class="strong"><strong>prototype</strong></span> that you can access with the function’s prototype property.</p></li><li class="listitem"><p>You can assign your own object to the prototype property of a constructor function.</p></li><li class="listitem"><p>If you use your own prototype object, make sure you set the constructor function correctly to the constructor property for consistency.</p></li><li class="listitem"><p>If you add properties to a prototype after you’ve created instances that inherit from it, all the instances will immediately inherit the new properties.</p></li><li class="listitem"><p>Use the <span class="strong"><strong>hasOwnProperty</strong></span> method on an instance to find out if a property is defined in the instance.</p></li><li class="listitem"><p>The method <span class="strong"><strong>call</strong></span> can be used to invoke a function and specify the object to be used as <span class="strong"><strong>this</strong></span> in the body of the function.</p></li><li class="listitem"><p><span class="strong"><strong>Object</strong></span> is the object that all prototypes and instances ultimately inherit from.</p></li><li class="listitem"><p>Object has properties and methods that all objects inherit, like toString and hasOwnProperty.</p></li><li class="listitem"><p>You can override or add properties to builtin objects like Object and String, but take care when doing so as your changes can have far-ranging effects.</p></li><li class="listitem"><p>In JavaScript, almost everything is an object, including functions, arrays, many built-in objects, and all the custom objects you make yourself.</p></li></ul></div></div><div class="informalfigure"><a id="med_id01007a"></a><div class="mediaobject"><a id="med_id01007"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114328.png.jpg" alt="image with no caption" width="1000" height="270"></div></div><div class="sidebar"><a id="code_magnets_solution-id00242"></a><p class="title">Code Magnets Solution</p><div class="informalfigure"><a id="med_id01008a"></a><div class="mediaobject"><a id="med_id01008"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112316.png.jpg" alt="image with no caption" width="124" height="184"></div></div><p><a id="iddle2420" class="indexterm"></a><a id="iddle2710" class="indexterm"></a>We had an object diagram on the fridge, and then someone came and messed it up. Can you help put it back together? To reassemble it, we need two instances of the robot prototype. One is Robby, created in 1956, owned by Dr. Morbius, has an on/off switch and runs to Starbucks for coffee. We’ve also got Rosie, created in 1962, who cleans house and is owned by George Jetson. Good luck (oh, and there might be some extra magnets below)!</p><p>Here’s our solution:</p><div class="informalfigure"><a id="med_id01009a"></a><div class="mediaobject"><a id="med_id01009"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114330.png.jpg" alt="image with no caption" width="560" height="522"></div></div></div><div class="sidebar"><a id="exercise_solution-id00243"></a><p class="title">Exercise Solution</p><p><a id="iddle2407" class="indexterm"></a><a id="iddle2697" class="indexterm"></a>Remember our object diagram for the Robby and Rosie robots? We’re going to implement that now. We’ve already written a Robot constructor for you along with some test code. Your job is to set up the robot prototype and to implement the two robots. Make sure you run them through the test code. Here’s our solution.</p><div class="informalfigure"><a id="med_id01010a"></a><div class="mediaobject"><a id="med_id01010"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114332.png.jpg" alt="image with no caption" width="816" height="769"></div></div><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note25c"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">Robby was made by ObjectsRUs in 1956 and is owned by Dr. Morbius</code></strong></span></p><p><span class="strong"><strong><code class="literal">Rosie was made by ObjectsRUs in 1962 and is owned by George Jetson</code></strong></span></p><div class="blockquote"><blockquote class="blockquote"><p>Here’s our output (plus some alerts we’re not showing).</p></blockquote></div></div></div><div class="sidebar"><a id="exercise_solution-id00244"></a><p class="title">Exercise Solution</p><p>Robby and Rosie are being used in a Robot game. You’ll find the code for them below. In this game, whenever a player reaches level 42, a new robot capability is unlocked: the laser beam capability. Finish the code below so that at level 42 both Robby and Rosie get their laser beams. Here’s our solution.</p><div class="informalfigure"><a id="med_id01011a"></a><div class="mediaobject"><a id="med_id01011"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114334.png.jpg" alt="image with no caption" width="625" height="639"></div></div><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note26"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">Welcome to level 1</code></strong></span></p><p><span class="strong"><strong><code class="literal">Welcome to level 2</code></strong></span></p><p><span class="strong"><strong><code class="literal">Welcome to level 3</code></strong></span></p><p><span class="strong"><strong><code class="literal">...</code></strong></span></p><p><span class="strong"><strong><code class="literal">Welcome to level 41</code></strong></span></p><p><span class="strong"><strong><code class="literal">Welcome to level 42</code></strong></span></p><p><span class="strong"><strong><code class="literal">Robby is blasting you with laser beams.</code></strong></span></p><p><span class="strong"><strong><code class="literal">Rosie is blasting you with laser beams.</code></strong></span></p><div class="blockquote"><blockquote class="blockquote"><p>A sample of our output. When you finish your code, give it a play and see which robot wins and gets to blast its laser beams!</p></blockquote></div></div></div><div class="sidebar"><a id="exercise_solution-id00245"></a><p class="title">Exercise Solution</p><p><a id="iddle2401" class="indexterm"></a><a id="iddle2666" class="indexterm"></a><a id="iddle2691" class="indexterm"></a><a id="iddle2770" class="indexterm"></a>We’ve added a new capability to our robots, Robby and Rosie: they can now report when they have an error through the reportError method. Trace the code below, paying particular attention to where this method gets its error information, and to whether it’s coming from the prototype of the robot instance.</p><p>Here’s our solution.</p><div class="informalfigure"><a id="med_id01012a"></a><div class="mediaobject"><a id="med_id01012"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114336.png.jpg" alt="image with no caption" width="805" height="751"></div></div></div><div class="sidebar"><a id="code_magnets_solution-id00246"></a><p class="title">Code Magnets Solution</p><div class="informalfigure"><a id="med_id01013a"></a><div class="mediaobject"><a id="med_id01013"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2112316.png.jpg" alt="image with no caption" width="124" height="184"></div></div><p><a id="iddle1399" class="indexterm"></a><a id="iddle2079" class="indexterm"></a><a id="iddle2267" class="indexterm"></a><a id="iddle2374" class="indexterm"></a><a id="iddle2397" class="indexterm"></a><a id="iddle2410" class="indexterm"></a><a id="iddle2433" class="indexterm"></a><a id="iddle2669" class="indexterm"></a><a id="iddle2687" class="indexterm"></a><a id="iddle2700" class="indexterm"></a><a id="iddle2723" class="indexterm"></a>We had another object diagram on the fridge, and then someone came and messed it up. Again!! Can you help put it back together? To reassemble it we need a new line of Space Robots that inherit properties from Robots. These new Space Robots override the Robot’s speaking functionality, and extend Robots with piloting functionality and a new property, homePlanet. Here’s our solution.</p><div class="informalfigure"><a id="med_id01014a"></a><div class="mediaobject"><a id="med_id01014"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114338.png.jpg" alt="image with no caption" width="779" height="695"></div></div></div><div class="sidebar"><a id="exercise_solution-id00247"></a><p class="title">Exercise Solution</p><p><a id="iddle1402" class="indexterm"></a><a id="iddle2083" class="indexterm"></a><a id="iddle2377" class="indexterm"></a><a id="iddle2414" class="indexterm"></a><a id="iddle2436" class="indexterm"></a><a id="iddle2704" class="indexterm"></a><a id="iddle2726" class="indexterm"></a>Your turn. Add a SpaceRobot line of robots to the ObjectsRUs line of robots. These robots should of course be able to do everything that robots can do, plus some extra behavior for space robots. We’ve started the code below, so finish it up and then test it. Here’s our solution.</p><div class="informalfigure"><a id="med_id01015a"></a><div class="mediaobject"><a id="med_id01015"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114340.png.jpg" alt="image with no caption" width="763" height="709"></div></div><div class="note" title="JavaScript console"><h3 class="title"><a id="ch13note27"></a>JavaScript console</h3><p><span class="strong"><strong><code class="literal">C3PO was made by ObjectsRUs</code></strong></span></p><div class="blockquote"><blockquote class="blockquote"><p>Here’s our output (plus some alerts we’re not showing).</p></blockquote></div></div></div><div class="sidebar"><a id="exercise_solution-id00248"></a><p class="title">Exercise Solution</p><p><a id="iddle2265" class="indexterm"></a><a id="iddle2404" class="indexterm"></a><a id="iddle2694" class="indexterm"></a><a id="iddle2826" class="indexterm"></a>Your turn. Write a method, palindrome, that returns true if a string reads the same forward and backward. Add the method to the String.prototype and test. Here’s our solution (for one word palindromes only).</p><div class="informalfigure"><a id="med_id01016a"></a><div class="mediaobject"><a id="med_id01016"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114342.png.jpg" alt="image with no caption" width="807" height="561"></div></div><div class="note" title="Super Advanced Solution"><h3 class="title"><a id="ch13note12"></a>Super Advanced Solution</h3><div class="informalfigure"><a id="med_id01017a"></a><div class="mediaobject"><a id="med_id01017"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114344.png.jpg" alt="image with no caption" width="797" height="223"></div></div></div></div><div class="informalfigure"><a id="med_id01018a"></a><div class="mediaobject"><a id="med_id01018"></a><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781449340124/files/httpatomoreillycomsourceoreillyimages2114346.png.jpg" alt="image with no caption" width="526" height="548"></div></div><p><span class="strong"><strong>Congratulations!</strong></span></p><p><span class="strong"><strong>You made it to the end.</strong></span></p><p><span class="strong"><strong>Of course, there’s still an appendix.</strong></span></p><p><span class="strong"><strong>And the index.</strong></span></p><p><span class="strong"><strong>And the colophon.</strong></span></p><p><span class="strong"><strong>And then there’s the website...</strong></span></p><p><span class="strong"><strong>There’s no escape, really.</strong></span></p></div></div></div></div><link rel="stylesheet" href="/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="/api/v2/epubs/urn:orm:book:9781449340124/files/core.css" crossorigin="anonymous"></div></div></section>
</div>

https://learning.oreilly.com