<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
</style>
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 11. The JavaScript Standard Library"><div class="chapter" id="builtintypes">
        <h1><span class="label">Chapter 11. </span>The JavaScript Standard Library</h1>
        
        
        <p>Some<a data-type="indexterm" data-primary="JavaScript standard library" data-secondary="overview of" id="idm46198529057304"></a><a data-type="indexterm" data-primary="standard library" data-see="JavaScript standard library" id="idm46198529056328"></a> datatypes, such as numbers and strings (<a data-type="xref" href="ch03.html#datatypes">Chapter&nbsp;3</a>), objects
        (<a data-type="xref" href="ch06.html#objects">Chapter&nbsp;6</a>), and arrays (<a data-type="xref" href="ch07.html#arrays">Chapter&nbsp;7</a>) are so fundamental to JavaScript
        that we can consider them to be part of the language itself. This
        chapter covers other important but less fundamental APIs that can be
        thought of as defining the “standard library” for JavaScript: these
        are useful classes and functions that are built in to JavaScript and
        available to all JavaScript programs in both web browsers and in
        Node.<sup><a data-type="noteref" id="idm46198529052360-marker" href="ch11.html#idm46198529052360">1</a></sup></p>
        
        <p>The sections of this chapter are independent of one another, and you
        can read them in any order. They cover:</p>
        
        <ul>
        <li>
        <p>The Set and Map classes for representing sets of values and mappings
        from one set of values to another set of values.</p>
        </li>
        <li>
        <p>Array-like objects known as TypedArrays that represent arrays of
        binary data, along with a related class for extracting values from
        non-array binary data.</p>
        </li>
        <li>
        <p>Regular expressions and the RegExp class, which define textual
        patterns and are useful for text processing. This section also
        covers regular expression syntax in detail.</p>
        </li>
        <li>
        <p>The Date class for representing and manipulating dates and times.</p>
        </li>
        <li>
        <p>The Error class and its various subclasses, instances of which are
        thrown when errors occur in JavaScript programs.</p>
        </li>
        <li>
        <p>The JSON object, whose methods support serialization and
        deserialization of JavaScript data structures composed of objects,
        arrays, strings, numbers, and <span class="keep-together">booleans.</span></p>
        </li>
        <li>
        <p>The Intl object and the classes it defines that can help you
        localize your JavaScript programs.</p>
        </li>
        <li>
        <p>The Console object, whose methods output strings in ways that are
        particularly useful for debugging programs and logging the behavior
        of those programs.</p>
        </li>
        <li>
        <p>The URL class, which simplifies the task of parsing and manipulating
        URLs. This section also covers global functions for encoding and
        decoding URLs and their component parts.</p>
        </li>
        <li>
        <p><code>setTimeout()</code> and related functions for specifying code to be
        executed after a specified interval of time has elapsed.</p>
        </li>
        </ul>
        
        <p>Some of the sections in this chapter—notably, the sections on typed
        arrays and regular expressions—are quite long because there is
        significant background information you need to understand before you
        can use those types effectively. Many of the other sections, however,
        are short: they simply introduce a new API and show some examples of
        its use.</p>
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="11.1 Sets and Maps"><div class="sect1" id="setsandmaps">
        <h1>11.1 Sets and Maps</h1>
        
        <p>JavaScript’s<a data-type="indexterm" data-primary="sets and maps" data-secondary="overview of" id="idm46198529009544"></a><a data-type="indexterm" data-primary="JavaScript standard library" data-secondary="sets and maps" id="JSLset11"></a> Object type is a versatile data structure that can be
        used to map strings (the object’s property names) to arbitrary
        values. And when the value being mapped to is something fixed like
        <code>true</code>, then the object is effectively a set of strings.</p>
        
        <p>Objects are actually used as maps and sets fairly routinely in
        JavaScript programming, but this is limited by the restriction to
        strings and complicated by the fact that objects normally inherit
        properties with names like “toString”, which are not typically intended
        to be part of the map or set.</p>
        
        <p>For this reason, ES6 introduces true Set and Map classes, which we’ll cover
        in the sub-sections that follow.</p>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.1.1 The Set Class"><div class="sect2" id="setclass">
        <h2>11.1.1 The Set Class</h2>
        
        <p>A<a data-type="indexterm" data-primary="Set class" id="set11"></a><a data-type="indexterm" data-primary="sets and maps" data-secondary="Set class" id="SMset11"></a><a data-type="indexterm" data-primary="sets and maps" data-secondary="definition of sets" id="idm46198529000920"></a> set is a collection of values, like an array is. Unlike arrays,
        however, sets are not ordered or indexed, and they do not allow
        duplicates: a value is either a member of a set or it is not a member;
        it is not possible to ask how many times a value appears in a set.</p>
        
        <p>Create<a data-type="indexterm" data-primary="constructors" data-secondary="Set() constructor" id="idm46198528999144"></a><a data-type="indexterm" data-primary="Set() constructor" id="idm46198528998136"></a> a Set object with the <code>Set()</code> constructor:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">s</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Set</code><code class="p">();</code>       <code class="c1">// A new, empty set</code>
        <code class="kd">let</code> <code class="nx">t</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Set</code><code class="p">([</code><code class="mi">1</code><code class="p">,</code> <code class="nx">s</code><code class="p">]);</code> <code class="c1">// A new set with two members</code></pre>
        
        <p>The argument to the <code>Set()</code> constructor need not be an array: any
        iterable object (including other Set objects) is allowed:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">t</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Set</code><code class="p">(</code><code class="nx">s</code><code class="p">);</code>                  <code class="c1">// A new set that copies the elements of s.</code>
        <code class="kd">let</code> <code class="nx">unique</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Set</code><code class="p">(</code><code class="s2">"Mississippi"</code><code class="p">);</code> <code class="c1">// 4 elements: "M", "i", "s", and "p"</code></pre>
        
        <p>The <code>size</code> property of a set is like the <code>length</code> property of an
        array: it tells you how many values the set contains:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="nx">unique</code><code class="p">.</code><code class="nx">size</code>        <code class="c1">// =&gt; 4</code></pre>
        
        <p>Sets don’t need to be initialized when you create them. You can add
        and remove elements at any time with <code>add()</code>, <code>delete()</code>, and
        <code>clear()</code>. Remember that sets cannot contain duplicates, so adding a
        value to a set when it already contains that value has no effect:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">s</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Set</code><code class="p">();</code>  <code class="c1">// Start empty</code>
        <code class="nx">s</code><code class="p">.</code><code class="nx">size</code>              <code class="c1">// =&gt; 0</code>
        <code class="nx">s</code><code class="p">.</code><code class="nx">add</code><code class="p">(</code><code class="mi">1</code><code class="p">);</code>           <code class="c1">// Add a number</code>
        <code class="nx">s</code><code class="p">.</code><code class="nx">size</code>              <code class="c1">// =&gt; 1; now the set has one member</code>
        <code class="nx">s</code><code class="p">.</code><code class="nx">add</code><code class="p">(</code><code class="mi">1</code><code class="p">);</code>           <code class="c1">// Add the same number again</code>
        <code class="nx">s</code><code class="p">.</code><code class="nx">size</code>              <code class="c1">// =&gt; 1; the size does not change</code>
        <code class="nx">s</code><code class="p">.</code><code class="nx">add</code><code class="p">(</code><code class="kc">true</code><code class="p">);</code>        <code class="c1">// Add another value; note that it is fine to mix types</code>
        <code class="nx">s</code><code class="p">.</code><code class="nx">size</code>              <code class="c1">// =&gt; 2</code>
        <code class="nx">s</code><code class="p">.</code><code class="nx">add</code><code class="p">([</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">]);</code>     <code class="c1">// Add an array value</code>
        <code class="nx">s</code><code class="p">.</code><code class="nx">size</code>              <code class="c1">// =&gt; 3; the array was added, not its elements</code>
        <code class="nx">s</code><code class="p">.</code><code class="k">delete</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>         <code class="c1">// =&gt; true: successfully deleted element 1</code>
        <code class="nx">s</code><code class="p">.</code><code class="nx">size</code>              <code class="c1">// =&gt; 2: the size is back down to 2</code>
        <code class="nx">s</code><code class="p">.</code><code class="k">delete</code><code class="p">(</code><code class="s2">"test"</code><code class="p">)</code>    <code class="c1">// =&gt; false: "test" was not a member, deletion failed</code>
        <code class="nx">s</code><code class="p">.</code><code class="k">delete</code><code class="p">(</code><code class="kc">true</code><code class="p">)</code>      <code class="c1">// =&gt; true: delete succeeded</code>
        <code class="nx">s</code><code class="p">.</code><code class="k">delete</code><code class="p">([</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">])</code>   <code class="c1">// =&gt; false: the array in the set is different</code>
        <code class="nx">s</code><code class="p">.</code><code class="nx">size</code>              <code class="c1">// =&gt; 1: there is still that one array in the set</code>
        <code class="nx">s</code><code class="p">.</code><code class="nx">clear</code><code class="p">();</code>          <code class="c1">// Remove everything from the set</code>
        <code class="nx">s</code><code class="p">.</code><code class="nx">size</code>              <code class="c1">// =&gt; 0</code></pre>
        
        <p>There are a few important points to note about this code:</p>
        
        <ul>
        <li>
        <p>The <code>add()</code> method takes a single argument; if you pass an array, it
        adds the array itself to the set, not the individual array
        elements. <code>add()</code> always returns the set it is invoked on, however,
        so if you want to add multiple values to a set, you can used chained
        method calls like <code>s.add('a').add('b').add('c');</code>.</p>
        </li>
        <li>
        <p>The <code>delete()</code> method also only deletes a single set element at a
        time. Unlike <code>add()</code>, however, <code>delete()</code> returns a boolean value. If
        the value you specify was actually a member of the set, then
        <code>delete()</code> removes it and returns <code>true</code>. Otherwise, it does nothing
        and returns <code>false</code>.</p>
        </li>
        <li>
        <p>Finally, it is very important to understand that set membership is
        based on strict equality checks, like the <code>===</code> operator
        performs. A set can contain both the number <code>1</code> and the string
        <code>"1"</code>, because it considers them to be distinct values. When the
        values are objects (or arrays or functions), they are also compared
        as if with <code>===</code>. This is why we were unable to delete the array
        element from the set in this code. We added an array to the
        set and then tried to remove that array by passing a
        <em>different</em> array (albeit with the same elements) to the <code>delete()</code>
        method. In order for this to work, we would have had to pass a
        reference to exactly the same array.</p>
        </li>
        </ul>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>Python programmers take note: this is a significant difference between JavaScript and
          Python sets. Python sets compare members for equality, not identity,
          but the trade-off is that Python sets only allow immutable members,
          like tuples, and do not allow lists and dicts to be added to sets.</p>
        </div>
        
        <p>In practice, the most important thing we do with sets is not to add
        and remove elements from them, but to check to see whether a specified
        value is a member of the set. We do this with the <code>has()</code> method:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">oneDigitPrimes</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Set</code><code class="p">([</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">,</code><code class="mi">5</code><code class="p">,</code><code class="mi">7</code><code class="p">]);</code>
        <code class="nx">oneDigitPrimes</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code>    <code class="c1">// =&gt; true: 2 is a one-digit prime number</code>
        <code class="nx">oneDigitPrimes</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="mi">3</code><code class="p">)</code>    <code class="c1">// =&gt; true: so is 3</code>
        <code class="nx">oneDigitPrimes</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code>    <code class="c1">// =&gt; false: 4 is not a prime</code>
        <code class="nx">oneDigitPrimes</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="s2">"5"</code><code class="p">)</code>  <code class="c1">// =&gt; false: "5" is not even a number</code></pre>
        
        <p>The most important thing to understand about sets is that they are
        optimized for membership testing, and no matter how many members the
        set has, the <code>has()</code> method will be very fast. The <code>includes()</code> method
        of an array also performs membership testing, but the time it takes is
        proportional to the size of the array, and using an array as a set can
        be much, much slower than using a real Set object.</p>
        
        <p>The Set class is iterable, which means that you can use a <code>for/of</code>
        loop to enumerate all of the elements of a set:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">sum</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>
        <code class="k">for</code><code class="p">(</code><code class="kd">let</code> <code class="nx">p</code> <code class="k">of</code> <code class="nx">oneDigitPrimes</code><code class="p">)</code> <code class="p">{</code> <code class="c1">// Loop through the one-digit primes</code>
            <code class="nx">sum</code> <code class="o">+=</code> <code class="nx">p</code><code class="p">;</code>                  <code class="c1">// and add them up</code>
        <code class="p">}</code>
        <code class="nx">sum</code>                            <code class="c1">// =&gt; 17: 2 + 3 + 5 + 7</code></pre>
        
        <p>Because Set objects are iterable, you can convert them to arrays and
        argument lists with the <code>...</code> spread operator:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="p">[...</code><code class="nx">oneDigitPrimes</code><code class="p">]</code>         <code class="c1">// =&gt; [2,3,5,7]: the set converted to an Array</code>
        <code class="nb">Math</code><code class="p">.</code><code class="nx">max</code><code class="p">(...</code><code class="nx">oneDigitPrimes</code><code class="p">)</code> <code class="c1">// =&gt; 7: set elements passed as function arguments</code></pre>
        
        <p>Sets are often described as “unordered collections.” This isn’t
        exactly true for the JavaScript Set class, however. A JavaScript set
        is unindexed: you can’t ask for the first or third element of a set
        the way you can with an array. But the JavaScript Set class always
        remembers the order that elements were inserted in, and it
        always uses this order when you iterate a set: the first element
        inserted will be the first one iterated (assuming you haven’t deleted
        it first), and the most recently inserted element will be the last one
        iterated.<sup><a data-type="noteref" id="idm46198528676184-marker" href="ch11.html#idm46198528676184">2</a></sup></p>
        
        <p>In addition to being iterable, the Set class also implements a
        <code>forEach()</code> method that is similar to the array method of the same name:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">product</code> <code class="o">=</code> <code class="mi">1</code><code class="p">;</code>
        <code class="nx">oneDigitPrimes</code><code class="p">.</code><code class="nx">forEach</code><code class="p">(</code><code class="nx">n</code> <code class="o">=&gt;</code> <code class="p">{</code> <code class="nx">product</code> <code class="o">*=</code> <code class="nx">n</code><code class="p">;</code> <code class="p">});</code>
        <code class="nx">product</code>     <code class="c1">// =&gt; 210: 2 * 3 * 5 * 7</code></pre>
        
        <p>The <code>forEach()</code> of an array passes array indexes as the second
        argument to the function you specify. Sets don’t have indexes, so the
        Set class’s version of this method simply passes the element value as
        both the first and second argument.<a data-type="indexterm" data-primary="" data-startref="SMset11" id="idm46198528560392"></a><a data-type="indexterm" data-primary="" data-startref="set11" id="idm46198528559512"></a></p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.1.2 The Map Class"><div class="sect2" id="mapclass">
        <h2>11.1.2 The Map Class</h2>
        
        <p>A<a data-type="indexterm" data-primary="Map class" id="mapclass11"></a><a data-type="indexterm" data-primary="sets and maps" data-secondary="Map class" id="SMmap11"></a> Map object represents a set of values known as <em>keys</em>, where each key
        has another value associated with (or “mapped to”) it. In a sense, a
        map is like an array, but instead of using a set of sequential
        integers as the keys, maps allow us to use arbitrary values as
        “indexes.” Like arrays, maps are fast: looking up the value associated
        with a key will be fast (though not as fast as indexing an array) no
        matter how large the <span class="keep-together">map is.</span></p>
        
        <p>Create a new map with the <code>Map()</code> constructor:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">m</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Map</code><code class="p">();</code>  <code class="c1">// Create a new, empty map</code>
        <code class="kd">let</code> <code class="nx">n</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Map</code><code class="p">([</code>   <code class="c1">// A new map initialized with string keys mapped to numbers</code>
            <code class="p">[</code><code class="s2">"one"</code><code class="p">,</code> <code class="mi">1</code><code class="p">],</code>
            <code class="p">[</code><code class="s2">"two"</code><code class="p">,</code> <code class="mi">2</code><code class="p">]</code>
        <code class="p">]);</code></pre>
        
        <p>The optional argument to the <code>Map()</code> constructor should be an iterable
        object that yields two element <code>[key, value]</code> arrays. In practice,
        this means that if you want to initialize a map when you create it,
        you’ll typically write out the desired keys and associated values as
        an array of arrays. But you can also use the <code>Map()</code> constructor to
        copy other maps or to copy the property names and values from an
        existing object:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">copy</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Map</code><code class="p">(</code><code class="nx">n</code><code class="p">);</code> <code class="c1">// A new map with the same keys and values as map n</code>
        <code class="kd">let</code> <code class="nx">o</code> <code class="o">=</code> <code class="p">{</code> <code class="nx">x</code><code class="o">:</code> <code class="mi">1</code><code class="p">,</code> <code class="nx">y</code><code class="o">:</code> <code class="mi">2</code><code class="p">};</code> <code class="c1">// An object with two properties</code>
        <code class="kd">let</code> <code class="nx">p</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Map</code><code class="p">(</code><code class="nb">Object</code><code class="p">.</code><code class="nx">entries</code><code class="p">(</code><code class="nx">o</code><code class="p">));</code> <code class="c1">// Same as new map([["x", 1], ["y", 2]])</code></pre>
        
        <p>Once you have created a Map object, you can query the value associated
        with a given key with <code>get()</code> and can add a new key/value pair with
        <code>set()</code>. Remember, though, that a map is a set of keys, each of which
        has an associated value. This is not quite the same as a set of
        key/value pairs. If you call <code>set()</code> with a key that already exists in
        the map, you will change the value associated with that key, not add a
        new key/value mapping. In addition to <code>get()</code> and <code>set()</code>, the Map
        class also defines methods that are like Set methods: use <code>has()</code> to
        check whether a map includes the specified key; use <code>delete()</code> to
        remove a key (and its associated value) from the map; use <code>clear()</code> to
        remove all key/value pairs from the map; and use the <code>size</code> property
        to find out how many keys a map contains.</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">m</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Map</code><code class="p">();</code>   <code class="c1">// Start with an empty map</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">size</code>               <code class="c1">// =&gt; 0: empty maps have no keys</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s2">"one"</code><code class="p">,</code> <code class="mi">1</code><code class="p">);</code>     <code class="c1">// Map the key "one" to the value 1</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s2">"two"</code><code class="p">,</code> <code class="mi">2</code><code class="p">);</code>     <code class="c1">// And the key "two" to the value 2.</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">size</code>               <code class="c1">// =&gt; 2: the map now has two keys</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"two"</code><code class="p">)</code>         <code class="c1">// =&gt; 2: return the value associated with key "two"</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"three"</code><code class="p">)</code>       <code class="c1">// =&gt; undefined: this key is not in the set</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s2">"one"</code><code class="p">,</code> <code class="kc">true</code><code class="p">);</code>  <code class="c1">// Change the value associated with an existing key</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">size</code>               <code class="c1">// =&gt; 2: the size doesn't change</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="s2">"one"</code><code class="p">)</code>         <code class="c1">// =&gt; true: the map has a key "one"</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="kc">true</code><code class="p">)</code>          <code class="c1">// =&gt; false: the map does not have a key true</code>
        <code class="nx">m</code><code class="p">.</code><code class="k">delete</code><code class="p">(</code><code class="s2">"one"</code><code class="p">)</code>      <code class="c1">// =&gt; true: the key existed and deletion succeeded</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">size</code>               <code class="c1">// =&gt; 1</code>
        <code class="nx">m</code><code class="p">.</code><code class="k">delete</code><code class="p">(</code><code class="s2">"three"</code><code class="p">)</code>    <code class="c1">// =&gt; false: failed to delete a nonexistent key</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">clear</code><code class="p">();</code>           <code class="c1">// Remove all keys and values from the map</code></pre>
        
        <p>Like the <code>add()</code> method of Set, the <code>set()</code> method of Map can be
        chained, which allows maps to be initialized without using arrays of
        arrays:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">m</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Map</code><code class="p">().</code><code class="nx">set</code><code class="p">(</code><code class="s2">"one"</code><code class="p">,</code> <code class="mi">1</code><code class="p">).</code><code class="nx">set</code><code class="p">(</code><code class="s2">"two"</code><code class="p">,</code> <code class="mi">2</code><code class="p">).</code><code class="nx">set</code><code class="p">(</code><code class="s2">"three"</code><code class="p">,</code> <code class="mi">3</code><code class="p">);</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">size</code>        <code class="c1">// =&gt; 3</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"two"</code><code class="p">)</code>  <code class="c1">// =&gt; 2</code></pre>
        
        <p>As with Set, any JavaScript value can be used as a key or a value in a
        Map. This includes <code>null</code>, <code>undefined</code>, and <code>NaN</code>, as well as reference
        types like objects and arrays. And as with the Set class, Map compares
        keys by identity, not by equality, so if you use an object or array as
        a key, it will be considered different from every other object and
        array, even those with exactly the same properties or elements:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">m</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Map</code><code class="p">();</code>   <code class="c1">// Start with an empty map.</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">set</code><code class="p">({},</code> <code class="mi">1</code><code class="p">);</code>        <code class="c1">// Map one empty object to the number 1.</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">set</code><code class="p">({},</code> <code class="mi">2</code><code class="p">);</code>        <code class="c1">// Map a different empty object to the number 2.</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">size</code>               <code class="c1">// =&gt; 2: there are two keys in this map</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">get</code><code class="p">({})</code>            <code class="c1">// =&gt; undefined: but this empty object is not a key</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="nx">m</code><code class="p">,</code> <code class="kc">undefined</code><code class="p">);</code> <code class="c1">// Map the map itself to the value undefined.</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="nx">m</code><code class="p">)</code>             <code class="c1">// =&gt; true: m is a key in itself</code>
        <code class="nx">m</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="nx">m</code><code class="p">)</code>             <code class="c1">// =&gt; undefined: same value we'd get if m wasn't a key</code></pre>
        
        <p>Map objects<a data-type="indexterm" data-primary="Map objects" id="idm46198528192600"></a> are iterable, and each iterated value is a two-element
        array where the first element is a key and the second element is the
        value associated with that key. If you use the spread operator with a
        Map object, you’ll get an array of arrays like the ones that we passed
        to the <code>Map()</code> constructor. And when iterating a map with a <code>for/of</code>
        loop, it is idiomatic to use destructuring assignment to assign the
        key and value to separate variables:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">m</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Map</code><code class="p">([[</code><code class="s2">"x"</code><code class="p">,</code> <code class="mi">1</code><code class="p">],</code> <code class="p">[</code><code class="s2">"y"</code><code class="p">,</code> <code class="mi">2</code><code class="p">]]);</code>
        <code class="p">[...</code><code class="nx">m</code><code class="p">]</code>    <code class="c1">// =&gt; [["x", 1], ["y", 2]]</code>
        
        <code class="k">for</code><code class="p">(</code><code class="kd">let</code> <code class="p">[</code><code class="nx">key</code><code class="p">,</code> <code class="nx">value</code><code class="p">]</code> <code class="k">of</code> <code class="nx">m</code><code class="p">)</code> <code class="p">{</code>
            <code class="c1">// On the first iteration, key will be "x" and value will be 1</code>
            <code class="c1">// On the second iteration, key will be "y" and value will be 2</code>
        <code class="p">}</code></pre>
        
        <p>Like the Set class, the Map class iterates in insertion order. The
        first key/value pair iterated will be the one least recently added to
        the map, and the last pair iterated will be the one most recently
        added.</p>
        
        <p>If you want to iterate just the keys or just the associated values of
        a map, use the <code>keys()</code> and <code>values()</code> methods: these return iterable
        objects that iterate keys and values, in insertion order. (The
        <code>entries()</code> method returns an iterable object that iterates key/value
        pairs, but this is exactly the same as iterating the map directly.)</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="p">[...</code><code class="nx">m</code><code class="p">.</code><code class="nx">keys</code><code class="p">()]</code>     <code class="c1">// =&gt; ["x", "y"]: just the keys</code>
        <code class="p">[...</code><code class="nx">m</code><code class="p">.</code><code class="nx">values</code><code class="p">()]</code>   <code class="c1">// =&gt; [1, 2]: just the values</code>
        <code class="p">[...</code><code class="nx">m</code><code class="p">.</code><code class="nx">entries</code><code class="p">()]</code>  <code class="c1">// =&gt; [["x", 1], ["y", 2]]: same as [...m]</code></pre>
        
        <p>Map objects can also be iterated using the <code>forEach()</code> method that was
        first implemented by the Array class.</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="nx">m</code><code class="p">.</code><code class="nx">forEach</code><code class="p">((</code><code class="nx">value</code><code class="p">,</code> <code class="nx">key</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>  <code class="c1">// note value, key NOT key, value</code>
            <code class="c1">// On the first invocation, value will be 1 and key will be "x"</code>
            <code class="c1">// On the second invocation, value will be 2 and key will be "y"</code>
        <code class="p">});</code></pre>
        
        <p>It may seem strange that the value parameter comes before the key
        parameter in the code above, since with <code>for/of</code> iteration, the key
        comes first. As noted at the start of this section, you can think of a
        map as a generalized array in which integer array indexes are replaced
        with arbitrary key values. The <code>forEach()</code> method of arrays passes the
        array element first and the array index second, so, by analogy, the
        <span class="keep-together"><code>forEach()</code></span> method of a map passes the map value first and the map key
        second.<a data-type="indexterm" data-primary="" data-startref="SMmap11" id="idm46198528000472"></a><a data-type="indexterm" data-primary="" data-startref="mapclass11" id="idm46198527999528"></a></p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.1.3 WeakMap and WeakSet"><div class="sect2" id="weakcollections">
        <h2>11.1.3 WeakMap and WeakSet</h2>
        
        <p>The<a data-type="indexterm" data-primary="WeakMap class" id="idm46198527939752"></a><a data-type="indexterm" data-primary="WeakSet class" id="idm46198527939016"></a><a data-type="indexterm" data-primary="sets and maps" data-secondary="WeakMap and WeakSet classes" id="idm46198527938344"></a> WeakMap class is a variant (but not an actual subclass) of the Map
        class that does not prevent its key values from being garbage
        collected. Garbage collection is the process by which the JavaScript
        interpreter reclaims the memory of objects that are no longer
        “reachable” and cannot be used by the program. A regular map holds
        “strong” references to its key values, and they remain reachable
        through the map, even if all other references to them are gone. The
        WeakMap, by contrast, keeps “weak” <span class="keep-together">references</span> to its key values so
        that they are not reachable through the WeakMap, and their presence in
        the map does not prevent their memory from being reclaimed.</p>
        
        <p>The <code>WeakMap()</code> constructor is just like the <code>Map()</code> constructor, but
        there are some significant differences between WeakMap and Map:</p>
        
        <ul>
        <li>
        <p>WeakMap keys must be objects or arrays; primitive values are not
        subject to garbage collection and cannot be used as keys.</p>
        </li>
        <li>
        <p>WeakMap implements only the <code>get()</code>, <code>set()</code>, <code>has()</code>, and <code>delete()</code>
        methods. In particular, WeakMap is not iterable and does not define
        <code>keys()</code>, <code>values()</code>, or <code>forEach()</code>. If WeakMap was iterable, then
        its keys would be reachable and it wouldn’t be weak.</p>
        </li>
        <li>
        <p>Similarly, WeakMap does not implement the <code>size</code> property because
        the size of a WeakMap could change at any time as objects are
        garbage collected.</p>
        </li>
        </ul>
        
        <p>The intended use of WeakMap is to allow you to associate values with
        objects without causing memory leaks. Suppose, for example, that you
        are writing a function that takes an object argument and needs to
        perform some time-consuming computation on that object. For efficiency,
        you’d like to cache the computed value for later reuse. If you use a
        Map object to implement the cache, you will prevent any of the objects
        from ever being reclaimed, but by using a WeakMap, you avoid this
        problem. (You can often achieve a similar result using a private Symbol
        property to cache the computed value directly on the object. See
        <a data-type="xref" href="ch06.html#symbols-as-property-names">§6.10.3</a>.)</p>
        
        <p>WeakSet implements a set of objects that does not prevent those
        objects from being garbage collected. The <code>WeakSet()</code> constructor
        works like the <code>Set()</code> constructor, but WeakSet objects differ from
        Set objects in the same ways that WeakMap objects differ from Map
        objects:</p>
        
        <ul>
        <li>
        <p>WeakSet does not allow primitive values as members.</p>
        </li>
        <li>
        <p>WeakSet implements only the <code>add()</code>, <code>has()</code>, and <code>delete()</code>
        methods and is not iterable.</p>
        </li>
        <li>
        <p>WeakSet does not have a <code>size</code> property.</p>
        </li>
        </ul>
        
        <p>WeakSet is not frequently used: its use cases are like those for
        WeakMap. If you want to mark (or “brand”) an object as having some
        special property or type, for example, you could add it to a
        WeakSet. Then, elsewhere, when you want to check for that property or
        type, you can test for membership in that WeakSet. Doing this with a
        regular set would prevent all marked objects from being garbage
        collected, but this is not a concern when using WeakSet.<a data-type="indexterm" data-primary="" data-startref="JSLset11" id="idm46198527903384"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" class="less_space pagebreak-before" data-pdf-bookmark="11.2 Typed Arrays and Binary Data"><div class="sect1" id="typedarrays">
        <h1>11.2 Typed Arrays and Binary Data</h1>
        
        <p>Regular JavaScript<a data-type="indexterm" data-primary="arrays" data-secondary="typed arrays" data-tertiary="overview of" id="idm46198527900104"></a><a data-type="indexterm" data-primary="typed arrays" data-secondary="overview of" id="idm46198527898856"></a><a data-type="indexterm" data-primary="JavaScript standard library" data-secondary="typed arrays and binary data" id="JSLtyped11"></a><a data-type="indexterm" data-primary="binary data, processing" id="dindatp11"></a><a data-type="indexterm" data-primary="binary data, processing" data-see="also typed arrays" id="idm46198527895688"></a> arrays can have elements of any type and can grow
        or shrink dynamically. JavaScript implementations perform lots of
        optimizations so that typical uses of JavaScript arrays are very
        fast. Nevertheless, they are still quite different from the array
        types of lower-level languages like C and Java. <em>Typed arrays</em>, which
        are new in ES6,<sup><a data-type="noteref" id="idm46198527893912-marker" href="ch11.html#idm46198527893912">3</a></sup> are much closer to the low-level arrays
        of those languages. Typed arrays are not technically arrays
        (<code>Array.isArray()</code> returns <code>false</code> for them), but they implement all of
        the array methods described in <a data-type="xref" href="ch07.html#arraymethods">§7.8</a> plus a few more of
        their own. They differ from regular arrays in some very important
        ways, however:</p>
        
        <ul>
        <li>
        <p>The elements of a typed array are all numbers. Unlike regular
        JavaScript numbers, however, typed arrays allow you to specify the
        type (signed and unsigned integers and IEEE-754 floating point) and
        size (8 bits to 64 bits) of the numbers to be stored in the array.</p>
        </li>
        <li>
        <p>You must specify the length of a typed array when you create it, and
        that length can never change.</p>
        </li>
        <li>
        <p>The elements of a typed array are always initialized to 0 when the
        array is created.</p>
        </li>
        </ul>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.2.1 Typed Array Types"><div class="sect2" id="idm46198527887704">
        <h2>11.2.1 Typed Array Types</h2>
        
        <p>JavaScript<a data-type="indexterm" data-primary="Uint8Array" id="idm46198527886200"></a><a data-type="indexterm" data-primary="arrays" data-secondary="typed arrays" data-tertiary="typed array types" id="idm46198527885464"></a><a data-type="indexterm" data-primary="typed arrays" data-secondary="typed array types" id="idm46198527884248"></a> does not define a TypedArray class. Instead, there are
        11 kinds of typed arrays, each with a different element<a data-type="indexterm" data-primary="ES2020" data-secondary="BigInt64Array()" id="idm46198527883048"></a><a data-type="indexterm" data-primary="ES2020" data-secondary="BigUint64Array()" id="idm46198527882104"></a> type and
        constructor:</p>
        <table>
        
        <thead>
        <tr>
        <th>Constructor</th>
        <th>Numeric type</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p><code>Int8Array()</code></p></td>
        <td><p>signed bytes</p></td>
        </tr>
        <tr>
        <td><p><code>Uint8Array()</code></p></td>
        <td><p>unsigned bytes</p></td>
        </tr>
        <tr>
        <td><p><code>Uint8ClampedArray()</code></p></td>
        <td><p>unsigned bytes without rollover</p></td>
        </tr>
        <tr>
        <td><p><code>Int16Array()</code></p></td>
        <td><p>signed 16-bit short integers</p></td>
        </tr>
        <tr>
        <td><p><code>Uint16Array()</code></p></td>
        <td><p>unsigned 16-bit short integers</p></td>
        </tr>
        <tr>
        <td><p><code>Int32Array()</code></p></td>
        <td><p>signed 32-bit integers</p></td>
        </tr>
        <tr>
        <td><p><code>Uint32Array()</code></p></td>
        <td><p>unsigned 32-bit integers</p></td>
        </tr>
        <tr>
        <td><p><code>BigInt64Array()</code></p></td>
        <td><p>signed 64-bit BigInt values (ES2020)</p></td>
        </tr>
        <tr>
        <td><p><code>BigUint64Array()</code></p></td>
        <td><p>unsigned 64-bit BigInt values (ES2020)</p></td>
        </tr>
        <tr>
        <td><p><code>Float32Array()</code></p></td>
        <td><p>32-bit floating-point value</p></td>
        </tr>
        <tr>
        <td><p><code>Float64Array()</code></p></td>
        <td><p>64-bit floating-point value: a regular JavaScript number</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>The types whose names begin with <code>Int</code> hold signed integers, of 1, 2,
        or 4 bytes (8, 16, or 32 bits). The types whose names begin with
        <code>Uint</code> hold unsigned integers of those same lengths. The “BigInt” and
        “BigUint” types hold 64-bit integers, represented in JavaScript as
        BigInt values (see <a data-type="xref" href="ch03.html#bigint">§3.2.5</a>). The types that
        begin with <code>Float</code> hold floating-point numbers. The elements of a
        <code>Float64Array</code> are of the same type as regular JavaScript numbers. The
        elements of a <code>Float32Array</code> have lower precision and a smaller range
        but require only half the memory. (This type is called <code>float</code> in C
        and Java.)</p>
        
        <p><code>Uint8ClampedArray</code> is a special-case variant on <code>Uint8Array</code>. Both of
        these types hold unsigned bytes and can represent numbers between 0
        and 255. With <code>Uint8Array</code>, if you store a value larger than 255 or
        less than zero into an array element, it “wraps around,” and you get
        some other value. This is how computer memory works at a low level, so
        this is very fast. <code>Uint8ClampedArray</code> does some extra
        type checking so that, if you store a value greater than 255 or less
        than 0, it “clamps” to 255 or 0 and does not wrap around. (This
        clamping behavior is required by the HTML <code>&lt;canvas&gt;</code> element’s low-level
        API for manipulating pixel colors.)</p>
        
        <p>Each of the typed array constructors has a <code>BYTES_PER_ELEMENT</code>
        property with the value 1, 2, 4, or 8, depending on the type.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.2.2 Creating Typed Arrays"><div class="sect2" id="idm46198527850824">
        <h2>11.2.2 Creating Typed Arrays</h2>
        
        <p>The<a data-type="indexterm" data-primary="arrays" data-secondary="typed arrays" data-tertiary="creating" id="idm46198527849080"></a><a data-type="indexterm" data-primary="typed arrays" data-secondary="creating" id="idm46198527847800"></a> simplest way to create a typed array is to call the appropriate
        constructor with one numeric argument that specifies the number of
        elements you want in the array:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">bytes</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Uint8Array</code><code class="p">(</code><code class="mi">1024</code><code class="p">);</code>    <code class="c1">// 1024 bytes</code>
        <code class="kd">let</code> <code class="nx">matrix</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Float64Array</code><code class="p">(</code><code class="mi">9</code><code class="p">);</code>    <code class="c1">// A 3x3 matrix</code>
        <code class="kd">let</code> <code class="nx">point</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Int16Array</code><code class="p">(</code><code class="mi">3</code><code class="p">);</code>       <code class="c1">// A point in 3D space</code>
        <code class="kd">let</code> <code class="nx">rgba</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Uint8ClampedArray</code><code class="p">(</code><code class="mi">4</code><code class="p">);</code> <code class="c1">// A 4-byte RGBA pixel value</code>
        <code class="kd">let</code> <code class="nx">sudoku</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Int8Array</code><code class="p">(</code><code class="mi">81</code><code class="p">);</code>      <code class="c1">// A 9x9 sudoku board</code></pre>
        
        <p>When you create typed arrays in this way, the array elements are all
        guaranteed to be initialized to <code>0</code>, <code>0n</code>, or <code>0.0</code>. But if you know
        the values you want in your typed array, you can also specify those
        values when you create the array. Each of the typed array constructors
        has static <code>from()</code> and <code>of()</code> factory methods that work like
        <code>Array.from()</code> and <code>Array.of()</code>:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">white</code> <code class="o">=</code> <code class="nx">Uint8ClampedArray</code><code class="p">.</code><code class="k">of</code><code class="p">(</code><code class="mi">255</code><code class="p">,</code> <code class="mi">255</code><code class="p">,</code> <code class="mi">255</code><code class="p">,</code> <code class="mi">0</code><code class="p">);</code>  <code class="c1">// RGBA opaque white</code></pre>
        
        <p>Recall that the <code>Array.from()</code> factory method expects an array-like or
        iterable object as its first argument. The same is true for the typed
        array variants, except that the iterable or array-like
        object must also have numeric elements. Strings are iterable, for example,
        but it would make no sense to pass them to the <code>from()</code> factory method
        of a typed array.</p>
        
        <p>If you are just using the one-argument version of <code>from()</code>, you can
        drop the <code>.from</code> and pass your iterable or array-like object directly
        to the constructor function, which behaves exactly the same. Note that
        both the constructor and the <code>from()</code> factory method allow you to copy
        existing typed arrays, while possibly changing the type:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">ints</code> <code class="o">=</code> <code class="nx">Uint32Array</code><code class="p">.</code><code class="nx">from</code><code class="p">(</code><code class="nx">white</code><code class="p">);</code>  <code class="c1">// The same 4 numbers, but as ints</code></pre>
        
        <p>When you create a new typed array from an existing array, iterable, or
        array-like object, the values may be truncated in order to fit the
        type constraints of your array. There are no warnings or errors when
        this happens:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// Floats truncated to ints, longer ints truncated to 8 bits</code>
        <code class="nx">Uint8Array</code><code class="p">.</code><code class="k">of</code><code class="p">(</code><code class="mf">1.23</code><code class="p">,</code> <code class="mf">2.99</code><code class="p">,</code> <code class="mi">45000</code><code class="p">)</code> <code class="c1">// =&gt; new Uint8Array([1, 2, 200])</code></pre>
        
        <p>Finally, there is one more way to create typed arrays that involves
        the ArrayBuffer type. An ArrayBuffer is an opaque reference to a chunk
        of memory. You can create one with the constructor; just pass in the
        number of bytes of memory you’d like to allocate:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">buffer</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">ArrayBuffer</code><code class="p">(</code><code class="mi">1024</code><code class="o">*</code><code class="mi">1024</code><code class="p">);</code>
        <code class="nx">buffer</code><code class="p">.</code><code class="nx">byteLength</code>   <code class="c1">// =&gt; 1024*1024; one megabyte of memory</code></pre>
        
        <p>The ArrayBuffer class does not allow you to read or write any of the
        bytes that you have allocated. But you can create typed arrays that
        use the buffer’s memory and that do allow you to read and write that
        memory. To do this, call the typed array constructor with an
        ArrayBuffer as the first argument, a byte offset within the array
        buffer as the second argument, and the array length (in elements, not
        in bytes) as the third argument. The second and third arguments are
        optional. If you omit both, then the array will use all of the memory
        in the array buffer.  If you omit only the length argument, then your
        array will use all of the available memory between the start position
        and the end of the array. One more thing to bear in mind about this
        form of the typed array constructor: arrays must be memory aligned, so
        if you specify a byte offset, the value should be a multiple of the
        size of your type. The <code>Int32Array()</code> constructor requires a multiple
        of four, for example, and the <code>Float64Array()</code> requires a multiple of eight.</p>
        
        <p>Given the ArrayBuffer created earlier, you could create typed arrays
        like these:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">asbytes</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Uint8Array</code><code class="p">(</code><code class="nx">buffer</code><code class="p">);</code>          <code class="c1">// Viewed as bytes</code>
        <code class="kd">let</code> <code class="nx">asints</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Int32Array</code><code class="p">(</code><code class="nx">buffer</code><code class="p">);</code>           <code class="c1">// Viewed as 32-bit signed ints</code>
        <code class="kd">let</code> <code class="nx">lastK</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Uint8Array</code><code class="p">(</code><code class="nx">buffer</code><code class="p">,</code> <code class="mi">1023</code><code class="o">*</code><code class="mi">1024</code><code class="p">);</code> <code class="c1">// Last kilobyte as bytes</code>
        <code class="kd">let</code> <code class="nx">ints2</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Int32Array</code><code class="p">(</code><code class="nx">buffer</code><code class="p">,</code> <code class="mi">1024</code><code class="p">,</code> <code class="mi">256</code><code class="p">);</code> <code class="c1">// 2nd kilobyte as 256 integers</code></pre>
        
        <p>These four typed arrays offer four different views into the memory
        represented by the ArrayBuffer. It is important to understand that all
        typed arrays have an underlying ArrayBuffer, even if you do not
        explicitly specify one. If you call a typed array constructor without
        passing a buffer object, a buffer of the appropriate size will be
        automatically created. As described later, the <code>buffer</code> property of
        any typed array refers to its underlying ArrayBuffer object. The
        reason to work directly with ArrayBuffer objects is that sometimes you
        may want to have multiple typed array views of a single buffer.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.2.3 Using Typed Arrays"><div class="sect2" id="idm46198527850152">
        <h2>11.2.3 Using Typed Arrays</h2>
        
        <p>Once<a data-type="indexterm" data-primary="typed arrays" data-secondary="using" id="idm46198527561848"></a><a data-type="indexterm" data-primary="arrays" data-secondary="typed arrays" data-tertiary="using" id="idm46198527560840"></a> you have created a typed array, you can read and write its
        elements with regular square-bracket notation, just as you would with
        any other array-like object:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// Return the largest prime smaller than n, using the sieve of Eratosthenes</code>
        <code class="kd">function</code> <code class="nx">sieve</code><code class="p">(</code><code class="nx">n</code><code class="p">)</code> <code class="p">{</code>
            <code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Uint8Array</code><code class="p">(</code><code class="nx">n</code><code class="o">+</code><code class="mi">1</code><code class="p">);</code>         <code class="c1">// a[x] will be 1 if x is composite</code>
            <code class="kd">let</code> <code class="nx">max</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">floor</code><code class="p">(</code><code class="nb">Math</code><code class="p">.</code><code class="nx">sqrt</code><code class="p">(</code><code class="nx">n</code><code class="p">));</code>  <code class="c1">// Don't do factors higher than this</code>
            <code class="kd">let</code> <code class="nx">p</code> <code class="o">=</code> <code class="mi">2</code><code class="p">;</code>                           <code class="c1">// 2 is the first prime</code>
            <code class="k">while</code><code class="p">(</code><code class="nx">p</code> <code class="o">&lt;=</code> <code class="nx">max</code><code class="p">)</code> <code class="p">{</code>                    <code class="c1">// For primes less than max</code>
                <code class="k">for</code><code class="p">(</code><code class="kd">let</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">2</code><code class="o">*</code><code class="nx">p</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;=</code> <code class="nx">n</code><code class="p">;</code> <code class="nx">i</code> <code class="o">+=</code> <code class="nx">p</code><code class="p">)</code> <code class="c1">// Mark multiples of p as composite</code>
                    <code class="nx">a</code><code class="p">[</code><code class="nx">i</code><code class="p">]</code> <code class="o">=</code> <code class="mi">1</code><code class="p">;</code>
                <code class="k">while</code><code class="p">(</code><code class="nx">a</code><code class="p">[</code><code class="o">++</code><code class="nx">p</code><code class="p">])</code> <code class="cm">/* empty */</code><code class="p">;</code>       <code class="c1">// The next unmarked index is prime</code>
            <code class="p">}</code>
            <code class="k">while</code><code class="p">(</code><code class="nx">a</code><code class="p">[</code><code class="nx">n</code><code class="p">])</code> <code class="nx">n</code><code class="o">--</code><code class="p">;</code>                     <code class="c1">// Loop backward to find the last prime</code>
            <code class="k">return</code> <code class="nx">n</code><code class="p">;</code>                            <code class="c1">// And return it</code>
        <code class="p">}</code></pre>
        
        <p>The function here computes the largest prime number smaller than the
        number you specify. The code is exactly the same as it would be with a
        regular JavaScript array, but using <code>Uint8Array()</code> instead of
        <code>Array()</code> makes the code run more than four times faster and use eight times
        less memory in my testing.</p>
        
        <p>Typed arrays are not true arrays, but they re-implement most
        array methods, so you can use them pretty much just like you’d use
        regular arrays:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">ints</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Int16Array</code><code class="p">(</code><code class="mi">10</code><code class="p">);</code>       <code class="c1">// 10 short integers</code>
        <code class="nx">ints</code><code class="p">.</code><code class="nx">fill</code><code class="p">(</code><code class="mi">3</code><code class="p">).</code><code class="nx">map</code><code class="p">(</code><code class="nx">x</code><code class="o">=&gt;</code><code class="nx">x</code><code class="o">*</code><code class="nx">x</code><code class="p">).</code><code class="nx">join</code><code class="p">(</code><code class="s2">""</code><code class="p">)</code>    <code class="c1">// =&gt; "9999999999"</code></pre>
        
        <p>Remember that typed arrays have fixed lengths, so the <code>length</code>
        property is read-only, and methods that change the length of the array
        (such as <code>push()</code>, <code>pop()</code>, <code>unshift()</code>, <code>shift()</code>, and <code>splice()</code>)
        are not implemented for typed arrays. Methods that alter the contents
        of an array without changing the length (such as <code>sort()</code>, <code>reverse()</code>,
        and <code>fill()</code>) are implemented. Methods like <code>map()</code> and <code>slice()</code> that
        return new arrays return a typed array of the same type as the one
        they are called on.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.2.4 Typed Array Methods and Properties"><div class="sect2" id="idm46198527406200">
        <h2>11.2.4 Typed Array Methods and Properties</h2>
        
        <p>In<a data-type="indexterm" data-primary="arrays" data-secondary="typed arrays" data-tertiary="methods and properties" id="idm46198527391656"></a><a data-type="indexterm" data-primary="typed arrays" data-secondary="methods and properties" id="idm46198527390376"></a><a data-type="indexterm" data-primary="methods" data-secondary="typed array methods" id="idm46198527389432"></a><a data-type="indexterm" data-primary="properties" data-secondary="typed array properties" id="idm46198527388488"></a> addition to standard array methods, typed arrays also implement a
        few methods of their own. The <code>set()</code> method sets multiple elements of
        a typed array at once by copying the elements of a regular or typed
        array into a typed array:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">bytes</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Uint8Array</code><code class="p">(</code><code class="mi">1024</code><code class="p">);</code>        <code class="c1">// A 1K buffer</code>
        <code class="kd">let</code> <code class="nx">pattern</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Uint8Array</code><code class="p">([</code><code class="mi">0</code><code class="p">,</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">]);</code> <code class="c1">// An array of 4 bytes</code>
        <code class="nx">bytes</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="nx">pattern</code><code class="p">);</code>      <code class="c1">// Copy them to the start of another byte array</code>
        <code class="nx">bytes</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="nx">pattern</code><code class="p">,</code> <code class="mi">4</code><code class="p">);</code>   <code class="c1">// Copy them again at a different offset</code>
        <code class="nx">bytes</code><code class="p">.</code><code class="nx">set</code><code class="p">([</code><code class="mi">0</code><code class="p">,</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">],</code> <code class="mi">8</code><code class="p">);</code> <code class="c1">// Or just copy values direct from a regular array</code>
        <code class="nx">bytes</code><code class="p">.</code><code class="nx">slice</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code> <code class="mi">12</code><code class="p">)</code>       <code class="c1">// =&gt; new Uint8Array([0,1,2,3,0,1,2,3,0,1,2,3])</code></pre>
        
        <p>The <code>set()</code> method takes an array or typed array as its first
        argument and an element offset as its optional second argument, which
        defaults to 0 if left unspecified. If you are copying values from one
        typed array to another, the operation will likely be extremely fast.</p>
        
        <p>Typed arrays also have a <code>subarray</code> method that returns a portion of the array
        on which it is called:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">ints</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Int16Array</code><code class="p">([</code><code class="mi">0</code><code class="p">,</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">,</code><code class="mi">4</code><code class="p">,</code><code class="mi">5</code><code class="p">,</code><code class="mi">6</code><code class="p">,</code><code class="mi">7</code><code class="p">,</code><code class="mi">8</code><code class="p">,</code><code class="mi">9</code><code class="p">]);</code>       <code class="c1">// 10 short integers</code>
        <code class="kd">let</code> <code class="nx">last3</code> <code class="o">=</code> <code class="nx">ints</code><code class="p">.</code><code class="nx">subarray</code><code class="p">(</code><code class="nx">ints</code><code class="p">.</code><code class="nx">length</code><code class="o">-</code><code class="mi">3</code><code class="p">,</code> <code class="nx">ints</code><code class="p">.</code><code class="nx">length</code><code class="p">);</code>  <code class="c1">// Last 3 of them</code>
        <code class="nx">last3</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code>       <code class="c1">// =&gt; 7: this is the same as ints[7]</code></pre>
        
        <p><code>subarray()</code> takes the same arguments as the <code>slice()</code> method and
        seems to work the same way. But there is an important
        difference. <code>slice()</code> returns the specified elements in a new,
        independent typed array that does not share memory with the original
        array. <code>subarray()</code> does not copy any memory; it just returns a new
        view of the same underlying values:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="nx">ints</code><code class="p">[</code><code class="mi">9</code><code class="p">]</code> <code class="o">=</code> <code class="o">-</code><code class="mi">1</code><code class="p">;</code>  <code class="c1">// Change a value in the original array and...</code>
        <code class="nx">last3</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code>       <code class="c1">// =&gt; -1: it also changes in the subarray</code></pre>
        
        <p>The fact that the <code>subarray()</code> method returns a new view of an existing array
        brings us back to the topic of ArrayBuffers. Every typed array has three
        properties that relate to the underlying buffer:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="nx">last3</code><code class="p">.</code><code class="nx">buffer</code>                 <code class="c1">// The ArrayBuffer object for a typed array</code>
        <code class="nx">last3</code><code class="p">.</code><code class="nx">buffer</code> <code class="o">===</code> <code class="nx">ints</code><code class="p">.</code><code class="nx">buffer</code> <code class="c1">// =&gt; true: both are views of the same buffer</code>
        <code class="nx">last3</code><code class="p">.</code><code class="nx">byteOffset</code>             <code class="c1">// =&gt; 14: this view starts at byte 14 of the buffer</code>
        <code class="nx">last3</code><code class="p">.</code><code class="nx">byteLength</code>             <code class="c1">// =&gt; 6: this view is 6 bytes (3 16-bit ints) long</code>
        <code class="nx">last3</code><code class="p">.</code><code class="nx">buffer</code><code class="p">.</code><code class="nx">byteLength</code>      <code class="c1">// =&gt; 20: but the underlying buffer has 20 bytes</code></pre>
        
        <p>The <code>buffer</code> property is the ArrayBuffer of the array. <code>byteOffset</code> is
        the starting position of the array’s data within the underlying
        buffer. And <code>byteLength</code> is the length of the array’s data in
        bytes. For any typed array, <code>a</code>, this invariant should always be true:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="nx">a</code><code class="p">.</code><code class="nx">length</code> <code class="o">*</code> <code class="nx">a</code><code class="p">.</code><code class="nx">BYTES_PER_ELEMENT</code> <code class="o">===</code> <code class="nx">a</code><code class="p">.</code><code class="nx">byteLength</code>  <code class="c1">// =&gt; true</code></pre>
        
        <p>ArrayBuffers are just opaque chunks of bytes. You can access those bytes with
        typed arrays, but an ArrayBuffer is not itself a typed array. Be careful,
        however: you can use numeric array indexing with ArrayBuffers just as you can
        with any JavaScript object. Doing so does not give you access to the bytes in
        the buffer, but it can cause confusing bugs:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">bytes</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Uint8Array</code><code class="p">(</code><code class="mi">8</code><code class="p">);</code>
        <code class="nx">bytes</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code> <code class="o">=</code> <code class="mi">1</code><code class="p">;</code>           <code class="c1">// Set the first byte to 1</code>
        <code class="nx">bytes</code><code class="p">.</code><code class="nx">buffer</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code>         <code class="c1">// =&gt; undefined: buffer doesn't have index 0</code>
        <code class="nx">bytes</code><code class="p">.</code><code class="nx">buffer</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code> <code class="o">=</code> <code class="mi">255</code><code class="p">;</code>  <code class="c1">// Try incorrectly to set a byte in the buffer</code>
        <code class="nx">bytes</code><code class="p">.</code><code class="nx">buffer</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>         <code class="c1">// =&gt; 255: this just sets a regular JS property</code>
        <code class="nx">bytes</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code>                <code class="c1">// =&gt; 0: the line above did not set the byte</code></pre>
        
        <p>We saw previously that you can create an ArrayBuffer with the
        <code>ArrayBuffer()</code> constructor and then create typed arrays that use that
        buffer. Another approach is to create an initial typed array, then use
        the buffer of that array to create other views:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">bytes</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Uint8Array</code><code class="p">(</code><code class="mi">1024</code><code class="p">);</code>            <code class="c1">// 1024 bytes</code>
        <code class="kd">let</code> <code class="nx">ints</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Uint32Array</code><code class="p">(</code><code class="nx">bytes</code><code class="p">.</code><code class="nx">buffer</code><code class="p">);</code>    <code class="c1">// or 256 integers</code>
        <code class="kd">let</code> <code class="nx">floats</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Float64Array</code><code class="p">(</code><code class="nx">bytes</code><code class="p">.</code><code class="nx">buffer</code><code class="p">);</code> <code class="c1">// or 128 doubles</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.2.5 DataView and Endianness"><div class="sect2" id="typedarrays-dataview">
        <h2>11.2.5 DataView and Endianness</h2>
        
        <p>Typed<a data-type="indexterm" data-primary="DataView class" id="idm46198526912376"></a><a data-type="indexterm" data-primary="arrays" data-secondary="typed arrays" data-tertiary="DataView and endianness" id="idm46198526911640"></a><a data-type="indexterm" data-primary="typed arrays" data-secondary="DataView and endianness" id="idm46198526910424"></a> arrays allow you to view the same sequence of bytes in chunks of 8, 16,
        32, or 64 bits. This exposes the “endianness”: the order in which bytes are
        arranged into longer words. For efficiency, typed arrays use the native
        endianness of the underlying hardware. On little-endian systems, the bytes of a
        number are arranged in an ArrayBuffer from least significant to most
        significant. On big-endian platforms, the bytes are arranged from most
        significant to least significant. You can determine the endianness of the
        underlying platform with code like this:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// If the integer 0x00000001 is arranged in memory as 01 00 00 00, then</code>
        <code class="c1">// we're on a little-endian platform. On a big-endian platform, we'd get</code>
        <code class="c1">// bytes 00 00 00 01 instead.</code>
        <code class="kd">let</code> <code class="nx">littleEndian</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Int8Array</code><code class="p">(</code><code class="k">new</code> <code class="nx">Int32Array</code><code class="p">([</code><code class="mi">1</code><code class="p">]).</code><code class="nx">buffer</code><code class="p">)[</code><code class="mi">0</code><code class="p">]</code> <code class="o">===</code> <code class="mi">1</code><code class="p">;</code></pre>
        
        <p>Today, the most common CPU architectures are<a data-type="indexterm" data-primary="little-endian architecture" id="idm46198526865640"></a> little-endian. Many
        network protocols, and some binary file formats, require<a data-type="indexterm" data-primary="big-endian byte ordering" id="idm46198526865016"></a> big-endian
        byte ordering, however. If you’re using typed arrays with data that
        came from the network or from a file, you can’t just assume that the
        platform endianness matches the byte order of the data. In general,
        when working with external data, you can use Int8Array and Uint8Array
        to view the data as an array of individual bytes, but you should not
        use the other typed arrays with multibyte word sizes. Instead, you can
        use the DataView class, which defines methods for reading and writing
        values from an ArrayBuffer with explicitly specified byte ordering:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// Assume we have a typed array of bytes of binary data to process. First,</code>
        <code class="c1">// we create a DataView object so we can flexibly read and write</code>
        <code class="c1">// values from those bytes</code>
        <code class="kd">let</code> <code class="nx">view</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">DataView</code><code class="p">(</code><code class="nx">bytes</code><code class="p">.</code><code class="nx">buffer</code><code class="p">,</code>
                                <code class="nx">bytes</code><code class="p">.</code><code class="nx">byteOffset</code><code class="p">,</code>
                                <code class="nx">bytes</code><code class="p">.</code><code class="nx">byteLength</code><code class="p">);</code>
        
        <code class="kd">let</code> <code class="kr">int</code> <code class="o">=</code> <code class="nx">view</code><code class="p">.</code><code class="nx">getInt32</code><code class="p">(</code><code class="mi">0</code><code class="p">);</code>     <code class="c1">// Read big-endian signed int from byte 0</code>
        <code class="kr">int</code> <code class="o">=</code> <code class="nx">view</code><code class="p">.</code><code class="nx">getInt32</code><code class="p">(</code><code class="mi">4</code><code class="p">,</code> <code class="kc">false</code><code class="p">);</code>  <code class="c1">// Next int is also big-endian</code>
        <code class="kr">int</code> <code class="o">=</code> <code class="nx">view</code><code class="p">.</code><code class="nx">getUint32</code><code class="p">(</code><code class="mi">8</code><code class="p">,</code> <code class="kc">true</code><code class="p">);</code>  <code class="c1">// Next int is little-endian and unsigned</code>
        <code class="nx">view</code><code class="p">.</code><code class="nx">setUint32</code><code class="p">(</code><code class="mi">8</code><code class="p">,</code> <code class="kr">int</code><code class="p">,</code> <code class="kc">false</code><code class="p">);</code>  <code class="c1">// Write it back in big-endian format</code></pre>
        
        <p>DataView defines 10 <code>get</code> methods for each of the 10 typed array
        classes (excluding Uint8ClampedArray). They have names like
        <code>getInt16()</code>, <code>getUint32()</code>, <span class="keep-together"><code>getBigInt64()</code></span>, and <code>getFloat64()</code>. The
        first argument is the byte offset within the ArrayBuffer at which the
        value begins.  All of these getter methods, other than <code>getInt8()</code> and
        <code>getUint8()</code>, accept an optional boolean value as their second
        argument. If the second argument is omitted or is <code>false</code>, big-endian
        byte ordering is used. If the second argument is <code>true</code>, little-endian
        ordering is used.</p>
        
        <p>DataView also defines 10 corresponding Set methods that write values
        into the underlying ArrayBuffer.  The first argument is the offset at
        which the value begins. The second argument is the value to
        write. Each of the methods, except <code>setInt8()</code> and <code>setUint8()</code>,
        accepts an optional third argument. If the argument is omitted or is
        <code>false</code>, the value is written in big-endian format with the most
        significant byte first. If the argument is <code>true</code>, the value is
        written in little-endian format with the least significant byte first.</p>
        
        <p>Typed arrays and the DataView class give you all the tools you need to
        process binary data and enable you to write JavaScript programs that
        do things like decompressing ZIP files or extracting metadata from
        JPEG files.<a data-type="indexterm" data-primary="" data-startref="JSLtyped11" id="idm46198526722040"></a><a data-type="indexterm" data-primary="" data-startref="dindatp11" id="idm46198526721064"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="11.3 Pattern Matching with Regular Expressions"><div class="sect1" id="regexps">
        <h1>11.3 Pattern Matching with Regular Expressions</h1>
        
        <p>A<a data-type="indexterm" data-primary="literals" data-secondary="regular expressions" id="idm46198526717992"></a><a data-type="indexterm" data-primary="regular expressions" data-seealso="pattern matching" id="idm46198526716984"></a> <em>regular expression</em> is<a data-type="indexterm" data-primary="JavaScript standard library" data-secondary="pattern matching" id="JSLpattern11"></a> an object that describes a textual pattern.
        The JavaScript<a data-type="indexterm" data-primary="RegExp type" id="idm46198526714120"></a><a data-type="indexterm" data-primary="RegExp type" data-see="also pattern matching" id="idm46198526713448"></a><a data-type="indexterm" data-primary="pattern matching" data-secondary="overview of" id="idm46198526712504"></a> RegExp class represents regular expressions, and both
        String and RegExp define methods that use regular expressions to
        perform powerful pattern-matching and search-and-replace functions on
        text. In order to use the RegExp API effectively, however, you must
        also learn how to describe patterns of text using the regular
        expression grammar, which is essentially a mini programming language
        of its own. Fortunately, the JavaScript regular expression grammar is
        quite similar to the grammar used by many other programming languages,
        so you may already be familiar with it. (And if you are not, the
        effort you invest in learning JavaScript regular expressions will
        probably be useful to you in other programming contexts as well.)</p>
        
        <p>The subsections that follow describe the regular expression grammar
        first, and then, after explaining how to write regular expressions,
        they explain how you can use them with methods of the String and
        RegExp classes.</p>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.3.1 Defining Regular Expressions"><div class="sect2" id="idm46198526710072">
        <h2>11.3.1 Defining Regular Expressions</h2>
        
        <p>In<a data-type="indexterm" data-primary="pattern matching" data-secondary="defining regular expressions" data-tertiary="pattern specifications" id="idm46198526708376"></a> JavaScript, regular expressions are represented by RegExp objects.
        RegExp objects may be created with the <code>RegExp()</code> constructor, of
        course, but they are more often created using a special literal syntax.
        Just as string literals are specified as characters within quotation
        marks, regular expression literals are specified as characters within a
        pair of slash (<code>/</code>) characters. Thus, your JavaScript code may
        contain lines like this:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">pattern</code> <code class="o">=</code> <code class="sr">/s$/</code><code class="p">;</code></pre>
        
        <p>This line creates a new RegExp object and assigns it to the variable
        <code>pattern</code>. This particular RegExp object matches any string that ends
        with the letter “s.” This regular expression could have equivalently
        been defined with the <code>RegExp()</code> constructor, like this:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">pattern</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">RegExp</code><code class="p">(</code><code class="s2">"s$"</code><code class="p">);</code></pre>
        
        <p>Regular-expression pattern specifications consist of a series of
        characters. Most characters, including all alphanumeric characters,
        simply describe characters to be matched literally. Thus, the regular
        expression <code>/java/</code> matches any string that contains the
        substring “java”. Other characters in regular expressions are not
        matched literally but have special significance. For example, the
        regular expression <code>/s$/</code> contains two characters. The first,
        “s”, matches itself literally. The second, “$”, is a special
        meta-character that matches the end of a string. Thus, this regular
        expression matches any string that contains the letter “s” as its
        last character.</p>
        
        <p>As we’ll see, regular expressions can also have one or more flag
        characters that affect how they work. Flags are specified following
        the second slash character in RegExp literals, or as a second string
        argument to the <code>RegExp()</code> constructor. If we wanted to match strings
        that end with “s” or “S”, for example, we could use the <code>i</code> flag
        with our regular expression to indicate that we want case-insensitive
        matching:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">pattern</code> <code class="o">=</code> <code class="sr">/s$/i</code><code class="p">;</code></pre>
        
        <p>The following sections describe the various characters and
        meta-characters used in JavaScript regular expressions.</p>
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="Literal characters"><div class="sect3" id="idm46198526697224">
        <h3>Literal characters</h3>
        
        <p>All<a data-type="indexterm" data-primary="pattern matching" data-secondary="defining regular expressions" data-tertiary="literal characters" id="idm46198526695784"></a> alphabetic characters and digits match themselves
        literally in regular expressions. JavaScript regular expression syntax
        also supports certain nonalphabetic characters through escape sequences
        that begin with a backslash (<code>\</code>). For example, the sequence
        <code>\n</code> matches a literal newline character in a string.
        <a data-type="xref" href="#regexps-TABLE-1">Table&nbsp;11-1</a> lists these characters.</p>
        <table id="regexps-TABLE-1">
        <caption><span class="label">Table 11-1. </span>Regular-expression literal characters</caption>
        <thead>
        <tr>
        <th>Character</th>
        <th>Matches</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>Alphanumeric character</p></td>
        <td><p>Itself</p></td>
        </tr>
        <tr>
        <td><p><code>\0</code></p></td>
        <td><p>The NUL character (<code>\u0000</code>)</p></td>
        </tr>
        <tr>
        <td><p><code>\t</code></p></td>
        <td><p>Tab (<code>\u0009</code>)</p></td>
        </tr>
        <tr>
        <td><p><code>\n</code></p></td>
        <td><p>Newline (<code>\u000A</code>)</p></td>
        </tr>
        <tr>
        <td><p><code>\v</code></p></td>
        <td><p>Vertical tab (<code>\u000B</code>)</p></td>
        </tr>
        <tr>
        <td><p><code>\f</code></p></td>
        <td><p>Form feed (<code>\u000C</code>)</p></td>
        </tr>
        <tr>
        <td><p><code>\r</code></p></td>
        <td><p>Carriage return (<code>\u000D</code>)</p></td>
        </tr>
        <tr>
        <td><p><code>\x</code><em>nn</em></p></td>
        <td><p>The Latin character specified by the hexadecimal number <em>nn</em>; for example, <code>\x0A</code> is the same as <code>\n</code>.</p></td>
        </tr>
        <tr>
        <td><p><code>\u</code><em>xxxx</em></p></td>
        <td><p>The Unicode character specified by the hexadecimal number <em>xxxx</em>; for example, <code>\u0009</code> is the same as <code>\t</code>.</p></td>
        </tr>
        <tr>
        <td><p><code>\u{</code><em>n</em><code>}</code></p></td>
        <td><p>The Unicode character specified by the codepoint <em>n</em>, where <em>n</em> is one to six hexadecimal digits between 0 and 10FFFF. Note that this syntax is only supported in regular expressions that use the <code>u</code> flag.</p></td>
        </tr>
        <tr>
        <td><p><code>\c</code><em>X</em></p></td>
        <td><p>The control character <code>^</code><em>X</em>; for example, <code>\cJ</code> is equivalent to the newline character <code>\n</code>.</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>A number of punctuation characters have special meanings in regular
        expressions. They are:</p>
        
        <pre data-type="programlisting">^ $ . * + ? = ! : | \ / ( ) [ ] { }</pre>
        
        <p>The meanings of these characters are discussed in the sections that
        follow. Some of these characters have special meaning only within
        certain contexts of a regular expression and are treated literally in
        other contexts. As a general rule, however, if you want to include any
        of these punctuation characters literally in a regular expression, you
        must precede them with a <code>\</code>. Other punctuation characters, such
        as quotation marks and <code>@</code>, do not have special meaning and simply
        match themselves literally in a regular expression.</p>
        
        <p>If you can’t remember exactly which punctuation characters need to be
        escaped with a backslash, you may safely place a backslash before any
        punctuation character. On the other hand, note that many letters and
        numbers have special meaning when preceded by a backslash, so any
        letters or numbers that you want to match literally should not be
        escaped with a backslash. To include a backslash character literally
        in a regular expression, you must escape it with a backslash, of
        course.  For example, the following regular expression matches any
        string that includes a backslash: <code>/\\/</code>. (And if you use the
        <code>RegExp()</code> constructor, keep in mind that any backslashes in your
        regular expression need to be doubled, since strings also use
        backslashes as an escape character.)</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="Character classes"><div class="sect3" id="idm46198526562952">
        <h3>Character classes</h3>
        
        <p>Individual<a data-type="indexterm" data-primary="pattern matching" data-secondary="defining regular expressions" data-tertiary="character classes" id="idm46198526561224"></a><a data-type="indexterm" data-primary="character classes (regular expressions)" id="idm46198526560008"></a> literal characters can be combined into <em>character classes</em>
        by placing them within square brackets. A character class matches any
        one character that is contained within it. Thus, the regular
        expression <code>/[abc]/</code> matches any one of the letters a, b, or
        c. Negated character classes can also be defined; these match any
        character except those contained within the brackets. A negated
        character class is specified by placing a caret (<code>^</code>) as the first
        character inside the left bracket. The RegExp <code>/[^abc]/</code> matches any
        one character other than a, b, or c. Character classes can use a
        hyphen to indicate a range of characters. To match any one lowercase
        character from the Latin alphabet, use <code>/[a-z]/</code>, and to match any
        letter or digit from the Latin alphabet, use <code>/[a-zA-Z0-9]/</code>. (And if
        you want to include an actual hyphen in your character class, simply
        make it the last character before the right bracket.)</p>
        
        <p>Because certain character classes are commonly used, the JavaScript
        regular-expression syntax includes special characters and escape
        sequences to represent these common classes. For example, <code>\s</code>
        matches the space character, the tab character, and any other Unicode
        whitespace character; <code>\S</code> matches any character that is <em>not</em>
        Unicode whitespace. <a data-type="xref" href="#regexps-TABLE-2">Table&nbsp;11-2</a> lists these characters and
        summarizes character-class syntax. (Note that several of these
        character-class escape sequences match only ASCII characters and have
        not been extended to work with Unicode characters. You can, however,
        explicitly define your own Unicode character classes; for example,
        <span class="keep-together"><code>/[\u0400-\u04FF]/</code></span> matches any one Cyrillic character.)</p>
        <table id="regexps-TABLE-2">
        <caption><span class="label">Table 11-2. </span>Regular expression character classes</caption>
        <thead>
        <tr>
        <th>Character</th>
        <th>Matches</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p><code>[...]</code></p></td>
        <td><p>Any one character between the brackets.</p></td>
        </tr>
        <tr>
        <td><p><code>[^...]</code></p></td>
        <td><p>Any one character not between the brackets.</p></td>
        </tr>
        <tr>
        <td><p><code>.</code></p></td>
        <td><p>Any character except newline or another Unicode line terminator. Or, if the RegExp uses the <code>s</code> flag, then a period matches any character, including line terminators.</p></td>
        </tr>
        <tr>
        <td><p><code>\w</code></p></td>
        <td><p>Any ASCII word character. Equivalent to <code>[a-zA-Z0-9_]</code>.</p></td>
        </tr>
        <tr>
        <td><p><code>\W</code></p></td>
        <td><p>Any character that is not an ASCII word character. Equivalent to <code>[^a-zA-Z0-9_]</code>.</p></td>
        </tr>
        <tr>
        <td><p><code>\s</code></p></td>
        <td><p>Any Unicode whitespace character.</p></td>
        </tr>
        <tr>
        <td><p><code>\S</code></p></td>
        <td><p>Any character that is not Unicode whitespace.</p></td>
        </tr>
        <tr>
        <td><p><code>\d</code></p></td>
        <td><p>Any ASCII digit. Equivalent to <code>[0-9]</code>.</p></td>
        </tr>
        <tr>
        <td><p><code>\D</code></p></td>
        <td><p>Any character other than an ASCII digit. Equivalent to <code>[^0-9]</code>.</p></td>
        </tr>
        <tr>
        <td><p><code>[\b]</code></p></td>
        <td><p>A literal backspace (special case).</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>Note that the special character-class escapes can be used within square
        brackets. <code>\s</code> matches any whitespace character, and <code>\d</code>
        matches any digit, so <code>/[\s\d]/</code> matches any one
        whitespace character or digit. Note that there is one special case. As
        you’ll see later, the <code>\b</code> escape has a special meaning. When
        used within a character class, however, it represents the backspace
        character. Thus, to represent a backspace character literally in a
        regular expression, use the character class with one element:
        <code>/[\b]/</code>.</p>
        <aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46198526525896">
        <h5>Unicode Character Classes</h5>
        <p>In<a data-type="indexterm" data-primary="pattern matching" data-secondary="defining regular expressions" data-tertiary="Unicode character classes" id="idm46198526524200"></a><a data-type="indexterm" data-primary="Unicode character set" data-secondary="pattern matching" id="idm46198526522920"></a><a data-type="indexterm" data-primary="ES2018" data-secondary="regular expressions" data-tertiary="Unicode character classes" id="idm46198526521944"></a> ES2018, if a regular expression uses the <code>u</code> flag, then
        character classes <code>\p{...}</code> and its negation <code>\P{...}</code> are
        supported. (As of early 2020, this is implemented by Node, Chrome, Edge, and
        Safari, but not Firefox.) These character classes are based on
        properties defined by the Unicode standard, and the set of characters
        they represent may change as Unicode evolves.</p>
        
        <p>The <code>\d</code> character class matches only ASCII digits. If you want to
        match one decimal digit from any of the world’s writing systems, you
        can use <code>/\p{Decimal_Number}/u</code>. And if you want to match any one
        character that is <em>not</em> a decimal digit in any language, you can
        capitalize the <code>p</code> and write <code>\P{Decimal_Number}</code>. If you want to
        match any number-like character, including fractions and roman
        numerals, you can use <code>\p{Number}</code>. Note that “Decimal_Number” and
        “Number” are not specific to JavaScript or to regular expression
        grammar: it is the name of a category of characters defined by the
        Unicode standard.</p>
        
        <p>The <code>\w</code> character class only works for ASCII text, but with <code>\p</code>, we
        can approximate an internationalized version like this:</p>
        
        <pre data-type="programlisting">/[\p{Alphabetic}\p{Decimal_Number}\p{Mark}]/u</pre>
        
        <p>(Though to be fully compatible with the complexity of the world’s
        languages, we really need to add in the categories
        “Connector_Punctuation” and “Join_Control” as well.)</p>
        
        <p>As a final example, the <code>\p</code> syntax also allows us to define regular
        expressions that match characters from a particular alphabet or
        script:</p>
        
        <pre data-type="programlisting">let greekLetter = /\p{Script=Greek}/u;
        let cyrillicLetter = /\p{Script=Cyrillic}/u;</pre>
        </div></aside>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="Repetition"><div class="sect3" id="idm46198526510952">
        <h3>Repetition</h3>
        
        <p>With<a data-type="indexterm" data-primary="pattern matching" data-secondary="defining regular expressions" data-tertiary="repetition characters" id="idm46198526509448"></a> the regular expression syntax you’ve learned so far, you can
        describe a two-digit number as <code>/\d\d/</code> and a
        four-digit number as <code>/\d\d\d\d/</code>. But you
        don’t have any way to describe, for example, a number that can have any
        number of digits or a string of three letters followed by an optional
        digit. These more complex patterns use regular expression syntax that
        specifies how many times an element of a regular expression may be
        repeated.</p>
        
        <p>The characters that specify repetition always follow the pattern to
        which they are being applied. Because certain types of repetition are
        quite commonly used, there are special characters to represent these
        cases. For example, <code>+</code> matches one or more occurrences of the
        previous pattern.</p>
        
        <p><a data-type="xref" href="#regexps-TABLE-3">Table&nbsp;11-3</a> summarizes the repetition syntax.</p>
        <table id="regexps-TABLE-3">
        <caption><span class="label">Table 11-3. </span>Regular expression repetition characters</caption>
        <thead>
        <tr>
        <th>Character</th>
        <th>Meaning</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p><code>{</code><em>n</em><code>,</code><em>m</em><code>}</code></p></td>
        <td><p>Match the previous item at least <em>n</em> times but no more than <em>m</em> times.</p></td>
        </tr>
        <tr>
        <td><p><code>{</code><em>n</em><code>,}</code></p></td>
        <td><p>Match the previous item <em>n</em> or more times.</p></td>
        </tr>
        <tr>
        <td><p><code>{</code><em>n</em><code>}</code></p></td>
        <td><p>Match exactly <em>n</em> occurrences of the previous item.</p></td>
        </tr>
        <tr>
        <td><p><code>?</code></p></td>
        <td><p>Match zero or one occurrences of the previous item. That is, the previous item is optional. Equivalent to <code>{0,1}</code>.</p></td>
        </tr>
        <tr>
        <td><p><code>+</code></p></td>
        <td><p>Match one or more occurrences of the previous item. Equivalent to <code>{1,}</code>.</p></td>
        </tr>
        <tr>
        <td><p><code>*</code></p></td>
        <td><p>Match zero or more occurrences of the previous item. Equivalent to <code>{0,}</code>.</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>The following lines show some examples:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">r</code> <code class="o">=</code> <code class="sr">/\d{2,4}/</code><code class="p">;</code> <code class="c1">// Match between two and four digits</code>
        <code class="nx">r</code> <code class="o">=</code> <code class="sr">/\w{3}\d?/</code><code class="p">;</code>    <code class="c1">// Match exactly three word characters and an optional digit</code>
        <code class="nx">r</code> <code class="o">=</code> <code class="sr">/\s+java\s+/</code><code class="p">;</code>  <code class="c1">// Match "java" with one or more spaces before and after</code>
        <code class="nx">r</code> <code class="o">=</code> <code class="sr">/[^(]*/</code><code class="p">;</code>       <code class="c1">// Match zero or more characters that are not open parens</code></pre>
        
        <p>Note that in all of these examples, the repetition specifiers apply to
        the single character or character class that precedes them. If you
        want to match repetitions of more complicated expressions, you’ll need
        to define a group with parentheses, which are explained in the following sections.</p>
        
        <p>Be careful when using the <code>*</code> and <code>?</code> repetition characters.
        Since these characters may match zero instances of whatever precedes
        them, they are allowed to match nothing. For example, the regular
        expression <code>/a*/</code> actually matches the string “bbbb”
        because the string contains zero occurrences of the letter a!</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="Non-greedy repetition"><div class="sect3" id="idm46198526470648">
        <h3>Non-greedy repetition</h3>
        
        <p>The<a data-type="indexterm" data-primary="pattern matching" data-secondary="defining regular expressions" data-tertiary="non-greedy repetition" id="idm46198526461512"></a> repetition characters listed in <a data-type="xref" href="#regexps-TABLE-3">Table&nbsp;11-3</a> match as many
        times as possible while still allowing any following parts of the
        regular expression to match. We say that this repetition is “greedy.”
        It is also possible to specify that repetition should be done in a
        non-greedy way. Simply follow the repetition character or characters
        with a question mark: <code>??</code>, <code>+?</code>, <code>*?</code>, or even <code>{1,5}?</code>.
        For example, the regular expression <code>/a+/</code> matches one or
        more occurrences of the letter a. When applied to the string “aaa”,
        it matches all three letters. But <code>/a+?/</code> matches one or
        more occurrences of the letter a, matching as few characters as
        necessary. When applied to the same string, this pattern matches only
        the first letter a.</p>
        
        <p>Using non-greedy repetition may not always produce the results you
        expect. Consider the pattern <code>/a+b/</code>, which matches one
        or more a’s, followed by the letter b. When applied to the string
        “aaab”, it matches the entire string. Now let’s use the non-greedy
        version: <code>/a+?b/</code>. This should match the letter b
        preceded by the fewest number of a’s possible. When applied to the same
        string “aaab”, you might expect it to match only one a and the last
        letter b. In fact, however, this pattern matches the entire string,
        just like the greedy version of the pattern. This is because
        regular expression pattern matching is done by finding the first
        position in the string at which a match is possible. Since a match is
        possible starting at the first character of the string, shorter matches
        starting at subsequent characters are never even considered.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="Alternation, grouping, and references"><div class="sect3" id="idm46198526453832">
        <h3>Alternation, grouping, and references</h3>
        
        <p>The<a data-type="indexterm" data-primary="pattern matching" data-secondary="defining regular expressions" data-tertiary="alternation, grouping, and references" id="idm46198526452088"></a> regular expression grammar includes special characters for
        specifying alternatives, grouping subexpressions, and referring to
        previous subexpressions. The <code>|</code> character separates alternatives. For
        example, <code>/ab|cd|ef/</code> matches the string “ab” or the string
        “cd” or the string “ef”. And <code>/\d{3}|[a-z]{4}/</code>
        matches either three digits or four lowercase letters.</p>
        
        <p>Note that alternatives are considered left to right until a match is
        found. If the left alternative matches, the right alternative is
        ignored, even if it would have produced a “better” match. Thus, when
        the pattern <code>/a|ab/</code> is applied to the string “ab”, it
        matches only the first letter.</p>
        
        <p>Parentheses have several purposes in regular expressions. One purpose
        is to group separate items into a single subexpression so that the
        items can be treated as a single unit by <code>|</code>, <code>*</code>, <code>+</code>,
        <code>?</code>, and so on. For example, <code>/java(script)?/</code> matches
        “java” followed by the optional “script”. And
        <code>/(ab|cd)+|ef/</code> matches either the string “ef” or one
        or more repetitions of either of the strings “ab” or “cd”.</p>
        
        <p>Another purpose of parentheses in regular expressions is to define
        subpatterns within the complete pattern. When a regular expression is
        successfully matched against a target string, it is possible to extract
        the portions of the target string that matched any particular
        parenthesized subpattern. (You’ll see how these matching substrings are
        obtained later in this section.) For example, suppose you are looking
        for one or more lowercase letters followed by one or more digits. You
        might use the pattern <code>/[a-z]+\d+/</code>. But suppose you
        only really care about the digits at the end of each match. If you put
        that part of the pattern in parentheses
        <code>(/[a-z]+(\d+)/)</code>, you can extract the digits
        from any matches you find, as explained later.</p>
        
        <p>A related use of parenthesized subexpressions is to allow you to refer
        back to a subexpression later in the same regular expression. This is
        done by following a <code>\</code> character by a digit or digits. The
        digits refer to the position of the parenthesized subexpression within
        the regular expression. For example, <code>\1</code> refers back to the
        first subexpression, and <code>\3</code> refers to the third. Note that,
        because subexpressions can be nested within others, it is the position
        of the left parenthesis that is counted. In the following regular
        expression, for example, the nested subexpression <code>([Ss]cript)</code> is
        referred to as <code>\2</code>:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="sr">/([Jj]ava([Ss]cript)?)\sis\s(fun\w*)/</code></pre>
        
        <p>A reference to a previous subexpression of a regular expression does
        <em>not</em> refer to the pattern for that subexpression but rather to the
        text that matched the pattern. Thus, references can be used to enforce
        a constraint that separate portions of a string contain exactly the
        same characters. For example, the following regular expression matches
        zero or more characters within single or double quotes. However, it
        does not require the opening and closing quotes to match (i.e., both
        single quotes or both double quotes):</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="sr">/['"][^'"]*['"]/</code></pre>
        
        <p>To require the quotes to match, use a reference:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="sr">/(['"])[^'"]*\1/</code></pre>
        
        <p>The <code>\1</code> matches whatever the first parenthesized subexpression
        matched. In this example, it enforces the constraint that the closing
        quote match the opening quote. This regular expression does not allow
        single quotes within double-quoted strings or vice versa. (It is not
        legal to use a reference within a character class, so you cannot write:
        <code>/(['"])[^\1]*\1/</code>.)</p>
        
        <p>When we cover the RegExp API later, you’ll see that this kind of
        reference to a parenthesized subexpression is a powerful feature of
        regular-expression search-and-replace operations.</p>
        
        <p>It is also possible to group items in a regular expression without
        creating a numbered reference to those items. Instead of simply
        grouping the items within <code>(</code> and <code>)</code>, begin the group with <code>(?:</code> and
        end it with <code>)</code>. Consider the following pattern:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="sr">/([Jj]ava(?:[Ss]cript)?)\sis\s(fun\w*)/</code></pre>
        
        <p>In this example, the subexpression <code>(?:[Ss]cript)</code> is used simply for grouping, so
        the <code>?</code> repetition character can be applied to the group. These
        modified parentheses do not produce a reference, so in this regular
        expression, <code>\2</code> refers to the text matched by
        <code>(fun\w*)</code>.</p>
        
        <p><a data-type="xref" href="#regexps-TABLE-4">Table&nbsp;11-4</a> summarizes the regular expression alternation,
        grouping, and referencing operators.</p>
        <table id="regexps-TABLE-4">
        <caption><span class="label">Table 11-4. </span>Regular expression alternation, grouping, and reference characters</caption>
        <thead>
        <tr>
        <th>Character</th>
        <th>Meaning</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p><code>|</code></p></td>
        <td><p>Alternation: match either the subexpression to the left or the subexpression to the right.</p></td>
        </tr>
        <tr>
        <td><p><code>(...)</code></p></td>
        <td><p>Grouping: group items into a single unit that can be used with <code>*</code>, <code>+</code>, <code>?</code>, <code>|</code>, and so on. Also remember the characters that match this group for use with later references.</p></td>
        </tr>
        <tr>
        <td><p><code>(?:...)</code></p></td>
        <td><p>Grouping only: group items into a single unit, but do not remember the characters that match this group.</p></td>
        </tr>
        <tr>
        <td><p><code>\</code><em>n</em></p></td>
        <td><p>Match the same characters that were matched when group number <em>n</em> was first matched. Groups are subexpressions within (possibly nested) parentheses. Group numbers are assigned by counting left parentheses from left to right. Groups formed with <code>(?:</code> are not numbered.</p></td>
        </tr>
        </tbody>
        </table>
        <aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46198526324248">
        <h5>Named Capture Groups</h5>
        <p>ES2018<a data-type="indexterm" data-primary="named capture groups" id="idm46198526322680"></a><a data-type="indexterm" data-primary="pattern matching" data-secondary="defining regular expressions" data-tertiary="named group captures" id="idm46198526321944"></a><a data-type="indexterm" data-primary="ES2018" data-secondary="regular expressions" data-tertiary="named capture groups" id="idm46198526320760"></a> standardizes a new feature that can make regular expressions
        more self-documenting and easier to understand. This new feature is
        known as “named capture groups” and it allows us to associate a name
        with each left parenthesis in a regular expression so that we can
        refer to the matching text by name rather than by number. Equally
        important: using names allows someone reading the code to more easily
        understand the purpose of that portion of the regular expression. As
        of early 2020, this feature is implemented in Node, Chrome, Edge, and Safari,
        but not yet by Firefox.</p>
        
        <p>To name a group, use <code>(?&lt;...&gt;</code> instead of <code>(</code> and put the name
        between the angle brackets. For example, here is a regular expression
        that might be used to check the formatting of the final line of a US
        mailing address:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="sr">/(?&lt;city&gt;\w+) (?&lt;state&gt;[A-Z]{2}) (?&lt;zipcode&gt;\d{5})(?&lt;zip9&gt;-\d{4})?/</code></pre>
        
        <p>Notice how much context the group names provide to make the regular
        expression easier to understand. In <a data-type="xref" href="#regexps-string-methods">§11.3.2</a>, when we discuss the String
        <code>replace()</code> and <code>match()</code> methods and the RegExp <code>exec()</code> method,
        you’ll see how the RegExp API allows you to refer to the text that
        matches each of these groups by name rather than by position.</p>
        
        <p>If you want to refer back to a named capture group within a regular
        expression, you can do that by name as well. In the preceding example, we were able to use a
        regular expression “backreference” to write a RegExp that would match
        a single- or double-quoted string where the open and close quotes had
        to match. We could rewrite this RegExp using a named capturing group
        and a named backreference like this:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="sr">/(?&lt;quote&gt;['"])[^'"]*\k&lt;quote&gt;/</code></pre>
        
        <p>The <code>\k&lt;quote&gt;</code> is a named backreference to the named group that
        captures the open quotation mark.</p>
        </div></aside>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="Specifying match position"><div class="sect3" id="idm46198526453208">
        <h3>Specifying match position</h3>
        
        <p>As<a data-type="indexterm" data-primary="pattern matching" data-secondary="defining regular expressions" data-tertiary="specifying match position" id="idm46198526293576"></a><a data-type="indexterm" data-primary="anchor characters" id="idm46198526284104"></a> described earlier, many elements of a regular expression match a
        single character in a string. For example, <code>\s</code> matches a single
        character of whitespace. Other regular expression elements match the
        positions between characters instead of actual characters. <code>\b</code>,
        for example, matches an ASCII word boundary—the boundary between a <code>\w</code>
        (ASCII word character) and a <code>\W</code> (nonword character), or the
        boundary between an ASCII word character and the beginning or end of a
        string.<sup><a data-type="noteref" id="idm46198526281256-marker" href="ch11.html#idm46198526281256">4</a></sup> Elements such as
        <code>\b</code> do not specify any characters to be used in a matched
        string; what they do specify, however, are legal positions at which a
        match can occur. Sometimes these elements are called
        <em>regular expression anchors</em> because they anchor the pattern to a
        specific position in the search string. The most commonly used anchor
        elements are <code>^</code>, which ties the pattern to the beginning of the
        string, and <code>$</code>, which anchors the pattern to the end of the string.</p>
        
        <p>For example, to match the word “JavaScript” on a line by itself, you
        can use the regular expression <code>/^JavaScript$/</code>. If you want
        to search for “Java” as a word by itself (not as a prefix, as it is
        in “JavaScript”), you can try the pattern
        <code>/\sJava\s/</code>, which requires a space before and after
        the word. But there are two problems with this solution. First, it does
        not match “Java” at the beginning or the end of a string, but only if
        it appears with space on either side. Second, when this pattern does
        find a match, the matched string it returns has leading and trailing
        spaces, which is not quite what’s needed. So instead of matching actual
        space characters with <code>\s</code>, match (or anchor to) word boundaries
        with <code>\b</code>. The resulting expression is
        <code>/\bJava\b/</code>. The element <code>\B</code> anchors the
        match to a location that is not a word boundary. Thus, the pattern <span class="keep-together"><code>/\B[Ss]cript/</code></span> matches “JavaScript” and
        “postscript”, but not “script” or <span class="keep-together">“Scripting”.</span></p>
        
        <p>You can also use arbitrary regular expressions as anchor conditions. If
        you include an expression within <code>(?=</code> and <code>)</code> characters, it is a
        lookahead assertion, and it specifies that the enclosed characters must
        match, without actually matching them. For example, to match the name
        of a common programming language, but only if it is followed by a
        colon, you could use <code>/[Jj]ava([Ss]cript)?(?=\:)/</code>. This
        pattern matches the word “JavaScript” in “JavaScript: The Definitive
        Guide”, but it does not match “Java” in “Java in a Nutshell”
        because it is not followed by a colon.</p>
        
        <p>If you instead introduce an assertion with <code>(?!</code>, it is a negative
        lookahead assertion, which specifies that the following characters must
        not match. For example, <code>/Java(?!Script)([A-Z]\w*)/</code>
        matches “Java” followed by a capital letter and any number of
        additional ASCII word characters, as long as “Java” is not followed
        by “Script”. It matches “JavaBeans” but not “Javanese”, and it
        matches “JavaScrip” but not “JavaScript” or “JavaScripter”. <a data-type="xref" href="#regexps-TABLE-5">Table&nbsp;11-5</a> summarizes regular expression anchors.</p>
        <table id="regexps-TABLE-5">
        <caption><span class="label">Table 11-5. </span>Regular expression anchor characters</caption>
        <thead>
        <tr>
        <th>Character</th>
        <th>Meaning</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p><code>^</code></p></td>
        <td><p>Match the beginning of the string or, with the <code>m</code> flag, the beginning of a line.</p></td>
        </tr>
        <tr>
        <td><p><code>$</code></p></td>
        <td><p>Match the end of the string and, with the <code>m</code> flag, the end of a line.</p></td>
        </tr>
        <tr>
        <td><p><code>\b</code></p></td>
        <td><p>Match a word boundary. That is, match the position between a <code>\w</code> character and a <code>\W</code> character or between a <code>\w</code> character and the beginning or end of a string. (Note, however, that <code>[\b]</code> matches backspace.)</p></td>
        </tr>
        <tr>
        <td><p><code>\B</code></p></td>
        <td><p>Match a position that is not a word boundary.</p></td>
        </tr>
        <tr>
        <td><p><code>(?=</code><em>p</em><code>)</code></p></td>
        <td><p>A positive lookahead assertion. Require that the following characters match the pattern <em>p</em>, but do not include those characters in the match.</p></td>
        </tr>
        <tr>
        <td><p><code>(?!</code><em>p</em><code>)</code></p></td>
        <td><p>A negative lookahead assertion. Require that the following characters do not match the pattern <em>p</em>.</p></td>
        </tr>
        </tbody>
        </table>
        <aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46198526219368">
        <h5>Lookbehind Assertions</h5>
        <p>ES2018<a data-type="indexterm" data-primary="pattern matching" data-secondary="defining regular expressions" data-tertiary="lookbehind assertions" id="idm46198526217864"></a><a data-type="indexterm" data-primary="ES2018" data-secondary="regular expressions" data-tertiary="lookbehind assertions" id="idm46198526216568"></a><a data-type="indexterm" data-primary="lookbehind assertions" id="idm46198526215352"></a> extends regular expression syntax to allow “lookbehind”
        assertions. These are like lookahead assertions but refer to text
        before the current match position. As of early 2020, these are
        implemented in Node, Chrome, and Edge, but not Firefox or Safari.</p>
        
        <p>Specify a positive lookbehind assertion with <code>(?&lt;=...)</code> and a negative
        lookbehind assertion with <code>(?&lt;!...)</code>.  For example, if you were
        working with US mailing addresses, you could match a 5-digit zip code,
        but only when it follows a two-letter state abbreviation, like this:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="sr">/(?&lt;= [A-Z]{2} )\d{5}/</code></pre>
        
        <p>And you could match a string of digits that is not preceded by a
        Unicode currency symbol with a negative lookbehind assertion like this:</p>
        
        <pre data-type="programlisting">/(?&lt;![\p{Currency_Symbol}\d.])\d+(\.\d+)?/u</pre>
        </div></aside>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="Flags"><div class="sect3" id="idm46198526209112">
        <h3>Flags</h3>
        
        <p>Every<a data-type="indexterm" data-primary="pattern matching" data-secondary="defining regular expressions" data-tertiary="flags" id="idm46198526207880"></a> regular expression can have one or more flags associated with
        it to alter its matching behavior. JavaScript defines six possible flags,
        each of which is represented by a single letter. Flags are specified
        after the second <code>/</code> character of a regular expression literal or as
        a string passed as the second argument to the <code>RegExp()</code> constructor. The supported flags and their meanings are:</p>
        <dl>
        <dt><code>g</code></dt>
        <dd>
        <p>The <code>g</code> flag indicates that the regular expression is
        “global”—that is, that we intend to use it to find all matches within
        a string rather than just finding the first match. This flag does not
        alter the way that pattern matching is done, but, as we’ll see later,
        it does alter the behavior of the String <code>match()</code> method and the
        RegExp <code>exec()</code> method in important ways.</p>
        </dd>
        <dt><code>i</code></dt>
        <dd>
        <p>The <code>i</code> flag specifies that pattern matching should be
        case-insensitive.</p>
        </dd>
        <dt><code>m</code></dt>
        <dd>
        <p>The <code>m</code> flag specifies that matching should be done in
        “multiline” mode. It says that the RegExp will be used with multiline
        strings and that the <code>^</code> and <code>$</code> anchors should match both the
        beginning and end of the string and also the beginning and end of
        individual lines within the string.</p>
        </dd>
        <dt><code>s</code></dt>
        <dd>
        <p>Like the <code>m</code> flag, the <code>s</code> flag is also useful when working with
        text that includes newlines. Normally, a “.” in a regular expression
        matches any character except a line terminator. When the <code>s</code> flag is
        used, however, “.” will match any character, including line
        terminators. The<a data-type="indexterm" data-primary="ES2018" data-secondary="regular expressions" data-tertiary="s flag" id="idm46198526195992"></a> <code>s</code> flag was added to JavaScript in ES2018 and, as of
        early 2020, is supported in Node, Chrome, Edge, and Safari, but not Firefox.</p>
        </dd>
        <dt><code>u</code></dt>
        <dd>
        <p>The <code>u</code> flag stands for Unicode, and it makes the regular expression
        match full Unicode codepoints rather than matching 16-bit
        values. This flag was introduced in ES6, and you should make a habit
        of using it on all regular expressions unless you have some reason not
        to. If you do not use this flag, then your RegExps will not work well
        with text that includes emoji and other characters (including many
        Chinese characters) that require more than 16 bits. Without the <code>u</code> flag,
        the “.” character matches any 1 UTF-16 16-bit value. With the flag,
        however, “.” matches one Unicode codepoint, including those that have
        more than 16 bits. Setting the <code>u</code> flag on a RegExp also allows you to use
        the new <code>\u{...}</code> escape sequence for Unicode character and also
        enables the <code>\p{...}</code> notation for Unicode character classes.</p>
        </dd>
        <dt><code>y</code></dt>
        <dd>
        <p>The <code>y</code> flag indicates that the regular expression is “sticky”
        and should match at the beginning of a string or at the first
        character following the previous match. When used with a regular
        expression that is designed to find a single match, it effectively
        treats that regular expression as if it begins with <code>^</code> to anchor it
        to the beginning of the string. This flag is more useful with regular
        expressions that are used repeatedly to find all matches within a
        string. In this case, it causes special behavior of the String
        <code>match()</code> method and the RegExp <code>exec()</code> method to enforce that each
        subsequent match is anchored to the string position at which the last
        one ended.</p>
        </dd>
        </dl>
        
        <p>These flags may be specified in any combination and in any order. For
        example, if you want your regular expression to be Unicode-aware to
        do case-insensitive matching and you intend to use it to find
        multiple matches within a string, you would specify the flags <code>uig</code>,
        <code>gui</code>, or any other permutation of these three letters.</p>
        </div></section>
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.3.2 String Methods for Pattern Matching"><div class="sect2" id="regexps-string-methods">
        <h2>11.3.2 String Methods for Pattern Matching</h2>
        
        <p>Until<a data-type="indexterm" data-primary="pattern matching" data-secondary="string methods for" data-tertiary="search()" id="idm46198526162056"></a><a data-type="indexterm" data-primary="search() method" id="idm46198526160776"></a><a data-type="indexterm" data-primary="strings" data-secondary="methods for pattern matching" data-tertiary="search()" id="idm46198526160104"></a> now, we have been describing the grammar used to define regular
        expressions, but not explaining how those regular expressions can
        actually be used in JavaScript code. We are now switching to cover the
        API for using RegExp objects. This section begins by explaining the
        string methods that use regular expressions to perform pattern
        matching and search-and-replace operations. The sections that follow
        this one continue the discussion of pattern matching with JavaScript
        regular expressions by discussing the RegExp object and its methods
        and properties.</p>
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="search()"><div class="sect3" id="idm46198526158088">
        <h3>search()</h3>
        
        <p>Strings support four methods that use regular expressions. The simplest
        is <code>search()</code>. This method takes a regular expression argument and
        returns either the character position of the start of the first
        matching substring or −1 if there is no match:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="s2">"JavaScript"</code><code class="p">.</code><code class="nx">search</code><code class="p">(</code><code class="err">/script/ui)  // =&gt; 4</code>
        <code class="s2">"Python"</code><code class="p">.</code><code class="nx">search</code><code class="p">(</code><code class="err">/script/ui)      // =&gt; -1</code></pre>
        
        <p>If the argument to <code>search()</code> is not a regular expression, it is first
        converted to one by passing it to the <code>RegExp</code> constructor. <code>search()</code>
        does not support global searches; it ignores the <code>g</code> flag of its
        regular expression argument.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="replace()"><div class="sect3" id="idm46198526145880">
        <h3>replace()</h3>
        
        <p>The<a data-type="indexterm" data-primary="pattern matching" data-secondary="string methods for" data-tertiary="replace()" id="idm46198526144152"></a><a data-type="indexterm" data-primary="strings" data-secondary="methods for pattern matching" data-tertiary="replace()" id="idm46198526137864"></a> <code>replace()</code> method performs a search-and-replace operation. It
        takes a regular expression as its first argument and a replacement
        string as its second argument. It searches the string on which it is
        called for matches with the specified pattern. If the regular
        expression has the <code>g</code> flag set, the <code>replace()</code> method replaces all
        matches in the string with the replacement string; otherwise, it
        replaces only the first match it finds. If the first argument to
        <code>replace()</code> is a string rather than a regular expression, the method
        searches for that string literally rather than converting it to a
        regular expression with the <code>RegExp()</code> constructor, as <code>search()</code> does.
        As an example, you can use <code>replace()</code> as follows to provide uniform
        capitalization of the word “JavaScript” throughout a string of text:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// No matter how it is capitalized, replace it with the correct capitalization</code>
        <code class="nx">text</code><code class="p">.</code><code class="nx">replace</code><code class="p">(</code><code class="sr">/javascript/gi</code><code class="p">,</code> <code class="s2">"JavaScript"</code><code class="p">);</code></pre>
        
        <p><code>replace()</code> is more powerful than this, however. Recall that
        parenthesized subexpressions of a regular expression are numbered from
        left to right and that the regular expression remembers the text that
        each subexpression matches. If a <code>$</code> followed by a digit appears in
        the replacement string, <code>replace()</code> replaces those two characters with
        the text that matches the specified subexpression. This is a very
        useful feature. You can use it, for example, to replace quotation marks
        in a string with other characters:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// A quote is a quotation mark, followed by any number of</code>
        <code class="c1">// nonquotation mark characters (which we capture), followed</code>
        <code class="c1">// by another quotation mark.</code>
        <code class="kd">let</code> <code class="nx">quote</code> <code class="o">=</code> <code class="sr">/"([^"]*)"/g</code><code class="p">;</code>
        <code class="c1">// Replace the straight quotation marks with guillemets</code>
        <code class="c1">// leaving the quoted text (stored in $1) unchanged.</code>
        <code class="s1">'He said "stop"'</code><code class="p">.</code><code class="nx">replace</code><code class="p">(</code><code class="nx">quote</code><code class="p">,</code> <code class="s1">'«$1»'</code><code class="p">)</code>  <code class="c1">// =&gt; 'He said «stop»'</code></pre>
        
        <p>If your RegExp uses named capture groups, then you can refer to the
        matching text by name rather than by number:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">quote</code> <code class="o">=</code> <code class="sr">/"(?&lt;quotedText&gt;[^"]*)"/g</code><code class="p">;</code>
        <code class="s1">'He said "stop"'</code><code class="p">.</code><code class="nx">replace</code><code class="p">(</code><code class="nx">quote</code><code class="p">,</code> <code class="s1">'«$&lt;quotedText&gt;»'</code><code class="p">)</code>  <code class="c1">// =&gt; 'He said «stop»'</code></pre>
        
        <p>Instead of passing a replacement string as the second argument to
        <code>replace()</code>, you can also pass a function that will be invoked to
        compute the replacement value. The replacement function is invoked
        with a number of arguments. First is the entire matched text. Next, if
        the RegExp has capturing groups, then the substrings that were captured
        by those groups are passed as arguments. The next argument is the
        position within the string at which the match was found. After that,
        the entire string that <code>replace()</code> was called on is passed. And
        finally, if the RegExp contained any named capture groups, the last
        argument to the replacement function is an object whose property names
        match the capture group names and whose values are the matching
        text. As an example, here is code that uses a replacement function to
        convert decimal integers in a string to hexadecimal:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">s</code> <code class="o">=</code> <code class="s2">"15 times 15 is 225"</code><code class="p">;</code>
        <code class="nx">s</code><code class="p">.</code><code class="nx">replace</code><code class="p">(</code><code class="err">/\d+/gu, n =&gt; parseInt(n).toString(16))  // =&gt; "f times f is e1"</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="match()"><div class="sect3" id="idm46198526145720">
        <h3>match()</h3>
        
        <p>The<a data-type="indexterm" data-primary="pattern matching" data-secondary="string methods for" data-tertiary="match()" id="idm46198526005480"></a><a data-type="indexterm" data-primary="match() method" id="idm46198526004200"></a><a data-type="indexterm" data-primary="strings" data-secondary="methods for pattern matching" data-tertiary="match()" id="idm46198526003528"></a> <code>match()</code> method is the most general of the String
        regular expression methods. It takes a regular expression as its only
        argument (or converts its argument to a regular expression by passing
        it to the <code>RegExp()</code> constructor) and returns an array that contains
        the results of the match, or <code>null</code> if no match is found. If the
        regular expression has the <code>g</code> flag set, the method returns an array
        of all matches that appear in the string. For example:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="s2">"7 plus 8 equals 15"</code><code class="p">.</code><code class="nx">match</code><code class="p">(</code><code class="sr">/\d+/g</code><code class="p">)</code>  <code class="c1">// =&gt; ["7", "8", "15"]</code></pre>
        
        <p>If the regular expression does not have the <code>g</code> flag set, <code>match()</code>
        does not do a global search; it simply searches for the first match.
        In this nonglobal case, <code>match()</code> still returns an array, but the
        array elements are completely different. Without the <code>g</code> flag, the
        first element of the returned array is the matching string, and any
        remaining elements are the substrings matching the parenthesized
        capturing groups of the regular expression. Thus, if <code>match()</code> returns
        an array <code>a</code>, <code>a[0]</code> contains the complete match, <code>a[1]</code> contains the
        substring that matched the first parenthesized expression, and so on.
        To draw a parallel with the <code>replace()</code> method, <code>a[1]</code> is the same
        string as <code>$1</code>, <code>a[2]</code> is the same as <code>$2</code>, and so on.</p>
        
        <p>For example, consider parsing a URL<sup><a data-type="noteref" id="idm46198525964472-marker" href="ch11.html#idm46198525964472">5</a></sup> with the following code:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// A very simple URL parsing RegExp</code>
        <code class="kd">let</code> <code class="nx">url</code> <code class="o">=</code> <code class="sr">/(\w+):\/\/([\w.]+)\/(\S*)/</code><code class="p">;</code>
        <code class="kd">let</code> <code class="nx">text</code> <code class="o">=</code> <code class="s2">"Visit my blog at http://www.example.com/~david"</code><code class="p">;</code>
        <code class="kd">let</code> <code class="nx">match</code> <code class="o">=</code> <code class="nx">text</code><code class="p">.</code><code class="nx">match</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>
        <code class="kd">let</code> <code class="nx">fullurl</code><code class="p">,</code> <code class="nx">protocol</code><code class="p">,</code> <code class="nx">host</code><code class="p">,</code> <code class="nx">path</code><code class="p">;</code>
        <code class="k">if</code> <code class="p">(</code><code class="nx">match</code> <code class="o">!==</code> <code class="kc">null</code><code class="p">)</code> <code class="p">{</code>
            <code class="nx">fullurl</code> <code class="o">=</code> <code class="nx">match</code><code class="p">[</code><code class="mi">0</code><code class="p">];</code>   <code class="c1">// fullurl == "http://www.example.com/~david"</code>
            <code class="nx">protocol</code> <code class="o">=</code> <code class="nx">match</code><code class="p">[</code><code class="mi">1</code><code class="p">];</code>  <code class="c1">// protocol == "http"</code>
            <code class="nx">host</code> <code class="o">=</code> <code class="nx">match</code><code class="p">[</code><code class="mi">2</code><code class="p">];</code>      <code class="c1">// host == "www.example.com"</code>
            <code class="nx">path</code> <code class="o">=</code> <code class="nx">match</code><code class="p">[</code><code class="mi">3</code><code class="p">];</code>      <code class="c1">// path == "~david"</code>
        <code class="p">}</code></pre>
        
        <p>In this non-global case, the array returned by <code>match()</code> also has some
        object properties in addition to the numbered array elements. The
        <code>input</code> property refers to the string on which <code>match()</code> was
        called. The <code>index</code> property is the position within that string at
        which the match starts. And if the regular expression contains named
        capture groups, then the returned array also has a <code>groups</code> property
        whose value is an object. The properties of this object match the
        names of the named groups, and the values are the matching text. We
        could rewrite the previous URL parsing example, for example, like this:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">url</code> <code class="o">=</code> <code class="sr">/(?&lt;protocol&gt;\w+):\/\/(?&lt;host&gt;[\w.]+)\/(?&lt;path&gt;\S*)/</code><code class="p">;</code>
        <code class="kd">let</code> <code class="nx">text</code> <code class="o">=</code> <code class="s2">"Visit my blog at http://www.example.com/~david"</code><code class="p">;</code>
        <code class="kd">let</code> <code class="nx">match</code> <code class="o">=</code> <code class="nx">text</code><code class="p">.</code><code class="nx">match</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>
        <code class="nx">match</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code>               <code class="c1">// =&gt; "http://www.example.com/~david"</code>
        <code class="nx">match</code><code class="p">.</code><code class="nx">input</code>            <code class="c1">// =&gt; text</code>
        <code class="nx">match</code><code class="p">.</code><code class="nx">index</code>            <code class="c1">// =&gt; 17</code>
        <code class="nx">match</code><code class="p">.</code><code class="nx">groups</code><code class="p">.</code><code class="nx">protocol</code>  <code class="c1">// =&gt; "http"</code>
        <code class="nx">match</code><code class="p">.</code><code class="nx">groups</code><code class="p">.</code><code class="nx">host</code>      <code class="c1">// =&gt; "www.example.com"</code>
        <code class="nx">match</code><code class="p">.</code><code class="nx">groups</code><code class="p">.</code><code class="nx">path</code>      <code class="c1">// =&gt; "~david"</code></pre>
        
        <p>We’ve seen that <code>match()</code> behaves quite differently depending on
        whether the RegExp has the <code>g</code> flag set or not. There are also
        important but less dramatic differences in behavior when the <code>y</code> flag
        is set.  Recall that the <code>y</code> flag makes a regular expression “sticky”
        by constraining where in the string matches can begin.  If a RegExp
        has both the <code>g</code> and <code>y</code> flags set, then <code>match()</code> returns an array of
        matched strings, just as it does when <code>g</code> is set without <code>y</code>. But the
        first match must begin at the start of the string, and each subsequent
        match must begin at the character immediately following the previous
        match.</p>
        
        <p>If the <code>y</code> flag is set without <code>g</code>, then <code>match()</code> tries to find a
        single match, and, by default, this match is constrained to the start
        of the string. You can change this default match start position,
        however, by setting the <code>lastIndex</code> property of the RegExp object at
        the index at which you want to match at. If a match is found, then
        this <code>lastIndex</code> will be automatically updated to the first character
        after the match, so if you call <code>match()</code> again, in this case, it will
        look for a subsequent match. (<code>lastIndex</code> may seem like a strange name
        for a property that specifies the position at which to begin the
        <em>next</em> match. We will see it again when we cover the RegExp <code>exec()</code>
        method, and its name may make more sense in that context.)</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">vowel</code> <code class="o">=</code> <code class="err">/[aeiou]/y;  // Sticky vowel match</code>
        <code class="s2">"test"</code><code class="p">.</code><code class="nx">match</code><code class="p">(</code><code class="nx">vowel</code><code class="p">)</code>      <code class="c1">// =&gt; null: "test" does not begin with a vowel</code>
        <code class="nx">vowel</code><code class="p">.</code><code class="nx">lastIndex</code> <code class="o">=</code> <code class="mi">1</code><code class="p">;</code>     <code class="c1">// Specify a different match position</code>
        <code class="s2">"test"</code><code class="p">.</code><code class="nx">match</code><code class="p">(</code><code class="nx">vowel</code><code class="p">)[</code><code class="mi">0</code><code class="p">]</code>   <code class="c1">// =&gt; "e": we found a vowel at position 1</code>
        <code class="nx">vowel</code><code class="p">.</code><code class="nx">lastIndex</code>          <code class="c1">// =&gt; 2: lastIndex was automatically updated</code>
        <code class="s2">"test"</code><code class="p">.</code><code class="nx">match</code><code class="p">(</code><code class="nx">vowel</code><code class="p">)</code>      <code class="c1">// =&gt; null: no vowel at position 2</code>
        <code class="nx">vowel</code><code class="p">.</code><code class="nx">lastIndex</code>          <code class="c1">// =&gt; 0: lastIndex gets reset after failed match</code></pre>
        
        <p>It is worth noting that passing a non-global regular expression to the
        <code>match()</code> method of a string is the same as passing the string
        to the <code>exec()</code> method of the regular expression: the returned array
        and its properties are the same in both cases.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="matchAll()"><div class="sect3" id="idm46198526006552">
        <h3>matchAll()</h3>
        
        <p>The<a data-type="indexterm" data-primary="pattern matching" data-secondary="string methods for" data-tertiary="matchAll()" id="idm46198525674936"></a><a data-type="indexterm" data-primary="strings" data-secondary="methods for pattern matching" data-tertiary="matchAll()" id="idm46198525673656"></a><a data-type="indexterm" data-primary="matchAll() method" id="idm46198525672472"></a> <code>matchAll()</code> method is defined<a data-type="indexterm" data-primary="ES2020" data-secondary="matchAll() method" id="idm46198525671256"></a> in ES2020, and as of early 2020 is
        implemented by modern web browsers and Node. <code>matchAll()</code> expects a
        RegExp with the <code>g</code> flag set. Instead of returning an array of
        matching substrings like <code>match()</code> does, however, it returns an
        iterator that yields the kind of match objects that <code>match()</code> returns
        when used with a non-global RegExp. This makes <code>matchAll()</code> the
        easiest and most general way to loop through all matches within a
        string.</p>
        
        <p>You might use <code>matchAll()</code> to loop through the words in a string of
        text like this:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// One or more Unicode alphabetic characters between word boundaries</code>
        <code class="kr">const</code> <code class="nx">words</code> <code class="o">=</code> <code class="err">/\b\p{Alphabetic}+\b/gu; // \p is not supported in Firefox yet</code>
        <code class="kr">const</code> <code class="nx">text</code> <code class="o">=</code> <code class="s2">"This is a naïve test of the matchAll() method."</code><code class="p">;</code>
        <code class="k">for</code><code class="p">(</code><code class="kd">let</code> <code class="nx">word</code> <code class="k">of</code> <code class="nx">text</code><code class="p">.</code><code class="nx">matchAll</code><code class="p">(</code><code class="nx">words</code><code class="p">))</code> <code class="p">{</code>
            <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Found '</code><code class="si">${</code><code class="nx">word</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="si">}</code><code class="sb">' at index </code><code class="si">${</code><code class="nx">word</code><code class="p">.</code><code class="nx">index</code><code class="si">}</code><code class="sb">.`</code><code class="p">);</code>
        <code class="p">}</code></pre>
        
        <p>You can set the <code>lastIndex</code> property of a RegExp object to tell
        <code>matchAll()</code> what index in the string to begin matching at. Unlike the
        other pattern-matching methods, however, <code>matchAll()</code> never modifies
        the <code>lastIndex</code> property of the RegExp you call it on, and this makes
        it much less likely to cause bugs in your code.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="split()"><div class="sect3" id="idm46198525595096">
        <h3>split()</h3>
        
        <p>The<a data-type="indexterm" data-primary="pattern matching" data-secondary="string methods for" data-tertiary="split()" id="idm46198525593528"></a><a data-type="indexterm" data-primary="strings" data-secondary="methods for pattern matching" data-tertiary="split()" id="idm46198525592248"></a><a data-type="indexterm" data-primary="split() method" id="idm46198525591064"></a> last of the regular expression methods of the String object is
        <code>split()</code>. This method breaks the string on which it is called into an
        array of substrings, using the argument as a separator. It can be used
        with a string argument like this:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="s2">"123,456,789"</code><code class="p">.</code><code class="nx">split</code><code class="p">(</code><code class="s2">","</code><code class="p">)</code>           <code class="c1">// =&gt; ["123", "456", "789"]</code></pre>
        
        <p>The <code>split()</code> method can also take a regular expression as its
        argument, and this allows you to specify more general separators. Here
        we call it with a separator that includes an arbitrary amount of
        whitespace on either side:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="s2">"1, 2, 3,\n4, 5"</code><code class="p">.</code><code class="nx">split</code><code class="p">(</code><code class="sr">/\s*,\s*/</code><code class="p">)</code>  <code class="c1">// =&gt; ["1", "2", "3", "4", "5"]</code></pre>
        
        <p>Surprisingly, if you call <code>split()</code> with a RegExp delimiter and the
        regular expression includes capturing groups, then the text that
        matches the capturing groups will be included in the returned
        array. For example:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kr">const</code> <code class="nx">htmlTag</code> <code class="o">=</code> <code class="sr">/&lt;([^&gt;]+)&gt;/</code><code class="p">;</code>  <code class="c1">// &lt; followed by one or more non-&gt;, followed by &gt;</code>
        <code class="s2">"Testing&lt;br/&gt;1,2,3"</code><code class="p">.</code><code class="nx">split</code><code class="p">(</code><code class="nx">htmlTag</code><code class="p">)</code>  <code class="c1">// =&gt; ["Testing", "br/", "1,2,3"]</code></pre>
        </div></section>
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.3.3 The RegExp Class"><div class="sect2" id="idm46198525594760">
        <h2>11.3.3 The RegExp Class</h2>
        
        <p>This<a data-type="indexterm" data-primary="pattern matching" data-secondary="RegExp class" data-tertiary="overview of" id="idm46198525570232"></a><a data-type="indexterm" data-primary="RegExp class" data-secondary="overview of" id="idm46198525568984"></a> section documents the <code>RegExp()</code> constructor, the properties of
        RegExp instances, and two important pattern-matching methods defined
        by the RegExp class.</p>
        
        <p>The <code>RegExp()</code> constructor takes one or two string arguments and
        creates a new RegExp object. The first argument to this constructor is
        a string that contains the body of the regular expression—the text
        that would appear within slashes in a regular-expression literal. Note
        that both string literals and regular expressions use the <code>\</code>
        character for escape sequences, so when you pass a regular expression
        to <code>RegExp()</code> as a string literal, you must replace each <code>\</code> character
        with <code>\\</code>. The second argument to <code>RegExp()</code> is optional. If supplied,
        it indicates the regular expression flags. It should be <code>g</code>, <code>i</code>, <code>m</code>,
        <code>s</code>, <code>u</code>, <code>y</code>, or any combination of those letters.</p>
        
        <p>For example:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// Find all five-digit numbers in a string. Note the double \\ in this case.</code>
        <code class="kd">let</code> <code class="nx">zipcode</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">RegExp</code><code class="p">(</code><code class="s2">"\\d{5}"</code><code class="p">,</code> <code class="s2">"g"</code><code class="p">);</code></pre>
        
        <p>The <code>RegExp()</code> constructor is useful when a regular expression is being
        dynamically created and thus cannot be represented with the
        regular expression literal syntax. For example, to search for a string
        entered by the user, a regular expression must be created at runtime
        with <code>RegExp()</code>.</p>
        
        <p>Instead of passing a string as the first argument to <code>RegExp()</code>, you
        can also pass a RegExp object. This allows you to copy a regular
        expression and change its flags:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">exactMatch</code> <code class="o">=</code> <code class="sr">/JavaScript/</code><code class="p">;</code>
        <code class="kd">let</code> <code class="nx">caseInsensitive</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">RegExp</code><code class="p">(</code><code class="nx">exactMatch</code><code class="p">,</code> <code class="s2">"i"</code><code class="p">);</code></pre>
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="RegExp properties"><div class="sect3" id="idm46198525458008">
        <h3>RegExp properties</h3>
        
        <p>RegExp<a data-type="indexterm" data-primary="pattern matching" data-secondary="RegExp class" data-tertiary="RegExp properties" id="idm46198525427144"></a><a data-type="indexterm" data-primary="RegExp class" data-secondary="RegExp properties" id="idm46198525425864"></a> objects have the following properties:</p>
        <dl>
        <dt><code>source</code></dt>
        <dd>
        <p>This read-only property is the source text of the regular
        expression: the characters that appear between the slashes in a
        RegExp literal.</p>
        </dd>
        <dt><code>flags</code></dt>
        <dd>
        <p>This read-only property is a string that specifies the set
        of letters that represent the flags for the RegExp.</p>
        </dd>
        <dt><code>global</code></dt>
        <dd>
        <p>A read-only boolean property that is true if the <code>g</code> flag
        is set.</p>
        </dd>
        <dt><code>ignoreCase</code></dt>
        <dd>
        <p>A read-only boolean property that is true if the <code>i</code>
        flag is set.</p>
        </dd>
        <dt><code>multiline</code></dt>
        <dd>
        <p>A read-only boolean property that is true if the <code>m</code>
        flag is set.</p>
        </dd>
        <dt><code>dotAll</code></dt>
        <dd>
        <p>A read-only boolean property that is true if the <code>s</code>
        flag is set.</p>
        </dd>
        <dt><code>unicode</code></dt>
        <dd>
        <p>A read-only boolean property that is true if the <code>u</code>
        flag is set.</p>
        </dd>
        <dt><code>sticky</code></dt>
        <dd>
        <p>A read-only boolean property that is true if the <code>y</code>
        flag is set.</p>
        </dd>
        <dt><code>lastIndex</code></dt>
        <dd>
        <p>This property is a read/write integer. For patterns with
        the <code>g</code> or <code>y</code> flags, it specifies the character position at which the
        next search is to begin. It is used by the <code>exec()</code> and <code>test()</code>
        methods, described in the next two subsections.</p>
        </dd>
        </dl>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="test()"><div class="sect3" id="idm46198525394600">
        <h3>test()</h3>
        
        <p>The<a data-type="indexterm" data-primary="pattern matching" data-secondary="RegExp class" data-tertiary="test() method" id="idm46198525375496"></a><a data-type="indexterm" data-primary="test() method" id="idm46198525357112"></a><a data-type="indexterm" data-primary="RegExp class" data-secondary="test() method" id="idm46198525356408"></a> <code>test()</code> method of the RegExp class is the simplest way to use a
        regular expression. It takes a single string argument and returns
        <code>true</code> if the string matches the pattern or <code>false</code> if it does not
        match.</p>
        
        <p><code>test()</code> works by simply calling the (much more complicated) <code>exec()</code>
        method described in the next section and returning <code>true</code> if <code>exec()</code> returns a
        non-null value. Because of this, if you use <code>test()</code> with a RegExp that
        uses the <code>g</code> or <code>y</code> flags, then its behavior depends on the value of
        the <code>lastIndex</code> property of the RegExp object, which can change
        unexpectedly. See <a data-type="xref" href="#lastIndexprop_andRER">“The lastIndex Property and RegExp Reuse”</a> for more details.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="exec()"><div class="sect3" id="idm46198525348952">
        <h3>exec()</h3>
        
        <p>The<a data-type="indexterm" data-primary="pattern matching" data-secondary="RegExp class" data-tertiary="exec() method" id="idm46198525347224"></a><a data-type="indexterm" data-primary="exec() method" id="idm46198525345976"></a><a data-type="indexterm" data-primary="RegExp class" data-secondary="exec() method" id="idm46198525345272"></a> RegExp <code>exec()</code> method is the most general and powerful way to use
        regular expressions. It takes a single string argument and looks for a
        match in that string. If no match is found, it returns <code>null</code>. If a
        match is found, however, it returns an array just like the array
        returned by the <code>match()</code> method for non-global searches. Element 0 of
        the array contains the string that matched the regular expression, and
        any subsequent array elements contain the substrings that matched any
        capturing groups. The returned array also has named properties: the
        <code>index</code> property contains the character position at which the match
        occurred, and the <code>input</code> property specifies the string that was
        searched, and the <code>groups</code> property, if defined, refers to an object
        that holds the substrings matching the any named capturing groups.</p>
        
        <p>Unlike the String <code>match()</code> method, <code>exec()</code> returns the same kind of
        array whether or not the regular expression has the global <code>g</code>
        flag. Recall that <code>match()</code> returns an array of matches when passed a
        global regular expression. <code>exec()</code>, by contrast, always returns a
        single match and provides complete information about that match. When
        <code>exec()</code> is called on a regular expression that has either the global
        <code>g</code> flag or the sticky <code>y</code> flag set, it consults the <code>lastIndex</code>
        property of the RegExp object to determine where to start looking for
        a match. (And if the <code>y</code> flag is set, it also constrains the match to
        begin at that position.) For a newly created RegExp object,
        <code>lastIndex</code> is 0, and the search begins at the start of the string. But
        each time <code>exec()</code> successfully finds a match, it updates the
        <code>lastIndex</code> property to the index of the character immediately after
        the matched text.  If <code>exec()</code> fails to find a match, it resets
        <code>lastIndex</code> to 0. This special behavior allows you to call <code>exec()</code>
        repeatedly in order to loop through all the regular expression matches
        in a string. (Although, as we’ve described, in<a data-type="indexterm" data-primary="ES2020" data-secondary="matchAll() method" id="idm46198525332920"></a> ES2020 and later, the
        <code>matchAll()</code> method of String is an easier way to loop through all
        matches.) For example, the loop in the following code will run twice:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">pattern</code> <code class="o">=</code> <code class="sr">/Java/g</code><code class="p">;</code>
        <code class="kd">let</code> <code class="nx">text</code> <code class="o">=</code> <code class="s2">"JavaScript &gt; Java"</code><code class="p">;</code>
        <code class="kd">let</code> <code class="nx">match</code><code class="p">;</code>
        <code class="k">while</code><code class="p">((</code><code class="nx">match</code> <code class="o">=</code> <code class="nx">pattern</code><code class="p">.</code><code class="nx">exec</code><code class="p">(</code><code class="nx">text</code><code class="p">))</code> <code class="o">!==</code> <code class="kc">null</code><code class="p">)</code> <code class="p">{</code>
            <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Matched </code><code class="si">${</code><code class="nx">match</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="si">}</code><code class="sb"> at </code><code class="si">${</code><code class="nx">match</code><code class="p">.</code><code class="nx">index</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
            <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Next search begins at </code><code class="si">${</code><code class="nx">pattern</code><code class="p">.</code><code class="nx">lastIndex</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
        <code class="p">}</code></pre>
        <aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="lastIndexprop_andRER">
        <h5>The lastIndex Property and RegExp Reuse</h5>
        <p>As<a data-type="indexterm" data-primary="pattern matching" data-secondary="RegExp class" data-tertiary="lastIndex property and RegExp reuse" id="idm46198525282600"></a><a data-type="indexterm" data-primary="RegExp class" data-secondary="lastIndex property and RegExp reuse" id="idm46198525281000"></a><a data-type="indexterm" data-primary="lastIndex property" id="idm46198525280088"></a> you have seen already, JavaScript’s regular expression API is
        complicated. The use of the <code>lastIndex</code> property with the <code>g</code> and <code>y</code>
        flags is a particularly awkward part of this API. When you use these
        flags, you need to be particularly careful when calling the <code>match()</code>,
        <code>exec()</code>, or <code>test()</code> methods because the behavior of these methods
        depends on <code>lastIndex</code>, and the value of <code>lastIndex</code> depends on what
        you have previously done with the RegExp object. This makes it easy to
        write buggy code.</p>
        
        <p>Suppose, for example, that we wanted to find the index of all <code>&lt;p&gt;</code>
        tags within a string of HTML text. We might write code like this:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">match</code><code class="p">,</code> <code class="nx">positions</code> <code class="o">=</code> <code class="p">[];</code>
        <code class="k">while</code><code class="p">((</code><code class="nx">match</code> <code class="o">=</code> <code class="sr">/&lt;p&gt;/g</code><code class="p">.</code><code class="nx">exec</code><code class="p">(</code><code class="nx">html</code><code class="p">))</code> <code class="o">!==</code> <code class="kc">null</code><code class="p">)</code> <code class="p">{</code> <code class="c1">// POSSIBLE INFINITE LOOP</code>
            <code class="nx">positions</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="nx">match</code><code class="p">.</code><code class="nx">index</code><code class="p">);</code>
        <code class="p">}</code></pre>
        
        <p>This code does not do what we want it to. If the <code>html</code> string
        contains at least one <code>&lt;p&gt;</code> tag, then it will loop forever. The
        problem is that we use a RegExp literal in the <code>while</code> loop
        condition. For each iteration of the loop, we’re creating a new RegExp
        object with <code>lastIndex</code> set to 0, so <code>exec()</code> always begins at the
        start of the string, and if there is a match, it will keep matching
        over and over.  The solution, of course, is to define the RegExp once,
        and save it to a variable so that we’re using the same RegExp object
        for each iteration of the loop.</p>
        
        <p>On the other hand, sometimes reusing a RegExp object is the wrong
        thing to do. Suppose, for example, that we want to loop through all of
        the words in a dictionary to find words that contain pairs of double
        letters:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">dictionary</code> <code class="o">=</code> <code class="p">[</code> <code class="s2">"apple"</code><code class="p">,</code> <code class="s2">"book"</code><code class="p">,</code> <code class="s2">"coffee"</code> <code class="p">];</code>
        <code class="kd">let</code> <code class="nx">doubleLetterWords</code> <code class="o">=</code> <code class="p">[];</code>
        <code class="kd">let</code> <code class="nx">doubleLetter</code> <code class="o">=</code> <code class="sr">/(\w)\1/g</code><code class="p">;</code>
        
        <code class="k">for</code><code class="p">(</code><code class="kd">let</code> <code class="nx">word</code> <code class="k">of</code> <code class="nx">dictionary</code><code class="p">)</code> <code class="p">{</code>
            <code class="k">if</code> <code class="p">(</code><code class="nx">doubleLetter</code><code class="p">.</code><code class="nx">test</code><code class="p">(</code><code class="nx">word</code><code class="p">))</code> <code class="p">{</code>
                <code class="nx">doubleLetterWords</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="nx">word</code><code class="p">);</code>
            <code class="p">}</code>
        <code class="p">}</code>
        <code class="nx">doubleLetterWords</code>  <code class="c1">// =&gt; ["apple", "coffee"]: "book" is missing!</code></pre>
        
        <p>Because we set the <code>g</code> flag on the RegExp, the <code>lastIndex</code> property is
        changed after successful matches, and the <code>test()</code> method (which is
        based on <code>exec()</code>) starts searching for a match at the position
        specified by <code>lastIndex</code>.  After matching the “pp” in “apple”,
        <code>lastIndex</code> is 3, and so we start searching the word “book” at position
        3 and do not see the “oo” that it contains.</p>
        
        <p>We could fix this problem by removing the <code>g</code> flag (which is not actually
        necessary in this particular example), or by moving the RegExp literal
        into the body of the loop so that it is re-created on each iteration,
        or by explicitly resetting <code>lastIndex</code> to zero before each call to
        <code>test()</code>.</p>
        
        <p>The moral here is that <code>lastIndex</code> makes the RegExp API error
        prone. So be extra careful when using the <code>g</code> or <code>y</code> flags and
        looping. And<a data-type="indexterm" data-primary="ES2020" data-secondary="lastIndex and RegExp API" id="idm46198525115640"></a> in ES2020 and later, use the String <code>matchAll()</code>
        method instead of <code>exec()</code> to sidestep this problem since <code>matchAll()</code>
        does not modify <code>lastIndex</code>.<a data-type="indexterm" data-primary="" data-startref="JSLpattern11" id="idm46198525112840"></a></p>
        </div></aside>
        </div></section>
        
        
        
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="11.4 Dates and Times"><div class="sect1" id="datesandtimes">
        <h1>11.4 Dates and Times</h1>
        
        <p>The<a data-type="indexterm" data-primary="Date type" id="idm46198525109752"></a><a data-type="indexterm" data-primary="JavaScript standard library" data-secondary="dates and times" id="JSLdate11"></a><a data-type="indexterm" data-primary="dates and times" data-secondary="overview of" id="idm46198525107832"></a> Date class is JavaScript’s API for working with dates and
        times. Create a Date object with the <code>Date()</code> constructor. With no
        arguments, it returns a Date object that represents the current date
        and time:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">now</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">();</code>     <code class="c1">// The current time</code></pre>
        
        <p>If you pass one numeric argument, the <code>Date()</code> constructor interprets
        that argument as the number of milliseconds since the 1970 epoch:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">epoch</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">(</code><code class="mi">0</code><code class="p">);</code>  <code class="c1">// Midnight, January 1st, 1970, GMT</code></pre>
        
        <p>If you specify two or more integer arguments, they are interpreted as
        the year, month, day-of-month, hour, minute, second, and millisecond in
        your local time zone, as in the <span class="keep-together">following:</span></p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">century</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">(</code><code class="mi">2100</code><code class="p">,</code>         <code class="c1">// Year 2100</code>
                               <code class="mi">0</code><code class="p">,</code>            <code class="c1">// January</code>
                               <code class="mi">1</code><code class="p">,</code>            <code class="c1">// 1st</code>
                               <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">5</code><code class="p">);</code>  <code class="c1">// 02:03:04.005, local time</code></pre>
        
        <p>One quirk of the Date API is that the first month of a year is
        number 0, but the first day of a month is number 1. If you omit the time
        fields, the <code>Date()</code> constructor defaults them all to 0, setting the
        time to midnight.</p>
        
        <p>Note that when invoked with multiple numbers, the <code>Date()</code> constructor
        interprets them using whatever time zone the local computer is set
        to. If you want to specify a date and time in UTC (Universal
        Coordinated Time, aka GMT), then you can use the <code>Date.UTC()</code>. This
        static method takes the same arguments as the <code>Date()</code> constructor,
        interprets them in UTC, and returns a millisecond timestamp that you
        can pass to the <code>Date()</code> constructor:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// Midnight in England, January 1, 2100</code>
        <code class="kd">let</code> <code class="nx">century</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">(</code><code class="nb">Date</code><code class="p">.</code><code class="nx">UTC</code><code class="p">(</code><code class="mi">2100</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">1</code><code class="p">));</code></pre>
        
        <p>If you print a date (with <code>console.log(century)</code>, for example), it will,
        by default, be printed in your local time zone. If you want to display a
        date in UTC, you should explicitly convert it to a string with
        <code>toUTCString()</code> or <code>toISOString()</code>.</p>
        
        <p>Finally, if you pass a string to the <code>Date()</code> constructor, it will
        attempt to parse that string as a date and time specification. The
        constructor can parse dates specified in the formats produced by the
        <code>toString()</code>, <code>toUTCString()</code>, and <code>toISOString()</code> <span class="keep-together">methods:</span></p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">century</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">(</code><code class="s2">"2100-01-01T00:00:00Z"</code><code class="p">);</code>  <code class="c1">// An ISO format date</code></pre>
        
        <p>Once you have a Date object, various get and set methods allow
        you to query and modify the year, month, day-of-month, hour, minute,
        second, and millisecond fields of the Date. Each of these methods has
        two forms: one that gets or sets using local time and one that gets or
        sets using UTC time. To get or set the year of a Date object, for
        example, you would use <code>getFullYear()</code>, <code>getUTCFullYear()</code>,
        <code>setFullYear()</code>, or <code>setUTCFullYear()</code>:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">();</code>                  <code class="c1">// Start with the current date</code>
        <code class="nx">d</code><code class="p">.</code><code class="nx">setFullYear</code><code class="p">(</code><code class="nx">d</code><code class="p">.</code><code class="nx">getFullYear</code><code class="p">()</code> <code class="o">+</code> <code class="mi">1</code><code class="p">);</code>  <code class="c1">// Increment the year</code></pre>
        
        <p>To get or set the other fields of a Date, replace “FullYear” in the
        method name with “Month”, “Date”, “Hours”, “Minutes”, “Seconds”, or
        “Milliseconds”. Some of the date set methods allow you to set more
        than one field at a time. <code>setFullYear()</code> and <code>setUTCFullYear()</code> also
        optionally allow you to set the month and day-of-month as well. And
        <code>setHours()</code> and <code>setUTCHours()</code> allow you to specify the minutes,
        seconds, and milliseconds fields in addition to the hours field.</p>
        
        <p>Note that the methods for querying the day-of-month are <code>getDate()</code> and
        <code>getUTCDate()</code>. The more natural-sounding functions <code>getDay()</code> and
        <code>getUTCDay()</code> return the day-of-week (0 for Sunday through 6 for
        Saturday). The day-of-week is read-only, so there is not a
        corresponding <code>setDay()</code> method.</p>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.4.1 Timestamps"><div class="sect2" id="idm46198524849752">
        <h2>11.4.1 Timestamps</h2>
        
        <p>JavaScript<a data-type="indexterm" data-primary="dates and times" data-secondary="timestamps" id="idm46198524848152"></a><a data-type="indexterm" data-primary="timestamps" id="idm46198524847144"></a> represents dates internally as integers that specify the
        number of milliseconds since (or before) midnight on January 1, 1970,
        UTC time. Integers as large as 8,640,000,000,000,000 are supported, so
        JavaScript won’t be running out of milliseconds for more than 270,000 years.</p>
        
        <p>For any Date object, the <code>getTime()</code> method returns this
        internal value, and the <code>setTime()</code> method sets it. So you can add 30
        seconds to a Date with code like this, for example:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="nx">d</code><code class="p">.</code><code class="nx">setTime</code><code class="p">(</code><code class="nx">d</code><code class="p">.</code><code class="nx">getTime</code><code class="p">()</code> <code class="o">+</code> <code class="mi">30000</code><code class="p">);</code></pre>
        
        <p>These millisecond values are sometimes called <em>timestamps</em>, and it is
        sometimes useful to work with them directly rather than with Date
        objects. The static <code>Date.now()</code> method returns the current time as a
        timestamp and is helpful when you want to measure how long your code
        takes to run:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">startTime</code> <code class="o">=</code> <code class="nb">Date</code><code class="p">.</code><code class="nx">now</code><code class="p">();</code>
        <code class="nx">reticulateSplines</code><code class="p">();</code> <code class="c1">// Do some time-consuming operation</code>
        <code class="kd">let</code> <code class="nx">endTime</code> <code class="o">=</code> <code class="nb">Date</code><code class="p">.</code><code class="nx">now</code><code class="p">();</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Spline reticulation took </code><code class="si">${</code><code class="nx">endTime</code> <code class="o">-</code> <code class="nx">startTime</code><code class="si">}</code><code class="sb">ms.`</code><code class="p">);</code></pre>
        <aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46198524835736">
        <h5>High-Resolution Timestamps</h5>
        <p>The<a data-type="indexterm" data-primary="dates and times" data-secondary="high-resolution timestamps" id="idm46198524758696"></a> timestamps returned by <code>Date.now()</code> are measured in
        milliseconds. A millisecond is actually a relatively long time for a
        computer, and sometimes you may want to measure elapsed time with
        higher precision. The <code>performance.now()</code> function allows this: it
        also returns a millisecond-based timestamp, but the return value is
        not an integer, so it includes fractions of a millisecond. The value
        returned by <code>performance.now()</code> is not an absolute timestamp like the
        <code>Date.now()</code> value is. Instead, it simply indicates how much time has
        elapsed since a web page was loaded or since the Node process started.</p>
        
        <p>The <code>performance</code> object is part of a larger Performance API that is
        not defined by the ECMAScript standard but is implemented by web
        browsers and by Node. In order to use the <code>performance</code> object in
        Node, you must import it with:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kr">const</code> <code class="p">{</code> <code class="nx">performance</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s2">"perf_hooks"</code><code class="p">);</code></pre>
        
        <p>Allowing high-precision timing on the web may allow unscrupulous
        websites to fingerprint visitors, so browsers (notably Firefox) may
        reduce the precision of <code>performance.now()</code> by default. As a web
        developer, you should be able to re-enable high-precision timing
        somehow (such as by setting <code>privacy.reduceTimerPrecision</code> to false in
        Firefox).</p>
        </div></aside>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.4.2 Date Arithmetic"><div class="sect2" id="idm46198524751064">
        <h2>11.4.2 Date Arithmetic</h2>
        
        <p>Date objects<a data-type="indexterm" data-primary="dates and times" data-secondary="date arithmetic" id="idm46198524749368"></a> can be compared with JavaScript’s standard <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>,
        and <code>&gt;=</code> comparison operators. And you can subtract one Date object
        from another to determine the number of milliseconds between the two
        dates. (This works because the Date class defines a <code>valueOf()</code> method
        that returns a timestamp.)</p>
        
        <p>If you want to add or subtract a specified number of seconds, minutes,
        or hours from a Date, it is often easiest to simply modify the
        timestamp as demonstrated in the previous example, when we added 30 seconds to a
        date. This technique becomes more cumbersome if you want to add days,
        and it does not work at all for months and years since they have
        varying numbers of days. To do date arithmetic involving days, months,
        and years, you can use <code>setDate()</code>, <code>setMonth()</code>, and <code>setYear()</code>.
        Here, for example, is code that adds three months and two weeks to
        the current date:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">();</code>
        <code class="nx">d</code><code class="p">.</code><code class="nx">setMonth</code><code class="p">(</code><code class="nx">d</code><code class="p">.</code><code class="nx">getMonth</code><code class="p">()</code> <code class="o">+</code> <code class="mi">3</code><code class="p">,</code> <code class="nx">d</code><code class="p">.</code><code class="nx">getDate</code><code class="p">()</code> <code class="o">+</code> <code class="mi">14</code><code class="p">);</code></pre>
        
        <p>Date setting methods work correctly even when they overflow. When we
        add three months to the current month, we can end up with a value
        greater than 11 (which represents December). The <code>setMonth()</code> handles
        this by incrementing the year as needed. Similarly, when we set the
        day of the month to a value larger than the number of days in the
        month, the month gets incremented appropriately.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.4.3 Formatting and Parsing Date Strings"><div class="sect2" id="idm46198524669496">
        <h2>11.4.3 Formatting and Parsing Date Strings</h2>
        
        <p>If<a data-type="indexterm" data-primary="dates and times" data-secondary="formatting and parsing date strings" id="idm46198524664648"></a> you are using the Date class to actually keep track of dates and
        times (as opposed to just measuring time intervals), then you are
        likely to need to display dates and times to the users of your
        code. The Date class defines a number of different methods for
        converting Date objects to strings. Here are some examples:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">(</code><code class="mi">2020</code><code class="p">,</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">1</code><code class="p">,</code> <code class="mi">17</code><code class="p">,</code> <code class="mi">10</code><code class="p">,</code> <code class="mi">30</code><code class="p">);</code> <code class="c1">// 5:10:30pm on New Year's Day 2020</code>
        <code class="nx">d</code><code class="p">.</code><code class="nx">toString</code><code class="p">()</code>  <code class="c1">// =&gt; "Wed Jan 01 2020 17:10:30 GMT-0800 (Pacific Standard Time)"</code>
        <code class="nx">d</code><code class="p">.</code><code class="nx">toUTCString</code><code class="p">()</code>         <code class="c1">// =&gt; "Thu, 02 Jan 2020 01:10:30 GMT"</code>
        <code class="nx">d</code><code class="p">.</code><code class="nx">toLocaleDateString</code><code class="p">()</code>  <code class="c1">// =&gt; "1/1/2020": 'en-US' locale</code>
        <code class="nx">d</code><code class="p">.</code><code class="nx">toLocaleTimeString</code><code class="p">()</code>  <code class="c1">// =&gt; "5:10:30 PM": 'en-US' locale</code>
        <code class="nx">d</code><code class="p">.</code><code class="nx">toISOString</code><code class="p">()</code>         <code class="c1">// =&gt; "2020-01-02T01:10:30.000Z"</code></pre>
        
        <p>This is a full list of the string formatting methods of the Date class:</p>
        <dl>
        <dt><code>toString()</code></dt>
        <dd>
        <p>This<a data-type="indexterm" data-primary="toString() method" id="idm46198524574424"></a> method uses the local time zone but does not format
        the date and time in a locale-aware way.</p>
        </dd>
        <dt><code>toUTCString()</code></dt>
        <dd>
        <p>This<a data-type="indexterm" data-primary="toUTCString() method" id="idm46198524572040"></a> method uses the UTC time zone but does not
        format the date in a locale-aware way.</p>
        </dd>
        <dt><code>toISOString()</code></dt>
        <dd>
        <p>This<a data-type="indexterm" data-primary="toISOString() method" id="idm46198524569768"></a> method prints the date and time in the standard
        year-month-day hours:minutes:seconds.ms format of the ISO-8601
        standard. The letter “T” separates the date portion of the output from
        the time portion of the output. The time is expressed in UTC, and this
        is indicated with the letter “Z” as the last letter of the
        output.</p>
        </dd>
        <dt><code>toLocaleString()</code></dt>
        <dd>
        <p>This<a data-type="indexterm" data-primary="toLocaleString() method" id="idm46198524567144"></a> method uses the local time zone and a
        format that is appropriate for the user’s locale.</p>
        </dd>
        <dt><code>toDateString()</code></dt>
        <dd>
        <p>This<a data-type="indexterm" data-primary="toDateString() method" id="idm46198524564760"></a> method formats only the date portion of the
        Date and omits the time. It uses the local time zone and does not do
        locale-appropriate formatting.</p>
        </dd>
        <dt><code>toLocaleDateString()</code></dt>
        <dd>
        <p>This<a data-type="indexterm" data-primary="toLocaleDateString() method" id="idm46198524562328"></a> method formats only the date. It uses
        the local time zone and a locale-appropriate date format.</p>
        </dd>
        <dt><code>toTimeString()</code></dt>
        <dd>
        <p>This<a data-type="indexterm" data-primary="toTimeString() method" id="idm46198524559928"></a> method formats only the time and omits the
        date. It uses the local time zone but does not format the time in a
        locale-aware way.</p>
        </dd>
        <dt><code>toLocaleTimeString()</code></dt>
        <dd>
        <p>This<a data-type="indexterm" data-primary="toLocaleTimeString() method" id="idm46198524557512"></a> method formats the time in a locale-aware way and uses the local time zone.</p>
        </dd>
        </dl>
        
        <p>None of these date-to-string methods is ideal when formatting dates and
        times to be displayed to end users. See <a data-type="xref" href="#datetimeformat">§11.7.2</a> for a more
        general-purpose and locale-aware date- and time-formatting
        technique.</p>
        
        <p>Finally, in addition to these methods that convert a Date object to a
        string, there is also a static <code>Date.parse()</code> method that takes a
        string as its argument, attempts to parse it as a date and time, and
        returns a timestamp representing that date. <code>Date.parse()</code> is able to
        parse the same strings that the <code>Date()</code> constructor can and is
        guaranteed to be able to parse the output of <code>toISOString()</code>,
        <code>toUTCString()</code>, and <code>toString()</code>.<a data-type="indexterm" data-primary="" data-startref="JSLdate11" id="idm46198524551960"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="11.5 Error Classes"><div class="sect1" id="idm46198525111048">
        <h1>11.5 Error Classes</h1>
        
        <p>The<a data-type="indexterm" data-primary="Error classes" id="idm46198524549672"></a><a data-type="indexterm" data-primary="JavaScript standard library" data-secondary="error classes" id="JSLerror11"></a><a data-type="indexterm" data-primary="throw statements" id="idm46198524547752"></a><a data-type="indexterm" data-primary="catch statements" id="idm46198524547080"></a> JavaScript <code>throw</code> and <code>catch</code> statements can throw and catch any
        JavaScript value, including primitive values. There is no exception
        type that must be used to signal errors. JavaScript does define an
        Error class, however, and it is traditional to use instances of Error
        or a subclass when signaling an error with <code>throw</code>. One good reason
        to use an Error object is that, when you create an Error, it captures
        the state of the JavaScript stack, and if the exception is uncaught,
        the stack trace will be displayed with the error message, which will
        help you debug the issue. (Note that the stack trace shows where
        the Error object was created, not where the <code>throw</code> statement throws
        it. If you always create the object right before throwing it with
        <code>throw new Error()</code>, this will not cause any confusion.)</p>
        
        <p>Error objects have two properties: <code>message</code> and <code>name</code>, and a
        <code>toString()</code> method. The value of the <code>message</code> property is the value
        you passed to the <code>Error()</code> constructor, converted to a string if
        necessary. For error objects created with <code>Error()</code>, the <code>name</code>
        property is always “Error”. The <code>toString()</code> method simply returns the
        value of the <code>name</code> property followed by a colon and space and the
        value of the <code>message</code> property.</p>
        
        <p>Although it is not part of the ECMAScript standard, Node and all
        modern browsers also define a <code>stack</code> property on Error objects. The
        value of this property is a multi-line string that contains a stack
        trace of the JavaScript call stack at the moment that the Error
        object was created. This can be useful information to log when an
        unexpected error is caught.</p>
        
        <p>In addition to the Error class, JavaScript defines a number of
        subclasses that it uses to signal particular types of errors defined
        by ECMAScript. These subclasses are <span class="keep-together">EvalError</span>, RangeError,
        ReferenceError, SyntaxError, TypeError, and URIError. You can use these
        error classes in your own code if they seem appropriate. Like the base
        Error class, each of these subclasses has a constructor that takes a
        single message argument. And instances of each of these subclasses
        have a <code>name</code> property whose value is the same as the constructor
        name.</p>
        
        <p>You should feel free to define your own Error subclasses that best
        encapsulate the error conditions of your own program. Note that you
        are not limited to the <code>name</code> and <code>message</code> properties. If you create
        a subclass, you can define new properties to provide error details. If
        you are writing a parser, for example, you might find it useful to
        define a ParseError class with <code>line</code> and <code>column</code> properties that
        specify the exact location of the parsing failure. Or if you are
        working with HTTP requests, you might want to define an HTTPError
        class that has a <code>status</code> property that holds the HTTP status code
        (such as 404 or 500) of the failed request.<a data-type="indexterm" data-primary="" data-startref="JSLerror11" id="idm46198524532136"></a></p>
        
        <p>For example:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kr">class</code> <code class="nx">HTTPError</code> <code class="kr">extends</code> <code class="nb">Error</code> <code class="p">{</code>
            <code class="nx">constructor</code><code class="p">(</code><code class="nx">status</code><code class="p">,</code> <code class="nx">statusText</code><code class="p">,</code> <code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
                <code class="kr">super</code><code class="p">(</code><code class="sb">`</code><code class="si">${</code><code class="nx">status</code><code class="si">}</code><code class="sb"> </code><code class="si">${</code><code class="nx">statusText</code><code class="si">}</code><code class="sb">: </code><code class="si">${</code><code class="nx">url</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
                <code class="k">this</code><code class="p">.</code><code class="nx">status</code> <code class="o">=</code> <code class="nx">status</code><code class="p">;</code>
                <code class="k">this</code><code class="p">.</code><code class="nx">statusText</code> <code class="o">=</code> <code class="nx">statusText</code><code class="p">;</code>
                <code class="k">this</code><code class="p">.</code><code class="nx">url</code> <code class="o">=</code> <code class="nx">url</code><code class="p">;</code>
            <code class="p">}</code>
        
            <code class="nx">get</code> <code class="nx">name</code><code class="p">()</code> <code class="p">{</code> <code class="k">return</code> <code class="s2">"HTTPError"</code><code class="p">;</code> <code class="p">}</code>
        <code class="p">}</code>
        
        <code class="kd">let</code> <code class="nx">error</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">HTTPError</code><code class="p">(</code><code class="mi">404</code><code class="p">,</code> <code class="s2">"Not Found"</code><code class="p">,</code> <code class="s2">"http://example.com/"</code><code class="p">);</code>
        <code class="nx">error</code><code class="p">.</code><code class="nx">status</code>        <code class="c1">// =&gt; 404</code>
        <code class="nx">error</code><code class="p">.</code><code class="nx">message</code>       <code class="c1">// =&gt; "404 Not Found: http://example.com/"</code>
        <code class="nx">error</code><code class="p">.</code><code class="nx">name</code>          <code class="c1">// =&gt; "HTTPError"</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="11.6 JSON Serialization and Parsing"><div class="sect1" id="jsonapi">
        <h1>11.6 JSON Serialization and Parsing</h1>
        
        <p>When<a data-type="indexterm" data-primary="JavaScript standard library" data-secondary="JSON serialization and parsing" id="JSLjson11"></a><a data-type="indexterm" data-primary="JSON serialization and parsing" id="jsonserial11"></a> a program needs to save data or needs to transmit data across a
        network connection to another program, it must to convert its
        in-memory data structures into a string of bytes or characters than
        can be saved or transmitted and then later be parsed to restore the
        original in-memory data structures. This<a data-type="indexterm" data-primary="serialization" id="idm46198524426312"></a><a data-type="indexterm" data-primary="marshaling" id="idm46198524425640"></a><a data-type="indexterm" data-primary="pickling" id="idm46198524424968"></a> process of converting data
        structures into streams of bytes or characters is known as
        <em>serialization</em> (or <em>marshaling</em> or even <em>pickling</em>).</p>
        
        <p>The easiest way to serialize data in JavaScript uses a serialization
        format known as JSON. This acronym stands for “JavaScript Object
        Notation” and, as the name implies, the format uses JavaScript
        object and array literal syntax to convert data structures consisting
        of objects and arrays into strings. JSON supports primitive numbers
        and strings and also the values <code>true</code>, <code>false</code>, and <code>null</code>, as well as
        arrays and objects built up from those primitive values. JSON does not
        support other JavaScript types like Map, Set, RegExp, Date, or typed
        arrays. Nevertheless, it has proved to be a remarkably versatile data
        format and is in common use even with non-JavaScript-based
        programs.</p>
        
        <p>JavaScript<a data-type="indexterm" data-primary="JSON.stringify() function" id="idm46198524419928"></a><a data-type="indexterm" data-primary="JSON.parse() function" id="idm46198524419224"></a> supports JSON serialization and deserialization with the
        two functions <code>JSON.stringify()</code> and <code>JSON.parse()</code>, which were covered
        briefly in <a data-type="xref" href="ch06.html#serializingobjects">§6.8</a>. Given an object
        or array (nested arbitrarily deeply) that does not contain any
        nonserializable values like RegExp objects or typed arrays, you can
        serialize the object simply by passing it to <code>JSON.stringify()</code>. As
        the name implies, the return value of this function is a string. And
        given a string returned by <code>JSON.stringify()</code>, you can re-create the
        original data structure by passing the string to <code>JSON.parse()</code>:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">o</code> <code class="o">=</code> <code class="p">{</code><code class="nx">s</code><code class="o">:</code> <code class="s2">""</code><code class="p">,</code> <code class="nx">n</code><code class="o">:</code> <code class="mi">0</code><code class="p">,</code> <code class="nx">a</code><code class="o">:</code> <code class="p">[</code><code class="kc">true</code><code class="p">,</code> <code class="kc">false</code><code class="p">,</code> <code class="kc">null</code><code class="p">]};</code>
        <code class="kd">let</code> <code class="nx">s</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">o</code><code class="p">);</code>  <code class="c1">// s == '{"s":"","n":0,"a":[true,false,null]}'</code>
        <code class="kd">let</code> <code class="nx">copy</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">s</code><code class="p">);</code>   <code class="c1">// copy == {s: "", n: 0, a: [true, false, null]}</code></pre>
        
        <p>If we leave out the part where serialized data is saved to a file or
        sent over the network, we can use this pair of functions as a somewhat
        inefficient way of creating a deep copy of an object:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// Make a deep copy of any serializable object or array</code>
        <code class="kd">function</code> <code class="nx">deepcopy</code><code class="p">(</code><code class="nx">o</code><code class="p">)</code> <code class="p">{</code>
            <code class="k">return</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">o</code><code class="p">));</code>
        <code class="p">}</code></pre>
        <div data-type="note" epub:type="note"><h1>JSON Is a Subset of JavaScript</h1>
        <p>When data is serialized to JSON format, the result is valid JavaScript
        source code for an expression that evaluates to a copy of the original
        data structure. If you prefix a JSON string with <code>var data =</code> and pass
        the result to <code>eval()</code>, you’ll get a copy of the original data
        structure assigned to the variable <code>data</code>. You should never do this,
        however, because it is a huge security hole—if an attacker could
        inject arbitrary JavaScript code into a JSON file, they could make your
        program run their code. It is faster and safer to just use
        <code>JSON.parse()</code> to decode JSON-formatted data.</p>
        
        <p>JSON is sometimes used as a human-readable configuration file
        format. If you find yourself hand-editing a JSON file, note that the
        JSON format is a very strict subset of JavaScript. Comments are not
        allowed and property names must be enclosed in double quotes even when
        JavaScript would not require this.</p>
        </div>
        
        <p>Typically, you pass only a single argument to <code>JSON.stringify()</code> and
        <code>JSON.parse()</code>.  Both functions accept an optional second argument
        that allows us to extend the JSON format, and these are described
        next. <code>JSON.stringify()</code> also takes an optional third argument
        that we’ll discuss first. If you would like your JSON-formatted string to be
        human-readable (if it is being used as a configuration file, for
        example), then you should pass <code>null</code> as the second argument and pass a
        number or string as the third argument. This third argument tells
        <code>JSON.stringify()</code> that it should format the data on multiple indented
        lines. If the third argument is a number, then it will use that number
        of spaces for each indentation level. If the third argument is a
        string of whitespace (such as <code>'\t'</code>), it will use that string for each
        level of indent.</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">o</code> <code class="o">=</code> <code class="p">{</code><code class="nx">s</code><code class="o">:</code> <code class="s2">"test"</code><code class="p">,</code> <code class="nx">n</code><code class="o">:</code> <code class="mi">0</code><code class="p">};</code>
        <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">o</code><code class="p">,</code> <code class="kc">null</code><code class="p">,</code> <code class="mi">2</code><code class="p">)</code>  <code class="c1">// =&gt; '{\n  "s": "test",\n  "n": 0\n}'</code></pre>
        
        <p><code>JSON.parse()</code> ignores whitespace, so passing a third argument to
        <code>JSON.stringify()</code> has no impact on our ability to convert the string
        back into a data structure.</p>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.6.1 JSON Customizations"><div class="sect2" id="json_customi">
        <h2>11.6.1 JSON Customizations</h2>
        
        <p>If <code>JSON.stringify()</code> is asked to serialize a value that is not
        natively supported by the JSON format, it looks to see if that value
        has<a data-type="indexterm" data-primary="toJSON() method" id="idm46198524218888"></a> a <code>toJSON()</code> method, and if so, it calls that method and then
        stringifies the return value in place of the original value. Date
        objects implement <code>toJSON()</code>: it<a data-type="indexterm" data-primary="toISOString() method" id="idm46198524217080"></a> returns the same string that
        <code>toISOString()</code> method does. This means that if you serialize an
        object that includes a Date, the date will automatically be converted
        to a string for you. When you parse the serialized string, the
        re-created data structure will not be exactly the same as the one you
        started with because it will have a string where the original object
        had a Date.</p>
        
        <p>If you need to re-create Date objects (or modify the parsed object in
        any other way), you can pass a “reviver” function as the second
        argument to <code>JSON.parse()</code>.  If specified, this “reviver” function is
        invoked once for each primitive value (but not the objects or arrays
        that contain those primitive values) parsed from the input
        string. The function is invoked with two arguments. The first is a
        property name—either an object property name or an array index
        converted to a string. The second argument is the primitive value of
        that object property or array element. Furthermore, the function is
        invoked as a method of the object or array that contains the primitive
        value, so you can refer to that containing object with the <code>this</code>
        keyword.</p>
        
        <p>The return value of the reviver function becomes the new value of the
        named property. If it returns its second argument, the property will
        remain unchanged. If it returns <code>undefined</code>, then the named property will
        be deleted from the object or array before <code>JSON.parse()</code> returns to
        the user.</p>
        
        <p>As an example, here is a call to <code>JSON.parse()</code> that uses a reviver
        function to filter some properties and to re-create Date objects:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">text</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">key</code><code class="p">,</code> <code class="nx">value</code><code class="p">)</code> <code class="p">{</code>
            <code class="c1">// Remove any values whose property name begins with an underscore</code>
            <code class="k">if</code> <code class="p">(</code><code class="nx">key</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code> <code class="o">===</code> <code class="s2">"_"</code><code class="p">)</code> <code class="k">return</code> <code class="kc">undefined</code><code class="p">;</code>
        
            <code class="c1">// If the value is a string in ISO 8601 date format convert it to a Date.</code>
            <code class="k">if</code> <code class="p">(</code><code class="k">typeof</code> <code class="nx">value</code> <code class="o">===</code> <code class="s2">"string"</code> <code class="o">&amp;&amp;</code>
                <code class="sr">/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\d.\d\d\dZ$/</code><code class="p">.</code><code class="nx">test</code><code class="p">(</code><code class="nx">value</code><code class="p">))</code> <code class="p">{</code>
                <code class="k">return</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">(</code><code class="nx">value</code><code class="p">);</code>
            <code class="p">}</code>
        
            <code class="c1">// Otherwise, return the value unchanged</code>
            <code class="k">return</code> <code class="nx">value</code><code class="p">;</code>
        <code class="p">});</code></pre>
        
        <p>In addition to its use of <code>toJSON()</code> described earlier,
        <code>JSON.stringify()</code> also allows its output to be customized by passing
        an array or a function as the optional second argument.</p>
        
        <p>If an array of strings (or numbers—they are converted to strings) is
        passed instead as the second argument, these are used as the names of
        object properties (or array elements). Any property whose name is not
        in the array will be omitted from stringification. Furthermore, the
        returned string will include properties in the same order that they
        appear in the array (which can be very useful when writing tests).</p>
        
        <p>If you pass a function, it is a replacer function—effectively the
        inverse of the optional reviver function you can pass to
        <code>JSON.parse()</code>. If specified, the replacer function is invoked for
        each value to be stringified. The first argument to the replacer
        function is the object property name or array index of the value
        within that object, and the second argument is the value itself. The
        replacer function is invoked as a method of the object or array that
        contains the value to be stringified. The return value of the replacer
        function is stringified in place of the original value. If the
        replacer returns <code>undefined</code> or returns nothing at all, then that
        value (and its array element or object property) is omitted from the
        stringification.</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// Specify what fields to serialize, and what order to serialize them in</code>
        <code class="kd">let</code> <code class="nx">text</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">address</code><code class="p">,</code> <code class="p">[</code><code class="s2">"city"</code><code class="p">,</code><code class="s2">"state"</code><code class="p">,</code><code class="s2">"country"</code><code class="p">]);</code>
        
        <code class="c1">// Specify a replacer function that omits RegExp-value properties</code>
        <code class="kd">let</code> <code class="nx">json</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">o</code><code class="p">,</code> <code class="p">(</code><code class="nx">k</code><code class="p">,</code> <code class="nx">v</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">v</code> <code class="k">instanceof</code> <code class="nb">RegExp</code> <code class="o">?</code> <code class="kc">undefined</code> <code class="o">:</code> <code class="nx">v</code><code class="p">);</code></pre>
        
        <p>The two <code>JSON.stringify()</code> calls here use the second argument in a
        benign way, producing serialized output that can be deserialized
        without requiring a special reviver function. In general, though, if
        you define a <code>toJSON()</code> method for a type, or if you use a replacer
        function that actually replaces nonserializable values with
        serializable ones, then you will typically need to use a custom reviver
        function with <code>JSON.parse()</code> to get your original data structure
        back. If you do this, you should understand that you are defining a
        custom data format and sacrificing portability and compatibility with
        a large ecosystem of JSON-compatible tools and languages.<a data-type="indexterm" data-primary="" data-startref="JSLjson11" id="idm46198524037208"></a><a data-type="indexterm" data-primary="" data-startref="jsonserial11" id="idm46198524036264"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="11.7 The Internationalization API"><div class="sect1" id="intlapi">
        <h1>11.7 The Internationalization API</h1>
        
        <p>The<a data-type="indexterm" data-primary="internationalization API" data-secondary="classes included in" id="idm46198524033496"></a><a data-type="indexterm" data-primary="JavaScript standard library" data-secondary="internationalization API" id="JSLinter11"></a> JavaScript internationalization API consists of the three classes
        Intl.NumberFormat, Intl.DateTimeFormat, and Intl.Collator that allow us
        to format numbers (including monetary amounts and percentages), dates,
        and times in locale-appropriate ways and to compare strings in
        locale-appropriate ways. These classes are not part of the ECMAScript
        standard but are defined<a data-type="indexterm" data-primary="ECMA402 standard" id="idm46198524030856"></a> as part of the <a href="https://tc39.es/ecma402/">ECMA402 standard</a>
         and are well-supported by web browsers. The
        Intl API<a data-type="indexterm" data-primary="Node" data-secondary="Intl API" id="idm46198524029336"></a><a data-type="indexterm" data-primary="internationalization API" data-secondary="support for in Node" id="idm46198524028360"></a> is also supported in Node, but at the time of this writing,
        prebuilt Node binaries do not ship with the localization data
        required to make them work with locales other than US English. So in
        order to use these classes with Node, you may need to download a
        separate data package or use a custom build of Node.</p>
        
        <p>One<a data-type="indexterm" data-primary="internationalization API" data-secondary="translated text" id="idm46198524026696"></a> of the most important parts of internationalization is displaying
        text that has been translated into the user’s language. There are
        various ways to achieve this, but none of them are within the scope of
        the Intl API described here.</p>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.7.1 Formatting Numbers"><div class="sect2" id="numberformat">
        <h2>11.7.1 Formatting Numbers</h2>
        
        <p>Users<a data-type="indexterm" data-primary="Intl.NumberFormat class" id="intlnumber11"></a><a data-type="indexterm" data-primary="internationalization API" data-secondary="formatting numbers" id="IAPInumber11"></a><a data-type="indexterm" data-primary="numbers, formatting for internationalization" id="numbers11"></a> around the world expect numbers to be formatted in different
        ways. Decimal points can be periods or commas. Thousands separators
        can be commas or periods, and they aren’t used every three digits in
        all places. Some currencies are divided into hundredths, some into
        thousandths, and some have no subdivisions. Finally, although
        the so-called “Arabic numerals” 0 through 9 are used in many
        languages, this is not universal, and users in some countries will
        expect to see numbers written using the digits from their own
        scripts.</p>
        
        <p>The<a data-type="indexterm" data-primary="format() method" id="idm46198524018744"></a> Intl.NumberFormat class defines a <code>format()</code> method that takes all
        of these formatting possibilities into account. The constructor takes
        two arguments. The first argument specifies the locale that the number
        should be formatted for and the second is an object that specifies
        more details about how the number should be formatted.  If the first
        argument is omitted or <code>undefined</code>, then
        the system locale (which we assume to be the user’s preferred locale)
        will be used. If the first argument is a string, it specifies a
        desired locale, such as <code>"en-US"</code> (English as used in the United
        States), <code>"fr"</code> (French), or <code>"zh-Hans-CN"</code> (Chinese, using the
        simplified Han writing system, in China). The first argument can also
        be an array of locale strings, and in this case, Intl.NumberFormat
        will choose the most specific one that is well supported.</p>
        
        <p>The second argument to the <code>Intl.NumberFormat()</code> constructor, if
        specified, should be an object that defines one or more of the
        following properties:</p>
        <dl>
        <dt><code>style</code></dt>
        <dd>
        <p>Specifies the kind of number formatting that is
        required. The default is <span class="keep-together"><code>"decimal"</code>.</span> Specify <code>"percent"</code> to format a
        number as a percentage or specify <code>"currency"</code> to specify a number as
        an amount of money.</p>
        </dd>
        <dt><code>currency</code></dt>
        <dd>
        <p>If<a data-type="indexterm" data-primary="currency" id="idm46198524008776"></a> style is <code>"currency"</code>, then this property is required
        to specify the three-letter ISO currency code (such as <code>"USD"</code> for US
        dollars or <code>"GBP"</code> for British pounds) of the desired currency.</p>
        </dd>
        <dt><code>currencyDisplay</code></dt>
        <dd>
        <p>If style is <code>"currency"</code>, then this property
        specifies how the currency is displayed. The default value <code>"symbol"</code>
        uses a currency symbol if the currency has one. The value <code>"code"</code>
        uses the three-letter ISO code, and the value <code>"name"</code> spells out the name
        of the currency in long form.</p>
        </dd>
        <dt><code>useGrouping</code></dt>
        <dd>
        <p>Set this property to <code>false</code> if you do not want
        numbers to have thousands separators (or their locale-appropriate
        equivalents).</p>
        </dd>
        <dt><code>minimumIntegerDigits</code></dt>
        <dd>
        <p>The minimum number of digits to use to
        display the integer part of the number. If the number has fewer digits
        than this, it will be padded on the left with zeros. The default value
        is 1, but you can use values as high as 21.</p>
        </dd>
        <dt><code>minimumFractionDigits</code>, <code>maximumFractionDigits</code></dt>
        <dd>
        <p>These<a data-type="indexterm" data-primary="fractions" id="idm46198523997624"></a> two
        properties control the formatting of the fractional part of the
        number. If a number has fewer fractional digits than the minimum, it
        will be padded with zeros on the right. If it has more than the
        maximum, then the fractional part will be rounded. Legal values for
        both properties are between 0 and 20. The default minimum is 0 and the
        default maximum is 3, except when formatting monetary amounts, when
        the length of the fractional part varies depending on the specified
        currency.</p>
        </dd>
        <dt><code>minimumSignificantDigits</code>, <code>maximumSignificantDigits</code></dt>
        <dd>
        <p>These properties control the number of
        significant digits used when formatting a number, making them suitable
        when formatting scientific data, for example. If specified, these
        properties override the integer and fractional digit properties listed
        previously. Legal values are between 1 and 21.</p>
        </dd>
        </dl>
        
        <p>Once you have created an Intl.NumberFormat object with the desired
        locale and options, you use it by passing a number to its <code>format()</code>
        method, which returns an appropriately formatted string. For example:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">euros</code> <code class="o">=</code> <code class="nx">Intl</code><code class="p">.</code><code class="nx">NumberFormat</code><code class="p">(</code><code class="s2">"es"</code><code class="p">,</code> <code class="p">{</code><code class="nx">style</code><code class="o">:</code> <code class="s2">"currency"</code><code class="p">,</code> <code class="nx">currency</code><code class="o">:</code> <code class="s2">"EUR"</code><code class="p">});</code>
        <code class="nx">euros</code><code class="p">.</code><code class="nx">format</code><code class="p">(</code><code class="mi">10</code><code class="p">)</code>    <code class="c1">// =&gt; "10,00&nbsp;€": ten euros, Spanish formatting</code>
        
        <code class="kd">let</code> <code class="nx">pounds</code> <code class="o">=</code> <code class="nx">Intl</code><code class="p">.</code><code class="nx">NumberFormat</code><code class="p">(</code><code class="s2">"en"</code><code class="p">,</code> <code class="p">{</code><code class="nx">style</code><code class="o">:</code> <code class="s2">"currency"</code><code class="p">,</code> <code class="nx">currency</code><code class="o">:</code> <code class="s2">"GBP"</code><code class="p">});</code>
        <code class="nx">pounds</code><code class="p">.</code><code class="nx">format</code><code class="p">(</code><code class="mi">1000</code><code class="p">)</code> <code class="c1">// =&gt; "£1,000.00": One thousand pounds, English formatting</code></pre>
        
        <p>A useful feature of <code>Intl.NumberFormat</code> (and the other Intl classes as
        well) is that its <code>format()</code> method is bound to the NumberFormat
        object to which it belongs. So instead of defining a variable that
        refers to the formatting object and then invoking the <code>format()</code>
        method on that, you can just assign the <code>format()</code> method to a
        variable and use it as if it were a standalone function, as in this
        example:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">data</code> <code class="o">=</code> <code class="p">[</code><code class="mf">0.05</code><code class="p">,</code> <code class="p">.</code><code class="mi">75</code><code class="p">,</code> <code class="mi">1</code><code class="p">];</code>
        <code class="kd">let</code> <code class="nx">formatData</code> <code class="o">=</code> <code class="nx">Intl</code><code class="p">.</code><code class="nx">NumberFormat</code><code class="p">(</code><code class="kc">undefined</code><code class="p">,</code> <code class="p">{</code>
            <code class="nx">style</code><code class="o">:</code> <code class="s2">"percent"</code><code class="p">,</code>
            <code class="nx">minimumFractionDigits</code><code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
            <code class="nx">maximumFractionDigits</code><code class="o">:</code> <code class="mi">1</code>
        <code class="p">}).</code><code class="nx">format</code><code class="p">;</code>
        
        <code class="nx">data</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">formatData</code><code class="p">)</code>   <code class="c1">// =&gt; ["5.0%", "75.0%", "100.0%"]: in en-US locale</code></pre>
        
        <p>Some languages, such as Arabic, use their own script for decimal
        digits:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">arabic</code> <code class="o">=</code> <code class="nx">Intl</code><code class="p">.</code><code class="nx">NumberFormat</code><code class="p">(</code><code class="s2">"ar"</code><code class="p">,</code> <code class="p">{</code><code class="nx">useGrouping</code><code class="o">:</code> <code class="kc">false</code><code class="p">}).</code><code class="nx">format</code><code class="p">;</code>
        <code class="nx">arabic</code><code class="p">(</code><code class="mi">1234567890</code><code class="p">)</code>   <code class="c1">// =&gt; "١٢٣٤٥٦٧٨٩٠"</code></pre>
        
        <p>Other languages, such as Hindi, use a script that has its own set of
        digits, but tend to use the ASCII digits 0–9 by default. If you want
        to override the default script used for digits, add <code>-u-nu-</code> to the
        locale and follow it with an abbreviated script name. You can format
        numbers with Indian-style grouping and Devanagari digits like this, for <span class="keep-together">example:</span></p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">hindi</code> <code class="o">=</code> <code class="nx">Intl</code><code class="p">.</code><code class="nx">NumberFormat</code><code class="p">(</code><code class="s2">"hi-IN-u-nu-deva"</code><code class="p">).</code><code class="nx">format</code><code class="p">;</code>
        <code class="nx">hindi</code><code class="p">(</code><code class="mi">1234567890</code><code class="p">)</code>    <code class="c1">// =&gt; "१,२३,४५,६७,८९०"</code></pre>
        
        <p><code>-u-</code> in a locale specifies that what comes next is a Unicode
        extension. <code>nu</code> is the extension name for the numbering system, and
        <code>deva</code> is short for Devanagari. The Intl API standard defines names for
        a number of other numbering systems, mostly for the Indic languages of
        South and Southeast Asia.<a data-type="indexterm" data-primary="" data-startref="intlnumber11" id="idm46198523762136"></a><a data-type="indexterm" data-primary="" data-startref="IAPInumber11" id="idm46198523761224"></a><a data-type="indexterm" data-primary="" data-startref="numbers11" id="idm46198523760280"></a></p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.7.2 Formatting Dates and Times"><div class="sect2" id="datetimeformat">
        <h2>11.7.2 Formatting Dates and Times</h2>
        
        <p>The<a data-type="indexterm" data-primary="dates and times" data-secondary="formatting for internationalization" id="DTintern11"></a><a data-type="indexterm" data-primary="internationalization API" data-secondary="formatting dates and times" id="IAPIdate11"></a><a data-type="indexterm" data-primary="Intl.DateTimeFormat class" id="intldate11"></a> Intl.DateTimeFormat class is a lot like the Intl.NumberFormat
        class. The <code>Intl.DateTimeFormat()</code> constructor takes the same two
        arguments that <code>Intl.NumberFormat()</code> does: a locale or array of
        locales and an object of formatting options. And the way you use an
        Intl.DateTimeFormat instance is by calling its <code>format()</code> method to
        convert a Date object to a string.</p>
        
        <p>As<a data-type="indexterm" data-primary="toLocaleDateString() method" id="idm46198523735080"></a><a data-type="indexterm" data-primary="toLocaleTimeString() method" id="idm46198523734376"></a> mentioned in <a data-type="xref" href="#datesandtimes">§11.4</a>, the Date class defines simple
        <code>toLocaleDateString()</code> and <span class="keep-together"><code>toLocaleTimeString()</code></span> methods that produce
        locale-appropriate output for the user’s locale. But these methods
        don’t give you any control over what fields of the date and time are
        displayed. Maybe you want to omit the year but add a weekday to the
        date format. Do you want the month to be represented numerically or
        spelled out by name? The Intl.DateTimeFormat class provides
        fine-grained control over what is output based on the properties in
        the options object that is passed as the second argument to the
        constructor. Note, however, that Intl.DateTimeFormat cannot always
        display exactly what you ask for. If you specify options to format
        hours and seconds but omit minutes, you’ll find that the formatter
        displays the minutes anyway. The idea is that you use the options
        object to specify what date and time fields you’d like to present to
        the user and how you’d like those formatted (by name or by number, for
        example), then the formatter will look for a locale-appropriate
        format that most closely matches what you have asked for.</p>
        
        <p>The available options are the following. Only specify properties for
        date and time fields that you would like to appear in the formatted
        output.</p>
        <dl>
        <dt><code>year</code></dt>
        <dd>
        <p>Use <code>"numeric"</code> for a full, four-digit year or <code>"2-digit"</code>
        for a two-digit <span class="keep-together">abbreviation.</span></p>
        </dd>
        <dt><code>month</code></dt>
        <dd>
        <p>Use <code>"numeric"</code> for a possibly short number like “1”, or
        <code>"2-digit"</code> for a numeric representation that always has two digits,
        like “01”. Use <code>"long"</code> for a full name like “January”, <code>"short"</code> for
        an abbreviated name like “Jan”, and <code>"narrow"</code> for a highly
        abbreviated name like “J” that is not guaranteed to be unique.</p>
        </dd>
        <dt><code>day</code></dt>
        <dd>
        <p>Use <code>"numeric"</code> for a one- or two-digit number or
        <code>"2-digit"</code> for a two-digit number for the day-of-month.</p>
        </dd>
        <dt><code>weekday</code></dt>
        <dd>
        <p>Use <code>"long"</code> for a full name like “Monday”, <code>"short"</code>
        for an abbreviated name like “Mon”, and <code>"narrow"</code> for a highly
        abbreviated name like “M” that is not guaranteed to be unique.</p>
        </dd>
        <dt><code>era</code></dt>
        <dd>
        <p>This property specifies whether a date should be formatted
        with an era, such as CE or BCE. This may be useful if you are
        formatting dates from very long ago or if you are using a Japanese
        calendar. Legal values are <code>"long"</code>, <code>"short"</code>, and <span class="keep-together"><code>"narrow"</code>.</span></p>
        </dd>
        <dt><code>hour</code>, <code>minute</code>, <code>second</code></dt>
        <dd>
        <p>These properties specify how you would
        like time displayed. Use <code>"numeric"</code> for a one- or two-digit field or
        <code>"2-digit"</code> to force single-digit numbers to be padded on the left
        with a 0.</p>
        </dd>
        <dt><code>timeZone</code></dt>
        <dd>
        <p>This<a data-type="indexterm" data-primary="time zones" id="idm46198523691672"></a> property specifies the desired time zone for which
        the date should be formatted. If omitted, the local time zone is
        used. Implementations always recognize “UTC” and may also recognize
        Internet Assigned Numbers Authority (IANA) time zone names, such as “America/Los_Angeles”.</p>
        </dd>
        <dt><code>timeZoneName</code></dt>
        <dd>
        <p>This property specifies how the time zone should be
        displayed in a formatted date or time. Use <code>"long"</code> for a fully
        spelled-out time zone name and <code>"short"</code> for an abbreviated or numeric
        time zone.</p>
        </dd>
        <dt><code>hour12</code></dt>
        <dd>
        <p>This boolean property specifies whether or not to use 12-hour time. The default is locale dependent, but you can override it with
        this property.</p>
        </dd>
        <dt><code>hourCycle</code></dt>
        <dd>
        <p>This property allows you to specify whether midnight is
        written as 0 hours, 12 hours, or 24 hours. The default is
        locale dependent, but you can override the default with this
        property. Note that <code>hour12</code> takes precedence over this property. Use
        the value <code>"h11"</code> to specify that midnight is 0 and the hour before
        midnight is 11pm. Use <code>"h12"</code> to specify that midnight is 12. Use
        <code>"h23"</code> to specify that midnight is 0 and the hour before midnight is 23.
        And use <code>"h24"</code> to specify that midnight is 24.</p>
        </dd>
        </dl>
        
        <p>Here are some examples:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">d</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">(</code><code class="s2">"2020-01-02T13:14:15Z"</code><code class="p">);</code>  <code class="c1">// January 2nd, 2020, 13:14:15 UTC</code>
        
        <code class="c1">// With no options, we get a basic numeric date format</code>
        <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code><code class="s2">"en-US"</code><code class="p">).</code><code class="nx">format</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code> <code class="c1">// =&gt; "1/2/2020"</code>
        <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code><code class="s2">"fr-FR"</code><code class="p">).</code><code class="nx">format</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code> <code class="c1">// =&gt; "02/01/2020"</code>
        
        <code class="c1">// Spelled out weekday and month</code>
        <code class="kd">let</code> <code class="nx">opts</code> <code class="o">=</code> <code class="p">{</code> <code class="nx">weekday</code><code class="o">:</code> <code class="s2">"long"</code><code class="p">,</code> <code class="nx">month</code><code class="o">:</code> <code class="s2">"long"</code><code class="p">,</code> <code class="nx">year</code><code class="o">:</code> <code class="s2">"numeric"</code><code class="p">,</code> <code class="nx">day</code><code class="o">:</code> <code class="s2">"numeric"</code> <code class="p">};</code>
        <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code><code class="s2">"en-US"</code><code class="p">,</code> <code class="nx">opts</code><code class="p">).</code><code class="nx">format</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code> <code class="c1">// =&gt; "Thursday, January 2, 2020"</code>
        <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code><code class="s2">"es-ES"</code><code class="p">,</code> <code class="nx">opts</code><code class="p">).</code><code class="nx">format</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code> <code class="c1">// =&gt; "jueves, 2 de enero de 2020"</code>
        
        <code class="c1">// The time in New York, for a French-speaking Canadian</code>
        <code class="nx">opts</code> <code class="o">=</code> <code class="p">{</code> <code class="nx">hour</code><code class="o">:</code> <code class="s2">"numeric"</code><code class="p">,</code> <code class="nx">minute</code><code class="o">:</code> <code class="s2">"2-digit"</code><code class="p">,</code> <code class="nx">timeZone</code><code class="o">:</code> <code class="s2">"America/New_York"</code> <code class="p">};</code>
        <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code><code class="s2">"fr-CA"</code><code class="p">,</code> <code class="nx">opts</code><code class="p">).</code><code class="nx">format</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code> <code class="c1">// =&gt; "8 h 14"</code></pre>
        
        <p>Intl.DateTimeFormat can display dates using<a data-type="indexterm" data-primary="calendars" id="idm46198523679320"></a> calendars other than the
        default Julian calendar based on the Christian era. Although some
        locales may use a non-Christian calendar by default, you can always
        explicitly specify the calendar to use by adding <span class="keep-together"><code>-u-ca-</code></span> to the
        locale and following that with the name of the calendar. Possible
        calendar names include “buddhist”, “chinese”, “coptic”, “ethiopic”,
        “gregory”, “hebrew”, “indian”, “islamic”, “iso8601”, “japanese”, and
        “persian”.  Continuing the preceding example, we can determine the year in
        various non-Christian<a data-type="indexterm" data-primary="" data-startref="IAPIdate11" id="idm46198523599800"></a><a data-type="indexterm" data-primary="" data-startref="intldate11" id="idm46198523598856"></a><a data-type="indexterm" data-primary="" data-startref="DTintern11" id="idm46198523597912"></a> calendars:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">opts</code> <code class="o">=</code> <code class="p">{</code> <code class="nx">year</code><code class="o">:</code> <code class="s2">"numeric"</code><code class="p">,</code> <code class="nx">era</code><code class="o">:</code> <code class="s2">"short"</code> <code class="p">};</code>
        <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code><code class="s2">"en"</code><code class="p">,</code> <code class="nx">opts</code><code class="p">).</code><code class="nx">format</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code>                <code class="c1">// =&gt; "2020 AD"</code>
        <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code><code class="s2">"en-u-ca-iso8601"</code><code class="p">,</code> <code class="nx">opts</code><code class="p">).</code><code class="nx">format</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code>   <code class="c1">// =&gt; "2020 AD"</code>
        <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code><code class="s2">"en-u-ca-hebrew"</code><code class="p">,</code> <code class="nx">opts</code><code class="p">).</code><code class="nx">format</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code>    <code class="c1">// =&gt; "5780 AM"</code>
        <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code><code class="s2">"en-u-ca-buddhist"</code><code class="p">,</code> <code class="nx">opts</code><code class="p">).</code><code class="nx">format</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code>  <code class="c1">// =&gt; "2563 BE"</code>
        <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code><code class="s2">"en-u-ca-islamic"</code><code class="p">,</code> <code class="nx">opts</code><code class="p">).</code><code class="nx">format</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code>   <code class="c1">// =&gt; "1441 AH"</code>
        <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code><code class="s2">"en-u-ca-persian"</code><code class="p">,</code> <code class="nx">opts</code><code class="p">).</code><code class="nx">format</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code>   <code class="c1">// =&gt; "1398 AP"</code>
        <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code><code class="s2">"en-u-ca-indian"</code><code class="p">,</code> <code class="nx">opts</code><code class="p">).</code><code class="nx">format</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code>    <code class="c1">// =&gt; "1941 Saka"</code>
        <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code><code class="s2">"en-u-ca-chinese"</code><code class="p">,</code> <code class="nx">opts</code><code class="p">).</code><code class="nx">format</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code>   <code class="c1">// =&gt; "36 78"</code>
        <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code><code class="s2">"en-u-ca-japanese"</code><code class="p">,</code> <code class="nx">opts</code><code class="p">).</code><code class="nx">format</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code>  <code class="c1">// =&gt; "2 Reiwa"</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.7.3 Comparing Strings"><div class="sect2" id="collator">
        <h2>11.7.3 Comparing Strings</h2>
        
        <p>The<a data-type="indexterm" data-primary="internationalization API" data-secondary="comparing strings" id="IAPIcomp11"></a><a data-type="indexterm" data-primary="strings" data-secondary="working with" data-tertiary="comparing" id="idm46198523423048"></a><a data-type="indexterm" data-primary="alphabetization" id="idm46198523421832"></a><a data-type="indexterm" data-primary="sort order" id="idm46198523421160"></a><a data-type="indexterm" data-primary="collation order" id="idm46198523420488"></a> problem of sorting strings into alphabetical order (or some more
        general “collation order” for nonalphabetical scripts) is more
        challenging than English speakers often realize. English uses a
        relatively small alphabet with no accented letters, and we have the
        benefit of a character encoding (ASCII, since incorporated into
        Unicode) whose numerical values perfectly match our standard string
        sort order. Things are not so simple in other languages. Spanish, for
        example treats ñ as a distinct letter that comes after n and before
        o. Lithuanian alphabetizes Y before J, and Welsh treats digraphs like
        CH and DD as single letters with CH coming after C and DD sorting
        after D.</p>
        
        <p>If you want to display strings to a user in an order that they will
        find natural, it is not enough use the <code>sort()</code> method on an array of
        strings. But<a data-type="indexterm" data-primary="compare() method" id="idm46198523417832"></a> if you create an Intl.Collator object, you can pass the
        <code>compare()</code> method of that object to the <code>sort()</code> method to perform
        locale-appropriate sorting of the strings. Intl.Collator objects can
        be configured so that the <code>compare()</code> method performs case-insensitive
        comparisons or even comparisons that only consider the base letter and
        ignore accents and other diacritics.</p>
        
        <p>Like <code>Intl.NumberFormat()</code> and <code>Intl.DateTimeFormat()</code>, the
        <code>Intl.Collator()</code> constructor takes two arguments. The first specifies
        a locale or an array of locales, and the second is an optional object
        whose properties specify exactly what kind of string comparison is to
        be done. The supported properties are these:</p>
        <dl>
        <dt><code>usage</code></dt>
        <dd>
        <p>This property specifies how the collator object is to be
        used. The default value is <code>"sort"</code>, but you can also specify
        <code>"search"</code>. The idea is that, when sorting strings, you typically want a
        collator that differentiates as many strings as possible to produce a
        reliable ordering. But when comparing two strings, some locales may
        want a less strict comparison that ignores accents, for example.</p>
        </dd>
        <dt><code>sensitivity</code></dt>
        <dd>
        <p>This property specifies whether the collator is
        sensitive to letter case and accents when comparing strings. The value
        <code>"base"</code> causes comparisons that ignore case and accents, considering
        only the base letter for each character. (Note, however, that some
        languages consider certain accented characters to be distinct base
        letters.) <code>"accent"</code> considers accents in comparisons but ignores
        case.  <code>"case"</code> considers case and ignores accents. And <code>"variant"</code>
        performs strict comparisons that consider both case and accents. The
        default value for this property is <code>"variant"</code> when <code>usage</code> is
        <code>"sort"</code>. If <code>usage</code> is <code>"search"</code>, then the default sensitivity
        depends on the locale.</p>
        </dd>
        <dt><code>ignorePunctuation</code></dt>
        <dd>
        <p>Set this property to <code>true</code> to ignore spaces and
        punctuation when comparing strings. With this property set to <code>true</code>,
        the strings “any one” and “anyone”, for example, will be considered
        equal.</p>
        </dd>
        <dt><code>numeric</code></dt>
        <dd>
        <p>Set this property to <code>true</code> if the strings you are
        comparing are integers or contain integers and you want them to be
        sorted into numerical order instead of alphabetical order. With this
        option set, the string “Version 9” will be sorted before “Version 10”,
        for example.</p>
        </dd>
        <dt><code>caseFirst</code></dt>
        <dd>
        <p>This property specifies which letter case should come
        first. If you specify <code>"upper"</code>, then “A” will sort before “a”. And if
        you specify <code>"lower"</code>, then “a” will sort before “A”. In either case,
        note that the upper- and lowercase variants of the same letter will be
        next to one another in sort order, which is different than Unicode
        lexicographic ordering (the default behavior of the Array <code>sort()</code>
        method) in which all ASCII uppercase letters come before all ASCII
        lowercase letters. The default for this property is locale dependent,
        and implementations may ignore this property and not allow you to
        override the case sort order.</p>
        </dd>
        </dl>
        
        <p>Once you have created an Intl.Collator object for the desired locale
        and options, you can use its <code>compare()</code> method to compare two
        strings. This method returns a number. If the returned value is less
        than zero, then the first string comes before the second string. If it
        is greater than zero, then the first string comes after the second
        string. And if <code>compare()</code> returns zero, then the two strings are equal
        as far as this collator is concerned.</p>
        
        <p>This <code>compare()</code> method that takes two strings and returns a number
        less than, equal to, or greater than zero is exactly what the Array
        <code>sort()</code> method expects for its optional argument. Also,
        Intl.Collator automatically binds the <code>compare()</code> method to its
        instance, so you can pass it directly to <code>sort()</code> without having to
        write a wrapper function and invoke it through the collator object.
        Here are some examples:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// A basic comparator for sorting in the user's locale.</code>
        <code class="c1">// Never sort human-readable strings without passing something like this:</code>
        <code class="kr">const</code> <code class="nx">collator</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Intl</code><code class="p">.</code><code class="nx">Collator</code><code class="p">().</code><code class="nx">compare</code><code class="p">;</code>
        <code class="p">[</code><code class="s2">"a"</code><code class="p">,</code> <code class="s2">"z"</code><code class="p">,</code> <code class="s2">"A"</code><code class="p">,</code> <code class="s2">"Z"</code><code class="p">].</code><code class="nx">sort</code><code class="p">(</code><code class="nx">collator</code><code class="p">)</code>      <code class="c1">// =&gt; ["a", "A", "z", "Z"]</code>
        
        <code class="c1">// Filenames often include numbers, so we should sort those specially</code>
        <code class="kr">const</code> <code class="nx">filenameOrder</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Intl</code><code class="p">.</code><code class="nx">Collator</code><code class="p">(</code><code class="kc">undefined</code><code class="p">,</code> <code class="p">{</code> <code class="nx">numeric</code><code class="o">:</code> <code class="kc">true</code> <code class="p">}).</code><code class="nx">compare</code><code class="p">;</code>
        <code class="p">[</code><code class="s2">"page10"</code><code class="p">,</code> <code class="s2">"page9"</code><code class="p">].</code><code class="nx">sort</code><code class="p">(</code><code class="nx">filenameOrder</code><code class="p">)</code>  <code class="c1">// =&gt; ["page9", "page10"]</code>
        
        <code class="c1">// Find all strings that loosely match a target string</code>
        <code class="kr">const</code> <code class="nx">fuzzyMatcher</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Intl</code><code class="p">.</code><code class="nx">Collator</code><code class="p">(</code><code class="kc">undefined</code><code class="p">,</code> <code class="p">{</code>
            <code class="nx">sensitivity</code><code class="o">:</code> <code class="s2">"base"</code><code class="p">,</code>
            <code class="nx">ignorePunctuation</code><code class="o">:</code> <code class="kc">true</code>
        <code class="p">}).</code><code class="nx">compare</code><code class="p">;</code>
        <code class="kd">let</code> <code class="nx">strings</code> <code class="o">=</code> <code class="p">[</code><code class="s2">"food"</code><code class="p">,</code> <code class="s2">"fool"</code><code class="p">,</code> <code class="s2">"Føø Bar"</code><code class="p">];</code>
        <code class="nx">strings</code><code class="p">.</code><code class="nx">findIndex</code><code class="p">(</code><code class="nx">s</code> <code class="o">=&gt;</code> <code class="nx">fuzzyMatcher</code><code class="p">(</code><code class="nx">s</code><code class="p">,</code> <code class="s2">"foobar"</code><code class="p">)</code> <code class="o">===</code> <code class="mi">0</code><code class="p">)</code>  <code class="c1">// =&gt; 2</code></pre>
        
        <p>Some locales have more than one possible collation order. In Germany,
        for example, phone books use a slightly more phonetic sort order than
        dictionaries do. In Spain, before 1994, “ch” and “ll” were treated as
        separate letters, so that country now has a modern sort order and a
        traditional sort order. And in China, collation order can be based on
        character encodings, the base radical and strokes of each character,
        or on the Pinyin romanization of characters. These collation variants
        cannot be selected through the Intl.Collator options argument, but
        they can be selected by adding <code>-u-co-</code> to the locale string and
        adding the name of the desired variant. Use <code>"de-DE-u-co-phonebk"</code>
        for phone book ordering in Germany, for example, and
        <code>"zh-TW-u-co-pinyin"</code> for Pinyin ordering in Taiwan.<a data-type="indexterm" data-primary="" data-startref="JSLinter11" id="idm46198523351096"></a><a data-type="indexterm" data-primary="" data-startref="IAPIcomp11" id="idm46198523350152"></a></p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// Before 1994, CH and LL were treated as separate letters in Spain</code>
        <code class="kr">const</code> <code class="nx">modernSpanish</code> <code class="o">=</code> <code class="nx">Intl</code><code class="p">.</code><code class="nx">Collator</code><code class="p">(</code><code class="s2">"es-ES"</code><code class="p">).</code><code class="nx">compare</code><code class="p">;</code>
        <code class="kr">const</code> <code class="nx">traditionalSpanish</code> <code class="o">=</code> <code class="nx">Intl</code><code class="p">.</code><code class="nx">Collator</code><code class="p">(</code><code class="s2">"es-ES-u-co-trad"</code><code class="p">).</code><code class="nx">compare</code><code class="p">;</code>
        <code class="kd">let</code> <code class="nx">palabras</code> <code class="o">=</code> <code class="p">[</code><code class="s2">"luz"</code><code class="p">,</code> <code class="s2">"llama"</code><code class="p">,</code> <code class="s2">"como"</code><code class="p">,</code> <code class="s2">"chico"</code><code class="p">];</code>
        <code class="nx">palabras</code><code class="p">.</code><code class="nx">sort</code><code class="p">(</code><code class="nx">modernSpanish</code><code class="p">)</code>      <code class="c1">// =&gt; ["chico", "como", "llama", "luz"]</code>
        <code class="nx">palabras</code><code class="p">.</code><code class="nx">sort</code><code class="p">(</code><code class="nx">traditionalSpanish</code><code class="p">)</code> <code class="c1">// =&gt; ["como", "chico", "luz", "llama"]</code></pre>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="11.8 The Console API"><div class="sect1" id="consoleapi">
        <h1>11.8 The Console API</h1>
        
        <p>You’ve<a data-type="indexterm" data-primary="Console API" data-secondary="console.log() function" id="idm46198523034056"></a><a data-type="indexterm" data-primary="JavaScript standard library" data-secondary="Console API" id="JSLconsole11"></a> seen the <code>console.log()</code> function used throughout this book: in
        web browsers, it prints a string in the “Console” tab of the browser’s
        developer tools pane, which can be very helpful when debugging. In
        Node, <code>console.log()</code> is a general-purpose output function and prints
        its arguments to the process’s stdout stream, where it typically
        appears to the user in a terminal window as program output.</p>
        
        <p>The<a data-type="indexterm" data-primary="Console API" data-secondary="support for" id="idm46198523030088"></a> Console API defines a number of useful functions in addition to
        <code>console.log()</code>. The API is not part of any ECMAScript standard, but
        it is supported by browsers and by Node and has been formally written
        up and standardized at <a href="https://console.spec.whatwg.org"><em class="hyperlink">https://console.spec.whatwg.org</em></a>.</p>
        
        <p>The<a data-type="indexterm" data-primary="Console API" data-secondary="functions defined by" id="CAPIfunc11"></a> Console API defines the following functions:</p>
        <dl>
        <dt><code>console.log()</code></dt>
        <dd>
        <p>This is the most well-known of the console functions. It converts its
        arguments to strings and outputs them to the console. It includes
        spaces between the arguments and starts a new line after outputting
        all arguments.</p>
        </dd>
        <dt><code>console.debug()</code>, <code>console.info()</code>, <code>console.warn()</code>, <code>console.error()</code></dt>
        <dd>
        <p>These functions are almost identical to <code>console.log()</code>. In Node,
        <code>console.error()</code> sends its output to the stderr stream rather than
        the stdout stream, but the other functions are aliases of
        <code>console.log()</code>.  In browsers, output messages generated by each of
        these functions may be prefixed by an icon that indicates its level
        or severity, and the developer console may also allow developers to
        filter console messages by level.</p>
        </dd>
        <dt><code>console.assert()</code></dt>
        <dd>
        <p>If the first argument is truthy (i.e., if the
        assertion passes), then this function does nothing. But if the first
        argument is <code>false</code> or another falsy value, then the remaining
        arguments are printed as if they had been passed to <code>console.error()</code>
        with an “Assertion failed” prefix. Note that, unlike typical
        <code>assert()</code> functions, <code>console.assert()</code> does not throw an exception
        when an assertion fails.</p>
        </dd>
        <dt><code>console.clear()</code></dt>
        <dd>
        <p>This function clears the console when that is
        possible. This works in browsers and in Node when Node is displaying
        its output to a terminal. If Node’s output has been redirected to a
        file or a pipe, however, then calling this function has no effect.</p>
        </dd>
        <dt><code>console.table()</code></dt>
        <dd>
        <p>This function is a remarkably powerful but
        little-known feature for producing tabular output, and it is
        particularly useful in Node programs that need to produce output that
        summarizes data. <code>console.table()</code> attempts to display its <span class="keep-together">argument</span> in
        tabular form (although, if it can’t do that, it displays it using regular
        <code>console.log()</code> formatting). This works best when the argument is a
        relatively short array of objects, and all of the objects in the array
        have the same (relatively small) set of properties. In this case,
        each object in the array is formatted as a row of the table, and each
        property is a column of the table. You can also pass an array of
        property names as an optional second argument to specify the desired
        set of columns. If you pass an object instead of an array of objects,
        then the output will be a table with one column for property names and
        one column for property values. Or, if those property values are
        themselves objects, their property names will become columns in the
        table.</p>
        </dd>
        <dt><code>console.trace()</code></dt>
        <dd>
        <p>This function logs its arguments like
        <code>console.log()</code> does, and, in addition, follows its output with a
        stack trace. In Node, the output goes to stderr instead of stdout.</p>
        </dd>
        <dt><code>console.count()</code></dt>
        <dd>
        <p>This function takes a string argument and logs
        that string, followed by the number of times it has been called with
        that string. This can be useful when debugging an event handler, for
        example, if you need to keep track of how many times the event handler
        has been triggered.</p>
        </dd>
        <dt><code>console.countReset()</code></dt>
        <dd>
        <p>This function takes a string argument and
        resets the counter for that string.</p>
        </dd>
        <dt><code>console.group()</code></dt>
        <dd>
        <p>This function prints its arguments to the console
        as if they had been passed to <code>console.log()</code>, then sets the
        internal state of the console so that all subsequent console messages
        (until the next <code>console.groupEnd()</code> call) will be indented relative
        to the message that it just printed. This allows a group of related
        messages to be visually grouped with indentation. In web browsers, the
        developer console typically allows grouped messages to be collapsed
        and expanded as a group. The arguments to <code>console.group()</code> are
        typically used to provide an explanatory name for the group.</p>
        </dd>
        <dt><code>console.groupCollapsed()</code></dt>
        <dd>
        <p>This function works like
        <code>console.group()</code> except that in web browsers, the group will be
        “collapsed” by default and the messages it contains will be hidden
        unless the user clicks to expand the group. In Node, this function is
        a synonym for <code>console.group()</code>.</p>
        </dd>
        <dt><code>console.groupEnd()</code></dt>
        <dd>
        <p>This function takes no arguments. It produces
        no output of its own but ends the indentation and grouping caused by
        the most recent call to <code>console.group()</code> or
        <code>console.groupCollapsed()</code>.</p>
        </dd>
        <dt><code>console.time()</code></dt>
        <dd>
        <p>This function takes a single string argument, makes
        a note of the time it was called with that string, and produces no output.</p>
        </dd>
        <dt><code>console.timeLog()</code></dt>
        <dd>
        <p>This function takes a string as its first
        argument. If that string had previously been passed to
        <code>console.time()</code>, then it prints that string followed by the elapsed
        time since the <code>console.time()</code> call. If there are any additional
        arguments to <span class="keep-together"><code>console.timeLog()</code>,</span> they are printed as if they had been
        passed to <span class="keep-together"><code>console.log()</code>.</span></p>
        </dd>
        <dt><code>console.timeEnd()</code></dt>
        <dd>
        <p>This function takes a single string argument. If
        that argument had previously been passed to <code>console.time()</code>, then it
        prints that argument and the elapsed time. After calling
        <code>console.timeEnd()</code>, it is no longer legal to call <code>console.timeLog()</code>
        without first calling <code>console.time()</code> again.<a data-type="indexterm" data-primary="" data-startref="CAPIfunc11" id="idm46198523127048"></a></p>
        </dd>
        </dl>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.8.1 Formatted Output with Console"><div class="sect2" id="idm46198523164632">
        <h2>11.8.1 Formatted Output with Console</h2>
        
        <p>Console functions<a data-type="indexterm" data-primary="Console API" data-secondary="formatted output with" id="idm46198523124760"></a> that print their arguments like <code>console.log()</code> have
        a little-known feature: if the first argument is a string that includes <code>%s</code>,
        <code>%i</code>, <code>%d</code>, <code>%f</code>, <code>%o</code>, <code>%O</code>, or <code>%c</code>, then this first argument is treated as
        format string,<sup><a data-type="noteref" id="idm46198523009064-marker" href="ch11.html#idm46198523009064">6</a></sup> and the values of subsequent arguments
        are substituted into the string in place of the two-character <code>%</code>
        sequences.</p>
        
        <p>The meanings of the sequences are as follows:</p>
        <dl>
        <dt><code>%s</code></dt>
        <dd>
        <p>The argument is converted to a string.</p>
        </dd>
        <dt><code>%i</code> and <code>%d</code></dt>
        <dd>
        <p>The argument is converted to a number and then
        truncated to an integer.</p>
        </dd>
        <dt><code>%f</code></dt>
        <dd>
        <p>The argument is converted to a number</p>
        </dd>
        <dt><code>%o</code> and <code>%O</code></dt>
        <dd>
        <p>The argument is treated as an
        object, and property names and values are displayed. (In web browsers,
        this display is typically interactive, and users can expand and
        collapse properties to explore a nested data structure.) <code>%o</code> and <code>%O</code>
        both display object details. The uppercase variant uses an
        implementation-dependent output format that is judged to be most
        useful for software developers.</p>
        </dd>
        <dt><code>%c</code></dt>
        <dd>
        <p>In web browsers, the argument is interpreted as a string of CSS
        styles and used to style any text that follows (until the next <code>%c</code>
        sequence or the end of the string). In Node, the <code>%c</code> sequence and its
        corresponding argument are simply ignored.</p>
        </dd>
        </dl>
        
        <p>Note that it is not often necessary to use a format string with
        the console functions: it is usually easy to obtain suitable output by
        simply passing one or more values (including objects) to the function
        and allowing the implementation to display them in a useful way. As an
        example, note that, if you pass an Error object to <span class="keep-together"><code>console.log()</code>,</span> it
        is automatically printed along with its stack trace.<a data-type="indexterm" data-primary="" data-startref="JSLconsole11" id="idm46198522994264"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="11.9 URL APIs"><div class="sect1" id="urlapi">
        <h1>11.9 URL APIs</h1>
        
        <p>Since<a data-type="indexterm" data-primary="URL APIs" id="url11"></a><a data-type="indexterm" data-primary="JavaScript standard library" data-secondary="URL APIs" id="JSLurl11"></a> JavaScript is so commonly used in web browsers and web
        servers, it is common for JavaScript code to need to manipulate
        URLs. The URL class parses URLs and also allows modification (adding
        search parameters or altering paths, for example) of existing
        URLs. It also properly handles the complicated topic of escaping and
        unescaping the various components of a URL.</p>
        
        <p>The URL class is not part of any ECMAScript standard, but it works in
        Node and all internet browsers other than Internet Explorer. It is standardized at <a href="https://url.spec.whatwg.org"><em class="hyperlink">https://url.spec.whatwg.org</em></a>.</p>
        
        <p>Create a URL object with the <code>URL()</code> constructor, passing an absolute
        URL string as the argument. Or pass a relative URL as the first
        argument and the absolute URL that it is relative to as the second
        argument. Once you have created the URL object, its various properties
        allow you to query unescaped versions of the various parts of the URL:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="s2">"https://example.com:8000/path/name?q=term#fragment"</code><code class="p">);</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">href</code>        <code class="c1">// =&gt; "https://example.com:8000/path/name?q=term#fragment"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">origin</code>      <code class="c1">// =&gt; "https://example.com:8000"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">protocol</code>    <code class="c1">// =&gt; "https:"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">host</code>        <code class="c1">// =&gt; "example.com:8000"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">hostname</code>    <code class="c1">// =&gt; "example.com"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">port</code>        <code class="c1">// =&gt; "8000"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">pathname</code>    <code class="c1">// =&gt; "/path/name"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">search</code>      <code class="c1">// =&gt; "?q=term"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">hash</code>        <code class="c1">// =&gt; "#fragment"</code></pre>
        
        <p>Although it is not commonly used, URLs can include a username or a
        username and password, and the URL class can parse these URL
        components, too:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="s2">"ftp://admin:1337!@ftp.example.com/"</code><code class="p">);</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">href</code>       <code class="c1">// =&gt; "ftp://admin:1337!@ftp.example.com/"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">origin</code>     <code class="c1">// =&gt; "ftp://ftp.example.com"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">username</code>   <code class="c1">// =&gt; "admin"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">password</code>   <code class="c1">// =&gt; "1337!"</code></pre>
        
        <p>The <code>origin</code> property here is a simple combination of the URL
        protocol and host (including the port if one is specified). As such,
        it is a read-only property. But each of the other properties
        demonstrated in the previous example is read/write: you can set any of these properties
        to set the corresponding part of the URL:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="s2">"https://example.com"</code><code class="p">);</code>  <code class="c1">// Start with our server</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">pathname</code> <code class="o">=</code> <code class="s2">"api/search"</code><code class="p">;</code>               <code class="c1">// Add a path to an API endpoint</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">search</code> <code class="o">=</code> <code class="s2">"q=test"</code><code class="p">;</code>                     <code class="c1">// Add a query parameter</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">toString</code><code class="p">()</code>  <code class="c1">// =&gt; "https://example.com/api/search?q=test"</code></pre>
        
        <p>One of the important features of the URL class is that it correctly
        adds punctuation and escapes special characters in URLs when that is
        needed:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="s2">"https://example.com"</code><code class="p">);</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">pathname</code> <code class="o">=</code> <code class="s2">"path with spaces"</code><code class="p">;</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">search</code> <code class="o">=</code> <code class="s2">"q=foo#bar"</code><code class="p">;</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">pathname</code>  <code class="c1">// =&gt; "/path%20with%20spaces"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">search</code>    <code class="c1">// =&gt; "?q=foo%23bar"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">href</code>      <code class="c1">// =&gt; "https://example.com/path%20with%20spaces?q=foo%23bar"</code></pre>
        
        <p>The <code>href</code> property in these examples is a special one: reading
        <code>href</code> is equivalent to calling <code>toString()</code>: it reassembles all parts
        of the URL into the canonical string form of the URL. And setting
        <code>href</code> to a new string reruns the URL parser on the new string as if
        you had called the <code>URL()</code> constructor again.</p>
        
        <p>In the previous examples, we’ve been using the <code>search</code> property to refer
        to the entire query portion of a URL, which consists of the characters
        from a question mark to the end of the URL or to the first hash
        character. Sometimes, it is sufficient to just treat this as a single
        URL property. Often, however, HTTP requests encode the values of
        multiple form fields or multiple API parameters into the query portion
        of a URL using the <code>application/x-www-form-urlencoded</code> format. In this
        format, the query portion of the URL is a question mark followed by
        one or more name/value pairs, which are separated from one another by
        ampersands. The same name can appear more than once, resulting in a
        named search parameter with more than one value.</p>
        
        <p>If you want to encode these kinds of name/value pairs into the query
        portion of a URL, then the <code>searchParams</code> property will be more useful
        than the <code>search</code> property. The <code>search</code> property is a read/write
        string that lets you get and set the entire query portion of the
        URL. The <code>searchParams</code> property is a read-only reference to a
        
        <span class="keep-together">URLSearchParams</span> object, which has an API for getting, setting, adding,
        deleting, and sorting the parameters encoded into the query portion of
        the URL:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="s2">"https://example.com/search"</code><code class="p">);</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">search</code>                            <code class="c1">// =&gt; "": no query yet</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"q"</code><code class="p">,</code> <code class="s2">"term"</code><code class="p">);</code> <code class="c1">// Add a search parameter</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">search</code>                            <code class="c1">// =&gt; "?q=term"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s2">"q"</code><code class="p">,</code> <code class="s2">"x"</code><code class="p">);</code>       <code class="c1">// Change the value of this parameter</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">search</code>                            <code class="c1">// =&gt; "?q=x"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"q"</code><code class="p">)</code>             <code class="c1">// =&gt; "x": query the parameter value</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="s2">"q"</code><code class="p">)</code>             <code class="c1">// =&gt; true: there is a q parameter</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="s2">"p"</code><code class="p">)</code>             <code class="c1">// =&gt; false: there is no p parameter</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"opts"</code><code class="p">,</code> <code class="s2">"1"</code><code class="p">);</code> <code class="c1">// Add another search parameter</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">search</code>                            <code class="c1">// =&gt; "?q=x&amp;opts=1"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"opts"</code><code class="p">,</code> <code class="s2">"&amp;"</code><code class="p">);</code> <code class="c1">// Add another value for same name</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">search</code>                            <code class="c1">// =&gt; "?q=x&amp;opts=1&amp;opts=%26": note escape</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"opts"</code><code class="p">)</code>          <code class="c1">// =&gt; "1": the first value</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">getAll</code><code class="p">(</code><code class="s2">"opts"</code><code class="p">)</code>       <code class="c1">// =&gt; ["1", "&amp;"]: all values</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">sort</code><code class="p">();</code>              <code class="c1">// Put params in alphabetical order</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">search</code>                            <code class="c1">// =&gt; "?opts=1&amp;opts=%26&amp;q=x"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s2">"opts"</code><code class="p">,</code> <code class="s2">"y"</code><code class="p">);</code>    <code class="c1">// Change the opts param</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">search</code>                            <code class="c1">// =&gt; "?opts=y&amp;q=x"</code>
        <code class="c1">// searchParams is iterable</code>
        <code class="p">[...</code><code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">]</code>                 <code class="c1">// =&gt; [["opts", "y"], ["q", "x"]]</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="k">delete</code><code class="p">(</code><code class="s2">"opts"</code><code class="p">);</code>      <code class="c1">// Delete the opts param</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">search</code>                            <code class="c1">// =&gt; "?q=x"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">href</code>                              <code class="c1">// =&gt; "https://example.com/search?q=x"</code></pre>
        
        <p>The value of the <code>searchParams</code> property is a URLSearchParams
        object. If you want to encode URL parameters into a query string, you
        can create a URLSearchParams object, append parameters, then convert
        it to a string and set it on the <code>search</code> property of a URL:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="kd">let</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="s2">"http://example.com"</code><code class="p">);</code>
        <code class="kd">let</code> <code class="nx">params</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URLSearchParams</code><code class="p">();</code>
        <code class="nx">params</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"q"</code><code class="p">,</code> <code class="s2">"term"</code><code class="p">);</code>
        <code class="nx">params</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s2">"opts"</code><code class="p">,</code> <code class="s2">"exact"</code><code class="p">);</code>
        <code class="nx">params</code><code class="p">.</code><code class="nx">toString</code><code class="p">()</code>               <code class="c1">// =&gt; "q=term&amp;opts=exact"</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">search</code> <code class="o">=</code> <code class="nx">params</code><code class="p">;</code>
        <code class="nx">url</code><code class="p">.</code><code class="nx">href</code>                        <code class="c1">// =&gt; "http://example.com/?q=term&amp;opts=exact"</code></pre>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="11.9.1 Legacy URL Functions"><div class="sect2" id="idm46198522514536">
        <h2>11.9.1 Legacy URL Functions</h2>
        
        <p>Prior to the definition of the URL API described previously, there have
        been multiple attempts to support URL escaping and unescaping in the
        core JavaScript language. The<a data-type="indexterm" data-primary="escape() function" id="idm46198522376104"></a><a data-type="indexterm" data-primary="unescape() function" id="idm46198522375400"></a> first attempt was the globally defined
        <code>escape()</code> and <code>unescape()</code> functions, which are now deprecated but
        still widely implemented. They should not be used.</p>
        
        <p>When <code>escape()</code> and <code>unescape()</code> were deprecated, ECMAScript
        introduced two pairs of alternative global functions:</p>
        <dl>
        <dt><code>encodeURI()</code> and <code>decodeURI()</code></dt>
        <dd>
        <p><code>encodeURI()</code> takes<a data-type="indexterm" data-primary="encodeURI() function" id="idm46198522369592"></a><a data-type="indexterm" data-primary="decodeURI() function" id="idm46198522368856"></a> a string as its
        argument and returns a new string in which non-ASCII characters plus
        certain ASCII characters (such as space) are escaped. <code>decodeURI()</code>
        reverses the process.  Characters that need to be escaped are first
        converted to their UTF-8 encoding, then each byte of that encoding
        is replaced with a <code>%</code><em>xx</em> escape sequence, where <em>xx</em> is two
        hexadecimal digits. Because <code>encodeURI()</code> is intended for encoding
        entire URLs, it does not escape URL separator characters such as <code>/</code>,
        <code>?</code>, and <code>#</code>. But this means that <code>encodeURI()</code> cannot work correctly
        for URLs that have those characters within their various components.</p>
        </dd>
        <dt><code>encodeURIComponent()</code> and <code>decodeURIComponent()</code></dt>
        <dd>
        <p>This<a data-type="indexterm" data-primary="encodeURIComponent() function" id="idm46198522362312"></a><a data-type="indexterm" data-primary="decodeURIComponent() function" id="idm46198522361224"></a> pair of
        functions works just like <code>encodeURI()</code> and <code>decodeURI()</code> except that
        they are intended to escape individual components of a URI, so they
        also escape characters like <code>/</code>, <code>?</code>, and <code>#</code> that are used to separate
        those components. These are the most useful of the legacy URL
        functions, but be aware that <code>encodeURIComponent()</code> will escape <code>/</code>
        characters in a path name that you probably do not want escaped. And
        it will convert spaces in a query parameter to <code>%20</code>, even though
        spaces are supposed to be escaped with a <code>+</code> in that portion of a
        URL.</p>
        </dd>
        </dl>
        
        <p>The fundamental problem with all of these legacy functions is that
        they seek to apply a single encoding scheme to all parts of a URL when
        the fact is that different portions of a URL use different
        encodings. If you want a properly formatted and encoded URL, the
        solution is simply to use the URL class for all URL manipulation you
        do.<a data-type="indexterm" data-primary="" data-startref="JSLurl11" id="idm46198522355304"></a><a data-type="indexterm" data-primary="" data-startref="url11" id="idm46198522354328"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="11.10 Timers"><div class="sect1" id="timerapi">
        <h1>11.10 Timers</h1>
        
        <p>Since<a data-type="indexterm" data-primary="setTimeout() function" id="idm46198522351416"></a><a data-type="indexterm" data-primary="timers" id="idm46198522350680"></a><a data-type="indexterm" data-primary="JavaScript standard library" data-secondary="timers" id="JSLtimers11"></a><a data-type="indexterm" data-primary="setInterval() function" id="idm46198522484024"></a> the earliest days of JavaScript, web browsers have defined two
        functions—<span class="keep-together"><code>setTimeout()</code></span> and <code>setInterval()</code>—that allow programs to ask
        the browser to invoke a function after a specified amount of time has
        elapsed or to invoke the function repeatedly at a specified
        interval. These functions have never been standardized as part of the
        core language, but they work in all browsers and in Node and are a
        de facto part of the JavaScript standard library.</p>
        
        <p>The first argument to <code>setTimeout()</code> is a function, and the second
        argument is a number that specifies how many milliseconds should
        elapse before the function is invoked. After the specified amount of
        time (and maybe a little longer if the system is busy), the function
        will be invoked with no arguments. Here, for example, are three
        <code>setTimeout()</code> calls that print console messages after one second, two
        seconds, and three seconds:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="nx">setTimeout</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s2">"Ready..."</code><code class="p">);</code> <code class="p">},</code> <code class="mi">1000</code><code class="p">);</code>
        <code class="nx">setTimeout</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s2">"set..."</code><code class="p">);</code> <code class="p">},</code> <code class="mi">2000</code><code class="p">);</code>
        <code class="nx">setTimeout</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s2">"go!"</code><code class="p">);</code> <code class="p">},</code> <code class="mi">3000</code><code class="p">);</code></pre>
        
        <p>Note that <code>setTimeout()</code> does not wait for the time to elapse before
        returning. All three lines of code in this example run almost instantly, but
        then nothing happens until 1,000 milliseconds elapse.</p>
        
        <p>If you omit the second argument to <code>setTimeout()</code>, it defaults to
        0. That does not mean, however, that the function you specify is
        invoked immediately. Instead, the function is registered to be called
        “as soon as possible.” If a browser is particularly busy handling user
        input or other events, it may take 10 milliseconds or more before the function is
        invoked.</p>
        
        <p><code>setTimeout()</code> registers a function to be invoked once. Sometimes, that
        function will itself call <code>setTimeout()</code> to schedule another
        invocation at a future time. If you want to invoke a function
        repeatedly, however, it is often simpler to use
        <code>setInterval()</code>. <code>setInterval()</code> takes the same two arguments as
        <code>setTimeout()</code> but invokes the function repeatedly every time the
        specified number of milliseconds (approximately) have elapsed.</p>
        
        <p>Both <code>setTimeout()</code> and <code>setInterval()</code> return a value. If you save
        this value in a variable, you can then use it later to cancel the
        execution of the function by passing it to <code>clearTimeout()</code> or
        <code>clearInterval()</code>. The returned value is typically a number in web
        browsers and is an object in Node. The actual type doesn’t matter,
        and you should treat it as an opaque value. The only thing you can do
        with this value is pass it to <code>clearTimeout()</code> to cancel the execution
        of a function registered with <code>setTimeout()</code> (assuming it hasn’t been
        invoked yet) or to stop the repeating execution of a function
        registered with <code>setInterval()</code>.</p>
        
        <p>Here is an example that demonstrates the use of <code>setTimeout()</code>,
        <code>setInterval()</code>, and <code>clearInterval()</code> to display a simple digital
        clock with the Console API:</p>
        
        <pre data-type="programlisting" data-code-language="js"><code class="c1">// Once a second: clear the console and print the current time</code>
        <code class="kd">let</code> <code class="nx">clock</code> <code class="o">=</code> <code class="nx">setInterval</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="nx">console</code><code class="p">.</code><code class="nx">clear</code><code class="p">();</code>
            <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="k">new</code> <code class="nb">Date</code><code class="p">().</code><code class="nx">toLocaleTimeString</code><code class="p">());</code>
        <code class="p">},</code> <code class="mi">1000</code><code class="p">);</code>
        
        <code class="c1">// After 10 seconds: stop the repeating code above.</code>
        <code class="nx">setTimeout</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code> <code class="nx">clearInterval</code><code class="p">(</code><code class="nx">clock</code><code class="p">);</code> <code class="p">},</code> <code class="mi">10000</code><code class="p">);</code></pre>
        
        <p>We’ll see <code>setTimeout()</code> and <code>setInterval()</code> again when we cover
        asynchronous programming in <a data-type="xref" href="ch13.html#async">Chapter&nbsp;13</a>.<a data-type="indexterm" data-primary="" data-startref="JSLtimers11" id="idm46198522299112"></a></p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" class="less_space pagebreak-before" data-pdf-bookmark="11.11 Summary"><div class="sect1" id="idm46198522352792">
        <h1>11.11 Summary</h1>
        
        <p>Learning a programming language is not just about mastering the
        grammar. It is equally important to study the standard library so that
        you are familiar with all the tools that are shipped with the
        language. This chapter has documented JavaScript’s standard library,
        which includes:</p>
        
        <ul>
        <li>
        <p>Important data structures, such as Set, Map, and typed arrays.</p>
        </li>
        <li>
        <p>The Date and URL classes for working with dates and URLs.</p>
        </li>
        <li>
        <p>JavaScript’s regular expression grammar and its RegExp class for
        textual pattern matching.</p>
        </li>
        <li>
        <p>JavaScript’s internationalization library for formatting dates, time,
        and numbers and for sorting strings.</p>
        </li>
        <li>
        <p>The <code>JSON</code> object for serializing and deserializing simple data
        structures and the <code>console</code> object for logging messages.</p>
        </li>
        </ul>
        </div></section>
        
        
        
        
        
        
        
        <div data-type="footnotes"><p data-type="footnote" id="idm46198529052360"><sup><a href="ch11.html#idm46198529052360-marker">1</a></sup> Not everything documented here is defined by the JavaScript language specification: some of the classes and functions documented here were first implemented in web browsers and then adopted by Node, making them de facto members of the JavaScript standard library.</p><p data-type="footnote" id="idm46198528676184"><sup><a href="ch11.html#idm46198528676184-marker">2</a></sup> This predictable iteration order is another thing about JavaScript sets that Python programmers may find  <span class="keep-together">surprising.</span></p><p data-type="footnote" id="idm46198527893912"><sup><a href="ch11.html#idm46198527893912-marker">3</a></sup> Typed arrays were first introduced to client-side JavaScript when web browsers added support for WebGL graphics. What is new in ES6 is that they have been elevated to a core language feature.</p><p data-type="footnote" id="idm46198526281256"><sup><a href="ch11.html#idm46198526281256-marker">4</a></sup> Except within a character class (square brackets), where <code>\b</code> matches the backspace character.</p><p data-type="footnote" id="idm46198525964472"><sup><a href="ch11.html#idm46198525964472-marker">5</a></sup> Parsing URLs with regular expressions is not a good idea. See <a data-type="xref" href="#urlapi">§11.9</a> for a more robust URL parser.</p><p data-type="footnote" id="idm46198523009064"><sup><a href="ch11.html#idm46198523009064-marker">6</a></sup> C programmers will recognize many of these character sequences from the <code>printf()</code> function.</p></div></div></section></div></div><link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781491952016/files/epub.css" crossorigin="anonymous"></div></div></section>
</div>

 <!-- https://learning.oreilly.com -->