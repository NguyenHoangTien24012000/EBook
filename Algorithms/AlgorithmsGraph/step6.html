<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
    
</style>
<link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492092506/files/epub.css" crossorigin="anonymous">
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Community Detection Algorithms"><div class="chapter" id="community_detection_algorithms">
        <h1><span class="label">Chapter 6. </span>Community Detection Algorithms</h1>
        
        
        <p><a data-type="indexterm" data-primary="community detection algorithms" id="ix_ch06-adoc0"></a>Community formation is common in all types of networks, and identifying them is essential for evaluating group behavior and emergent phenomena.
        The general principle in finding communities is that its members will have more relationships within the group than with nodes outside their group.
        Identifying these related sets reveals clusters of nodes, isolated groups, and network structure.
        This information helps infer similar behavior or preferences of peer groups, estimate resiliency, find nested relationships, and prepare data for other analyses.
        Community detection algorithms are also commonly used to produce network visualization for general inspection.</p>
        
        <p>We’ll provide details on the most representative community detection algorithms:</p>
        
        <ul>
        <li>
        <p>Triangle Count and Clustering Coefficient for overall relationship density</p>
        </li>
        <li>
        <p>Strongly Connected Components and Weakly Connected Components for finding connected clusters</p>
        </li>
        <li>
        <p>Label Propagation for quickly inferring groups based on node labels</p>
        </li>
        <li>
        <p>Louvain Modularity for looking at grouping quality and hierarchies</p>
        </li>
        </ul>
        
        <p>We’ll explain how the algorithms work and show examples in Apache Spark and Neo4j.
        In cases where an algorithm is only available in one platform, we’ll provide just one example. We use weighted relationships for these algorithms because they’re typically used to capture the significance of different relationships.</p>
        
        <p><a data-type="indexterm" data-primary="Clustering Coefficient algorithm" data-seealso="Triangle Count and Clustering Coefficient algorithms" id="idm46681366710888"></a><a data-type="indexterm" data-primary="Connected Components algorithm" id="idm46681366709912"></a><a data-type="indexterm" data-primary="Label Propagation algorithm (LPA)" id="idm46681366709272"></a><a data-type="indexterm" data-primary="Louvain Modularity algorithm" id="idm46681366708584"></a><a data-type="indexterm" data-primary="Strongly Connected Components (SCC) algorithm" id="idm46681366707896"></a><a data-type="indexterm" data-primary="Triangle Count and Clustering Coefficient algorithms" id="idm46681366707192"></a><a data-type="xref" href="#community_overview">Figure&nbsp;6-1</a> gives an overview of the differences between the community detection algorithms covered here, and <a data-type="xref" href="#communitydetection-overview-table">Table&nbsp;6-1</a> provides a quick reference as to what each algorithm calculates with example uses.</p>
        
        <figure><div id="community_overview" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/gral_rr_0601.png" alt="gral rr 0601" width="1407" height="1747">
        <h6><span class="label">Figure 6-1. </span>Representative community detection algorithms</h6>
        </div></figure>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>We use the terms <em>set</em>, <em>partition</em>, <em>cluster</em>, <em>group</em>, and <em>community</em> interchangeably.
        These terms are different ways to indicate that similar nodes can be grouped. Community detection algorithms are also called clustering and partitioning algorithms.
        In each section, we use the terms that are most prominent in the literature for a particular algorithm.</p>
        </div>
        <table id="communitydetection-overview-table">
        <caption><span class="label">Table 6-1. </span>Overview of community detection algorithms</caption>
        <thead>
        <tr>
        <th>Algorithm type</th>
        <th>What it does</th>
        <th>Example use</th>
        <th>Spark example</th>
        <th>Neo4j example</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><div>
        <p><a href="#triangles_coefficient">Triangle Count and Clustering Coefficient</a></p></div></td>
        <td><div>
        <p>Measures how many nodes form triangles and the degree to which nodes tend to cluster together</p></div></td>
        <td><div>
        <p>Estimating group stability and whether the network might exhibit “small-world” behaviors seen in graphs with tightly knit clusters</p></div></td>
        <td><div>
        <p>Yes</p></div></td>
        <td><div>
        <p>Yes</p></div></td>
        </tr>
        <tr>
        <td><div>
        <p><a href="#strongly_connected_components">Strongly Connected Components</a></p></div></td>
        <td><div>
        <p>Finds groups where each node is reachable from every other node in that same group <em>following the direction</em> of relationships</p></div></td>
        <td><div>
        <p>Making product recommendations based on group affiliation or similar items</p></div></td>
        <td><div>
        <p>Yes</p></div></td>
        <td><div>
        <p>Yes</p></div></td>
        </tr>
        <tr>
        <td><div>
        <p><a href="#weakly_connected_components">Connected Components</a></p></div></td>
        <td><div>
        <p>Finds groups where each node is reachable from every other node in that same group, <em>regardless of the direction</em> of relationships</p></div></td>
        <td><div>
        <p>Performing fast grouping for other algorithms and identify islands</p></div></td>
        <td><div>
        <p>Yes</p></div></td>
        <td><div>
        <p>Yes</p></div></td>
        </tr>
        <tr>
        <td><div>
        <p><a href="#label_propagation">Label Propagation</a></p></div></td>
        <td><div>
        <p>Infers clusters by spreading labels based on neighborhood majorities</p></div></td>
        <td><div>
        <p>Understanding consensus in social communities or finding dangerous combinations of possible co-prescribed drugs</p></div></td>
        <td><div>
        <p>Yes</p></div></td>
        <td><div>
        <p>Yes</p></div></td>
        </tr>
        <tr>
        <td><div>
        <p><a href="#louvain">Louvain Modularity</a></p></div></td>
        <td><div>
        <p>Maximizes the presumed accuracy of groupings by comparing relationship weights and densities to a defined estimate or average</p></div></td>
        <td><div>
        <p>In fraud analysis, evaluating whether a group has just a few discrete bad behaviors or is acting as a fraud ring</p></div></td>
        <td><div>
        <p>No</p></div></td>
        <td><div>
        <p>Yes</p></div></td>
        </tr>
        </tbody>
        </table>
        
        <p>First, we’ll describe the data for our examples and walk through importing the data into Spark and Neo4j.
        The algorithms are covered in the order listed in <a data-type="xref" href="#communitydetection-overview-table">Table&nbsp;6-1</a>.
        For each, you’ll find a short description and advice on when to use it.
        Most sections also include guidance on when to use related algorithms.
        We demonstrate example code using sample data at the end of each algorithm section.</p>
        <div data-type="tip"><h6>Tip</h6>
        <p><a data-type="indexterm" data-primary="density of relationships" id="idm46681366624984"></a>When using community detection algorithms, be conscious of the density of the relationships.</p>
        
        <p>If the graph is very dense, you may end up with all nodes congregating in one or just a few clusters.
        You can counteract this by filtering by degree, relationship weights, or similarity metrics.</p>
        
        <p>On the other hand, if the graph is too sparse with few connected nodes, you may end up with each node in its own cluster.
        In this case, try to incorporate additional relationship types that carry more relevant information.</p>
        </div>
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Example Graph Data: The Software Dependency Graph"><div class="sect1" id="idm46681366622632">
        <h1>Example Graph Data: The Software Dependency Graph</h1>
        
        <p><a data-type="indexterm" data-primary="community detection algorithms" data-secondary="software dependency graph data for" id="ix_ch06-adoc1"></a><a data-type="indexterm" data-primary="software dependency graph data" id="ix_ch06-adoc2"></a>Dependency graphs are particularly well suited for demonstrating the sometimes subtle differences between community detection algorithms because they tend to be more connected and hierarchical.
        The examples in this chapter are run against a graph containing dependencies between Python libraries, although dependency graphs are used in various fields, from software to energy grids.
        This kind of software dependency graph is used by developers to keep track of transitive interdependencies and conflicts in software projects.
        You can download the nodes and relationships files from the book’s <a href="https://bit.ly/2FPgGVV">GitHub repository</a>.</p>
        <table>
        <caption class="width-full"><span class="label">Table 6-2. </span><em>sw-nodes.csv</em></caption>
        <thead>
        <tr>
        <th>id</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>six</p></td>
        </tr>
        <tr>
        <td><p>pandas</p></td>
        </tr>
        <tr>
        <td><p>numpy</p></td>
        </tr>
        <tr>
        <td><p>python-dateutil</p></td>
        </tr>
        <tr>
        <td><p>pytz</p></td>
        </tr>
        <tr>
        <td><p>pyspark</p></td>
        </tr>
        <tr>
        <td><p>matplotlib</p></td>
        </tr>
        <tr>
        <td><p>spacy</p></td>
        </tr>
        <tr>
        <td><p>py4j</p></td>
        </tr>
        <tr>
        <td><p>jupyter</p></td>
        </tr>
        <tr>
        <td><p>jpy-console</p></td>
        </tr>
        <tr>
        <td><p>nbconvert</p></td>
        </tr>
        <tr>
        <td><p>ipykernel</p></td>
        </tr>
        <tr>
        <td><p>jpy-client</p></td>
        </tr>
        <tr>
        <td><p>jpy-core</p></td>
        </tr>
        <tr>
        <td></td>
        </tr>
        </tbody>
        </table>
        <table>
        <caption><span class="label">Table 6-3. </span><em>sw-relationships.csv</em></caption>
        <thead>
        <tr>
        <th>src</th>
        <th>dst</th>
        <th>relationship</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>pandas</p></td>
        <td><p>numpy</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>pandas</p></td>
        <td><p>pytz</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>pandas</p></td>
        <td><p>python-dateutil</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>python-dateutil</p></td>
        <td><p>six</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>pyspark</p></td>
        <td><p>py4j</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>matplotlib</p></td>
        <td><p>numpy</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>matplotlib</p></td>
        <td><p>python-dateutil</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>matplotlib</p></td>
        <td><p>six</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>matplotlib</p></td>
        <td><p>pytz</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>spacy</p></td>
        <td><p>six</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>spacy</p></td>
        <td><p>numpy</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>jupyter</p></td>
        <td><p>nbconvert</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>jupyter</p></td>
        <td><p>ipykernel</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>jupyter</p></td>
        <td><p>jpy-console</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>jpy-console</p></td>
        <td><p>jpy-client</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>jpy-console</p></td>
        <td><p>ipykernel</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>jpy-client</p></td>
        <td><p>jpy-core</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        <tr>
        <td><p>nbconvert</p></td>
        <td><p>jpy-core</p></td>
        <td><p>DEPENDS_ON</p></td>
        </tr>
        </tbody>
        </table>
        
        <p><a data-type="xref" href="#community_detection-graph">Figure&nbsp;6-2</a> shows the graph that we want to construct.
        Looking at this graph, we see that there are three clusters of libraries.
        We can use visualizations on smaller datasets as a tool to help validate the clusters derived by community detection algorithms.</p>
        
        <figure><div id="community_detection-graph" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/gral_0602.png" alt="gral 0602" width="3438" height="2997">
        <h6><span class="label">Figure 6-2. </span>The graph model</h6>
        </div></figure>
        
        <p>Let’s create graphs in Spark and Neo4j from the example CSV files.</p>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Importing the Data into Apache Spark"><div class="sect2" id="idm46681366551480">
        <h2>Importing the Data into Apache Spark</h2>
        
        <p><a data-type="indexterm" data-primary="Apache Spark" data-secondary="importing software dependency graph data into" id="idm46681366550136"></a><a data-type="indexterm" data-primary="GraphFrames" id="idm46681366549064"></a><a data-type="indexterm" data-primary="software dependency graph data" data-secondary="importing into Apache Spark" id="idm46681366548392"></a>We’ll first import the packages we need from Apache Spark and the GraphFrames package:</p>
        
        <pre data-type="programlisting" data-code-language="python"><code class="kn">from</code> <code class="nn">graphframes</code> <code class="kn">import</code> <code class="o">*</code></pre>
        
        <p>The following function creates a GraphFrame from the example CSV files:</p>
        
        <pre data-type="programlisting" data-code-language="python"><code class="k">def</code> <code class="nf">create_software_graph</code><code class="p">():</code>
            <code class="n">nodes</code> <code class="o">=</code> <code class="n">spark</code><code class="o">.</code><code class="n">read</code><code class="o">.</code><code class="n">csv</code><code class="p">(</code><code class="s2">"data/sw-nodes.csv"</code><code class="p">,</code> <code class="n">header</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>
            <code class="n">relationships</code> <code class="o">=</code> <code class="n">spark</code><code class="o">.</code><code class="n">read</code><code class="o">.</code><code class="n">csv</code><code class="p">(</code><code class="s2">"data/sw-relationships.csv"</code><code class="p">,</code> <code class="n">header</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>
            <code class="k">return</code> <code class="n">GraphFrame</code><code class="p">(</code><code class="n">nodes</code><code class="p">,</code> <code class="n">relationships</code><code class="p">)</code></pre>
        
        <p>Now let’s call that function:</p>
        
        <pre data-type="programlisting" data-code-language="python"><code class="n">g</code> <code class="o">=</code> <code class="n">create_software_graph</code><code class="p">()</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Importing the Data into Neo4j"><div class="sect2" id="idm46681366458456">
        <h2>Importing the Data into Neo4j</h2>
        
        <p><a data-type="indexterm" data-primary="Neo4j" data-secondary="importing software dependency graph data into" id="idm46681366470360"></a><a data-type="indexterm" data-primary="software dependency graph data" data-secondary="importing into Neo4j" id="idm46681366469448"></a>Next we’ll do the same for Neo4j.
        We’ll start by creating a database that we’ll use for the examples in this chapter:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="n">:</code><code class="n">u</code><code class="n">s</code><code class="n">e</code><code class="n"> </code><code class="n">s</code><code class="n">y</code><code class="n">s</code><code class="n">t</code><code class="n">e</code><code class="n">m</code><code class="n">;</code><code class="n"> </code><a class="co" id="co_community_detection_algorithms_CO1-1" href="#callout_community_detection_algorithms_CO1-1"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/1.png" alt="1" width="12" height="12"></a><code class="n">
        </code><code class="k">CREATE </code><code class="n">D</code><code class="n">A</code><code class="n">T</code><code class="n">A</code><code class="n">B</code><code class="n">A</code><code class="n">S</code><code class="n">E</code><code class="n"> </code><code class="n">c</code><code class="n">h</code><code class="n">a</code><code class="n">p</code><code class="n">t</code><code class="n">e</code><code class="n">r</code><code class="n">6</code><code class="n">;</code><code class="n"> </code><a class="co" id="co_community_detection_algorithms_CO1-2" href="#callout_community_detection_algorithms_CO1-2"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/2.png" alt="2" width="12" height="12"></a><code class="n">
        </code><code class="n">:</code><code class="n">u</code><code class="n">s</code><code class="n">e</code><code class="n"> </code><code class="n">c</code><code class="n">h</code><code class="n">a</code><code class="n">p</code><code class="n">t</code><code class="n">e</code><code class="n">r</code><code class="n">6</code><code class="n">;</code><code class="n"> </code><a class="co" id="co_community_detection_algorithms_CO1-3" href="#callout_community_detection_algorithms_CO1-3"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/3.png" alt="3" width="12" height="12"></a></pre>
        <dl class="calloutlist">
        <dt><a class="co" id="callout_community_detection_algorithms_CO1-1" href="#co_community_detection_algorithms_CO1-1"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/1.png" alt="1" width="12" height="12"></a></dt>
        <dd><p>Switch to the system database.</p></dd>
        <dt><a class="co" id="callout_community_detection_algorithms_CO1-2" href="#co_community_detection_algorithms_CO1-2"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/2.png" alt="2" width="12" height="12"></a></dt>
        <dd><p>Create a new database with the name <code>chapter6</code>. This operation is asynchronous so we may have to wait a couple of seconds before switching to the database.</p></dd>
        <dt><a class="co" id="callout_community_detection_algorithms_CO1-3" href="#co_community_detection_algorithms_CO1-3"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/3.png" alt="3" width="12" height="12"></a></dt>
        <dd><p>Switch to the <code>chapter6</code> database.</p></dd>
        </dl>
        
        <p>The following query imports the nodes:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="k">WITH</code><code class="n"> </code><code class="s1">'https://github.com/neo4j-graph-analytics/book/raw/master/data/'</code><code class="n"> </code><code class="k">AS </code><code class="n">base</code>
        <code class="k">WITH </code><code class="n">base + </code><code class="s1">'sw-nodes.csv'</code><code class="n"> </code><code class="k">AS </code><code class="n">uri</code>
        <code class="n">LOAD CSV </code><code class="k">WITH </code><code class="n">HEADERS FROM uri </code><code class="k">AS </code><code class="n">row</code>
        <code class="n">MERGE (:Library {</code><code class="nf">id</code><code class="n">: row.</code><code class="nf">id</code><code class="n">});</code></pre>
        
        <p>And this imports the relationships:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="k">WITH</code><code class="n"> </code><code class="s1">'https://github.com/neo4j-graph-analytics/book/raw/master/data/'</code><code class="n"> </code><code class="k">AS </code><code class="n">base</code>
        <code class="k">WITH </code><code class="n">base + </code><code class="s1">'sw-relationships.csv'</code><code class="n"> </code><code class="k">AS </code><code class="n">uri</code>
        <code class="n">LOAD CSV </code><code class="k">WITH </code><code class="n">HEADERS FROM uri </code><code class="k">AS </code><code class="n">row</code>
        <code class="k">MATCH</code><code class="n"> (source:Library {</code><code class="nf">id</code><code class="n">: row.src})</code>
        <code class="k">MATCH</code><code class="n"> (destination:Library {</code><code class="nf">id</code><code class="n">: row.dst})</code>
        <code class="n">MERGE (source)-[:DEPENDS_ON]-&gt;(destination);</code></pre>
        
        <p>Now that we’ve got our graphs loaded it’s on to the algorithms!<a data-type="indexterm" data-startref="ix_ch06-adoc2" id="idm46681366295032"></a><a data-type="indexterm" data-startref="ix_ch06-adoc1" id="idm46681366294536"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Triangle Count and Clustering Coefficient"><div class="sect1" id="triangles_coefficient">
        <h1>Triangle Count and Clustering Coefficient</h1>
        
        <p><a data-type="indexterm" data-primary="community detection algorithms" data-secondary="Triangle Count and Clustering Coefficient" id="ix_ch06-adoc3"></a><a data-type="indexterm" data-primary="Triangle Count and Clustering Coefficient algorithms" id="ix_ch06-adoc4"></a>The Triangle Count and Clustering Coefficient algorithms are presented together because they are so often used together. Triangle Count determines the number of triangles passing through each node in the graph.
        A triangle is a set of three nodes, where each node has a relationship to all other nodes.
        Triangle Count can also be run globally for evaluating our overall dataset.</p>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>Networks with a high number of triangles are more likely to exhibit small-world structures and behaviors.</p>
        </div>
        
        <p>The goal of the Clustering Coefficient algorithm is to measure how tightly a group is clustered compared to how tightly it could be clustered. The algorithm uses Triangle Count in its calculations, which provides a ratio of existing triangles to possible relationships. A maximum value of 1 indicates a clique where every node is connected to every other node.</p>
        
        <p>There are two types of clustering coefficients: local clustering and global clustering.</p>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Local Clustering Coefficient"><div class="sect2" id="idm46681366256056">
        <h2>Local Clustering Coefficient</h2>
        
        <p><a data-type="indexterm" data-primary="local clustering coefficient" id="idm46681366254648"></a><a data-type="indexterm" data-primary="Triangle Count and Clustering Coefficient algorithms" data-secondary="local clustering coefficient" id="idm46681366253976"></a>The local clustering coefficient of a node is the likelihood that its neighbors are also connected.
        The computation of this score involves triangle counting.</p>
        
        <p>The clustering coefficient of a node can be found by multiplying the number of triangles passing through the node by two and then diving that by the maximum number of relationships in the group, which is always the degree of that node, minus one. Examples of different triangles and clustering coefficients for a node with five relationships are portrayed in <a data-type="xref" href="#triangle-clustercoeff">Figure&nbsp;6-3</a>.</p>
        
        <figure><div id="triangle-clustercoeff" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/gral_rr_0603.png" alt="gral rr 0603" width="1429" height="519">
        <h6><span class="label">Figure 6-3. </span>Triangle counts and clustering coefficients for node u</h6>
        </div></figure>
        
        <p>Note in <a data-type="xref" href="#triangle-clustercoeff">Figure&nbsp;6-3</a>, we use a node with five relationships which makes it appear that the clustering coefficient will always equate to 10% of the number of triangles. We can see this is not the case when we alter the number of relationships. If we change the second example to have four relationships (and the same two triangles) then the coefficient is 0.33.</p>
        
        <p>The clustering coefficient for a node uses the formula:</p>
        <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="13" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="18.039ex" height="3.352ex" role="img" focusable="false" viewBox="0 -934.5 7973.1 1481.6" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -1.238ex;"><defs><path id="MJX-14-TEX-I-1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path><path id="MJX-14-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-14-TEX-I-1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-14-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-14-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-14-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-14-TEX-I-1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path><path id="MJX-14-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path><path id="MJX-14-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-14-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mi"><use data-c="1D436" xlink:href="#MJX-14-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(760,0)"><use data-c="1D436" xlink:href="#MJX-14-TEX-I-1D436"></use></g><g data-mml-node="mrow" transform="translate(1686.7,0)"><g data-mml-node="mo"><use data-c="28" xlink:href="#MJX-14-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(389,0)"><use data-c="1D462" xlink:href="#MJX-14-TEX-I-1D462"></use></g><g data-mml-node="mo" transform="translate(961,0)"><use data-c="29" xlink:href="#MJX-14-TEX-N-29"></use></g></g><g data-mml-node="mo" transform="translate(3314.4,0)"><use data-c="3D" xlink:href="#MJX-14-TEX-N-3D"></use></g><g data-mml-node="mfrac" transform="translate(4370.2,0)"><g data-mml-node="mrow" transform="translate(1184,451.6) scale(0.707)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-14-TEX-N-32"></use></g><g data-mml-node="msub" transform="translate(500,0)"><g data-mml-node="mi"><use data-c="1D445" xlink:href="#MJX-14-TEX-I-1D445"></use></g><g data-mml-node="mi" transform="translate(792,-150) scale(0.707)"><use data-c="1D462" xlink:href="#MJX-14-TEX-I-1D462"></use></g></g></g><g data-mml-node="mrow" transform="translate(220,-370.3) scale(0.707)"><g data-mml-node="mspace"></g><g data-mml-node="msub" transform="translate(400,0)"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-14-TEX-I-1D458"></use></g><g data-mml-node="mi" transform="translate(554,-150) scale(0.707)"><use data-c="1D462" xlink:href="#MJX-14-TEX-I-1D462"></use></g></g><g data-mml-node="mrow" transform="translate(1408.5,0)"><g data-mml-node="mo"><use data-c="28" xlink:href="#MJX-14-TEX-N-28"></use></g><g data-mml-node="msub" transform="translate(389,0)"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-14-TEX-I-1D458"></use></g><g data-mml-node="mi" transform="translate(554,-150) scale(0.707)"><use data-c="1D462" xlink:href="#MJX-14-TEX-I-1D462"></use></g></g><g data-mml-node="mo" transform="translate(1397.5,0)"><use data-c="2212" xlink:href="#MJX-14-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(2175.5,0)"><use data-c="31" xlink:href="#MJX-14-TEX-N-31"></use></g><g data-mml-node="mo" transform="translate(2675.5,0)"><use data-c="29" xlink:href="#MJX-14-TEX-N-29"></use></g></g></g><rect width="3362.8" height="60" x="120" y="220"></rect></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><mi>C</mi><mi>C</mi><mrow><mo>(</mo><mi>u</mi><mo>)</mo></mrow><mo>=</mo><mfrac><mrow><mn>2</mn><msub><mi>R</mi><mi>u</mi></msub></mrow><mrow><mspace width="4pt"></mspace><msub><mi>k</mi><mi>u</mi></msub><mrow><mo>(</mo><msub><mi>k</mi><mi>u</mi></msub><mo>-</mo><mn>1</mn><mo>)</mo></mrow></mrow></mfrac></mrow></math></mjx-assistive-mml></mjx-container>
        
        <p>where:</p>
        
        <ul>
        <li>
        <p><em>u</em> is a node.</p>
        </li>
        <li>
        <p><em>R(u)</em> is the number of relationships through the neighbors of <em>u</em> (this can be obtained by using the number of triangles passing through <em>u</em>).</p>
        </li>
        <li>
        <p><em>k(u)</em> is the degree of <em>u</em>.</p>
        </li>
        </ul>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Global Clustering Coefficient"><div class="sect2" id="idm46681366207688">
        <h2>Global Clustering Coefficient</h2>
        
        <p><a data-type="indexterm" data-primary="global clustering coefficient" id="idm46681366206520"></a><a data-type="indexterm" data-primary="Triangle Count and Clustering Coefficient algorithms" data-secondary="global clustering coefficient" id="idm46681366205848"></a>The global clustering coefficient is the normalized sum of the local clustering coefficients.</p>
        
        <p>Clustering coefficients give us an effective means to find obvious groups like cliques, where every node has a relationship with all other nodes, but we can also specify thresholds to set levels (say, where nodes are 40% connected).</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="When Should I Use Triangle Count and Clustering Coefficient?"><div class="sect2" id="idm46681366203704">
        <h2>When Should I Use Triangle Count and Clustering Coefficient?</h2>
        
        <p><a data-type="indexterm" data-primary="Triangle Count and Clustering Coefficient algorithms" data-secondary="when to use" id="idm46681366202328"></a>Use Triangle Count when you need to determine the stability of a group or as part of calculating other network measures such as the clustering coefficient.
        <a data-type="indexterm" data-primary="social network analysis" id="idm46681366201016"></a>Triangle counting is popular in social network analysis, where it is used to detect communities.</p>
        
        <p>Clustering Coefficient can provide the probability that randomly chosen nodes will be connected.
        You can also use it to quickly evaluate the cohesiveness of a specific group or your overall network.
        Together these algorithms are used to estimate resiliency and look for network structures.</p>
        
        <p>Example use cases include:</p>
        
        <ul>
        <li>
        <p>Identifying features for classifying a given website as spam content.
        This is described in <a href="http://bit.ly/2ut0Lao">“Efficient Semi-Streaming Algorithms for Local Triangle Counting in Massive Graphs”</a>, a paper by L. Becchetti et al.</p>
        </li>
        <li>
        <p>Investigating the community structure of Facebook’s social graph, where researchers found dense neighborhoods of users in an otherwise sparse global graph.
        Find this study in the paper <a href="https://bit.ly/2TXWsTC">“The Anatomy of the Facebook Social Graph”</a>, by J. Ugander et al.</p>
        </li>
        <li>
        <p>Exploring the thematic structure of the web and detecting communities of pages with common topics based on the reciprocal links between them.
        For more information, see <a href="http://bit.ly/2YkCrFo">“Curvature of Co-Links Uncovers Hidden Thematic Layers in the World Wide Web”</a>, by J.-P. Eckmann and E. Moses.</p>
        </li>
        </ul>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Triangle Count with Apache Spark"><div class="sect2" id="idm46681366193288">
        <h2>Triangle Count with Apache Spark</h2>
        
        <p><a data-type="indexterm" data-primary="Apache Spark" data-secondary="Triangle Count with" id="idm46681366191960"></a><a data-type="indexterm" data-primary="Triangle Count and Clustering Coefficient algorithms" data-secondary="Triangle Count with Apache Spark" id="idm46681366190984"></a>Now we’re ready to execute the Triangle Count algorithm.
        We can use the following code to do this:</p>
        
        <pre data-type="programlisting" data-code-language="python"><code class="n">result</code> <code class="o">=</code> <code class="n">g</code><code class="o">.</code><code class="n">triangleCount</code><code class="p">()</code>
        <code class="p">(</code><code class="n">result</code><code class="o">.</code><code class="n">sort</code><code class="p">(</code><code class="s2">"count"</code><code class="p">,</code> <code class="n">ascending</code><code class="o">=</code><code class="bp">False</code><code class="p">)</code>
         <code class="o">.</code><code class="n">filter</code><code class="p">(</code><code class="s1">'count &gt; 0'</code><code class="p">)</code>
         <code class="o">.</code><code class="n">show</code><code class="p">())</code></pre>
        
        <p>If we run that code in pyspark we’ll see this output:</p>
        <table>
        
        <thead>
        <tr>
        <th>count</th>
        <th>id</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>1</p></td>
        <td><p>jupyter</p></td>
        </tr>
        <tr>
        <td><p>1</p></td>
        <td><p>python-dateutil</p></td>
        </tr>
        <tr>
        <td><p>1</p></td>
        <td><p>six</p></td>
        </tr>
        <tr>
        <td><p>1</p></td>
        <td><p>ipykernel</p></td>
        </tr>
        <tr>
        <td><p>1</p></td>
        <td><p>matplotlib</p></td>
        </tr>
        <tr>
        <td><p>1</p></td>
        <td><p>jpy-console</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>A triangle in this graph would indicate that two of a node’s neighbors are also neighbors.
        Six of our libraries participate in such triangles.</p>
        
        <p>What if we want to know which nodes are in those triangles? That’s where a <em>triangle stream</em> comes in. For this, we need Neo4j.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Triangles with Neo4j"><div class="sect2" id="idm46681366149192">
        <h2>Triangles with Neo4j</h2>
        
        <p><a data-type="indexterm" data-primary="Neo4j" data-secondary="Triangles with" id="idm46681366147592"></a><a data-type="indexterm" data-primary="Triangle Count and Clustering Coefficient algorithms" data-secondary="Triangles with Neo4j" id="idm46681366146616"></a>Getting a stream of the triangles isn’t available using Spark, but we can return it using Neo4j.
        The triangles algorithm takes in a config map with the following keys:</p>
        <dl>
        <dt><code>nodeProjection</code></dt>
        <dd>
        <p>Enables the mapping of specific kinds of nodes into the in-memory graph. We can declare one or more node labels.</p>
        </dd>
        <dt><code>relationshipProjection</code></dt>
        <dd>
        <p>Enables the mapping of relationship types into the in-memory graph. We can declare one or more relationship types along with direction and properties.</p>
        </dd>
        </dl>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>The Triangles and Triangle Count procedures require relationship projections to be undirected, which we can do by setting <code>orientation: "UNDIRECTED"</code>.</p>
        </div>
        
        <p>A call to the following procedure will calculate the triangles in the graph:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="n">CALL gds.alpha.triangles({</code>
        <code class="n">  nodeProjection: </code><code class="s2">"Library"</code><code class="n">,</code>
        <code class="n">  relationshipProjection:  {</code>
        <code class="n">    DEPENDS_ON: {</code>
        <code class="n">      </code><code class="nf">type</code><code class="n">: </code><code class="s2">"DEPENDS_ON"</code><code class="n">,</code>
        <code class="n">      orientation: </code><code class="s2">"UNDIRECTED"</code><code class="n"></code>
        <code class="n">    }</code>
        <code class="n">  }</code>
        <code class="n">})</code>
        <code class="n">YIELD nodeA, nodeB, nodeC</code>
        <code class="k">RETURN </code><code class="n">gds.util.asNode(nodeA).</code><code class="nf">id </code><code class="k">AS </code><code class="n">nodeA,</code>
        <code class="n">       gds.util.asNode(nodeB).</code><code class="nf">id </code><code class="k">AS </code><code class="n">nodeB,</code>
        <code class="n">       gds.util.asNode(nodeC).</code><code class="nf">id </code><code class="k">AS </code><code class="n">nodeC;</code></pre>
        
        <p>Running this procedure gives the following result:</p>
        <table>
        
        <thead>
        <tr>
        <th>nodeA</th>
        <th>nodeB</th>
        <th>nodeC</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>matplotlib</p></td>
        <td><p>six</p></td>
        <td><p>python-dateutil</p></td>
        </tr>
        <tr>
        <td><p>jupyter</p></td>
        <td><p>jpy-console</p></td>
        <td><p>ipykernel</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>We see the same six libraries as we did before, but now we know how they’re connected.
        matplotlib, six, and python-dateutil form one triangle.
        jupyter, jpy-console, and ipykernel form the other. We can see these triangles in <a data-type="xref" href="#triangles_image">Figure&nbsp;6-4</a>.</p>
        
        <figure><div id="triangles_image" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/gral_0604.png" alt="gral 0604" width="3449" height="2502">
        <h6><span class="label">Figure 6-4. </span>Triangles in the software dependency graph</h6>
        </div></figure>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Local Clustering Coefficient with Neo4j"><div class="sect2" id="idm46681366148568">
        <h2>Local Clustering Coefficient with Neo4j</h2>
        
        <p><a data-type="indexterm" data-primary="local clustering coefficient" id="idm46681366073704"></a><a data-type="indexterm" data-primary="Neo4j" data-secondary="local clustering coefficient with" id="idm46681366073032"></a><a data-type="indexterm" data-primary="Triangle Count and Clustering Coefficient algorithms" data-secondary="local clustering coefficient with Neo4j" id="idm46681366072072"></a>We can also work out the local clustering coefficient using the triangle count algorithm.
        The triangle count algorithm takes in a config map with the following keys:</p>
        <dl>
        <dt><code>nodeProjection</code></dt>
        <dd>
        <p>Enables the mapping of specific kinds of nodes into the in-memory graph. We can declare one or more node labels.</p>
        </dd>
        <dt><code>relationshipProjection</code></dt>
        <dd>
        <p>Enables the mapping of relationship types into the in-memory graph. We can declare one or more relationship types along with direction and properties.</p>
        </dd>
        </dl>
        
        <p>The following query calculates the local clustering coefficient for each node:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="n">CALL gds.localClusteringCoefficient.stream({</code>
        <code class="n">  nodeProjection: </code><code class="s2">"Library"</code><code class="n">,</code>
        <code class="n">  relationshipProjection:  {</code>
        <code class="n">    DEPENDS_ON: {</code>
        <code class="n">      </code><code class="nf">type</code><code class="n">: </code><code class="s2">"DEPENDS_ON"</code><code class="n">,</code>
        <code class="n">      orientation: </code><code class="s2">"UNDIRECTED"</code><code class="n"></code>
        <code class="n">    }</code>
        <code class="n">  }</code>
        <code class="n">})</code>
        <code class="n">YIELD nodeId, localClusteringCoefficient</code>
        <code class="k">WHERE </code><code class="n">localClusteringCoefficient &gt; 0</code>
        <code class="k">RETURN </code><code class="n">gds.util.asNode(nodeId).</code><code class="nf">id </code><code class="k">AS </code><code class="n">library, localClusteringCoefficient</code>
        <code class="k">ORDER BY </code><code class="n">localClusteringCoefficient </code><code class="k">DESC</code><code class="n">;</code></pre>
        
        <p>Running this procedure gives the following result:</p>
        <table>
        
        <thead>
        <tr>
        <th>library</th>
        <th>localClusteringCoefficient</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>ipykernel</p></td>
        <td><p>1.0</p></td>
        </tr>
        <tr>
        <td><p>jupyter</p></td>
        <td><p>0.3333333333333333</p></td>
        </tr>
        <tr>
        <td><p>jpy-console</p></td>
        <td><p>0.3333333333333333</p></td>
        </tr>
        <tr>
        <td><p>six</p></td>
        <td><p>0.3333333333333333</p></td>
        </tr>
        <tr>
        <td><p>python-dateutil</p></td>
        <td><p>0.3333333333333333</p></td>
        </tr>
        <tr>
        <td><p>matplotlib</p></td>
        <td><p>0.16666666666666666</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>ipykernel has a score of 1, which means that all ipykernel’s neighbors are neighbors of each other.
        We can clearly see that in <a data-type="xref" href="#triangles_image">Figure&nbsp;6-4</a>.
        This tells us that the community directly around ipykernel is very cohesive.</p>
        
        <p>We’ve filtered out nodes with a coefficient score of 0 in this code sample, but nodes with low coefficients may also be interesting.
        <a data-type="indexterm" data-primary="structural hole" id="idm46681365992008"></a>A low score can be an indicator that a node is a <a href="http://stanford.io/2UTYVex"><em>structural hole</em></a>—a node that is well connected to nodes in different communities that aren’t otherwise connected to each other. This is a method for finding <em>potential</em> bridges that we discussed in <a data-type="xref" href="ch05.html#centrality_algorithms">Chapter&nbsp;5</a>.<a data-type="indexterm" data-startref="ix_ch06-adoc4" id="idm46681365988904"></a><a data-type="indexterm" data-startref="ix_ch06-adoc3" id="idm46681365988200"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Strongly Connected Components"><div class="sect1" id="strongly_connected_components">
        <h1>Strongly Connected Components</h1>
        
        <p><a data-type="indexterm" data-primary="community detection algorithms" data-secondary="Strongly Connected Components" id="ix_ch06-adoc5"></a><a data-type="indexterm" data-primary="Strongly Connected Components (SCC) algorithm" id="ix_ch06-adoc6"></a>The Strongly Connected Components (SCC) algorithm is one of the earliest graph algorithms.
        SCC finds sets of connected nodes in a directed graph where each node is reachable in both directions from any other node in the same set. Its runtime operations scale well, proportional to the number of nodes.
        In <a data-type="xref" href="#SCC">Figure&nbsp;6-5</a> you can see that the nodes in an SCC group don’t need to be immediate neighbors, but there must be directional paths between all nodes in the set.</p>
        
        <figure><div id="SCC" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/gral_rr_0605.png" alt="gral rr 0605" width="1316" height="876">
        <h6><span class="label">Figure 6-5. </span>Strongly connected components</h6>
        </div></figure>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p><a data-type="indexterm" data-primary="Depth First Search (DFS)" id="idm46681365979512"></a>Decomposing a directed graph into its strongly connected components is a classic application of the <a href="ch04.html#dfs">Depth First Search algorithm</a>.
        Neo4j uses DFS under the hood as part of its implementation of the SCC algorithm.</p>
        </div>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="When Should I Use Strongly Connected Components?"><div class="sect2" id="idm46681365977592">
        <h2>When Should I Use Strongly Connected Components?</h2>
        
        <p><a data-type="indexterm" data-primary="Strongly Connected Components (SCC) algorithm" data-secondary="when to use" id="idm46681365976216"></a>Use Strongly Connected Components as an early step in graph analysis to see how a graph is structured or to identify tight clusters that may warrant independent investigation.
        A component that is strongly connected can be used to profile similar behavior or inclinations in a group for applications such as recommendation engines.</p>
        
        <p>Many community detection algorithms like SCC are used to find and collapse clusters into single nodes for further intercluster analysis. You can also use SCC to visualize cycles for analyses like finding processes that might deadlock because each subprocess is waiting for another member to take action.</p>
        
        <p>Example use cases include:</p>
        
        <ul>
        <li>
        <p>Finding the set of firms in which every member directly and/or indirectly owns shares in every other member, as in <a href="http://bit.ly/2UU4EAP">“The Network of Global Corporate Control”</a>, an analysis of powerful transnational corporations by S. Vitali, J. B. Glattfelder, and S. Battiston.</p>
        </li>
        <li>
        <p>Computing the connectivity of different network configurations when measuring routing performance in multihop wireless networks.
        Read more in <a href="https://bit.ly/2uAJs7H">“Routing Performance in the Presence of Unidirectional Links in Multihop Wireless Networks”</a>, by M. K. Marina and S. R. Das.</p>
        </li>
        <li>
        <p>Acting as the first step in many graph algorithms that work only on strongly connected graphs.
        In social networks we find many strongly connected groups.
        In these sets people often have similar preferences, and the SCC algorithm is used to find such groups and suggest pages to like or products to purchase to the people in the group who have not yet done so.</p>
        </li>
        </ul>
        <div data-type="tip"><h6>Tip</h6>
        <p>Some algorithms have strategies for escaping infinite loops, but if we’re writing our own algorithms or finding nonterminating processes, we can use SCC to check for cycles.</p>
        </div>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Strongly Connected Components with Apache Spark"><div class="sect2" id="idm46681365966824">
        <h2>Strongly Connected Components with Apache Spark</h2>
        
        <p><a data-type="indexterm" data-primary="Apache Spark" data-secondary="Strongly Connected Components with" id="idm46681365965256"></a><a data-type="indexterm" data-primary="Strongly Connected Components (SCC) algorithm" data-secondary="with Apache Spark" id="idm46681365964264"></a>Starting with Apache Spark, we’ll first import the packages we need from Spark and the GraphFrames package:</p>
        
        <pre data-type="programlisting" data-code-language="python"><code class="kn">from</code> <code class="nn">graphframes</code> <code class="kn">import</code> <code class="o">*</code>
        <code class="kn">from</code> <code class="nn">pyspark.sql</code> <code class="kn">import</code> <code class="n">functions</code> <code class="k">as</code> <code class="n">F</code></pre>
        
        <p>Now we’re ready to execute the Strongly Connected Components algorithm.
        We’ll use it to work out whether there are any circular dependencies in our graph.</p>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>Two nodes can only be in the same strongly connected component if there are paths between them in both directions.</p>
        </div>
        
        <p>We write the following code to do this:</p>
        
        <pre data-type="programlisting" data-code-language="python"><code class="n">result</code> <code class="o">=</code> <code class="n">g</code><code class="o">.</code><code class="n">stronglyConnectedComponents</code><code class="p">(</code><code class="n">maxIter</code><code class="o">=</code><code class="mi">10</code><code class="p">)</code>
        <code class="p">(</code><code class="n">result</code><code class="o">.</code><code class="n">sort</code><code class="p">(</code><code class="s2">"component"</code><code class="p">)</code>
         <code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s2">"component"</code><code class="p">)</code>
         <code class="o">.</code><code class="n">agg</code><code class="p">(</code><code class="n">F</code><code class="o">.</code><code class="n">collect_list</code><code class="p">(</code><code class="s2">"id"</code><code class="p">)</code><code class="o">.</code><code class="n">alias</code><code class="p">(</code><code class="s2">"libraries"</code><code class="p">))</code>
         <code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="n">truncate</code><code class="o">=</code><code class="bp">False</code><code class="p">))</code></pre>
        
        <p class="pagebreak-before">If we run that code in pyspark we’ll see this output:</p>
        <table>
        
        <thead>
        <tr>
        <th>component</th>
        <th>libraries</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>180388626432</p></td>
        <td><p>[jpy-core]</p></td>
        </tr>
        <tr>
        <td><p>223338299392</p></td>
        <td><p>[spacy]</p></td>
        </tr>
        <tr>
        <td><p>498216206336</p></td>
        <td><p>[numpy]</p></td>
        </tr>
        <tr>
        <td><p>523986010112</p></td>
        <td><p>[six]</p></td>
        </tr>
        <tr>
        <td><p>549755813888</p></td>
        <td><p>[pandas]</p></td>
        </tr>
        <tr>
        <td><p>558345748480</p></td>
        <td><p>[nbconvert]</p></td>
        </tr>
        <tr>
        <td><p>661424963584</p></td>
        <td><p>[ipykernel]</p></td>
        </tr>
        <tr>
        <td><p>721554505728</p></td>
        <td><p>[jupyter]</p></td>
        </tr>
        <tr>
        <td><p>764504178688</p></td>
        <td><p>[jpy-client]</p></td>
        </tr>
        <tr>
        <td><p>833223655424</p></td>
        <td><p>[pytz]</p></td>
        </tr>
        <tr>
        <td><p>910533066752</p></td>
        <td><p>[python-dateutil]</p></td>
        </tr>
        <tr>
        <td><p>936302870528</p></td>
        <td><p>[pyspark]</p></td>
        </tr>
        <tr>
        <td><p>944892805120</p></td>
        <td><p>[matplotlib]</p></td>
        </tr>
        <tr>
        <td><p>1099511627776</p></td>
        <td><p>[jpy-console]</p></td>
        </tr>
        <tr>
        <td><p>1279900254208</p></td>
        <td><p>[py4j]</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>You might notice that every library node is assigned to a unique component.
        This is the partition or subgroup it belongs to, and as we (hopefully!) expected, every node is in its own partition.
        This means our software project has no circular dependencies amongst these libraries.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Strongly Connected Components with Neo4j"><div class="sect2" id="idm46681365966200">
        <h2>Strongly Connected Components with Neo4j</h2>
        
        <p><a data-type="indexterm" data-primary="Neo4j" data-secondary="Strongly Connected Components with" id="ix_ch06-adoc7"></a><a data-type="indexterm" data-primary="Strongly Connected Components (SCC) algorithm" data-secondary="with Neo4j" id="ix_ch06-adoc8"></a>Let’s run the same algorithm using Neo4j.
        The Strongly Connected Components algorithm takes in a config map with the following keys:</p>
        <dl>
        <dt><code>nodeProjection</code></dt>
        <dd>
        <p>Enables the mapping of specific kinds of nodes into the in-memory graph. We can declare one or more node labels.</p>
        </dd>
        <dt><code>relationshipProjection</code></dt>
        <dd>
        <p>Enables the mapping of relationship types into the in-memory graph. We can declare one or more relationship types along with direction and properties.</p>
        </dd>
        </dl>
        
        <p>We can execute the following query to run the algorithm:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="n">CALL gds.alpha.scc.stream({</code>
        <code class="n">  nodeProjection: </code><code class="s2">"Library"</code><code class="n">,</code>
        <code class="n">  relationshipProjection: </code><code class="s2">"DEPENDS_ON"</code><code class="n"></code>
        <code class="n">})</code>
        <code class="n">YIELD nodeId, partition</code>
        <code class="k">RETURN </code><code class="n">partition, </code><code class="nf">collect</code><code class="n">(gds.util.asNode(nodeId).</code><code class="nf">id</code><code class="n">) </code><code class="k">AS </code><code class="n">libraries</code>
        <code class="k">ORDER BY </code><code class="n">size(libraries) </code><code class="k">DESC</code><code class="n">;</code></pre>
        
        <p>The parameters passed to this algorithm are:</p>
        <dl>
        <dt><code>Library</code></dt>
        <dd>
        <p>The node label to load from the graph</p>
        </dd>
        <dt><code>DEPENDS_ON</code></dt>
        <dd>
        <p>The relationship type to load from the graph</p>
        </dd>
        </dl>
        
        <p>This is the output we’ll see when we run the query:</p>
        <table>
        
        <thead>
        <tr>
        <th>partition</th>
        <th>libraries</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>8</p></td>
        <td><p>[ipykernel]</p></td>
        </tr>
        <tr>
        <td><p>11</p></td>
        <td><p>[six]</p></td>
        </tr>
        <tr>
        <td><p>2</p></td>
        <td><p>[matplotlib]</p></td>
        </tr>
        <tr>
        <td><p>5</p></td>
        <td><p>[jupyter]</p></td>
        </tr>
        <tr>
        <td><p>14</p></td>
        <td><p>[python-dateutil]</p></td>
        </tr>
        <tr>
        <td><p>13</p></td>
        <td><p>[numpy]</p></td>
        </tr>
        <tr>
        <td><p>4</p></td>
        <td><p>[py4j]</p></td>
        </tr>
        <tr>
        <td><p>7</p></td>
        <td><p>[nbconvert]</p></td>
        </tr>
        <tr>
        <td><p>1</p></td>
        <td><p>[pyspark]</p></td>
        </tr>
        <tr>
        <td><p>10</p></td>
        <td><p>[jpy-core]</p></td>
        </tr>
        <tr>
        <td><p>9</p></td>
        <td><p>[jpy-client]</p></td>
        </tr>
        <tr>
        <td><p>3</p></td>
        <td><p>[spacy]</p></td>
        </tr>
        <tr>
        <td><p>12</p></td>
        <td><p>[pandas]</p></td>
        </tr>
        <tr>
        <td><p>6</p></td>
        <td><p>[jpy-console]</p></td>
        </tr>
        <tr>
        <td><p>0</p></td>
        <td><p>[pytz]</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>As with the Spark example, every node is in its own partition.</p>
        
        <p>So far the algorithm has only revealed that our Python libraries are very well behaved, but let’s create a circular dependency in the graph to make things more interesting.
        This should mean that we’ll end up with some nodes in the same partition.</p>
        
        <p>The following query adds an extra library that creates a circular dependency between py4j and pyspark:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="k">MATCH</code><code class="n"> (py4j:Library {</code><code class="nf">id</code><code class="n">: </code><code class="s2">"py4j"</code><code class="n">})</code>
        <code class="k">MATCH</code><code class="n"> (pyspark:Library {</code><code class="nf">id</code><code class="n">: </code><code class="s2">"pyspark"</code><code class="n">})</code>
        <code class="n">MERGE (extra:Library {</code><code class="nf">id</code><code class="n">: </code><code class="s2">"extra"</code><code class="n">})</code>
        <code class="n">MERGE (py4j)-[:DEPENDS_ON]-&gt;(extra)</code>
        <code class="n">MERGE (extra)-[:DEPENDS_ON]-&gt;(pyspark);</code></pre>
        
        <p>We can clearly see the circular dependency that got created in <a data-type="xref" href="#circular_dependency_image">Figure&nbsp;6-6</a>.</p>
        
        <figure><div id="circular_dependency_image" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/gral_rr_0606.png" alt="gral rr 0606" width="1412" height="1072">
        <h6><span class="label">Figure 6-6. </span>A circular dependency between pyspark, py4j, and extra</h6>
        </div></figure>
        
        <p>Now if we run the SCC algorithm again we’ll see a slightly different result:</p>
        <table>
        
        <thead>
        <tr>
        <th>partition</th>
        <th>libraries</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>1</p></td>
        <td><p>[pyspark, py4j, extra]</p></td>
        </tr>
        <tr>
        <td><p>8</p></td>
        <td><p>[ipykernel]</p></td>
        </tr>
        <tr>
        <td><p>11</p></td>
        <td><p>[six]</p></td>
        </tr>
        <tr>
        <td><p>2</p></td>
        <td><p>[matplotlib]</p></td>
        </tr>
        <tr>
        <td><p>5</p></td>
        <td><p>[jupyter]</p></td>
        </tr>
        <tr>
        <td><p>14</p></td>
        <td><p>[numpy]</p></td>
        </tr>
        <tr>
        <td><p>13</p></td>
        <td><p>[pandas]</p></td>
        </tr>
        <tr>
        <td><p>7</p></td>
        <td><p>[nbconvert]</p></td>
        </tr>
        <tr>
        <td><p>10</p></td>
        <td><p>[jpy-core]</p></td>
        </tr>
        <tr>
        <td><p>9</p></td>
        <td><p>[jpy-client]</p></td>
        </tr>
        <tr>
        <td><p>3</p></td>
        <td><p>[spacy]</p></td>
        </tr>
        <tr>
        <td><p>15</p></td>
        <td><p>[python-dateutil]</p></td>
        </tr>
        <tr>
        <td><p>6</p></td>
        <td><p>[jpy-console]</p></td>
        </tr>
        <tr>
        <td><p>0</p></td>
        <td><p>[pytz]</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>pyspark, py4j, and extra are all part of the same partition, and SCCs helped us find the circular dependency!</p>
        
        <p>Before we move on to the next algorithm we’ll delete the extra library and its relationships from the graph<a data-type="indexterm" data-startref="ix_ch06-adoc8" id="idm46681365646968"></a><a data-type="indexterm" data-startref="ix_ch06-adoc7" id="idm46681365646360"></a>:<a data-type="indexterm" data-startref="ix_ch06-adoc6" id="idm46681365645624"></a><a data-type="indexterm" data-startref="ix_ch06-adoc5" id="idm46681365644920"></a></p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="k">MATCH</code><code class="n"> (extra:Library {</code><code class="nf">id</code><code class="n">: </code><code class="s2">"extra"</code><code class="n">})</code>
        <code class="n">DETACH </code><code class="k">DELETE </code><code class="n">extra;</code></pre>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Connected Components"><div class="sect1" id="weakly_connected_components">
        <h1>Connected Components</h1>
        
        <p><a data-type="indexterm" data-primary="community detection algorithms" data-secondary="Connected Components" id="ix_ch06-adoc9"></a><a data-type="indexterm" data-primary="Connected Components algorithm" id="ix_ch06-adoc10"></a>The Connected Components algorithm (sometimes called Union Find or Weakly Connected Components) finds sets of connected nodes in an undirected graph where each node is reachable from any other node in the <a data-type="indexterm" data-primary="Union Find" id="idm46681365633480"></a><a data-type="indexterm" data-primary="Weakly Connected Components" id="idm46681365632808"></a>same set.
        It differs from the SCC algorithm because it only needs a path to exist between pairs of nodes in one direction, whereas SCC needs a path to exist in both directions. <a data-type="indexterm" data-primary="Fischer, Michael J." id="idm46681365628600"></a><a data-type="indexterm" data-primary="Galler, Bernard A." id="idm46681365627928"></a>Bernard A. Galler and Michael J. Fischer first described this algorithm in their 1964 paper, <a href="https://bit.ly/2WsPNxT">“An Improved Equivalence Algorithm”</a>.</p>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="When Should I Use Connected Components?"><div class="sect2" id="idm46681365626360">
        <h2>When Should I Use Connected Components?</h2>
        
        <p><a data-type="indexterm" data-primary="Connected Components algorithm" data-secondary="when to use" id="idm46681365624952"></a>As with SCC, Connected Components is often used early in an analysis to understand a graph’s structure. Because it scales efficiently, consider this algorithm for graphs requiring frequent updates. It can quickly show new nodes in common between groups, which is useful for analysis such as fraud detection.</p>
        
        <p>Make it a habit to run Connected Components to test whether a graph is connected as a preparatory step for general graph analysis.
        Performing this quick test can avoid accidentally running algorithms on only one disconnected component of a graph and getting incorrect results.</p>
        
        <p>Example use cases include:</p>
        
        <ul>
        <li>
        <p>Keeping track of clusters of database records, as part of the deduplication process.
        <a data-type="indexterm" data-primary="deduplication" id="idm46681365621416"></a>Deduplication is an important task in master data management applications; the approach is described in more detail in <a href="http://bit.ly/2CCNpgy">“An Efficient Domain-Independent Algorithm for Detecting Approximately Duplicate Database Records”</a>, by A. Monge and C. Elkan.</p>
        </li>
        <li>
        <p>Analyzing citation networks.
        <a data-type="indexterm" data-primary="citation networks" id="idm46681365618760"></a>One study uses Connected Components to work out how well connected a network is, and then to see whether the connectivity remains if “hub” or “authority” nodes are moved from the graph.
        This use case is explained further in <a href="https://bit.ly/2U8cfi9">“Characterizing and Mining Citation Graph of Computer Science Literature”</a>, a paper by Y. An, J. C. M. Janssen, and E. E. Milios.</p>
        </li>
        </ul>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" class="less_space pagebreak-before" data-pdf-bookmark="Connected Components with Apache Spark"><div class="sect2" id="idm46681365616632">
        <h2>Connected Components with Apache Spark</h2>
        
        <p><a data-type="indexterm" data-primary="Apache Spark" data-secondary="Connected Components with" id="ix_ch06-adoc11"></a><a data-type="indexterm" data-primary="Connected Components algorithm" data-secondary="with Apache Spark" id="ix_ch06-adoc12"></a>Starting with Apache Spark, we’ll first import the packages we need from Spark and the GraphFrames package:</p>
        
        <pre data-type="programlisting" data-code-language="python"><code class="kn">from</code> <code class="nn">pyspark.sql</code> <code class="kn">import</code> <code class="n">functions</code> <code class="k">as</code> <code class="n">F</code></pre>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>Two nodes can be in the same connected component if there is a path between them in either direction.</p>
        </div>
        
        <p>Now we’re ready to execute the Connected Components algorithm. We write the following code to do this:</p>
        
        <pre data-type="programlisting" data-code-language="python"><code class="n">result</code> <code class="o">=</code> <code class="n">g</code><code class="o">.</code><code class="n">connectedComponents</code><code class="p">()</code>
        <code class="p">(</code><code class="n">result</code><code class="o">.</code><code class="n">sort</code><code class="p">(</code><code class="s2">"component"</code><code class="p">)</code>
         <code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s2">"component"</code><code class="p">)</code>
         <code class="o">.</code><code class="n">agg</code><code class="p">(</code><code class="n">F</code><code class="o">.</code><code class="n">collect_list</code><code class="p">(</code><code class="s2">"id"</code><code class="p">)</code><code class="o">.</code><code class="n">alias</code><code class="p">(</code><code class="s2">"libraries"</code><code class="p">))</code>
         <code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="n">truncate</code><code class="o">=</code><code class="bp">False</code><code class="p">))</code></pre>
        
        <p>If we run that code in pyspark we’ll see this output:</p>
        <table>
        
        <thead>
        <tr>
        <th>component</th>
        <th>libraries</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>180388626432</p></td>
        <td><p>[jpy-core, nbconvert, ipykernel, jupyter, jpy-client, jpy-console]</p></td>
        </tr>
        <tr>
        <td><p>223338299392</p></td>
        <td><p>[spacy, numpy, six, pandas, pytz, python-dateutil, matplotlib]</p></td>
        </tr>
        <tr>
        <td><p>936302870528</p></td>
        <td><p>[pyspark, py4j]</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>The results show three clusters of nodes, which can also be seen in <a data-type="xref" href="#unionfind-image">Figure&nbsp;6-7</a>. In this example it’s very easy to see that there are three components just by visual inspection. This algorithm shows its value more on larger graphs, where visual inspection isn’t possible or is very time-consuming.<a data-type="indexterm" data-startref="ix_ch06-adoc12" id="idm46681365502824"></a><a data-type="indexterm" data-startref="ix_ch06-adoc11" id="idm46681365502152"></a></p>
        
        <figure><div id="unionfind-image" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/gral_0607.png" alt="gral 0607" width="3417" height="2593">
        <h6><span class="label">Figure 6-7. </span>Clusters found by the Connected Components algorithm</h6>
        </div></figure>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Connected Components with Neo4j"><div class="sect2" id="idm46681365616040">
        <h2>Connected Components with Neo4j</h2>
        
        <p><a data-type="indexterm" data-primary="Connected Components algorithm" data-secondary="with Neo4j" id="idm46681365498168"></a><a data-type="indexterm" data-primary="Neo4j" data-secondary="Connected Components with" id="idm46681365497224"></a>We can also execute this algorithm in Neo4j.
        The Connected Components algorithm takes in a config map with the following keys:</p>
        <dl>
        <dt><code>nodeProjection</code></dt>
        <dd>
        <p>Enables the mapping of specific kinds of nodes into the in-memory graph. We can declare one or more node labels.</p>
        </dd>
        <dt><code>relationshipProjection</code></dt>
        <dd>
        <p>Enables the mapping of relationship types into the in-memory graph. We can declare one or more relationship types along with direction and properties.</p>
        </dd>
        </dl>
        
        <p>We can execute this algorithm by running the following query:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="n">CALL gds.wcc.stream({</code>
        <code class="n">  nodeProjection: </code><code class="s2">"Library"</code><code class="n">,</code>
        <code class="n">  relationshipProjection: </code><code class="s2">"DEPENDS_ON"</code><code class="n"></code>
        <code class="n">})</code>
        <code class="n">YIELD nodeId, componentId</code>
        <code class="k">RETURN </code><code class="n">componentId, </code><code class="nf">collect</code><code class="n">(gds.util.asNode(nodeId).</code><code class="nf">id</code><code class="n">) </code><code class="k">AS </code><code class="n">libraries</code>
        <code class="k">ORDER BY </code><code class="n">size(libraries) </code><code class="k">DESC</code><code class="n">;</code></pre>
        
        <p>Here’s the output:</p>
        <table>
        
        <thead>
        <tr>
        <th>componentId</th>
        <th>libraries</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>2</p></td>
        <td><p>[pytz, matplotlib, spacy, six, pandas, numpy, python-dateutil]</p></td>
        </tr>
        <tr>
        <td><p>5</p></td>
        <td><p>[jupyter, jpy-console, nbconvert, ipykernel, jpy-client, jpy-core]</p></td>
        </tr>
        <tr>
        <td><p>1</p></td>
        <td><p>[pyspark, py4j]</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>As expected, we get exactly the same results as we did with Spark.</p>
        
        <p>Both of the community detection algorithms that we’ve covered so far are deterministic: they return the same results each time we run them.
        Our next two algorithms are examples of nondeterministic algorithms, where we may see different results if we run them multiple times, even on the same data.<a data-type="indexterm" data-startref="ix_ch06-adoc10" id="idm46681365449960"></a><a data-type="indexterm" data-startref="ix_ch06-adoc9" id="idm46681365449256"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Label Propagation"><div class="sect1" id="label_propagation">
        <h1>Label Propagation</h1>
        
        <p><a data-type="indexterm" data-primary="community detection algorithms" data-secondary="Label Propagation algorithm" id="ix_ch06-adoc13"></a><a data-type="indexterm" data-primary="Label Propagation algorithm (LPA)" id="ix_ch06-adoc14"></a>The Label Propagation algorithm (LPA) is a fast algorithm for finding communities in a graph. In LPA, nodes select their group based on their direct neighbors. This process is well suited to networks where groupings are less clear and weights can be used to help a node determine which community to place itself within. It also lends itself well to semisupervised learning because you can seed the process with preassigned, indicative node labels.</p>
        
        <p>The intuition behind this algorithm is that a single label can quickly become dominant in a densely connected group of nodes, but it will have trouble crossing a sparsely connected region.
        Labels get trapped inside a densely connected group of nodes, and nodes that end up with the same label when the algorithm finishes are considered part of the same community.
        The algorithm resolves overlaps, where nodes are potentially part of multiple clusters, by assigning membership to the label neighborhood with the highest combined relationship and node weight. <a data-type="indexterm" data-primary="Raghavan, Usha Nandini" id="idm46681365443032"></a>LPA is a relatively new algorithm proposed in 2007 by U. N. Raghavan, R. Albert, and S. Kumara, in a paper titled <a href="https://bit.ly/2Frb1Fu">“Near Linear Time Algorithm to Detect Community Structures in Large-Scale Networks”</a>.</p>
        
        <p><a data-type="indexterm" data-primary="Label Propagation algorithm (LPA)" data-secondary="push method" id="idm46681365441128"></a><a data-type="xref" href="#lpa-steps">Figure&nbsp;6-8</a> depicts two variations of Label Propagation, a simple push method and the more typical pull method that relies on relationship weights. The pull method lends itself well to parallelization.</p>
        
        <figure><div id="lpa-steps" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/gral_rr_0608.png" alt="gral rr 0608" width="1406" height="1470">
        <h6><span class="label">Figure 6-8. </span>Two variations of Label Propagation</h6>
        </div></figure>
        
        <p><a data-type="indexterm" data-primary="Label Propagation algorithm (LPA)" data-secondary="pull method" id="idm46681365436904"></a>The steps often used for the Label Propagation pull method are:</p>
        <ol>
        <li>
        <p>Every node is initialized with a unique label (an identifier), and, optionally preliminary “seed” labels can be used.</p>
        </li>
        <li>
        <p>These labels propagate through the network.</p>
        </li>
        <li>
        <p>At every propagation iteration, each node updates its label to match the one with the maximum weight, which is calculated based on the weights of neighbor nodes <em>and</em> their relationships.
        Ties are broken uniformly and randomly.</p>
        </li>
        <li>
        <p>LPA reaches convergence when each node has the majority label of its neighbors.</p>
        </li>
        
        </ol>
        
        <p>As labels propagate, densely connected groups of nodes quickly reach a consensus on a unique label.
        At the end of the propagation, only a few labels will remain, and nodes that have the same label belong to the same community.</p>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Semi-Supervised Learning and Seed Labels"><div class="sect2" id="idm46681365430344">
        <h2>Semi-Supervised Learning and Seed Labels</h2>
        
        <p>In contrast to other algorithms, Label Propagation can return different community structures when run multiple times on the same graph.
        The order in which LPA evaluates nodes can have an influence on the final communities it returns.</p>
        
        <p>The range of solutions is narrowed when some nodes are given preliminary labels (i.e., seed labels), while others are unlabeled.
        Unlabeled nodes are more likely to adopt the preliminary labels.</p>
        
        <p><a data-type="indexterm" data-primary="Label Propagation algorithm (LPA)" data-secondary="semi-supervised learning" id="idm46681365401880"></a><a data-type="indexterm" data-primary="semi-supervised learning" id="idm46681365400968"></a>This use of Label Propagation can be considered a <em>semi-supervised learning</em> method to find communities.
        Semi-supervised learning is a class of machine learning tasks and techniques that operate on a small amount of labeled data, along with a larger amount of unlabeled data.
        We can also run the algorithm repeatedly on graphs as they evolve.</p>
        
        <p><a data-type="indexterm" data-primary="Label Propagation algorithm (LPA)" data-secondary="seed labels" id="idm46681365399160"></a><a data-type="indexterm" data-primary="seed labels" id="idm46681365398120"></a>Finally, LPA sometimes doesn’t converge on a single solution.
        In this situation, our community results will continually flip between a few remarkably similar communities and the algorithm would never complete.
        Seed labels help guide it toward a solution.
        Spark and Neo4j use a set maximum number of iterations to avoid never-ending execution.
        You should test the iteration setting for your data to balance accuracy and execution time.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="When Should I Use Label Propagation?"><div class="sect2" id="idm46681365396744">
        <h2>When Should I Use Label Propagation?</h2>
        
        <p><a data-type="indexterm" data-primary="Label Propagation algorithm (LPA)" data-secondary="when to use" id="idm46681365395640"></a>Use Label Propagation in large-scale networks for initial community detection, especially when weights are available.
        This algorithm can be parallelized and is therefore extremely fast at graph partitioning.</p>
        
        <p>Example use cases include:</p>
        
        <ul>
        <li>
        <p>Assigning polarity of tweets as a part of semantic analysis.
        <a data-type="indexterm" data-primary="Twitter" data-secondary="Label Propagation" id="idm46681365392808"></a>In this scenario, positive and negative seed labels from a classifier are used in combination with the Twitter follower graph.
        For more information, see <a href="https://bit.ly/2FBq2pv">“Twitter Polarity Classification with Label Propagation over Lexical Links and the Follower Graph”</a>, by M. Speriosu et al.</p>
        </li>
        <li>
        <p>Finding potentially dangerous combinations of possible co-prescribed drugs, based on the chemical similarity and side effect profiles.
        See <a href="https://www.nature.com/articles/srep12339">“Label Propagation Prediction of Drug–Drug Interactions Based on Clinical Side Effects”</a>, a paper by P. Zhang et al.</p>
        </li>
        <li>
        <p>Inferring dialogue features and user intention for a machine learning model.
        For more information, see <a href="https://bit.ly/2FtGpTK">“Feature Inference Based on Label Propagation on Wikidata Graph for DST”</a>, a paper by Y. Murase et al.</p>
        </li>
        </ul>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Label Propagation with Apache Spark"><div class="sect2" id="idm46681365386520">
        <h2>Label Propagation with Apache Spark</h2>
        
        <p><a data-type="indexterm" data-primary="Apache Spark" data-secondary="Label Propagation with" id="idm46681365385160"></a><a data-type="indexterm" data-primary="Label Propagation algorithm (LPA)" data-secondary="with Apache Spark" id="idm46681365384184"></a>Starting with Apache Spark, we’ll first import the packages we need from Spark and the GraphFrames package:</p>
        
        <pre data-type="programlisting" data-code-language="python"><code class="kn">from</code> <code class="nn">pyspark.sql</code> <code class="kn">import</code> <code class="n">functions</code> <code class="k">as</code> <code class="n">F</code></pre>
        
        <p>Now we’re ready to execute the Label Propagation algorithm.
        We write the following code to do this:</p>
        
        <pre data-type="programlisting" data-code-language="python"><code class="n">result</code> <code class="o">=</code> <code class="n">g</code><code class="o">.</code><code class="n">labelPropagation</code><code class="p">(</code><code class="n">maxIter</code><code class="o">=</code><code class="mi">10</code><code class="p">)</code>
        <code class="p">(</code><code class="n">result</code>
        <code class="o">.</code><code class="n">sort</code><code class="p">(</code><code class="s2">"label"</code><code class="p">)</code>
        <code class="o">.</code><code class="n">groupby</code><code class="p">(</code><code class="s2">"label"</code><code class="p">)</code>
        <code class="o">.</code><code class="n">agg</code><code class="p">(</code><code class="n">F</code><code class="o">.</code><code class="n">collect_list</code><code class="p">(</code><code class="s2">"id"</code><code class="p">))</code>
        <code class="o">.</code><code class="n">show</code><code class="p">(</code><code class="n">truncate</code><code class="o">=</code><code class="bp">False</code><code class="p">))</code></pre>
        
        <p>If we run that code in pyspark, we’ll see this output:</p>
        <table>
        
        <thead>
        <tr>
        <th>label</th>
        <th>collect_list(id)</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>180388626432</p></td>
        <td><p>[jpy-core, jpy-console, jupyter]</p></td>
        </tr>
        <tr>
        <td><p>223338299392</p></td>
        <td><p>[matplotlib, spacy]</p></td>
        </tr>
        <tr>
        <td><p>498216206336</p></td>
        <td><p>[python-dateutil, numpy, six, pytz]</p></td>
        </tr>
        <tr>
        <td><p>549755813888</p></td>
        <td><p>[pandas]</p></td>
        </tr>
        <tr>
        <td><p>558345748480</p></td>
        <td><p>[nbconvert, ipykernel, jpy-client]</p></td>
        </tr>
        <tr>
        <td><p>936302870528</p></td>
        <td><p>[pyspark]</p></td>
        </tr>
        <tr>
        <td><p>1279900254208</p></td>
        <td><p>[py4j]</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>Compared to <a href="#weakly_connected_components">Connected Components</a>, we have more clusters of libraries in this example.
        LPA is less strict than Connected Components with respect to how it determines clusters.
        Two neighbors (directly connected nodes) may be found to be in different clusters using Label Propagation. However, using Connected Components a node would always be in the same cluster as its neighbors because that algorithm bases grouping strictly on relationships.</p>
        
        <p>In our example, the most obvious difference is that the Jupyter libraries have been split into two communities—one containing the core parts of the library and the other the client-facing tools.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Label Propagation with Neo4j"><div class="sect2" id="idm46681365290760">
        <h2>Label Propagation with Neo4j</h2>
        
        <p><a data-type="indexterm" data-primary="Label Propagation algorithm (LPA)" data-secondary="with Neo4j" id="ix_ch06-adoc15"></a><a data-type="indexterm" data-primary="Neo4j" data-secondary="Label Propagation with" id="ix_ch06-adoc16"></a>Now let’s try the same algorithm with Neo4j.
        LPA takes in a config map with the following keys:</p>
        <dl>
        <dt><code>nodeProjection</code></dt>
        <dd>
        <p>Enables the mapping of specific kinds of nodes into the in-memory graph. We can declare one or more node labels.</p>
        </dd>
        <dt><code>relationshipProjection</code></dt>
        <dd>
        <p>Enables the mapping of relationship types into the in-memory graph. We can declare one or more relationship types along with direction and properties.</p>
        </dd>
        <dt><code>maxIterations</code></dt>
        <dd>
        <p>The maximum number of iterations of Label Propagation to run.</p>
        </dd>
        </dl>
        
        <p>We can execute LPA by running the following query:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="n">CALL gds.labelPropagation.stream({</code>
        <code class="n">  nodeProjection: </code><code class="s2">"Library"</code><code class="n">,</code>
        <code class="n">  relationshipProjection: </code><code class="s2">"DEPENDS_ON"</code><code class="n">,</code>
        <code class="n">  maxIterations: 10</code>
        <code class="n">})</code>
        <code class="n">YIELD nodeId, communityId</code>
        <code class="k">RETURN </code><code class="n">communityId </code><code class="k">AS </code><code class="n">label,</code>
        <code class="n">       </code><code class="nf">collect</code><code class="n">(gds.util.asNode(nodeId).</code><code class="nf">id</code><code class="n">) </code><code class="k">AS </code><code class="n">libraries</code>
        <code class="k">ORDER BY </code><code class="n">size(libraries) </code><code class="k">DESC</code><code class="n">;</code></pre>
        
        <p>If we run this procedure, these are the results we’d see:</p>
        <table>
        
        <thead>
        <tr>
        <th>label</th>
        <th>libraries</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>32</p></td>
        <td><p>["six”, “pandas”, “python-dateutil”, “matplotlib”, “spacy"]</p></td>
        </tr>
        <tr>
        <td><p>0</p></td>
        <td><p>["ipykernel”, “jupyter”, “jpy-console"]</p></td>
        </tr>
        <tr>
        <td><p>2</p></td>
        <td><p>["jpy-client”, “jpy-core”, “nbconvert"]</p></td>
        </tr>
        <tr>
        <td><p>908</p></td>
        <td><p>["pyspark”, “py4j"]</p></td>
        </tr>
        <tr>
        <td><p>34</p></td>
        <td><p>["numpy"]</p></td>
        </tr>
        <tr>
        <td><p>36</p></td>
        <td><p>["pytz"]</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>A subset of the results can be seen visually in <a data-type="xref" href="#lpa-image">Figure&nbsp;6-9</a> and are similar to those we got with Apache Spark.</p>
        
        <figure><div id="lpa-image" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/gral_0609.png" alt="gral 0609" width="3586" height="3173">
        <h6><span class="label">Figure 6-9. </span>Clusters found by the Label Propagation algorithm, when respecting relationship direction</h6>
        </div></figure>
        
        <p>We can also run the algorithm assuming that the graph is undirected, which means that nodes will try to adopt labels from the libraries they depend on as well as ones that depend on them.</p>
        
        <p>To do this, we pass the <code>DIRECTION:BOTH</code> parameter to the algorithm:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="n">CALL gds.labelPropagation.stream({</code>
        <code class="n">  nodeProjection: </code><code class="s2">"Library"</code><code class="n">,</code>
        <code class="n">  relationshipProjection: {</code>
        <code class="n">    DEPENDS_ON: {</code>
        <code class="n">      </code><code class="nf">type</code><code class="n">: </code><code class="s2">"DEPENDS_ON"</code><code class="n">,</code>
        <code class="n">      orientation: </code><code class="s2">"UNDIRECTED"</code><code class="n"></code>
        <code class="n">    }</code>
        <code class="n">  },</code>
        <code class="n">  maxIterations: 10</code>
        <code class="n">})</code>
        <code class="n">YIELD nodeId, communityId</code>
        <code class="k">RETURN </code><code class="n">communityId </code><code class="k">AS </code><code class="n">label,</code>
        <code class="n">       </code><code class="nf">collect</code><code class="n">(gds.util.asNode(nodeId).</code><code class="nf">id</code><code class="n">) </code><code class="k">AS </code><code class="n">libraries</code>
        <code class="k">ORDER BY </code><code class="n">size(libraries) </code><code class="k">DESC</code><code class="n">;</code></pre>
        
        <p>If we run that, we’ll get the following output:</p>
        <table>
        
        <thead>
        <tr>
        <th>label</th>
        <th>libraries</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>11</p></td>
        <td><p>[pytz, matplotlib, spacy, six, pandas, numpy, python-dateutil]</p></td>
        </tr>
        <tr>
        <td><p>10</p></td>
        <td><p>[nbconvert, jpy-client, jpy-core]</p></td>
        </tr>
        <tr>
        <td><p>6</p></td>
        <td><p>[jupyter, jpy-console, ipykernel]</p></td>
        </tr>
        <tr>
        <td><p>4</p></td>
        <td><p>[pyspark, py4j]</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>The number of clusters has reduced from six to four, and all the nodes in the matplotlib part of the graph are now grouped together.
        This can be seen more clearly in <a data-type="xref" href="#lpa-undirected-image">Figure&nbsp;6-10</a>.</p>
        
        <figure><div id="lpa-undirected-image" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/gral_0610.png" alt="gral 0610" width="3566" height="2819">
        <h6><span class="label">Figure 6-10. </span>Clusters found by the Label Propagation algorithm, when ignoring relationship direction</h6>
        </div></figure>
        
        <p>Although the results of running Label Propagation on this data are similar for undirected and directed calculation, on complicated graphs you will see more significant differences. This is because ignoring direction causes nodes to try and adopt more labels, regardless of the relationship source<a data-type="indexterm" data-startref="ix_ch06-adoc16" id="idm46681365149768"></a><a data-type="indexterm" data-startref="ix_ch06-adoc15" id="idm46681365149064"></a>.<a data-type="indexterm" data-startref="ix_ch06-adoc14" id="idm46681365148264"></a><a data-type="indexterm" data-startref="ix_ch06-adoc13" id="idm46681365147560"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Louvain Modularity"><div class="sect1" id="louvain">
        <h1>Louvain Modularity</h1>
        
        <p><a data-type="indexterm" data-primary="community detection algorithms" data-secondary="Louvain Modularity" id="ix_ch06-adoc17"></a><a data-type="indexterm" data-primary="Louvain Modularity algorithm" id="ix_ch06-adoc18"></a>The Louvain Modularity algorithm finds clusters by comparing community density as it assigns nodes to different groups.
        You can think of this as a “what if” analysis to try various groupings with the goal of reaching a global optimum.</p>
        
        <p>Proposed in 2008, the <a href="https://arxiv.org/pdf/0803.0476.pdf">Louvain algorithm</a> is one of the fastest modularity-based algorithms.
        As well as detecting communities, it also reveals a hierarchy of communities at different scales.
        This is useful for understanding the structure of a network at different levels of granularity.</p>
        
        <p>Louvain quantifies how well a node is assigned to a group by looking at the density of connections within a cluster in comparison to an average or random sample.
        This measure of community assignment is called <em>modularity</em>.</p>
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="Quality-based grouping via modularity"><div class="sect3" id="idm46681365140168">
        <h3>Quality-based grouping via modularity</h3>
        
        <p><a data-type="indexterm" data-primary="Louvain Modularity algorithm" data-secondary="quality-based grouping via modularity" id="ix_ch06-adoc19"></a><a data-type="indexterm" data-primary="modularity" data-secondary="quality-based grouping and" id="ix_ch06-adoc20"></a><a data-type="indexterm" data-primary="quality-based grouping" id="ix_ch06-adoc21"></a><a data-type="indexterm" data-primary="modularity" data-seealso="Louvain Modularity algorithm" id="idm46681365135064"></a>Modularity is a technique for uncovering communities by partitioning a graph into more coarse-grained modules (or clusters) and then measuring the strength of the groupings.
        As opposed to just looking at the concentration of connections within a cluster, this method compares relationship densities in given clusters to densities between clusters.
        The measure of the quality of those groupings is called modularity.</p>
        
        <p>Modularity algorithms optimize communities locally and then globally, using multiple iterations to test different groupings and increasing coarseness.
        This strategy identifies community hierarchies and provides a broad understanding of the overall structure.
        However, all modularity algorithms suffer from two drawbacks:</p>
        
        <ul>
        <li>
        <p>They merge smaller communities into larger ones.</p>
        </li>
        <li>
        <p>A plateau can occur where several partition options are present with similar modularity, forming local maxima and preventing progress.</p>
        </li>
        </ul>
        
        <p>For more information, see the paper <a href="https://arxiv.org/abs/0910.0165">“The Performance of Modularity Maximization in Practical Contexts”</a>, by B. H. Good, Y.-A. de Montjoye, and A. Clauset.</p>
        
        <p>Initially the Louvain Modularity algorithm optimizes modularity locally on all nodes, which finds small communities; then each small community is grouped into a larger conglomerate node and the first step is repeated until we reach a global optimum.</p>
        <aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46681365128488">
        <h5>Calculating Modularity</h5>
        <p><a data-type="indexterm" data-primary="modularity" data-secondary="calculating" id="ix_ch06-adoc22"></a>A simple calculation of modularity is based on the fraction of the relationships within the given groups minus the expected fraction if relationships were distributed at random between all nodes.
        The value is always between 1 and –1, with positive values indicating more relationship density than you’d expect by chance and negative values indicating less density.
        <a data-type="xref" href="#modularity">Figure&nbsp;6-11</a> illustrates several different modularity scores based on node groupings.</p>
        
        <figure><div id="modularity" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/gral_rr_0611.png" alt="gral rr 0611" width="1321" height="950">
        <h6><span class="label">Figure 6-11. </span>Four modularity scores based on different partitioning choices</h6>
        </div></figure>
        
        <p>The formula for the modularity of a group is:</p>
        <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="14" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="24.476ex" height="5.428ex" role="img" focusable="false" viewBox="0 -1449.5 10818.6 2399" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -2.148ex;"><defs><path id="MJX-15-TEX-I-1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path><path id="MJX-15-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-15-TEX-SO-2211" d="M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z"></path><path id="MJX-15-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-15-TEX-I-1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path id="MJX-15-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-15-TEX-S3-5B" d="M247 -949V1450H516V1388H309V-887H516V-949H247Z"></path><path id="MJX-15-TEX-I-1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path><path id="MJX-15-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-15-TEX-LO-28" d="M180 96T180 250T205 541T266 770T353 944T444 1069T527 1150H555Q561 1144 561 1141Q561 1137 545 1120T504 1072T447 995T386 878T330 721T288 513T272 251Q272 133 280 56Q293 -87 326 -209T399 -405T475 -531T536 -609T561 -640Q561 -643 555 -649H527Q483 -612 443 -568T353 -443T266 -270T205 -41Z"></path><path id="MJX-15-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path><path id="MJX-15-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-15-TEX-LO-29" d="M35 1138Q35 1150 51 1150H56H69Q113 1113 153 1069T243 944T330 771T391 541T416 250T391 -40T330 -270T243 -443T152 -568T69 -649H56Q43 -649 39 -647T35 -637Q65 -607 110 -548Q283 -316 316 56Q324 133 324 251Q324 368 316 445Q278 877 48 1123Q36 1137 35 1138Z"></path><path id="MJX-15-TEX-S3-5D" d="M11 1388V1450H280V-949H11V-887H218V1388H11Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mi"><use data-c="1D440" xlink:href="#MJX-15-TEX-I-1D440"></use></g><g data-mml-node="mo" transform="translate(1328.8,0)"><use data-c="3D" xlink:href="#MJX-15-TEX-N-3D"></use></g><g data-mml-node="munderover" transform="translate(2384.6,0)"><g data-mml-node="mo"><use data-c="2211" xlink:href="#MJX-15-TEX-SO-2211"></use></g><g data-mml-node="msub" transform="translate(1089,477.1) scale(0.707)"><g data-mml-node="mi"><use data-c="1D45B" xlink:href="#MJX-15-TEX-I-1D45B"></use></g><g data-mml-node="mi" transform="translate(633,-150) scale(0.707)"><use data-c="1D450" xlink:href="#MJX-15-TEX-I-1D450"></use></g></g><g data-mml-node="mrow" transform="translate(1089,-285.4) scale(0.707)"><g data-mml-node="msub"><g data-mml-node="mrow"></g><g data-mml-node="mrow" transform="translate(33,-150) scale(0.707)"><g data-mml-node="mi"><use data-c="1D450" xlink:href="#MJX-15-TEX-I-1D450"></use></g><g data-mml-node="mo" transform="translate(433,0)"><use data-c="3D" xlink:href="#MJX-15-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(1211,0)"><use data-c="31" xlink:href="#MJX-15-TEX-N-31"></use></g></g></g></g></g><g data-mml-node="mfenced" transform="translate(4437.7,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><use data-c="5B" xlink:href="#MJX-15-TEX-S3-5B"></use></g><g data-mml-node="mfrac" transform="translate(528,0)"><g data-mml-node="msub" transform="translate(220,451.6) scale(0.707)"><g data-mml-node="mi"><use data-c="1D43F" xlink:href="#MJX-15-TEX-I-1D43F"></use></g><g data-mml-node="mi" transform="translate(714,-150) scale(0.707)"><use data-c="1D450" xlink:href="#MJX-15-TEX-I-1D450"></use></g></g><g data-mml-node="mi" transform="translate(357.6,-345) scale(0.707)"><use data-c="1D43F" xlink:href="#MJX-15-TEX-I-1D43F"></use></g><rect width="956.7" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(1947,0)"><use data-c="2212" xlink:href="#MJX-15-TEX-N-2212"></use></g><g data-mml-node="msup" transform="translate(2947.2,0)"><g data-mml-node="mfenced"><g data-mml-node="mo" transform="translate(0 -0.5)"><use data-c="28" xlink:href="#MJX-15-TEX-LO-28"></use></g><g data-mml-node="mfrac" transform="translate(597,0)"><g data-mml-node="msub" transform="translate(315.8,451.6) scale(0.707)"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-15-TEX-I-1D458"></use></g><g data-mml-node="mi" transform="translate(554,-150) scale(0.707)"><use data-c="1D450" xlink:href="#MJX-15-TEX-I-1D450"></use></g></g><g data-mml-node="mrow" transform="translate(220,-345) scale(0.707)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-15-TEX-N-32"></use></g><g data-mml-node="mi" transform="translate(500,0)"><use data-c="1D43F" xlink:href="#MJX-15-TEX-I-1D43F"></use></g></g><rect width="1035.1" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(1872.1,0) translate(0 -0.5)"><use data-c="29" xlink:href="#MJX-15-TEX-LO-29"></use></g></g><g data-mml-node="mn" transform="translate(2502.1,876.6) scale(0.707)"><use data-c="32" xlink:href="#MJX-15-TEX-N-32"></use></g></g><g data-mml-node="mo" transform="translate(5852.8,0) translate(0 -0.5)"><use data-c="5D" xlink:href="#MJX-15-TEX-S3-5D"></use></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><mi>M</mi><mo>=</mo><munderover><mo>∑</mo><mrow><msub><mrow></mrow><mrow><mi>c</mi><mo>=</mo><mn>1</mn></mrow></msub></mrow><msub><mi>n</mi><mi>c</mi></msub></munderover><mfenced separators="" open="[" close="]"><mfrac><msub><mi>L</mi><mi>c</mi></msub><mi>L</mi></mfrac><mo>-</mo><msup><mfenced separators="" open="(" close=")"><mfrac><msub><mi>k</mi><mi>c</mi></msub><mrow><mn>2</mn><mi>L</mi></mrow></mfrac></mfenced><mn>2</mn></msup></mfenced></mrow></math></mjx-assistive-mml></mjx-container>
        
        <p>where:</p>
        <ul>
        <li><p><em>L</em> is the number of relationships in the entire group.</p></li>
        <li><p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="15" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.421ex" height="1.902ex" role="img" focusable="false" viewBox="0 -683 1070.2 840.8" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.357ex;"><defs><path id="MJX-16-TEX-I-1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path><path id="MJX-16-TEX-I-1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D43F" xlink:href="#MJX-16-TEX-I-1D43F"></use></g><g data-mml-node="mi" transform="translate(714,-150) scale(0.707)"><use data-c="1D450" xlink:href="#MJX-16-TEX-I-1D450"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><msub><mi>L</mi><mi>c</mi></msub></math></mjx-assistive-mml></mjx-container> is the number of relationships in a partition.</p></li>
        <li><p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="16" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.059ex" height="1.927ex" role="img" focusable="false" viewBox="0 -694 910.2 851.8" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.357ex;"><defs><path id="MJX-17-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path><path id="MJX-17-TEX-I-1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-17-TEX-I-1D458"></use></g><g data-mml-node="mi" transform="translate(554,-150) scale(0.707)"><use data-c="1D450" xlink:href="#MJX-17-TEX-I-1D450"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><msub><mi>k</mi><mi>c</mi></msub></math></mjx-assistive-mml></mjx-container> is the total degree of nodes in a partition.</p></li>
        </ul>
        
        <p class="pagebreak-before">The calculation for the optimal partition at the top of <a data-type="xref" href="#modularity">Figure&nbsp;6-11</a> is as follows:</p>
        
        <ul>
        <li>
        <p>The dark partition is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="17" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="25.568ex" height="5.428ex" role="img" focusable="false" viewBox="0 -1449.5 11301.1 2399" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -2.148ex;"><defs><path id="MJX-18-TEX-S3-28" d="M701 -940Q701 -943 695 -949H664Q662 -947 636 -922T591 -879T537 -818T475 -737T412 -636T350 -511T295 -362T250 -186T221 17T209 251Q209 962 573 1361Q596 1386 616 1405T649 1437T664 1450H695Q701 1444 701 1441Q701 1436 681 1415T629 1356T557 1261T476 1118T400 927T340 675T308 359Q306 321 306 250Q306 -139 400 -430T690 -924Q701 -936 701 -940Z"></path><path id="MJX-18-TEX-N-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path id="MJX-18-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-18-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-18-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-18-TEX-LO-28" d="M180 96T180 250T205 541T266 770T353 944T444 1069T527 1150H555Q561 1144 561 1141Q561 1137 545 1120T504 1072T447 995T386 878T330 721T288 513T272 251Q272 133 280 56Q293 -87 326 -209T399 -405T475 -531T536 -609T561 -640Q561 -643 555 -649H527Q483 -612 443 -568T353 -443T266 -270T205 -41Z"></path><path id="MJX-18-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path id="MJX-18-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-18-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-18-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-18-TEX-LO-29" d="M35 1138Q35 1150 51 1150H56H69Q113 1113 153 1069T243 944T330 771T391 541T416 250T391 -40T330 -270T243 -443T152 -568T69 -649H56Q43 -649 39 -647T35 -637Q65 -607 110 -548Q283 -316 316 56Q324 133 324 251Q324 368 316 445Q278 877 48 1123Q36 1137 35 1138Z"></path><path id="MJX-18-TEX-S3-29" d="M34 1438Q34 1446 37 1448T50 1450H56H71Q73 1448 99 1423T144 1380T198 1319T260 1238T323 1137T385 1013T440 864T485 688T514 485T526 251Q526 134 519 53Q472 -519 162 -860Q139 -885 119 -904T86 -936T71 -949H56Q43 -949 39 -947T34 -937Q88 -883 140 -813Q428 -430 428 251Q428 453 402 628T338 922T245 1146T145 1309T46 1425Q44 1427 42 1429T39 1433T36 1436L34 1438Z"></path><path id="MJX-18-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-18-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-18-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mfenced"><g data-mml-node="mo" transform="translate(0 -0.5)"><use data-c="28" xlink:href="#MJX-18-TEX-S3-28"></use></g><g data-mml-node="mfrac" transform="translate(736,0)"><g data-mml-node="mn" transform="translate(396.8,394) scale(0.707)"><use data-c="37" xlink:href="#MJX-18-TEX-N-37"></use></g><g data-mml-node="mn" transform="translate(220,-345) scale(0.707)"><use data-c="31" xlink:href="#MJX-18-TEX-N-31"></use><use data-c="33" xlink:href="#MJX-18-TEX-N-33" transform="translate(500,0)"></use></g><rect width="907.1" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(2105.3,0)"><use data-c="2212" xlink:href="#MJX-18-TEX-N-2212"></use></g><g data-mml-node="msup" transform="translate(3105.6,0)"><g data-mml-node="mfenced"><g data-mml-node="mo" transform="translate(0 -0.5)"><use data-c="28" xlink:href="#MJX-18-TEX-LO-28"></use></g><g data-mml-node="mfrac" transform="translate(597,0)"><g data-mml-node="mn" transform="translate(671.8,394) scale(0.707)"><use data-c="31" xlink:href="#MJX-18-TEX-N-31"></use><use data-c="35" xlink:href="#MJX-18-TEX-N-35" transform="translate(500,0)"></use></g><g data-mml-node="mrow" transform="translate(220,-370.3) scale(0.707)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-18-TEX-N-32"></use></g><g data-mml-node="mo" transform="translate(500,0)"><use data-c="28" xlink:href="#MJX-18-TEX-N-28"></use></g><g data-mml-node="mn" transform="translate(889,0)"><use data-c="31" xlink:href="#MJX-18-TEX-N-31"></use><use data-c="33" xlink:href="#MJX-18-TEX-N-33" transform="translate(500,0)"></use></g><g data-mml-node="mo" transform="translate(1889,0)"><use data-c="29" xlink:href="#MJX-18-TEX-N-29"></use></g></g><rect width="1810.8" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(2647.8,0) translate(0 -0.5)"><use data-c="29" xlink:href="#MJX-18-TEX-LO-29"></use></g></g><g data-mml-node="mn" transform="translate(3277.8,876.6) scale(0.707)"><use data-c="32" xlink:href="#MJX-18-TEX-N-32"></use></g></g><g data-mml-node="mo" transform="translate(6786.9,0) translate(0 -0.5)"><use data-c="29" xlink:href="#MJX-18-TEX-S3-29"></use></g></g><g data-mml-node="mo" transform="translate(7800.7,0)"><use data-c="3D" xlink:href="#MJX-18-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(8856.4,0)"><use data-c="30" xlink:href="#MJX-18-TEX-N-30"></use></g><g data-mml-node="mo" transform="translate(9356.4,0)"><use data-c="2E" xlink:href="#MJX-18-TEX-N-2E"></use></g><g data-mml-node="mn" transform="translate(9801.1,0)"><use data-c="32" xlink:href="#MJX-18-TEX-N-32"></use><use data-c="30" xlink:href="#MJX-18-TEX-N-30" transform="translate(500,0)"></use><use data-c="35" xlink:href="#MJX-18-TEX-N-35" transform="translate(1000,0)"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><mfenced separators="" open="(" close=")"><mfrac><mn>7</mn><mn>13</mn></mfrac><mo>-</mo><msup><mfenced separators="" open="(" close=")"><mfrac><mn>15</mn><mrow><mn>2</mn><mo>(</mo><mn>13</mn><mo>)</mo></mrow></mfrac></mfenced><mn>2</mn></msup></mfenced><mo>=</mo><mn>0</mn><mo>.</mo><mn>205</mn></mrow></math></mjx-assistive-mml></mjx-container></p>
        </li>
        <li>
        <p>The light partition is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="18" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="25.568ex" height="5.428ex" role="img" focusable="false" viewBox="0 -1449.5 11301.1 2399" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -2.148ex;"><defs><path id="MJX-19-TEX-S3-28" d="M701 -940Q701 -943 695 -949H664Q662 -947 636 -922T591 -879T537 -818T475 -737T412 -636T350 -511T295 -362T250 -186T221 17T209 251Q209 962 573 1361Q596 1386 616 1405T649 1437T664 1450H695Q701 1444 701 1441Q701 1436 681 1415T629 1356T557 1261T476 1118T400 927T340 675T308 359Q306 321 306 250Q306 -139 400 -430T690 -924Q701 -936 701 -940Z"></path><path id="MJX-19-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path id="MJX-19-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-19-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-19-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-19-TEX-LO-28" d="M180 96T180 250T205 541T266 770T353 944T444 1069T527 1150H555Q561 1144 561 1141Q561 1137 545 1120T504 1072T447 995T386 878T330 721T288 513T272 251Q272 133 280 56Q293 -87 326 -209T399 -405T475 -531T536 -609T561 -640Q561 -643 555 -649H527Q483 -612 443 -568T353 -443T266 -270T205 -41Z"></path><path id="MJX-19-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-19-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-19-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-19-TEX-LO-29" d="M35 1138Q35 1150 51 1150H56H69Q113 1113 153 1069T243 944T330 771T391 541T416 250T391 -40T330 -270T243 -443T152 -568T69 -649H56Q43 -649 39 -647T35 -637Q65 -607 110 -548Q283 -316 316 56Q324 133 324 251Q324 368 316 445Q278 877 48 1123Q36 1137 35 1138Z"></path><path id="MJX-19-TEX-S3-29" d="M34 1438Q34 1446 37 1448T50 1450H56H71Q73 1448 99 1423T144 1380T198 1319T260 1238T323 1137T385 1013T440 864T485 688T514 485T526 251Q526 134 519 53Q472 -519 162 -860Q139 -885 119 -904T86 -936T71 -949H56Q43 -949 39 -947T34 -937Q88 -883 140 -813Q428 -430 428 251Q428 453 402 628T338 922T245 1146T145 1309T46 1425Q44 1427 42 1429T39 1433T36 1436L34 1438Z"></path><path id="MJX-19-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-19-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-19-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-19-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mfenced"><g data-mml-node="mo" transform="translate(0 -0.5)"><use data-c="28" xlink:href="#MJX-19-TEX-S3-28"></use></g><g data-mml-node="mfrac" transform="translate(736,0)"><g data-mml-node="mn" transform="translate(396.8,394) scale(0.707)"><use data-c="35" xlink:href="#MJX-19-TEX-N-35"></use></g><g data-mml-node="mn" transform="translate(220,-345) scale(0.707)"><use data-c="31" xlink:href="#MJX-19-TEX-N-31"></use><use data-c="33" xlink:href="#MJX-19-TEX-N-33" transform="translate(500,0)"></use></g><rect width="907.1" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(2105.3,0)"><use data-c="2212" xlink:href="#MJX-19-TEX-N-2212"></use></g><g data-mml-node="msup" transform="translate(3105.6,0)"><g data-mml-node="mfenced"><g data-mml-node="mo" transform="translate(0 -0.5)"><use data-c="28" xlink:href="#MJX-19-TEX-LO-28"></use></g><g data-mml-node="mfrac" transform="translate(597,0)"><g data-mml-node="mn" transform="translate(671.8,394) scale(0.707)"><use data-c="31" xlink:href="#MJX-19-TEX-N-31"></use><use data-c="31" xlink:href="#MJX-19-TEX-N-31" transform="translate(500,0)"></use></g><g data-mml-node="mrow" transform="translate(220,-370.3) scale(0.707)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-19-TEX-N-32"></use></g><g data-mml-node="mo" transform="translate(500,0)"><use data-c="28" xlink:href="#MJX-19-TEX-N-28"></use></g><g data-mml-node="mn" transform="translate(889,0)"><use data-c="31" xlink:href="#MJX-19-TEX-N-31"></use><use data-c="33" xlink:href="#MJX-19-TEX-N-33" transform="translate(500,0)"></use></g><g data-mml-node="mo" transform="translate(1889,0)"><use data-c="29" xlink:href="#MJX-19-TEX-N-29"></use></g></g><rect width="1810.8" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(2647.8,0) translate(0 -0.5)"><use data-c="29" xlink:href="#MJX-19-TEX-LO-29"></use></g></g><g data-mml-node="mn" transform="translate(3277.8,876.6) scale(0.707)"><use data-c="32" xlink:href="#MJX-19-TEX-N-32"></use></g></g><g data-mml-node="mo" transform="translate(6786.9,0) translate(0 -0.5)"><use data-c="29" xlink:href="#MJX-19-TEX-S3-29"></use></g></g><g data-mml-node="mo" transform="translate(7800.7,0)"><use data-c="3D" xlink:href="#MJX-19-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(8856.4,0)"><use data-c="30" xlink:href="#MJX-19-TEX-N-30"></use></g><g data-mml-node="mo" transform="translate(9356.4,0)"><use data-c="2E" xlink:href="#MJX-19-TEX-N-2E"></use></g><g data-mml-node="mn" transform="translate(9801.1,0)"><use data-c="32" xlink:href="#MJX-19-TEX-N-32"></use><use data-c="30" xlink:href="#MJX-19-TEX-N-30" transform="translate(500,0)"></use><use data-c="36" xlink:href="#MJX-19-TEX-N-36" transform="translate(1000,0)"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><mfenced separators="" open="(" close=")"><mfrac><mn>5</mn><mn>13</mn></mfrac><mo>-</mo><msup><mfenced separators="" open="(" close=")"><mfrac><mn>11</mn><mrow><mn>2</mn><mo>(</mo><mn>13</mn><mo>)</mo></mrow></mfrac></mfenced><mn>2</mn></msup></mfenced><mo>=</mo><mn>0</mn><mo>.</mo><mn>206</mn></mrow></math></mjx-assistive-mml></mjx-container></p>
        </li>
        <li>
        <p>These<a data-type="indexterm" data-startref="ix_ch06-adoc22" id="idm46681365049672"></a> are added together for <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="19" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="26.639ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 11774.6 765" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.186ex;"><defs><path id="MJX-20-TEX-I-1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path><path id="MJX-20-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-20-TEX-N-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path id="MJX-20-TEX-N-2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path><path id="MJX-20-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-20-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path id="MJX-20-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-20-TEX-N-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path id="MJX-20-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path id="MJX-20-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mi"><use data-c="1D440" xlink:href="#MJX-20-TEX-I-1D440"></use></g><g data-mml-node="mo" transform="translate(1328.8,0)"><use data-c="3D" xlink:href="#MJX-20-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(2384.6,0)"><use data-c="30" xlink:href="#MJX-20-TEX-N-30"></use></g><g data-mml-node="mo" transform="translate(2884.6,0)"><use data-c="2E" xlink:href="#MJX-20-TEX-N-2E"></use></g><g data-mml-node="mn" transform="translate(3329.2,0)"><use data-c="32" xlink:href="#MJX-20-TEX-N-32"></use><use data-c="30" xlink:href="#MJX-20-TEX-N-30" transform="translate(500,0)"></use><use data-c="35" xlink:href="#MJX-20-TEX-N-35" transform="translate(1000,0)"></use></g><g data-mml-node="mo" transform="translate(5051.4,0)"><use data-c="2B" xlink:href="#MJX-20-TEX-N-2B"></use></g><g data-mml-node="mn" transform="translate(6051.7,0)"><use data-c="30" xlink:href="#MJX-20-TEX-N-30"></use></g><g data-mml-node="mo" transform="translate(6551.7,0)"><use data-c="2E" xlink:href="#MJX-20-TEX-N-2E"></use></g><g data-mml-node="mn" transform="translate(6996.3,0)"><use data-c="32" xlink:href="#MJX-20-TEX-N-32"></use><use data-c="30" xlink:href="#MJX-20-TEX-N-30" transform="translate(500,0)"></use><use data-c="36" xlink:href="#MJX-20-TEX-N-36" transform="translate(1000,0)"></use></g><g data-mml-node="mo" transform="translate(8774.1,0)"><use data-c="3D" xlink:href="#MJX-20-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(9829.9,0)"><use data-c="30" xlink:href="#MJX-20-TEX-N-30"></use></g><g data-mml-node="mo" transform="translate(10329.9,0)"><use data-c="2E" xlink:href="#MJX-20-TEX-N-2E"></use></g><g data-mml-node="mn" transform="translate(10774.6,0)"><use data-c="34" xlink:href="#MJX-20-TEX-N-34"></use><use data-c="31" xlink:href="#MJX-20-TEX-N-31" transform="translate(500,0)"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><mi>M</mi><mo>=</mo><mn>0</mn><mo>.</mo><mn>205</mn><mo>+</mo><mn>0</mn><mo>.</mo><mn>206</mn><mo>=</mo><mn>0</mn><mo>.</mo><mn>41</mn></mrow></math></mjx-assistive-mml></mjx-container></p>
        </li>
        </ul>
        </div></aside>
        
        <p>The algorithm consists of repeated application of two steps, as illustrated in <a data-type="xref" href="#louvain-steps">Figure&nbsp;6-12</a>.</p>
        
        <figure><div id="louvain-steps" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/gral_rr_0612.png" alt="gral rr 0612" width="1403" height="1431">
        <h6><span class="label">Figure 6-12. </span>The Louvain algorithm process</h6>
        </div></figure>
        
        <p class="less_space pagebreak-before">The Louvain algorithm’s steps include:</p>
        <ol>
        <li>
        <p>A “greedy” assignment of nodes to communities, favoring local optimizations of modularity.</p>
        </li>
        <li>
        <p>The definition of a more coarse-grained network based on the communities found in the first step.
        This coarse-grained network will be used in the next iteration of the algorithm.</p>
        </li>
        
        </ol>
        
        <p>These two steps are repeated until no further modularity-increasing reassignments of communities are possible.</p>
        
        <p>Part of the first optimization step is evaluating the modularity of a group.
        Louvain uses the following formula to accomplish this:</p>
        <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" display="true" tabindex="0" ctxtmenu_counter="20" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="34.887ex" height="6.192ex" role="img" focusable="false" viewBox="0 -1449.5 15420.2 2736.7" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -2.912ex;"><defs><path id="MJX-21-TEX-I-1D444" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"></path><path id="MJX-21-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-21-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-21-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-21-TEX-I-1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-21-TEX-LO-2211" d="M60 948Q63 950 665 950H1267L1325 815Q1384 677 1388 669H1348L1341 683Q1320 724 1285 761Q1235 809 1174 838T1033 881T882 898T699 902H574H543H251L259 891Q722 258 724 252Q725 250 724 246Q721 243 460 -56L196 -356Q196 -357 407 -357Q459 -357 548 -357T676 -358Q812 -358 896 -353T1063 -332T1204 -283T1307 -196Q1328 -170 1348 -124H1388Q1388 -125 1381 -145T1356 -210T1325 -294L1267 -449L666 -450Q64 -450 61 -448Q55 -446 55 -439Q55 -437 57 -433L590 177Q590 178 557 222T452 366T322 544L56 909L55 924Q55 945 60 948Z"></path><path id="MJX-21-TEX-I-1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-21-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-21-TEX-I-1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path><path id="MJX-21-TEX-S3-5B" d="M247 -949V1450H516V1388H309V-887H516V-949H247Z"></path><path id="MJX-21-TEX-I-1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path id="MJX-21-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-21-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path><path id="MJX-21-TEX-S3-5D" d="M11 1388V1450H280V-949H11V-887H218V1388H11Z"></path><path id="MJX-21-TEX-I-1D6FF" d="M195 609Q195 656 227 686T302 717Q319 716 351 709T407 697T433 690Q451 682 451 662Q451 644 438 628T403 612Q382 612 348 641T288 671T249 657T235 628Q235 584 334 463Q401 379 401 292Q401 169 340 80T205 -10H198Q127 -10 83 36T36 153Q36 286 151 382Q191 413 252 434Q252 435 245 449T230 481T214 521T201 566T195 609ZM112 130Q112 83 136 55T204 27Q233 27 256 51T291 111T309 178T316 232Q316 267 309 298T295 344T269 400L259 396Q215 381 183 342T137 256T118 179T112 130Z"></path><path id="MJX-21-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-21-TEX-I-1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path id="MJX-21-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mi"><use data-c="1D444" xlink:href="#MJX-21-TEX-I-1D444"></use></g><g data-mml-node="mo" transform="translate(1068.8,0)"><use data-c="3D" xlink:href="#MJX-21-TEX-N-3D"></use></g><g data-mml-node="mfrac" transform="translate(2124.6,0)"><g data-mml-node="mn" transform="translate(659,676)"><use data-c="31" xlink:href="#MJX-21-TEX-N-31"></use></g><g data-mml-node="mrow" transform="translate(220,-686)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-21-TEX-N-32"></use></g><g data-mml-node="mi" transform="translate(500,0)"><use data-c="1D45A" xlink:href="#MJX-21-TEX-I-1D45A"></use></g></g><rect width="1578" height="60" x="120" y="220"></rect></g><g data-mml-node="munder" transform="translate(4109.2,0)"><g data-mml-node="mo"><use data-c="2211" xlink:href="#MJX-21-TEX-LO-2211"></use></g><g data-mml-node="mrow" transform="translate(250,-1050) scale(0.707)"><g data-mml-node="mi"><use data-c="1D462" xlink:href="#MJX-21-TEX-I-1D462"></use></g><g data-mml-node="mo" transform="translate(572,0)"><use data-c="2C" xlink:href="#MJX-21-TEX-N-2C"></use></g><g data-mml-node="mi" transform="translate(850,0)"><use data-c="1D463" xlink:href="#MJX-21-TEX-I-1D463"></use></g></g></g><g data-mml-node="mfenced" transform="translate(5553.2,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><use data-c="5B" xlink:href="#MJX-21-TEX-S3-5B"></use></g><g data-mml-node="msub" transform="translate(528,0)"><g data-mml-node="mi"><use data-c="1D434" xlink:href="#MJX-21-TEX-I-1D434"></use></g><g data-mml-node="mrow" transform="translate(783,-150) scale(0.707)"><g data-mml-node="mi"><use data-c="1D462" xlink:href="#MJX-21-TEX-I-1D462"></use></g><g data-mml-node="mi" transform="translate(572,0)"><use data-c="1D463" xlink:href="#MJX-21-TEX-I-1D463"></use></g></g></g><g data-mml-node="mo" transform="translate(2330.6,0)"><use data-c="2212" xlink:href="#MJX-21-TEX-N-2212"></use></g><g data-mml-node="mfrac" transform="translate(3330.9,0)"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-21-TEX-I-1D458"></use></g><g data-mml-node="mi" transform="translate(554,-150) scale(0.707)"><use data-c="1D462" xlink:href="#MJX-21-TEX-I-1D462"></use></g></g><g data-mml-node="msub" transform="translate(1008.5,0)"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-21-TEX-I-1D458"></use></g><g data-mml-node="mi" transform="translate(554,-150) scale(0.707)"><use data-c="1D463" xlink:href="#MJX-21-TEX-I-1D463"></use></g></g></g><g data-mml-node="mrow" transform="translate(508.7,-686)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-21-TEX-N-32"></use></g><g data-mml-node="mi" transform="translate(500,0)"><use data-c="1D45A" xlink:href="#MJX-21-TEX-I-1D45A"></use></g></g><rect width="2155.4" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(5726.3,0) translate(0 -0.5)"><use data-c="5D" xlink:href="#MJX-21-TEX-S3-5D"></use></g></g><g data-mml-node="mi" transform="translate(11807.5,0)"><use data-c="1D6FF" xlink:href="#MJX-21-TEX-I-1D6FF"></use></g><g data-mml-node="mrow" transform="translate(12418.2,0)"><g data-mml-node="mo"><use data-c="28" xlink:href="#MJX-21-TEX-N-28"></use></g><g data-mml-node="msub" transform="translate(389,0)"><g data-mml-node="mi"><use data-c="1D450" xlink:href="#MJX-21-TEX-I-1D450"></use></g><g data-mml-node="mi" transform="translate(466,-150) scale(0.707)"><use data-c="1D462" xlink:href="#MJX-21-TEX-I-1D462"></use></g></g><g data-mml-node="mo" transform="translate(1309.5,0)"><use data-c="2C" xlink:href="#MJX-21-TEX-N-2C"></use></g><g data-mml-node="msub" transform="translate(1754.1,0)"><g data-mml-node="mi"><use data-c="1D450" xlink:href="#MJX-21-TEX-I-1D450"></use></g><g data-mml-node="mi" transform="translate(466,-150) scale(0.707)"><use data-c="1D463" xlink:href="#MJX-21-TEX-I-1D463"></use></g></g><g data-mml-node="mo" transform="translate(2613.1,0)"><use data-c="29" xlink:href="#MJX-21-TEX-N-29"></use></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mi>Q</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>m</mi></mrow></mfrac><munder><mo>∑</mo><mrow><mi>u</mi><mo>,</mo><mi>v</mi></mrow></munder><mfenced separators="" open="[" close="]"><msub><mi>A</mi><mrow><mi>u</mi><mi>v</mi></mrow></msub><mo>-</mo><mfrac><mrow><msub><mi>k</mi><mi>u</mi></msub><msub><mi>k</mi><mi>v</mi></msub></mrow><mrow><mn>2</mn><mi>m</mi></mrow></mfrac></mfenced><mi>δ</mi><mrow><mo>(</mo><msub><mi>c</mi><mi>u</mi></msub><mo>,</mo><msub><mi>c</mi><mi>v</mi></msub><mo>)</mo></mrow></mrow></math></mjx-assistive-mml></mjx-container>
        
        <p>where:</p>
        
        <ul>
        <li>
        <p><em>u</em> and <em>v</em> are nodes.</p>
        </li>
        <li>
        <p><em>m</em> is the total relationship weight across the entire graph (<em>2m</em> is a common normalization value in modularity formulas).</p>
        </li>
        <li>
        <p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="21" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="10.465ex" height="2.93ex" role="img" focusable="false" viewBox="0 -942.3 4625.5 1295.1" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.798ex;"><defs><path id="MJX-22-TEX-I-1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path id="MJX-22-TEX-I-1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-22-TEX-I-1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path><path id="MJX-22-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-22-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path><path id="MJX-22-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-22-TEX-I-1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D434" xlink:href="#MJX-22-TEX-I-1D434"></use></g><g data-mml-node="mrow" transform="translate(783,-150) scale(0.707)"><g data-mml-node="mi"><use data-c="1D462" xlink:href="#MJX-22-TEX-I-1D462"></use></g><g data-mml-node="mi" transform="translate(572,0)"><use data-c="1D463" xlink:href="#MJX-22-TEX-I-1D463"></use></g></g></g><g data-mml-node="mo" transform="translate(1802.6,0)"><use data-c="2212" xlink:href="#MJX-22-TEX-N-2212"></use></g><g data-mml-node="mfrac" transform="translate(2802.9,0)"><g data-mml-node="mrow" transform="translate(220,451.6) scale(0.707)"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-22-TEX-I-1D458"></use></g><g data-mml-node="mi" transform="translate(554,-150) scale(0.707)"><use data-c="1D462" xlink:href="#MJX-22-TEX-I-1D462"></use></g></g><g data-mml-node="msub" transform="translate(1008.5,0)"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-22-TEX-I-1D458"></use></g><g data-mml-node="mi" transform="translate(554,-150) scale(0.707)"><use data-c="1D463" xlink:href="#MJX-22-TEX-I-1D463"></use></g></g></g><g data-mml-node="mrow" transform="translate(424.1,-345) scale(0.707)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-22-TEX-N-32"></use></g><g data-mml-node="mi" transform="translate(500,0)"><use data-c="1D45A" xlink:href="#MJX-22-TEX-I-1D45A"></use></g></g><rect width="1582.7" height="60" x="120" y="220"></rect></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><msub><mi>A</mi><mrow><mi>u</mi><mi>v</mi></mrow></msub><mo>-</mo><mfrac><mrow><msub><mi>k</mi><mi>u</mi></msub><msub><mi>k</mi><mi>v</mi></msub></mrow><mrow><mn>2</mn><mi>m</mi></mrow></mfrac></mrow></math></mjx-assistive-mml></mjx-container> is the strength of the relationship between <em>u</em> and <em>v</em> compared to what we would expect with a random assignment (tends toward averages) of those nodes in the network.</p>
        
        <ul>
        <li>
        <p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="22" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="3.576ex" height="1.977ex" role="img" focusable="false" viewBox="0 -716 1580.4 873.8" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.357ex;"><defs><path id="MJX-23-TEX-I-1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path id="MJX-23-TEX-I-1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-23-TEX-I-1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D434" xlink:href="#MJX-23-TEX-I-1D434"></use></g><g data-mml-node="mrow" transform="translate(783,-150) scale(0.707)"><g data-mml-node="mi"><use data-c="1D462" xlink:href="#MJX-23-TEX-I-1D462"></use></g><g data-mml-node="mi" transform="translate(572,0)"><use data-c="1D463" xlink:href="#MJX-23-TEX-I-1D463"></use></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><msub><mi>A</mi><mrow><mi>u</mi><mi>v</mi></mrow></msub></math></mjx-assistive-mml></mjx-container> is the weight of the relationship between <em>u</em> and <em>v</em>.</p>
        </li>
        <li>
        <p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="23" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.282ex" height="1.927ex" role="img" focusable="false" viewBox="0 -694 1008.5 851.8" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.357ex;"><defs><path id="MJX-24-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path><path id="MJX-24-TEX-I-1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-24-TEX-I-1D458"></use></g><g data-mml-node="mi" transform="translate(554,-150) scale(0.707)"><use data-c="1D462" xlink:href="#MJX-24-TEX-I-1D462"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><msub><mi>k</mi><mi>u</mi></msub></math></mjx-assistive-mml></mjx-container> is the sum of relationship weights for <em>u</em>.</p>
        </li>
        <li>
        <p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="24" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.142ex" height="1.927ex" role="img" focusable="false" viewBox="0 -694 946.9 851.8" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.357ex;"><defs><path id="MJX-25-TEX-I-1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path><path id="MJX-25-TEX-I-1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D458" xlink:href="#MJX-25-TEX-I-1D458"></use></g><g data-mml-node="mi" transform="translate(554,-150) scale(0.707)"><use data-c="1D463" xlink:href="#MJX-25-TEX-I-1D463"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><msub><mi>k</mi><mi>v</mi></msub></math></mjx-assistive-mml></mjx-container> is the sum of relationship weights for <em>v</em>.</p>
        </li>
        </ul>
        </li>
        <li>
        <p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="25" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="7.797ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 3446.1 1000" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.566ex;"><defs><path id="MJX-26-TEX-I-1D6FF" d="M195 609Q195 656 227 686T302 717Q319 716 351 709T407 697T433 690Q451 682 451 662Q451 644 438 628T403 612Q382 612 348 641T288 671T249 657T235 628Q235 584 334 463Q401 379 401 292Q401 169 340 80T205 -10H198Q127 -10 83 36T36 153Q36 286 151 382Q191 413 252 434Q252 435 245 449T230 481T214 521T201 566T195 609ZM112 130Q112 83 136 55T204 27Q233 27 256 51T291 111T309 178T316 232Q316 267 309 298T295 344T269 400L259 396Q215 381 183 342T137 256T118 179T112 130Z"></path><path id="MJX-26-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-26-TEX-I-1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path id="MJX-26-TEX-I-1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-26-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-26-TEX-I-1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path><path id="MJX-26-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mi"><use data-c="1D6FF" xlink:href="#MJX-26-TEX-I-1D6FF"></use></g><g data-mml-node="mo" transform="translate(444,0)"><use data-c="28" xlink:href="#MJX-26-TEX-N-28"></use></g><g data-mml-node="msub" transform="translate(833,0)"><g data-mml-node="mi"><use data-c="1D450" xlink:href="#MJX-26-TEX-I-1D450"></use></g><g data-mml-node="mi" transform="translate(466,-150) scale(0.707)"><use data-c="1D462" xlink:href="#MJX-26-TEX-I-1D462"></use></g></g><g data-mml-node="mo" transform="translate(1753.5,0)"><use data-c="2C" xlink:href="#MJX-26-TEX-N-2C"></use></g><g data-mml-node="msub" transform="translate(2198.1,0)"><g data-mml-node="mi"><use data-c="1D450" xlink:href="#MJX-26-TEX-I-1D450"></use></g><g data-mml-node="mi" transform="translate(466,-150) scale(0.707)"><use data-c="1D463" xlink:href="#MJX-26-TEX-I-1D463"></use></g></g><g data-mml-node="mo" transform="translate(3057.1,0)"><use data-c="29" xlink:href="#MJX-26-TEX-N-29"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" display="inline"><mrow><mi>δ</mi><mo>(</mo><msub><mi>c</mi><mi>u</mi></msub><mo>,</mo><msub><mi>c</mi><mi>v</mi></msub><mo>)</mo></mrow></math></mjx-assistive-mml></mjx-container> is equal to 1 if <em>u</em> and <em>v</em> are assigned to the same community, and 0 if they are not.</p>
        </li>
        </ul>
        
        <p>Another part of that first step evaluates the change in modularity if a node is moved to another group.
        Louvain uses a more complicated variation of this formula and then determines the best group assignment.<a data-type="indexterm" data-startref="ix_ch06-adoc21" id="idm46681364987480"></a><a data-type="indexterm" data-startref="ix_ch06-adoc20" id="idm46681364986776"></a><a data-type="indexterm" data-startref="ix_ch06-adoc19" id="idm46681364986104"></a></p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="When Should I Use Louvain?"><div class="sect2" id="idm46681365139512">
        <h2>When Should I Use Louvain?</h2>
        
        <p><a data-type="indexterm" data-primary="Louvain Modularity algorithm" data-secondary="when to use" id="idm46681364984184"></a>Use Louvain Modularity to find communities in vast networks.
        This algorithm applies a heuristic, as opposed to exact, modularity, which is computationally expensive.
        Louvain can therefore be used on large graphs where standard modularity algorithms may struggle.</p>
        
        <p>Louvain is also very helpful for evaluating the structure of complex networks, in particular uncovering many levels of hierarchies–such as what you might find in a criminal organization.
        The algorithm can provide results where you can zoom in on different levels of granularity and find subcommunities within subcommunities within subcommunities.</p>
        
        <p>Example use cases include:</p>
        
        <ul>
        <li>
        <p>Detecting cyberattacks.
        The Louvain algorithm was used in a <a href="https://bit.ly/2FAxalS">2016 study by S. V. Shanbhaq</a> of fast community detection in large-scale cybernetworks for cybersecurity applications. Once these communities have been detected they can be used to detect cyberattacks.</p>
        </li>
        <li>
        <p>Extracting topics from online social platforms, like Twitter and YouTube, based on the co-occurence of terms in documents as part of the topic modeling process.
        This approach is described in a paper by G. S. Kido, R. A. Igawa, and S. Barbon Jr., <a href="http://bit.ly/2UbCCUl">“Topic Modeling Based on Louvain Method in Online Social Networks”</a>.</p>
        </li>
        <li>
        <p>Finding hierarchical community structures within the brain’s functional network, as described in <a href="https://bit.ly/2HFHXxu">“Hierarchical Modularity in Human Brain Functional Networks”</a> by D. Meunier et al.</p>
        </li>
        </ul>
        <div data-type="warning" epub:type="warning"><h6>Warning</h6>
        <p>Modularity optimization algorithms, including Louvain, suffer from two issues.
        First, the algorithms can overlook small communities within large networks.
        You can overcome this problem by reviewing the intermediate consolidation steps.
        Second, in large graphs with overlapping communities, modularity optimizers may not correctly determine the global maxima.
        In the latter case, we recommend using any modularity algorithm as a guide for gross estimation but not complete accuracy.</p>
        </div>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Louvain with Neo4j"><div class="sect2" id="idm46681364974296">
        <h2>Louvain with Neo4j</h2>
        
        <p><a data-type="indexterm" data-primary="Louvain Modularity algorithm" data-secondary="with Neo4j" id="ix_ch06-adoc23"></a><a data-type="indexterm" data-primary="Neo4j" data-secondary="Louvain Modularity with" id="ix_ch06-adoc24"></a>Let’s see the Louvain algorithm in action.
        Louvain takes in a config map with the following keys:</p>
        <dl>
        <dt><code>nodeProjection</code></dt>
        <dd>
        <p>Enables the mapping of specific kinds of nodes into the in-memory graph. We can declare one or more node labels.</p>
        </dd>
        <dt><code>relationshipProjection</code></dt>
        <dd>
        <p>Enables the mapping of relationship types into the in-memory graph. We can declare one or more relationship types along with direction and properties.</p>
        </dd>
        <dt><code>includeIntermediateCommunities</code></dt>
        <dd>
        <p>Indicates whether to write intermediate communities. If set to false, only the final community is persisted.</p>
        </dd>
        </dl>
        
        <p>We can execute the following query to run the algorithm over our graph:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="n">CALL gds.louvain.stream({</code>
        <code class="n">    nodeProjection: </code><code class="s2">"Library"</code><code class="n">,</code>
        <code class="n">    relationshipProjection: </code><code class="s2">"DEPENDS_ON"</code><code class="n">,</code>
        <code class="n">    includeIntermediateCommunities: </code><code class="no">true</code><code class="n"></code>
        <code class="n">})</code>
        <code class="n">YIELD nodeId, communityId, intermediateCommunityIds</code>
        <code class="k">RETURN </code><code class="n">gds.util.asNode(nodeId).</code><code class="nf">id </code><code class="k">AS </code><code class="n">libraries,</code>
        <code class="n">       communityId, intermediateCommunityIds;</code></pre>
        
        <p>These are the results:</p>
        <table>
        
        <thead>
        <tr>
        <th>libraries</th>
        <th>communityId</th>
        <th>intermediateCommunityIds</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>“ipykernel”</p></td>
        <td><p>0</p></td>
        <td><p>[0, 0]</p></td>
        </tr>
        <tr>
        <td><p>“jpy-client”</p></td>
        <td><p>0</p></td>
        <td><p>[2, 0]</p></td>
        </tr>
        <tr>
        <td><p>“jpy-core”</p></td>
        <td><p>0</p></td>
        <td><p>[2, 0]</p></td>
        </tr>
        <tr>
        <td><p>“six”</p></td>
        <td><p>5</p></td>
        <td><p>[3, 5]</p></td>
        </tr>
        <tr>
        <td><p>“pandas”</p></td>
        <td><p>5</p></td>
        <td><p>[7, 5]</p></td>
        </tr>
        <tr>
        <td><p>“numpy”</p></td>
        <td><p>5</p></td>
        <td><p>[5, 5]</p></td>
        </tr>
        <tr>
        <td><p>“python-dateutil”</p></td>
        <td><p>5</p></td>
        <td><p>[3, 5]</p></td>
        </tr>
        <tr>
        <td><p>“pytz”</p></td>
        <td><p>5</p></td>
        <td><p>[7, 5]</p></td>
        </tr>
        <tr>
        <td><p>“pyspark”</p></td>
        <td><p>11</p></td>
        <td><p>[11, 11]</p></td>
        </tr>
        <tr>
        <td><p>“matplotlib”</p></td>
        <td><p>5</p></td>
        <td><p>[3, 5]</p></td>
        </tr>
        <tr>
        <td><p>“spacy”</p></td>
        <td><p>5</p></td>
        <td><p>[5, 5]</p></td>
        </tr>
        <tr>
        <td><p>“py4j”</p></td>
        <td><p>11</p></td>
        <td><p>[11, 11]</p></td>
        </tr>
        <tr>
        <td><p>“jupyter”</p></td>
        <td><p>0</p></td>
        <td><p>[2, 0]</p></td>
        </tr>
        <tr>
        <td><p>“jpy-console”</p></td>
        <td><p>0</p></td>
        <td><p>[2, 0]</p></td>
        </tr>
        <tr>
        <td><p>“nbconvert”</p></td>
        <td><p>0</p></td>
        <td><p>[2, 0]</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>The <code>intermediateCommunityIds</code> column describes the community that nodes fall into at two levels.
        The last value in the array is the final community and the other one is an intermediate community.</p>
        
        <p>The numbers assigned to the intermediate and final communities are simply labels with no measurable meaning.
        Treat these as labels that indicate which community nodes belong to such as “belongs to a community labeled 0”, “a community labeled 4”, and so forth.</p>
        
        <p>For example, matplotlib has a result of <code>[3,5]</code>.
        This means that matplotlib’s final community is labeled <code>5</code> and its intermediate community is labeled <code>3</code>.</p>
        
        <p>The <code>communityId</code> column returns the final community for each node.</p>
        
        <p>We can also store the final and intermediate communities using the write version of the algorithm and then query the results afterwards.</p>
        
        <p>The following query will run the Louvain algorithm and store the list of communities in the <code>communities</code> property on each node:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="n">CALL gds.louvain.write({</code>
        <code class="n">    nodeProjection: </code><code class="s2">"Library"</code><code class="n">,</code>
        <code class="n">    relationshipProjection: </code><code class="s2">"DEPENDS_ON"</code><code class="n">,</code>
        <code class="n">    includeIntermediateCommunities: </code><code class="no">true</code><code class="n">,</code>
        <code class="n">    writeProperty: </code><code class="s2">"communities"</code><code class="n"></code>
        <code class="n">});</code></pre>
        
        <p>And the following query will run the Louvain algorithm and store the final community in the <code>finalCommunity</code> property on each node:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="n">CALL gds.louvain.write({</code>
        <code class="n">    nodeProjection: </code><code class="s2">"Library"</code><code class="n">,</code>
        <code class="n">    relationshipProjection: </code><code class="s2">"DEPENDS_ON"</code><code class="n">,</code>
        <code class="n">    includeIntermediateCommunities: </code><code class="no">false</code><code class="n">,</code>
        <code class="n">    writeProperty: </code><code class="s2">"finalCommunity"</code><code class="n"></code>
        <code class="n">});</code></pre>
        
        <p>Once we’ve run these two procedures, we can write the following query to explore the final clusters:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="k">MATCH</code><code class="n"> (l:Library)</code>
        <code class="k">RETURN </code><code class="n">l.finalCommunity </code><code class="k">AS </code><code class="n">community, </code><code class="nf">collect</code><code class="n">(l.</code><code class="nf">id</code><code class="n">) </code><code class="k">AS </code><code class="n">libraries</code>
        <code class="k">ORDER BY </code><code class="n">size(libraries) </code><code class="k">DESC</code><code class="n">;</code></pre>
        
        <p>Running the query yields this output:</p>
        <table>
        
        <thead>
        <tr>
        <th>community</th>
        <th>libraries</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>5</p></td>
        <td><p>["six”, “pandas”, “numpy”, “python-dateutil”, “pytz”, “matplotlib”, “spacy"]</p></td>
        </tr>
        <tr>
        <td><p>0</p></td>
        <td><p>["ipykernel”, “jpy-client”, “jpy-core”, “jupyter”, “jpy-console”, “nbconvert"]</p></td>
        </tr>
        <tr>
        <td><p>11</p></td>
        <td><p>["pyspark”, “py4j"]</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>This clustering is the same as we saw with the connected components algorithm.</p>
        
        <p>matplotlib is in a community with pytz, spacy, six, pandas, numpy, and python-dateutil.
        We can see this more clearly in <a data-type="xref" href="#louvain_level_2_image">Figure&nbsp;6-13</a>.</p>
        
        <figure><div id="louvain_level_2_image" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/gral_0613.png" alt="gral 0613" width="2928" height="3073">
        <h6><span class="label">Figure 6-13. </span>Clusters found by the Louvain algorithm</h6>
        </div></figure>
        
        <p class="pagebreak-before">An additional feature of the Louvain algorithm is that we can see the intermediate clustering as well.
        The following query will show us finer-grained clusters than the final layer did:</p>
        
        <pre data-type="programlisting" data-code-language="cypher"><code class="k">MATCH</code><code class="n"> (l:Library)</code>
        <code class="k">RETURN </code><code class="n">l.communities[0] </code><code class="k">AS </code><code class="n">community, </code><code class="nf">collect</code><code class="n">(l.</code><code class="nf">id</code><code class="n">) </code><code class="k">AS </code><code class="n">libraries</code>
        <code class="k">ORDER BY </code><code class="n">size(libraries) </code><code class="k">DESC</code><code class="n">;</code></pre>
        
        <p>Running that query gives this output:</p>
        <table>
        
        <thead>
        <tr>
        <th>community</th>
        <th>libraries</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>2</p></td>
        <td><p>["jpy-client”, “jpy-core”, “jupyter”, “jpy-console”, “nbconvert"]</p></td>
        </tr>
        <tr>
        <td><p>3</p></td>
        <td><p>["six”, “python-dateutil”, “matplotlib"]</p></td>
        </tr>
        <tr>
        <td><p>7</p></td>
        <td><p>["pandas”, “pytz"]</p></td>
        </tr>
        <tr>
        <td><p>5</p></td>
        <td><p>["numpy”, “spacy"]</p></td>
        </tr>
        <tr>
        <td><p>11</p></td>
        <td><p>["pyspark”, “py4j"]</p></td>
        </tr>
        <tr>
        <td><p>0</p></td>
        <td><p>["ipykernel"]</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>The libraries in the matplotlib community have now broken down into three smaller communities:</p>
        
        <ul>
        <li>
        <p>matplotlib, python-dateutil, and six</p>
        </li>
        <li>
        <p>pandas and pytz</p>
        </li>
        <li>
        <p>numpy and spacy</p>
        </li>
        </ul>
        
        <p>We can see this breakdown visually in <a data-type="xref" href="#louvain_level_2_image_2">Figure&nbsp;6-14</a>.</p>
        
        <figure><div id="louvain_level_2_image_2" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492047674/files/assets/gral_0614.png" alt="gral 0614" width="2855" height="3222">
        <h6><span class="label">Figure 6-14. </span>Intermediate clusters found by the Louvain algorithm</h6>
        </div></figure>
        
        <p>Although this graph only showed two layers of hierarchy, if we ran this algorithm on a larger graph we would see a more complex hierarchy.
        The intermediate clusters that Louvain reveals can be very useful for detecting fine-grained communities that may not be detected by other community detection algorithms<a data-type="indexterm" data-startref="ix_ch06-adoc24" id="idm46681364716664"></a><a data-type="indexterm" data-startref="ix_ch06-adoc23" id="idm46681364715960"></a>.<a data-type="indexterm" data-startref="ix_ch06-adoc18" id="idm46681364715160"></a><a data-type="indexterm" data-startref="ix_ch06-adoc17" id="idm46681364714456"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" class="less_space pagebreak-before" data-pdf-bookmark="Validating Communities"><div class="sect1" id="idm46681364973384">
        <h1>Validating Communities</h1>
        
        <p><a data-type="indexterm" data-primary="community detection algorithms" data-secondary="validating communities" id="idm46681364712488"></a>Community detection algorithms generally have the same goal: to identify groups.
        However, because different algorithms begin with different assumptions, they may uncover different communities.
        This makes choosing the right algorithm for a particular problem more challenging and a bit of an exploration.</p>
        
        <p>Most community detection algorithms do reasonably well when relationship density is high within groups compared to their surroundings, but real-world networks are often less distinct.
        We can validate the accuracy of the communities found by comparing our results to a benchmark based on data with known communities.</p>
        
        <p><a data-type="indexterm" data-primary="Girvan–Newman (GN) benchmark" id="idm46681364690856"></a><a data-type="indexterm" data-primary="Lancichinetti–Fortunato–Radicchi (LFR) benchmark" id="idm46681364690248"></a>Two of the best-known benchmarks are the Girvan-Newman (GN) and Lancichinetti–Fortunato–Radicchi (LFR) algorithms.
        The reference networks that these algorithms generate are quite different: GN generates a random network which is more homogeneous, whereas LFR creates a more heterogeneous graph where node degrees and community size are distributed according to a power law.</p>
        
        <p>Since the accuracy of our testing depends on the benchmark used, it’s important to match our benchmark to our dataset. As much as possible, look for similar densities, relationship distributions, community definitions, and related domains.<a data-type="indexterm" data-startref="ix_ch06-adoc0" id="idm46681364688472"></a></p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm46681364687672">
        <h1>Summary</h1>
        
        <p>Community detection algorithms are useful for understanding the way that nodes are grouped together in a graph.</p>
        
        <p>In this chapter, we started by learning about the Triangle Count and Clustering Coefficient algorithms. We then moved on to two deterministic community detection algorithms: Strongly Connected Components and Connected Components.
        These algorithms have strict definitions of what constitutes a community and are very useful for getting a feel for the graph structure early in the graph analytics pipeline.</p>
        
        <p>We finished with Label Propagation and Louvain, two nondeterministic algorithms which are better able to detect finer-grained communities.
        Louvain also showed us a hierarchy of communities at different scales.</p>
        
        <p>In the next chapter, we’ll take a much larger dataset and learn how to combine the algorithms together to gain even more insight into our connected data.</p>
        </div></section>
        
        
        
        
        
        
        
        </div></section></div></div><link rel="stylesheet" href="/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="/api/v2/epubs/urn:orm:book:9781492047674/files/epub.css" crossorigin="anonymous"><script src="https://learning.oreilly.comhttps://cdn.jsdelivr.net/npm/mathjax@3/es5/mml-svg.js"></script></div></div></section>
</div>

https://learning.oreilly.com