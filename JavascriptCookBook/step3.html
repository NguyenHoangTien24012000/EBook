<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
    
</style>
<link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492092506/files/epub.css" crossorigin="anonymous">
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 3. Numbers"><div class="chapter" id="ch03">
        <h1><span class="label">Chapter 3. </span>Numbers</h1>
        
        
        <p><a data-type="indexterm" data-primary="numbers" id="ix_numbers_ch3"></a>There are few ingredients more essential to everyday programming than numbers. Many modern languages have a set of different numeric data types to use in different scenarios, like integers, decimals, floating point values, and so on. But when it comes to numbers, JavaScript reveals its rushed, slightly improvised creation as a loosely-typed scripting language.</p>
        
        <p><a data-type="indexterm" data-primary="Number type" id="idm45475177755816"></a>Until recently, JavaScript had just a single do-everything numeric data type called <code>Number</code>. <a data-type="indexterm" data-primary="BigInt type" id="idm45475177754376"></a>Today, it has two: the standard <code>Number</code> you use almost all of the time, and the very specialized <code>BigInt</code> that you only consider when you need to deal with huge whole numbers. You’ll use both in this chapter, along with the utility methods of the <code>Math</code> object.</p>
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Generating Random Numbers"><div class="sect1" id="generating_random_numbers">
        <h1>Generating Random Numbers</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475177750616">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="Math object" id="ix_math_object"></a><a data-type="indexterm" data-primary="random numbers, generating" id="ix_random_nun_gen"></a><a data-type="indexterm" data-primary="numbers" data-secondary="generating random" id="ix_numbers_gen_random"></a>You want to generate a random whole number that falls in a set range (for example, from 1 to 6).</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475177745816">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="random() method" id="idm45475177744408"></a>You can use the <code>Math.random()</code> method to generate a floating-point value between 0 and 1. Usually, you’ll scale this fractional value and round it, so you end up with an integer in a specific range. Assuming your range spans from some minimum number <code>min</code> to a maximum number <code>max</code>, here’s the statement you need:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">randomNumber</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">floor</code><code class="p">(</code><code class="nb">Math</code><code class="p">.</code><code class="nx">random</code><code class="p">()</code> <code class="o">*</code> <code class="p">(</code><code class="nx">max</code> <code class="o">-</code> <code class="nx">min</code> <code class="o">+</code> <code class="mi">1</code><code class="p">)</code> <code class="p">)</code> <code class="o">+</code> <code class="nx">min</code><code class="p">;</code></pre>
        
        <p>For example, if you want to pick a random number between 1 and 6, the code becomes:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">randomNumber</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">floor</code><code class="p">(</code><code class="nb">Math</code><code class="p">.</code><code class="nx">random</code><code class="p">()</code><code class="o">*</code><code class="mi">6</code><code class="p">)</code> <code class="o">+</code> <code class="mi">1</code><code class="p">;</code></pre>
        
        <p>Now possible values of <code>randomNumber</code> are 1, 2, 3, 4, 5, or 6.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475177640440">
        <h2>Discussion</h2>
        
        <p>The <code>Math</code> object is stocked full of static utility methods you can call at any time. <a data-type="indexterm" data-primary="floor() method" id="idm45475177638520"></a>This recipe uses <code>Math.random()</code> to get a random fractional number, and <code>Math.floor()</code> to truncate the decimal portion, leaving you with an integer.</p>
        
        <p>To understand how this works, let’s consider a sample run-through. First, <code>Math.random()</code> picks a value between 0 and 1, like <em>0.374324823</em>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">randomNumber</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">floor</code><code class="p">(</code><code class="mf">0.374324823</code><code class="o">*</code><code class="mi">6</code><code class="p">)</code> <code class="o">+</code> <code class="mi">1</code><code class="p">;</code></pre>
        
        <p>That number is multiplied by the number of values in your range (in this example, 6), becoming <em>2.245948938</em>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">randomNumber</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">floor</code><code class="p">(</code><code class="mf">2.245948938</code><code class="p">)</code> <code class="o">+</code> <code class="mi">1</code><code class="p">;</code></pre>
        
        <p>Then the <code>Math.floor()</code> function truncates this to just <em>2</em>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">randomNumber</code> <code class="o">=</code> <code class="mi">2</code> <code class="o">+</code> <code class="mi">1</code><code class="p">;</code></pre>
        
        <p>Finally, the starting number of the range is added, giving the final result of <em>3</em>. Repeat this calculation and you’ll get a different number, but it will always be an integer from the range we’ve set of 1 to 6.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45475177550872">
        <h2>See Also</h2>
        
        <p>The <code>Math.floor()</code> method is only one way to round numbers. See <a data-type="xref" href="#rounding_specific_decimal">“Rounding to a Specific Decimal Place”</a> for more.</p>
        
        <p><a data-type="indexterm" data-primary="numbers" data-secondary="pseudorandom generator" id="idm45475177565336"></a><a data-type="indexterm" data-primary="pseudorandom number generator" id="idm45475177564136"></a>It’s important to understand that numbers generated by <code>Math.random()</code> are <em>pseudorandom</em>, which means they can be guessed or reverse engineered. They are not random enough for cryptography, lotteries, or complex modelling. For more about the difference, see <a data-type="xref" href="#generating_secure_random_numbers">“Generating Cryptographically Secure Random Numbers”</a>. And if you need a way to generate a repeatable sequence of pseudorandom numbers, refer to <a data-type="xref" href="ch06.html#repeatable_PRNG">“Extra: Building a Repeatable Pseudorandom Number Generator”</a>.</p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Generating Cryptographically Secure Random Numbers"><div class="sect1" id="generating_secure_random_numbers">
        <h1>Generating Cryptographically Secure Random Numbers</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475177559016">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="numbers" data-secondary="cryptograpically secure random" id="ix_numbers_crypto_sec_random"></a><a data-type="indexterm" data-primary="cryptograpically secure random numbers" id="ix_crypto_sec_random_num"></a>You want to create a random number that can’t be easily reverse engineered (guessed).</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475177530360">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="getRandomValues() method" id="ix_getrandomvalue"></a><a data-type="indexterm" data-primary="window.crypt property" id="idm45475177527848"></a><a data-type="indexterm" data-primary="Crypto object" id="idm45475177527176"></a>Use the <code>window.crypto</code> property to get an instance of the <code>Crypto</code> object. Use the <code>Crypto.getRandomValues()</code> method to generate random values that have more <em>entropy</em> than those produced by <code>Math.random()</code>. (In other words, they are much less likely to be repeated or predicted—see the Discussion section for full details.)</p>
        
        <p>The <code>Crypto.getRandomValues()</code> method works differently from <code>Math.random()</code>. Rather than giving you a floating-point number between 0 and 1, <code>getRandomValues()</code> fills an array with random integers. You can choose whether these integers are 8-bit, 16-bit, or 32-bit, and whether they are signed or unsigned. (A signed data type can be negative or positive, whereas an unsigned number is only positive.)</p>
        
        <p>There is an accepted workaround to convert the output of <code>getRandomValues()</code> to a fractional value between 0 and 1. The trick is to divide the random value by the maximum possible number that data type can contain:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">randomBuffer</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Uint32Array</code><code class="p">(</code><code class="mi">1</code><code class="p">);</code>
        <code class="nb">window</code><code class="p">.</code><code class="nx">crypto</code><code class="p">.</code><code class="nx">getRandomValues</code><code class="p">(</code><code class="nx">randomBuffer</code><code class="p">);</code>
        <code class="kr">const</code> <code class="nx">randomFraction</code> <code class="o">=</code> <code class="nx">randomBuffer</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code> <code class="o">/</code> <code class="p">(</code><code class="mh">0xffffffff</code> <code class="o">+</code> <code class="mi">1</code><code class="p">);</code></pre>
        
        <p>You can now work with <code>randomFraction</code> in the same way that you work with the number returned from <code>Math.random()</code>. For example, you can convert it to a random integer in a specific range, as explained in <a data-type="xref" href="#generating_random_numbers">“Generating Random Numbers”</a>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="c1">// Use the random fraction to make a random integer from 1-6</code>
        <code class="kr">const</code> <code class="nx">randomNumber</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">floor</code><code class="p">(</code><code class="nx">randomFraction</code><code class="o">*</code><code class="mi">6</code><code class="p">)</code> <code class="o">+</code> <code class="mi">1</code><code class="p">;</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">randomNumber</code><code class="p">);</code></pre>
        
        <p><a data-type="indexterm" data-primary="Node" data-secondary="Web Crypto API" id="idm45475177455560"></a><a data-type="indexterm" data-primary="Web Crypto API" id="idm45475177408408"></a>If you’re running your code in the Node.js runtime environment, you won’t have access to a <code>window</code> object. However, you can get access to a very similar implementation of the Web Crypto API using this code:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">crypto</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'crypto'</code><code class="p">).</code><code class="nx">webcrypto</code><code class="p">;</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475177530056">
        <h2>Discussion</h2>
        
        <p>There’s a lot to unpack in this example. First, even if you don’t dig deeper into <em>how</em> this code works, you need to be aware of a few important details about the implementation of <code>Crypto.getRandomValues()</code>:</p>
        
        <ul>
        <li>
        <p>Technically, <code>Crypto</code> creates pseudorandom numbers that are generated by a mathematical formula, like those provided by <code>Math.random()</code>. The difference is that these numbers are considered <em>cryptographically strong</em>, because the random number generator is seeded with a truly random value. The benefit of this trade-off is that <code>getRandomValues()</code> has similar performance to <code>Math.random()</code>. (It’s fast.)</p>
        </li>
        <li>
        <p>There’s no way to know how the <code>Crypto</code> object is seeded, because that’s up to the implementation (for web page code, that means the browser manufacturer), which in turn relies on functionality in the operating system. Usually, the seed is created using a combination of recently recorded details about keyboard timings, mouse movements, and hardware readings.</p>
        </li>
        <li>
        <p>No matter how good your random numbers are, if your JavaScript code is running in a browser, it’s exposed to a great number of attacks. After all, there’s nothing to stop a malicious party from seeing your code and creating an altered copy that bypasses all random number generation. If your code is running on a server, the situation is different.</p>
        </li>
        </ul>
        
        <p>Now let’s look closer at how <code>getRandomValues()</code> works. Before you call <code>getRandomValues()</code>, you must create a <em>typed array</em>, which is an array-like object that can only hold values of a specific data type. (We say <em>array-like</em> because it behaves like an array, but it isn’t an instance of the official <code>Array</code> type.) JavaScript provides several strongly typed array objects you can use: like <code>Uint32Array</code> (for an array of unsigned 32-bit integers), <code>Uint16Array</code>, <code>Uint8Array</code>, and the signed counterparts <code>Int32Array</code>, <code>Int16Array</code>, and <code>Int8Array</code>. You create this array to be as big as you want, and <code>getRandomValues()</code> will fill the whole buffer.</p>
        
        <p>In this recipe, we make room for just one value in the <code>Uint32Array</code>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">randomBuffer</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Uint32Array</code><code class="p">(</code><code class="mi">1</code><code class="p">);</code>
        <code class="nb">window</code><code class="p">.</code><code class="nx">crypto</code><code class="p">.</code><code class="nx">getRandomValues</code><code class="p">(</code><code class="nx">randomBuffer</code><code class="p">);</code></pre>
        
        <p>The final step is to divide this random value by the maximum possible unsigned 32-bit integer, which is
        4,294,967,295. This number is cleaner in its hexadecimal representation, <code>0xffffffff</code>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">randomFraction</code> <code class="o">=</code> <code class="nx">randomBuffer</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code> <code class="o">/</code> <code class="p">(</code><code class="mh">0xffffffff</code> <code class="o">+</code> <code class="mi">1</code><code class="p">);</code></pre>
        
        <p class="pagebreak-before less_space">As this code shows, you also need to add 1 to the maximum value. That’s because the random value could theoretically land exactly on the maximum integer value. If it did, the <code>randomFraction</code> would become 1, which differs from <code>Math.random()</code> and most other random number generators. (And a tiny unexpected variation from the norm is something that can lead to a incorrect assumption, and then a bug further down the road.)<a data-type="indexterm" data-primary="" data-startref="ix_numbers_gen_random" id="idm45475177331032"></a><a data-type="indexterm" data-primary="" data-startref="ix_random_nun_gen" id="idm45475177330152"></a><a data-type="indexterm" data-primary="" data-startref="ix_crypto_sec_random_num" id="idm45475177329208"></a><a data-type="indexterm" data-primary="" data-startref="ix_numbers_crypto_sec_random" id="idm45475177328296"></a><a data-type="indexterm" data-primary="" data-startref="ix_getrandomvalue" id="idm45475177327384"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Rounding to a Specific Decimal Place"><div class="sect1" id="rounding_specific_decimal">
        <h1>Rounding to a Specific Decimal Place</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475177279528">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="rounding numbers to specific decimal place" id="ix_round_num_dec"></a><a data-type="indexterm" data-primary="numbers" data-secondary="rounding to specific decimal place" id="ix_numbers_round_dec"></a>You want to round a number to a certain precision (for example, 124.793 to 124.80 or 120).</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475177275704">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="round() method" id="idm45475177274296"></a>You can use the <code>Math.round()</code> method to round a number to the nearest whole <span class="keep-together">number</span>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">fractionalNumber</code> <code class="o">=</code> <code class="mf">19.48938</code><code class="p">;</code>
        <code class="kr">const</code> <code class="nx">roundedNumber</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">round</code><code class="p">(</code><code class="nx">fractionalNumber</code><code class="p">);</code>
        
        <code class="c1">// Now roundedNumber is 19</code></pre>
        
        <p>Oddly enough, the <code>round()</code> method doesn’t take an argument that lets you specify a number of decimal places to keep. If you want a different degree of precision, it’s up to you to multiply your number by the appropriate power of 10, round it, and then divide it by the same power of 10 after rounding. Here’s the general formula for this operation:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">numberToRound</code> <code class="o">=</code> <code class="nx">fractionalNumber</code> <code class="o">*</code> <code class="p">(</code><code class="mi">10</code><code class="o">**</code><code class="nx">numberOfDecimalPlaces</code><code class="p">);</code>
        <code class="kd">let</code> <code class="nx">roundedNumber</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">round</code><code class="p">(</code><code class="nx">numberToRound</code><code class="p">);</code>
        <code class="nx">roundedNumber</code> <code class="o">=</code> <code class="nx">roundedNumber</code> <code class="o">/</code> <code class="p">(</code><code class="mi">10</code><code class="o">**</code><code class="nx">numberOfDecimalPlaces</code><code class="p">);</code></pre>
        
        <p>For example, if you want to round to two decimal places, the code becomes this:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">fractionalNumber</code> <code class="o">=</code> <code class="mf">19.48938</code><code class="p">;</code>
        <code class="kr">const</code> <code class="nx">numberToRound</code> <code class="o">=</code> <code class="nx">fractionalNumber</code> <code class="o">*</code> <code class="p">(</code><code class="mi">10</code><code class="o">**</code><code class="mi">2</code><code class="p">);</code>
        <code class="kd">let</code> <code class="nx">roundedNumber</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">round</code><code class="p">(</code><code class="nx">numberToRound</code><code class="p">);</code>
        <code class="nx">roundedNumber</code> <code class="o">=</code> <code class="nx">roundedNumber</code> <code class="o">/</code> <code class="p">(</code><code class="mi">10</code><code class="o">**</code><code class="mi">2</code><code class="p">);</code>
        
        <code class="c1">// Now roundedNumber is 19.49</code></pre>
        
        <p>If you want to round <em>left</em> of decimal place (for example, to the nearest tens, hundreds, and so on), just use a negative number for <code>numberOfDecimalPlaces</code>. For example, –1 rounds to the nearest 10, –2 rounds to the nearest 100, and so on.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475177119096">
        <h2>Discussion</h2>
        
        <p>The <code>Math</code> object has several static methods for turning fractional values into integers. <a data-type="indexterm" data-primary="floor() method" id="idm45475177117272"></a>The <code>floor()</code> method removes all decimal digits, rounding a number down to the nearest whole number. <a data-type="indexterm" data-primary="ceil() method" id="idm45475177115912"></a>The <code>ceil()</code> method does the reverse, and always rounds a fractional number up to the next whole number. The <code>round()</code> method rounds to the closest whole number.</p>
        
        <p>There are two important points you need to know about how <code>round()</code> works:</p>
        
        <ul>
        <li>
        <p>An exact value of 0.5 is always rounded up, even though it is equally distant from both the next lower and next higher integer. In finance and science, different rounding techniques are often used to remove this bias (such as rounding some 0.5 values up and others down). But if you want that behavior in JavaScript, you need to implement it yourself or use a third-party library.</p>
        </li>
        <li>
        <p>When rounding negative numbers, JavaScript rounds –0.5 up <em>toward zero</em>. That means that –4.5 is rounded to –4, which is different than the rounding implementation in many other programming languages.</p>
        </li>
        </ul>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45475177109912">
        <h2>See Also</h2>
        
        <p>Rounding numbers is one way to get a numeric value closer to an appropriate display format. If you’re using rounding to prepare a number to show to a user, you may also be interested in the <code>Number</code> formatting methods described in <a data-type="xref" href="ch02.html#converting_number_to_string">“Converting a Numeric Value to a Formatted String”</a>.<a data-type="indexterm" data-primary="" data-startref="ix_numbers_round_dec" id="idm45475177107160"></a><a data-type="indexterm" data-primary="" data-startref="ix_round_num_dec" id="idm45475177106184"></a><a data-type="indexterm" data-primary="" data-startref="ix_math_object" id="idm45475177105240"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Preserving Accuracy in Decimal Values"><div class="sect1" id="preserving_decimal_accuracy">
        <h1>Preserving Accuracy in Decimal Values</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475177102584">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="decimal values" id="ix_decimal_values"></a><a data-type="indexterm" data-primary="numbers" data-secondary="preserving accuracy in decimal values" id="ix_numbers_acc_dec"></a>All numbers in JavaScript are floating point values, which suffer minute rounding errors with certain operations. In some applications (for example, when dealing with amounts of money), these errors may not be acceptable.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475177098552">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="errors (Error object)" data-secondary="floating point rounding" id="idm45475177097144"></a><a data-type="indexterm" data-primary="floating point rounding errors" id="idm45475177096168"></a>Floating point rounding errors are a well-understood phenomenon that exists in almost every programming language. To see it in JavaScript, run the following code:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">sum</code> <code class="o">=</code> <code class="mf">0.1</code> <code class="o">+</code> <code class="mf">0.2</code><code class="p">;</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">sum</code><code class="p">);</code>      <code class="c1">// displays 0.30000000000000004</code></pre>
        
        <p class="pagebreak-before less_space">You can’t avoid the rounding error, but you can minimize it. If you’re working with a currency type that has two decimal places of precision (like dollars), consider multiplying all values by 100 to avoid dealing with decimals. Instead of writing code like this:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">currentBalance</code> <code class="o">=</code> <code class="mf">5382.23</code><code class="p">;</code>
        <code class="kr">const</code> <code class="nx">transactionAmount</code> <code class="o">=</code> <code class="mf">14.02</code><code class="p">;</code>
        
        <code class="kr">const</code> <code class="nx">updatedBalance</code> <code class="o">=</code> <code class="nx">currentBalance</code> <code class="o">-</code> <code class="nx">transactionAmount</code><code class="p">;</code>
        
        <code class="c1">// Now updatedBalance = 5368.209999999999</code></pre>
        
        <p>Use currency variables like this:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">currentBalanceInCents</code> <code class="o">=</code> <code class="mi">538223</code><code class="p">;</code>
        <code class="kr">const</code> <code class="nx">transactionAmountInCents</code> <code class="o">=</code> <code class="mi">1402</code><code class="p">;</code>
        
        <code class="kr">const</code> <code class="nx">updatedBalanceInCents</code> <code class="o">=</code> <code class="nx">currentBalanceInCents</code> <code class="o">-</code> <code class="nx">transactionAmountInCents</code><code class="p">;</code>
        
        <code class="c1">// Now updatedBalanceInCents = 536821</code></pre>
        
        <p>This solves the problem for operations that work out to exact whole numbers, like adding and subtracting numbers of cents. But what happens when you need to calculate tax or interest? In these situations you’ll end up with fractional values no matter what, and you need to do what businesses and banks do—round your values immediately after your transaction:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">costInCents</code> <code class="o">=</code> <code class="mi">4899</code><code class="p">;</code>
        
        <code class="c1">// Calculate 11% tax, and round the result to the nearest cent</code>
        <code class="kr">const</code> <code class="nx">costWithTax</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">round</code><code class="p">(</code><code class="nx">costInCents</code><code class="o">*</code><code class="mf">1.11</code><code class="p">);</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475176949416">
        <h2>Discussion</h2>
        
        <p>The floating point rounding issue stems from the fact that some decimal values can’t be stored in binary representation without rounding. The same problem occurs with decimal numbering systems (for example, try to write the result of 1/3). The difference with floating point numbers is that the effect is <em>counterintuitive</em>. We don’t expect to have trouble adding 0.1 and 0.2, because in decimal notation both fractions can be represented exactly.</p>
        
        <p>Although other programming languages experience the same phenomenon, many of them include an alternate data type for decimal or currency values. JavaScript does not. <a data-type="indexterm" data-primary="Decimal type" id="idm45475176954696"></a>However, there is a proposal for a <a href="https://github.com/tc39/proposal-decimal">new Decimal type</a>, which could be incorporated into a future version of the JavaScript language.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45475176918952">
        <h2>See Also</h2>
        
        <p>If you perform a lot of financial calculations, you can simplify your life by using a third-party library like <a href="https://github.com/MikeMcl/bignumber.js"><em>bignumber.js</em></a>, which provides a customized numeric data type that works a lot like the ordinary <code>Number</code>, but preserves exact precision for a fixed number of decimal places.<a data-type="indexterm" data-primary="" data-startref="ix_numbers_acc_dec" id="idm45475176916296"></a><a data-type="indexterm" data-primary="" data-startref="ix_decimal_values" id="idm45475176915320"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Converting a String to a Number"><div class="sect1" id="converting_string_to_number">
        <h1>Converting a String to a Number</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475176912728">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="strings (String object)" data-secondary="converting to numbers" id="ix_string_to_number"></a><a data-type="indexterm" data-primary="numbers" data-secondary="converting string to number" id="ix_numbers_string-number"></a>You want to parse a number in a string and convert it to the number data type.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475176908744">
        <h2>Solution</h2>
        
        <p>It’s always safe to convert a number into a string, because that operation can’t fail. The reverse task—converting a string into a number, so you can use it in calculations—is a more delicate affair.</p>
        
        <p><a data-type="indexterm" data-primary="Number() function" id="idm45475176906536"></a>The canonical approach is to use the <code>Number()</code> function:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">stringData</code> <code class="o">=</code> <code class="s1">'42'</code><code class="p">;</code>
        <code class="kr">const</code> <code class="nx">numberData</code> <code class="o">=</code> <code class="nb">Number</code><code class="p">(</code><code class="nx">stringData</code><code class="p">);</code></pre>
        
        <p>The <code>Number()</code> function won’t accept formatting like currency symbols and comma separators. It <em>will</em> allow extra spaces at the beginning and end of the string. The <code>Number()</code> function also converts empty strings or strings with only whitespace to the number 0. This might be a reasonable default (for example, if you’re retrieving user input from a text box), but it’s not always appropriate. To avoid this case, consider testing for a whitespace-only string before you call <code>Number()</code>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="k">if</code> <code class="p">(</code><code class="nx">stringData</code><code class="p">.</code><code class="nx">trim</code><code class="p">()</code> <code class="o">===</code> <code class="s1">''</code><code class="p">)</code> <code class="p">{</code>
          <code class="c1">// This is an all-whitespace or empty string</code>
        <code class="p">}</code></pre>
        
        <p>If a conversion fails, the <code>Number()</code> function assigns the value <code>NaN</code> (for <em>not a number</em>) to your variable. You can test for this failure by calling the <code>Number.isNaN()</code> method immediately after you use <code>Number()</code>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">numberData</code> <code class="o">=</code> <code class="nb">Number</code><code class="p">(</code><code class="nx">stringData</code><code class="p">);</code>
        
        <code class="k">if</code> <code class="p">(</code><code class="nb">Number</code><code class="p">.</code><code class="nb">isNaN</code><code class="p">(</code><code class="nx">numberData</code><code class="p">))</code> <code class="p">{</code>
          <code class="c1">// It's safe to process this data as a number</code>
        <code class="p">}</code></pre>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p><a data-type="indexterm" data-primary="isFinite() method" id="idm45475176855240"></a>The <code>isFinite()</code> method is almost the same as <code>isNaN()</code>, except it avoids strange edge cases, like <code>1/0</code>, which returns a value of <code>infinity</code>. <a data-type="indexterm" data-primary="isNan() method" id="idm45475176852488"></a>If you use the <code>isNaN()</code> method on <code>infinity</code>, it somewhat dubiously returns <code>false</code>.</p>
        </div>
        
        <p>An alternate approach is to use the <code>parseFloat()</code> method. It’s a slightly looser conversion that tolerates text after the number. However, <code>parseFloat()</code> is stricter with blank strings, which it refuses.</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nb">Number</code><code class="p">(</code><code class="s1">'42'</code><code class="p">));</code>               <code class="c1">// 42</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nb">parseFloat</code><code class="p">(</code><code class="s1">'42'</code><code class="p">));</code>           <code class="c1">// 42</code>
        
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nb">Number</code><code class="p">(</code><code class="s1">'12 goats'</code><code class="p">));</code>         <code class="c1">// NaN</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nb">parseFloat</code><code class="p">(</code><code class="s1">'12 goats'</code><code class="p">));</code>     <code class="c1">// 12</code>
        
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nb">Number</code><code class="p">(</code><code class="s1">'goats 12'</code><code class="p">));</code>         <code class="c1">// NaN</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nb">parseFloat</code><code class="p">(</code><code class="s1">'goats 12'</code><code class="p">));</code>     <code class="c1">// NaN</code>
        
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nb">Number</code><code class="p">(</code><code class="s1">'2001/01/01'</code><code class="p">));</code>       <code class="c1">// NaN</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nb">parseFloat</code><code class="p">(</code><code class="s1">'2001/01/01'</code><code class="p">));</code>   <code class="c1">// 2001</code>
        
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nb">Number</code><code class="p">(</code><code class="s1">' '</code><code class="p">));</code>                <code class="c1">// 0</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nb">parseFloat</code><code class="p">(</code><code class="s1">' '</code><code class="p">));</code>            <code class="c1">// NaN</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475176908152">
        <h2>Discussion</h2>
        
        <p><a data-type="indexterm" data-primary="parseFloat() method" id="idm45475176788328"></a>Developers use some conversion tricks that are functionally equivalent to the <span class="keep-together"><code>Number</code>()</span> function, like multiplying a string by 1 (<code>numberInString*1</code>) or using the unary operator (<code>+numberInString</code>). But using <code>Number()</code> or <code>parseFloat()</code> is preferred for clarity.</p>
        
        <p><a data-type="indexterm" data-primary="formatting" data-secondary="numbers" id="idm45475176672328"></a><a data-type="indexterm" data-primary="Intl.NumberFormat object" id="idm45475176671304"></a><a data-type="indexterm" data-primary="numbers" data-secondary="formatting" id="idm45475176670664"></a>If you have a formatted number (like <em>2,300</em>), you need to do more work to convert it. The <code>Number()</code> method will return <code>NaN</code>, and <code>parseFloat()</code> will stop at the comma and treat it as 2. Unfortunately, although JavaScript has an <code>Intl.NumberFormat</code> object that can <em>create</em> formatted strings from numbers (see <a data-type="xref" href="ch02.html#converting_number_to_string">“Converting a Numeric Value to a Formatted String”</a>), it doesn’t provide parsing functionality for the reverse operation.</p>
        
        <p>You can use regular expressions to take care of tasks like removing commas from a string (see <a data-type="xref" href="ch02.html#replacing_all_occurrences_string">“Replacing All Occurrences of a String”</a>). But a home brew solution can be risky, because some locales use commas to separate thousands, while others use them to separate decimals. In situations like these, a well-used, well-tested JavaScript library like <a href="http://numeraljs.com">Numeral</a> is a better choice.<a data-type="indexterm" data-primary="" data-startref="ix_numbers_string-number" id="idm45475176663912"></a><a data-type="indexterm" data-primary="" data-startref="ix_string_to_number" id="idm45475176662936"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" class="pagebreak-before less_space" data-pdf-bookmark="Converting a Decimal to a Hexadecimal Value"><div class="sect1" id="converting_a_decimal_to_a_hexadecimal_va">
        <h1>Converting a Decimal to a Hexadecimal Value</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475176659976">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="hexadecimal to decimal value, converting" id="ix_hex_to_dec"></a><a data-type="indexterm" data-primary="numbers" data-secondary="converting decimal to hexadecimal value" id="ix_numbers_dec_hexadec"></a><a data-type="indexterm" data-primary="decimal values" id="ix_decimal_values2"></a>You have a decimal value, and need to find its hexadecimal equivalent.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475176655144">
        <h2>Solution</h2>
        
        <p><a data-type="indexterm" data-primary="toString() method" data-secondary="Number object" id="idm45475176653976"></a>Use the <code>Number.toString()</code> method, with an argument that specifies the base you are converting <em>to</em>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">num</code> <code class="o">=</code> <code class="mi">255</code><code class="p">;</code>
        
        <code class="c1">// displays ff, which is hexadecimal equivalent for 255</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">num</code><code class="p">.</code><code class="nx">toString</code><code class="p">(</code><code class="mi">16</code><code class="p">));</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475176632968">
        <h2>Discussion</h2>
        
        <p><a data-type="indexterm" data-primary="octal numbers" id="idm45475176639608"></a>By default, numbers in JavaScript are base 10, or decimal. However, they can also be converted to a different <em>radix<a data-type="indexterm" data-primary="radix" id="idm45475176638392"></a></em>, including hexadecimal (16) and octal (8). Hexadecimal numbers begin with <code>0x</code> (a zero followed by lowercase x). Octal numbers used to begin with just a zero (0), but now should begin with a zero and then a Latin letter <em>O</em> (upper or lowercase):</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">octalNumber</code> <code class="o">=</code> <code class="mo">0o255</code><code class="p">;</code>  <code class="c1">// equivalent to 173 decimal</code>
        <code class="kr">const</code> <code class="nx">hexaNumber</code> <code class="o">=</code> <code class="mh">0xad</code><code class="p">;</code>    <code class="c1">// equivalent to 173 decimal</code></pre>
        
        <p>A decimal number can be converted to another radix, in a range from 2 to 36:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">decNum</code> <code class="o">=</code> <code class="mi">55</code><code class="p">;</code>
        <code class="kr">const</code> <code class="nx">octNum</code> <code class="o">=</code> <code class="nx">decNum</code><code class="p">.</code><code class="nx">toString</code><code class="p">(</code><code class="mi">8</code><code class="p">);</code>   <code class="c1">// value of 67 octal</code>
        <code class="kr">const</code> <code class="nx">hexNum</code> <code class="o">=</code> <code class="nx">decNum</code><code class="p">.</code><code class="nx">toString</code><code class="p">(</code><code class="mi">16</code><code class="p">);</code>  <code class="c1">// value of 37 hexadecimal</code>
        <code class="kr">const</code> <code class="nx">binNum</code> <code class="o">=</code> <code class="nx">decNum</code><code class="p">.</code><code class="nx">toString</code><code class="p">(</code><code class="mi">2</code><code class="p">);</code>   <code class="c1">// value of 110111 binary</code></pre>
        
        <p>To complete the octal and hexadecimal presentation, you’ll need to concatenate the <code>0o</code> to the octal, and the <code>0x</code> to the hexadecimal value. But remember, once you’ve converted your number into a string, don’t expect to use it in any sort of numeric calculation, no matter how it’s formatted.</p>
        
        <p>Although decimals can be converted to any base number (between a range of 2 to 36), only the octal, hexadecimal, and decimal numbers can be manipulated directly as numbers.<a data-type="indexterm" data-primary="" data-startref="ix_decimal_values2" id="idm45475176470728"></a><a data-type="indexterm" data-primary="" data-startref="ix_numbers_dec_hexadec" id="idm45475176469784"></a><a data-type="indexterm" data-primary="" data-startref="ix_hex_to_dec" id="idm45475176468840"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Converting Between Degrees and Radians"><div class="sect1" id="converting_degress_to_radians">
        <h1>Converting Between Degrees and Radians</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475176466376">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="degrees, converting to radians" id="idm45475176465176"></a><a data-type="indexterm" data-primary="radians, converting to degrees" id="idm45475176464504"></a><a data-type="indexterm" data-primary="numbers" data-secondary="converting between degrees and radians" id="idm45475176463864"></a>You have an angle in degrees. <a data-type="indexterm" data-primary="Math object" id="idm45475176462776"></a>To use the value in the <code>Math</code> object’s trigonometric functions, you need to convert the degrees to radians.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475176461288">
        <h2>Solution</h2>
        
        <p>To convert degrees to radians, multiply the degree value by <code>(Math.PI/180)</code>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">radians</code> <code class="o">=</code> <code class="nx">degrees</code> <code class="o">*</code> <code class="p">(</code><code class="nb">Math</code><code class="p">.</code><code class="nx">PI</code> <code class="o">/</code> <code class="mi">180</code><code class="p">);</code></pre>
        
        <p>So if you have a 90 degree angle, the calculation becomes:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">radians</code> <code class="o">=</code> <code class="mi">90</code> <code class="o">*</code> <code class="p">(</code><code class="nb">Math</code><code class="p">.</code><code class="nx">PI</code> <code class="o">/</code> <code class="mi">180</code><code class="p">);</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">radians</code><code class="p">);</code>   <code class="c1">// 1.5707963267948966</code></pre>
        
        <p>To convert radians to degrees, multiply the radians value by <code>(180/Math.PI)</code>:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">degrees</code> <code class="o">=</code> <code class="nx">radians</code> <code class="o">*</code> <code class="p">(</code><code class="mi">180</code> <code class="o">/</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">PI</code><code class="p">);</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475176460952">
        <h2>Discussion</h2>
        
        <p>All the trigonometric methods of the <code>Math</code> object (<code>sin()</code>, <code>cos()</code>, <code>tan()</code>, <code>asin()</code>, <code>acos()</code>, <code>atan()</code>, and <code>atan2()</code>) take values in radians, and return radians as a result. Yet it’s not unusual for people to provide values in degrees rather than radians, as degrees are the more familiar unit of measure.</p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Calculating the Length of a Circular Arc"><div class="sect1" id="calculating_the_length_of_a_circular_arc">
        <h1>Calculating the Length of a Circular Arc</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475176372568">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="numbers" data-secondary="calculating circular arc length" id="idm45475176371368"></a><a data-type="indexterm" data-primary="circular arc length, calculating" id="idm45475176331832"></a><a data-type="indexterm" data-primary="arc length, calculating" id="idm45475176331192"></a>Given the radius of a circle, and the angle of an arc in degrees, find the length of the arc.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475176330024">
        <h2>Solution</h2>
        
        <p>Use <code>Math.PI</code> to convert degrees to radians, and use the result in a formula to find the length of the arc:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="c1">// angle of arc is 120 degrees, radius of circle is 2</code>
        <code class="kr">const</code> <code class="nx">radians</code> <code class="o">=</code> <code class="nx">degrees</code> <code class="o">*</code> <code class="p">(</code><code class="nb">Math</code><code class="p">.</code><code class="nx">PI</code> <code class="o">/</code> <code class="mi">180</code><code class="p">);</code>
        <code class="kr">const</code> <code class="nx">arclength</code> <code class="o">=</code> <code class="nx">radians</code> <code class="o">*</code> <code class="nx">radius</code><code class="p">;</code> <code class="c1">// value is 4.18879020478...</code></pre>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475176321592">
        <h2>Discussion</h2>
        
        <p>The length of a circular arc is found by multiplying the circle’s radius times the angle of the arc, in radians.</p>
        
        <p>If the angle is given in degrees, you’ll need to convert the degree to radians first, before multiplying the angle by the radius. This calculation is frequently used when drawing shapes in SVG, as covered in <a data-type="xref" href="ch15.html#ch15">Chapter&nbsp;15</a>.</p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Manipulating Very Large Numbers with BigInt"><div class="sect1" id="using_bigint">
        <h1>Manipulating Very Large Numbers with BigInt</h1>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45475176287288">
        <h2>Problem</h2>
        
        <p><a data-type="indexterm" data-primary="BigInt type" id="ix_bigint_type"></a><a data-type="indexterm" data-primary="numbers" data-secondary="BigInt for manipulating very large" id="ix_numbers_bigint"></a>You need to work with very large integers (above 2<sup>53</sup>), without losing precision.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45475176283096">
        <h2>Solution</h2>
        
        <p>Use the <code>BigInt</code> data type, which can hold integers of any size, limited only by system memory (or the <code>BigInt</code> implementation of the JavaScript engine you’re using).</p>
        
        <p>You can create a <code>BigInt</code> in two ways. You use the <code>BigInt()</code> function, like this:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="c1">// Create a BigInt and set it to 10</code>
        <code class="kr">const</code> <code class="nx">bigInteger</code> <code class="o">=</code> <code class="nx">BigInt</code><code class="p">(</code><code class="mi">10</code><code class="p">);</code></pre>
        
        <p>Or you can add the letter <em>n</em> to the end of a number:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">bigInteger</code> <code class="o">=</code> <code class="mi">10</code><code class="nx">n</code><code class="p">;</code></pre>
        
        <p>This example shows the difference between an ordinary <code>Number</code> and the <code>BigInt</code> for very large values:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="c1">// Ordinarily, large integers suffer from imprecision</code>
        <code class="kr">const</code> <code class="nx">maxInt</code> <code class="o">=</code> <code class="nb">Number</code><code class="p">.</code><code class="nx">MAX_SAFE_INTEGER</code> <code class="c1">// Probably about 9007199254740991</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">maxInt</code> <code class="o">+</code> <code class="mi">1</code><code class="p">);</code>  <code class="c1">// 9007199254740992 (reasonable)</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">maxInt</code> <code class="o">+</code> <code class="mi">2</code><code class="p">);</code>  <code class="c1">// 9007199254740992 (not a typo, this seems wrong)</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">maxInt</code> <code class="o">+</code> <code class="mi">3</code><code class="p">);</code>  <code class="c1">// 9007199254740994 (sure)</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">maxInt</code> <code class="o">+</code> <code class="mi">4</code><code class="p">);</code>  <code class="c1">// 9007199254740996 (wait, what now?)</code>
        
        <code class="c1">// BigInts behave more reliably</code>
        <code class="kr">const</code> <code class="nx">bigInt</code> <code class="o">=</code> <code class="nx">BigInt</code><code class="p">(</code><code class="nx">maxInt</code><code class="p">);</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">bigInt</code> <code class="o">+</code> <code class="mi">1</code><code class="nx">n</code><code class="p">);</code>  <code class="c1">// 9007199254740992 (as before)</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">bigInt</code> <code class="o">+</code> <code class="mi">2</code><code class="nx">n</code><code class="p">);</code>  <code class="c1">// 9007199254740993 (this is better)</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">bigInt</code> <code class="o">+</code> <code class="mi">3</code><code class="nx">n</code><code class="p">);</code>  <code class="c1">// 9007199254740994 (still good)</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">bigInt</code> <code class="o">+</code> <code class="mi">4</code><code class="nx">n</code><code class="p">);</code>  <code class="c1">// 9007199254740995 (excellent!)</code></pre>
        <div data-type="note" epub:type="note"><h6>Note</h6>
        <p>When you log a <code>BigInt</code> to the developer console, it appears with an <em>n</em> appended to its value (as in <em>9007199254740992n</em>). This convention makes it easy to recognize <code>BigInt</code> values. But if you just want the numeric value of your <code>BigInt</code>, you simply need to convert it to text first, with <code>BigInt.toString()</code>.</p>
        </div>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45475176066616">
        <h2>Discussion</h2>
        
        <p><a data-type="indexterm" data-primary="Number type" id="idm45475176065112"></a>JavaScript’s native <code>Number</code> type conforms to the IEEE-754 specification for 64-bit, double-precision floating-point numbers. The standard has acceptable, known limitations and inaccuracies. One practical limitation is that integers cannot be accurately represented past 2<sup>53</sup>. Beyond this point, inaccuracies in representation which had previously been confined to the right of the decimal place (see <a data-type="xref" href="#preserving_decimal_accuracy">“Preserving Accuracy in Decimal Values”</a>) jump over to the left of the decimal place. Put another way, as the JavaScript engine counts higher, the chance for inaccuracy grows. Once we are past 2<sup>53</sup>, the inaccuracy is larger than 1 and shows up in calculations with integral numbers, not just decimal values.</p>
        
        <p><a data-type="indexterm" data-primary="ECMAScript" data-seealso="ES6" id="idm45475176061272"></a><a data-type="indexterm" data-primary="ECMAScript" data-secondary="BigInt and" id="idm45475176060296"></a>JavaScript has a partial solution to this problem with the <code>BigInt</code> type, introduced as part of the ECMAScript 2020 specification. A <code>BigInt</code> is an arbitrarily sized integer that allows you to represent exceedingly large numbers. Practically speaking, there is no upper limit to the bit width of a <code>BigInt</code>.</p>
        
        <p>Almost all of the operators you are used to using with regular numbers can be used on a <code>BigInt</code>, including addition (<code>+</code>), subtraction (<code>-</code>), multiplication (<code>*</code>), division (<code>/</code>), and exponentiation (<code>**</code>). However, <code>BigInt</code> is an integer and does not store fractional values. When you perform a division operation, <code>BigInt</code> quietly discards the decimal portion:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="mi">10</code><code class="nx">n</code> <code class="o">/</code> <code class="mi">6</code><code class="nx">n</code><code class="p">;</code>    <code class="c1">// result is 1.</code></pre>
        
        <p><code>BigInts</code> and <code>Numbers</code> are not interchangeable nor are they interoperable. But they can be converted to one another using the <code>Number()</code> and <code>BigInt()</code> functions:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">let</code> <code class="nx">bigInteger</code> <code class="o">=</code> <code class="mi">10</code><code class="nx">n</code><code class="p">;</code>
        <code class="kd">let</code> <code class="nx">integer</code> <code class="o">=</code> <code class="nb">Number</code><code class="p">(</code><code class="nx">bigInteger</code><code class="p">);</code>  <code class="c1">// Number is 10</code>
        
        <code class="nx">integer</code> <code class="o">=</code> <code class="mi">20</code><code class="p">;</code>
        <code class="nx">bigInteger</code> <code class="o">=</code> <code class="nx">BigInt</code><code class="p">(</code><code class="nx">integer</code><code class="p">);</code>      <code class="c1">// bigInteger is 20n</code></pre>
        
        <p><a data-type="indexterm" data-primary="Number type" id="idm45475176031016"></a>You need to perform a conversion if you want to use a <code>BigInt</code> with a method that expects a <code>Number</code>, like the methods of the <code>Math</code> object. Similarly, you need to perform a conversion if you want to use a <code>Number</code> in a calculation with another <code>BigInt</code>.</p>
        
        <p>If you attempt to convert a <code>Number</code> that holds a fractional value into a <code>BigInt</code>, you’ll receive a <code>RangeError</code>. You can avoid this possibility by rounding first:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">decimal</code> <code class="o">=</code> <code class="mf">10.8</code><code class="p">;</code>
        <code class="kr">const</code> <code class="nx">bigInteger</code> <code class="o">=</code> <code class="nx">BigInt</code><code class="p">(</code><code class="nb">Math</code><code class="p">.</code><code class="nx">round</code><code class="p">(</code><code class="nx">decimal</code><code class="p">));</code>    <code class="c1">// bigInteger is 11n</code></pre>
        
        <p>Remember to keep operations consistent with the type. Sometimes what seems like a simple operation can fail because you accidentally combine a <code>BigInt</code> with an ordinary number:</p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="kd">let</code> <code class="nx">x</code> <code class="o">=</code> <code class="mi">10</code><code class="nx">n</code><code class="p">;</code>
        <code class="nx">x</code> <code class="o">=</code> <code class="nx">x</code> <code class="o">*</code> <code class="mi">2</code><code class="p">;</code>    <code class="c1">// throws a TypeError because x is a BigInt and 2 is a Number</code>
        <code class="nx">x</code> <code class="o">+=</code> <code class="mi">1</code><code class="p">;</code>       <code class="c1">// also throws a TypeError</code>
        
        <code class="nx">x</code> <code class="o">=</code> <code class="nx">x</code> <code class="o">*</code> <code class="mi">2</code><code class="nx">n</code><code class="p">;</code>   <code class="c1">// x is now 20n, as expected</code>
        <code class="nx">x</code> <code class="o">+=</code> <code class="mi">1</code><code class="nx">n</code><code class="p">;</code>      <code class="c1">// x is 21</code></pre>
        
        <p><a data-type="indexterm" data-primary="equality operators" id="idm45475175831976"></a><a data-type="indexterm" data-primary="!= operator" id="idm45475175870120"></a><a data-type="indexterm" data-primary="== operator" id="idm45475175868808"></a><a data-type="indexterm" data-primary="=== operator" id="idm45475175868136"></a><a data-type="indexterm" data-primary="> angle bracket" id="idm45475175867464"></a><a data-type="indexterm" data-primary=">= comparison operator" id="idm45475175866792"></a><a data-type="indexterm" data-primary="< angle bracket" id="idm45475175866120"></a><a data-type="indexterm" data-primary="<= comparison operator" id="idm45475175865448"></a>You can compare a <code>BigInt</code> value against a <code>Number</code> value using the standard comparison operators (<code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>). <a data-type="indexterm" data-primary="testing" data-secondary="for loose equality" data-secondary-sortas="loose equality" id="idm45475175862024"></a><a data-type="indexterm" data-primary="loose equality, testing for" id="idm45475175860744"></a>If you want to test if a <code>BigInt</code> and a number are equal, use the loose equality operators (<code>==</code> and <code>!=</code>). <a data-type="indexterm" data-primary="strict equality" id="idm45475175858728"></a>Strict equality (<code>===</code>) will always return <code>false</code>, because <code>BigInt</code> and <code>Number</code> are different data types. Or, better yet, explicitly convert your <code>Number</code> to a <code>BigInt</code> and then compare it with <code>===</code>.</p>
        
        <p><a data-type="indexterm" data-primary="JSON" data-secondary="BigInt issue" id="idm45475175869320"></a>One last thing to consider with <code>BigInt</code>: it is not (at publishing time) serializable to JSON. <a data-type="indexterm" data-primary="stringify() method" id="idm45475175853496"></a><a data-type="indexterm" data-primary="toJSON() method" id="idm45475175852792"></a>Attempts to call <code>JSON.stringify()</code> on a <code>BigInt</code> yield a syntax error. You have several options to consider as a solution. You could monkey-patch your <code>BigInt</code> implementation with an appropriate <code>toJSON()</code> method:<a data-type="indexterm" data-primary="" data-startref="ix_numbers_ch3" id="idm45475175850136"></a><a data-type="indexterm" data-primary="" data-startref="ix_numbers_bigint" id="idm45475175849128"></a><a data-type="indexterm" data-primary="" data-startref="ix_bigint_type" id="idm45475175848184"></a></p>
        
        <pre data-type="programlisting" data-code-language="javascript"><code class="nx">BigInt</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">toJSON</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code> <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="nx">toString</code><code class="p">()</code> <code class="p">}</code></pre>
        
        <p>You could also use a library like <a href="https://github.com/kanongil/granola">granola</a>, which provides JSON-compatiable stringifiers for a number of values, including <code>BigInt</code>.</p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        </div></section></div></div><link rel="stylesheet" href="/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="/api/v2/epubs/urn:orm:book:9781492055747/files/epub.css" crossorigin="anonymous"></div></div></section>
</div>

https://learning.oreilly.com