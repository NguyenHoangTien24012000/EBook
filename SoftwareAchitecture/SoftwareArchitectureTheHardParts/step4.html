<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
    
</style>
<link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492092506/files/epub.css" crossorigin="anonymous">
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 4. Architectural Decomposition"><div class="chapter" id="ch04-architectural-decomposition">
        <h1><span class="label">Chapter 4. </span>Architectural Decomposition</h1>
        
        
        <p><code>Monday, October 4, 10:04</code></p>
        <div class="story">
        
        <p>Now that Addison and Austen had the go-ahead to move to a distributed architecture<a data-type="indexterm" data-primary="architectural decomposition" data-secondary="about" data-tertiary="eating the elephant" id="idm45978857427088"></a><a data-type="indexterm" data-primary="monolithic architectures" data-secondary="architectural decomposition" data-see="architectural decomposition" id="idm45978857425776"></a><a data-type="indexterm" data-primary="Sysops Squad sagas" data-secondary="monolithic application broken apart" data-tertiary="decomposition method" id="idm45978857424512"></a><a data-type="indexterm" data-primary="decomposition" data-see="architectural decomposition" id="idm45978857423280"></a> and break apart the monolithic Sysops Squad application, they needed to determine the best approach for how to get started.</p>
        
        <p>“The application is so big I don’t even know where to start. It’s as big as an elephant!” exclaimed Addison.</p>
        
        <p>“Well,” said Austen. “How do you eat an elephant?”</p>
        
        <p>“Ha, I’ve heard that joke before, Austen. One bite at a time, of course!” laughed Addison.</p>
        
        <p>“Exactly. So let’s use the same principle with the Sysops Squad application,” said Austen. “Why don’t we just start breaking it apart, one bite at a time? Remember how I said reporting was one of the things causing the application to freeze up? Maybe we should start there.”</p>
        
        <p>“That might be a good start,” said Addison, “but what about the data? Just making reporting a separate service doesn’t solve the problem. We’d need to break apart the data as well, or even create a separate reporting database with data pumps to feed it. I think that’s too big of a bite to take starting out.”</p>
        
        <p>“You’re right,” said Austen. “Hey, what about the knowledge base functionality? That’s fairly standalone and might be easier to extract.”</p>
        
        <p>“That’s true. And what about the survey functionality? That should be easy to separate out as well,” said Addison. “The problem is, I can’t help feeling like we should be tackling this with more of a methodical approach rather than just eating the elephant bite by bite.”</p>
        
        <p>“Maybe Logan can give us some advice,” said Austen.</p>
        
        <p>Addison and Austen met with Logan to discuss some of the approaches they were considering for how to break apart the application. They explained to Logan that they wanted to start with the knowledge base and survey functionality but weren’t sure what to do after that.</p>
        
        <p>“The approach you’re suggesting,” said Logan, “is what is known as the Elephant Migration Anti-Pattern. Eating the elephant one bite at a time may seem like a good approach at the start, but in most cases it leads to an unstructured approach that results in a big ball of distributed mud, what some people also call a distributed monolith. I would not recommend that approach.”</p>
        
        <p>“So, what other approaches exist? Are there patterns we can use to break apart the application?” asked Addison.</p>
        
        <p>“You need to take a holistic view of the application and apply either tactical forking or component-based decomposition,” said Logan. “Those are the two most effective approaches I know of.”</p>
        
        <p>Addison and Austen looked at Logan. “But how do we know which one to use?”</p>
        <hr>
        </div>
        
        <p>Whereas architectural modularity describes the <em>why</em> for breaking apart a monolithic application, <a data-type="indexterm" data-primary="architectural decomposition" data-secondary="about" id="idm45978857413808"></a>architectural decomposition describes the <em>how</em>. Breaking apart large, complex monolithic applications can be a complex and time-consuming undertaking, and it’s important to know whether it is even feasible to begin such an effort and how to approach it.</p>
        
        <p>Component-based decomposition and tactical forking are two common <a data-type="indexterm" data-primary="architectural decomposition" data-secondary="component-based" data-tertiary="about" id="idm45978857411600"></a><a data-type="indexterm" data-primary="component-based decomposition" data-secondary="about" id="idm45978857410256"></a><a data-type="indexterm" data-primary="architectural decomposition" data-secondary="tactical forking" data-tertiary="about" id="idm45978857409296"></a><a data-type="indexterm" data-primary="tactical forking" data-secondary="about" id="idm45978857408064"></a>approaches for breaking apart monolithic applications. <em>Component-based decomposition</em> is an extraction approach that applies various refactoring patterns for refining and extracting components (the logical building blocks of an application) to form a distributed architecture in an incremental and controlled fashion. The <em>tactical forking</em> approach involves making replicas of an application and chipping away at the unwanted parts to form services, similar to the way a sculptor creates a beautiful work of art from a block of granite or marble.</p>
        
        <p>Which approach is most effective? The answer to this question is, of course, <em>it depends</em>. One of the main factors in selecting a decomposition approach is how well the existing monolithic application code is structured. Do clear components and component boundaries exist within the codebase, or is the codebase largely an unstructured big ball of mud?</p>
        
        <p>As the flowchart in <a data-type="xref" href="#fig-architectural-decomposition-flowchart">Figure 4-1</a> illustrates, the first step in an architecture decomposition effort is to first determine whether the codebase is even decomposable. We cover this topic in detail in the next section. If the codebase is decomposable, the next step is to determine if the source code is largely an unstructured mess with no clearly definable components. If that’s the case, then tactical forking (see <a data-type="xref" href="#sec-tactical-forking">“Tactical Forking”</a>) is probably the right approach. However, if the source code files are structured in a way that combines like functionality within well-defined (or even loosely defined) components, then a component-based decomposition approach (see <a data-type="xref" href="#sec-component-decomposition">“Component-Based Decomposition”</a>) is the way to go.</p>
        
        <figure><div id="fig-architectural-decomposition-flowchart" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0401.png" alt="Decomposition Approach Flowchart" width="600" height="554">
        <h6><span class="label">Figure 4-1. </span>The decision tree for selecting a decomposition approach</h6>
        </div></figure>
        
        <p>We describe both of these approaches in this chapter, and then devote an entire chapter (<a data-type="xref" href="ch05.html#ch05-decomposition-patterns">Chapter&nbsp;5</a>) to describing each of the component-based decomposition patterns in detail.</p>
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Is the Codebase Decomposable?"><div class="sect1" id="sec-decomposable">
        <h1>Is the Codebase Decomposable?</h1>
        
        <p>What happens when a codebase lacks internal structure? <a data-type="indexterm" data-primary="architecture" data-secondary="architecture governance" data-tertiary="Big Ball of Mud anti-pattern" id="idm45978851827840"></a><a data-type="indexterm" data-primary="architectural decomposition" data-secondary="codebase analysis" data-tertiary="about" id="idm45978851826576"></a><a data-type="indexterm" data-primary="Big Ball of Mud anti-pattern" id="idm45978851825344"></a><a data-type="indexterm" data-primary="monolithic architectures" data-secondary="Big Ball of Mud anti-pattern" id="idm45978851824656"></a><a data-type="indexterm" data-primary="Foote, Brian" id="idm45978851823680"></a><a data-type="indexterm" data-primary="architecture governance" data-secondary="Big Ball of Mud anti-pattern" id="idm45978851823008"></a>Can it even be decomposed? Such software has a colloquial name—the <a href="https://oreil.ly/7WkHf">Big Ball of Mud Anti-Pattern</a>, coined by Brian Foote in a <a href="http://www.laputan.org/mud">same-named essay</a> in 1999. For example, a complex web application with event handlers wired directly to database calls and no modularity can be considered a Big Ball of Mud architecture. Generally, architects don’t spend much time creating patterns for these kinds of systems; software architecture concerns internal structure, and these systems lack that defining feature.</p>
        
        <p class="pagebreak-before">Unfortunately, without careful governance, many software systems degrade into big balls of mud, leaving it to subsequent architects (or perhaps a despised former self) to repair. Step one in any architecture restructuring exercise requires an architect to determine a <em>plan</em> for the restructuring, which in turn requires the architect to understand the internal structure. The key question the architect must answer becomes is this codebase salvageable? In other words, is it a candidate for decomposition patterns, or is another approach more appropriate?</p>
        
        <p>No single measure will determine whether a codebase has reasonable internal structure—that evaluation falls to one or more architects to determine. However, architects do have tools to help determine macro characteristics of a codebase, particularly coupling metrics, to help evaluate internal structure.</p>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Afferent and Efferent Coupling"><div class="sect2" id="idm45978851817840">
        <h2>Afferent and Efferent Coupling</h2>
        
        <p>In 1979, Edward Yourdon and Larry Constantine published<a data-type="indexterm" data-primary="architectural decomposition" data-secondary="codebase analysis" data-tertiary="afferent and efferent coupling" id="idm45978851816080"></a><a data-type="indexterm" data-primary="coupling" data-secondary="architectural decomposition" data-tertiary="afferent coupling" id="idm45978851814848"></a><a data-type="indexterm" data-primary="afferent coupling" id="idm45978851813616"></a><a data-type="indexterm" data-primary="coupling" data-secondary="architectural decomposition" data-tertiary="efferent coupling" id="idm45978851812944"></a><a data-type="indexterm" data-primary="efferent coupling" id="idm45978851811712"></a><a data-type="indexterm" data-primary="Yourdon, Edward" id="idm45978851811040"></a><a data-type="indexterm" data-primary="Constantine, Larry" id="idm45978851810368"></a><a data-type="indexterm" data-primary="Structured Design (Yourdon and Constantine)" id="idm45978851809696"></a> <em>Structured Design: Fundamentals of a Discipline of Computer Program and Systems Design</em> (Yourdon), defining many core concepts, including the metrics afferent and efferent coupling. <em>Afferent</em> coupling measures the number of <em>incoming</em> connections to a code artifact (component, class, function, and so on). <em>Efferent</em> coupling measures the <em>outgoing</em> connections to other code artifacts.</p>
        
        <p>Note the value of just these two measures when changing the structure of a system. For example, when deconstructing a monolith into a distributed architecture, an architect will find shared classes such as <code>Address</code>. When building a monolith, it is common and encouraged for developers to reuse core concepts such as <code>Address</code>, but when pulling the monolith apart, now the architect must determine how many other parts of the system use this shared asset.</p>
        
        <p>Virtually every platform has tools that allow architects to analyze the coupling characteristics of code in order to assist in restructuring, migrating, or understanding a codebase. Many tools exist for various platforms that provide a matrix view of class and/or component relationships, as illustrated in <a data-type="xref" href="#fig-decomposition-patterns-tf-matrix">Figure 4-2</a>.</p>
        
        <p>In this example, the Eclipse plug-in provides<a data-type="indexterm" data-primary="tools" data-secondary="dependencies" data-tertiary="visualization" id="idm45978851802928"></a><a data-type="indexterm" data-primary="tools" data-secondary="visualization" data-tertiary="dependencies" id="idm45978851801680"></a><a data-type="indexterm" data-primary="tools" data-secondary="visualization" data-tertiary="afferent and efferent coupling" id="idm45978851800464"></a><a data-type="indexterm" data-primary="resources online" data-secondary="dependency tools" data-tertiary="JDepend" id="idm45978851799280"></a><a data-type="indexterm" data-primary="tools" data-secondary="dependencies" data-tertiary="JDepend" id="idm45978851798064"></a><a data-type="indexterm" data-primary="dependencies" data-secondary="tools" data-tertiary="JDepend" id="idm45978851796848"></a><a data-type="indexterm" data-primary="JDepend tool" data-secondary="Eclipse plug-in" id="idm45978851795632"></a><a data-type="indexterm" data-primary="visualization tools" data-secondary="afferent and efferent coupling" id="idm45978851794688"></a><a data-type="indexterm" data-primary="visualization tools" data-secondary="dependencies" data-tertiary="JDepend Eclipse plug-in" id="idm45978851793728"></a> a visualization of the output of JDepend, which includes coupling analysis per package, along with some aggregate metrics highlighted in the next section.</p>
        
        <figure><div id="fig-decomposition-patterns-tf-matrix" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0402.png" alt="JDepend view of coupling relationships" width="600" height="457">
        <h6><span class="label">Figure 4-2. </span>JDepend in Eclipse analysis view of coupling relationships</h6>
        </div></figure>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Abstractness and Instability"><div class="sect2" id="sec-abstractness-instability-and-distance-from-the-main-sequence">
        <h2>Abstractness and Instability</h2>
        
        <p>Robert Martin, a well-known figure in the software architecture<a data-type="indexterm" data-primary="architectural decomposition" data-secondary="codebase analysis" data-tertiary="abstractness and instability" id="idm45978851788192"></a><a data-type="indexterm" data-primary="Martin, Robert C." id="idm45978851786832"></a><a data-type="indexterm" data-primary="abstractness of codebase" id="idm45978851786160"></a> world, created some derived metrics for a C++ book in the late 1990s that are applicable to any object-oriented language. These metrics—abstractness and instability—measure the balance of the internal characteristics of a codebase.</p>
        
        <p><em>Abstractness</em> is the ratio of abstract artifacts (abstract classes, interfaces, and so on) to concrete artifacts (implementation classes). It represents a measure of <em>abstract</em> versus <em>implementation</em>. Abstract elements are features of a codebase that allow developers to understand the overall function better. For example, a codebase consisting of a single <code>main()</code> method and 10,000 lines of code would score nearly zero on this metric and be quite hard to understand.</p>
        
        <p>The formula for abstractness appears in <a data-type="xref" href="#eq_abstractness">Equation 4-1</a>.</p>
        <div id="eq_abstractness" data-type="equation">
        <h5><span class="label">Equation 4-1. </span>Abstractness</h5>
        <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" display="true" tabindex="0" ctxtmenu_counter="1" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="19.895ex" height="5.475ex" role="img" focusable="false" viewBox="0 -1460 8793.6 2420" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -2.172ex;"><defs><path id="MJX-2-TEX-I-1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path id="MJX-2-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-2-TEX-SO-2211" d="M61 748Q64 750 489 750H913L954 640Q965 609 976 579T993 533T999 516H979L959 517Q936 579 886 621T777 682Q724 700 655 705T436 710H319Q183 710 183 709Q186 706 348 484T511 259Q517 250 513 244L490 216Q466 188 420 134T330 27L149 -187Q149 -188 362 -188Q388 -188 436 -188T506 -189Q679 -189 778 -162T936 -43Q946 -27 959 6H999L913 -249L489 -250Q65 -250 62 -248Q56 -246 56 -239Q56 -234 118 -161Q186 -81 245 -11L428 206Q428 207 242 462L57 717L56 728Q56 744 61 748Z"></path><path id="MJX-2-TEX-I-1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-2-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-2-TEX-I-1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path id="MJX-2-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mi"><use data-c="1D434" xlink:href="#MJX-2-TEX-I-1D434"></use></g><g data-mml-node="mo" transform="translate(1027.8,0)"><use data-c="3D" xlink:href="#MJX-2-TEX-N-3D"></use></g><g data-mml-node="mfrac" transform="translate(2083.6,0)"><g data-mml-node="mrow" transform="translate(2076.1,710)"><g data-mml-node="mo"><use data-c="2211" xlink:href="#MJX-2-TEX-SO-2211"></use></g><g data-mml-node="msup" transform="translate(1222.7,0)"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-2-TEX-I-1D45A"></use></g><g data-mml-node="mi" transform="translate(911,363) scale(0.707)"><use data-c="1D44E" xlink:href="#MJX-2-TEX-I-1D44E"></use></g></g></g><g data-mml-node="mrow" transform="translate(220,-710)"><g data-mml-node="mo"><use data-c="2211" xlink:href="#MJX-2-TEX-SO-2211"></use></g><g data-mml-node="msup" transform="translate(1222.7,0)"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-2-TEX-I-1D45A"></use></g><g data-mml-node="mi" transform="translate(911,289) scale(0.707)"><use data-c="1D450" xlink:href="#MJX-2-TEX-I-1D450"></use></g></g><g data-mml-node="mo" transform="translate(2712.1,0)"><use data-c="2B" xlink:href="#MJX-2-TEX-N-2B"></use></g><g data-mml-node="mo" transform="translate(3712.3,0)"><use data-c="2211" xlink:href="#MJX-2-TEX-SO-2211"></use></g><g data-mml-node="msup" transform="translate(4935,0)"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-2-TEX-I-1D45A"></use></g><g data-mml-node="mi" transform="translate(911,289) scale(0.707)"><use data-c="1D44E" xlink:href="#MJX-2-TEX-I-1D44E"></use></g></g></g><rect width="6470" height="60" x="120" y="220"></rect></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="upper A equals StartFraction sigma-summation m Superscript a Baseline Over sigma-summation m Superscript c Baseline plus sigma-summation m Superscript a Baseline EndFraction" display="block"><mrow><mi>A</mi><mo>=</mo><mfrac><mrow><mo>∑</mo><msup><mi>m</mi><mi>a</mi></msup></mrow><mrow><mo>∑</mo><msup><mi>m</mi><mi>c</mi></msup><mo>+</mo><mo>∑</mo><msup><mi>m</mi><mi>a</mi></msup></mrow></mfrac></mrow></math></mjx-assistive-mml></mjx-container>
        </div>
        
        <p class="pagebreak-before">In the equation, <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="2" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="3.02ex" height="1.552ex" role="img" focusable="false" viewBox="0 -674.8 1335.1 685.8" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.025ex;"><defs><path id="MJX-3-TEX-I-1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-3-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-3-TEX-I-1D45A"></use></g><g data-mml-node="mi" transform="translate(911,363) scale(0.707)"><use data-c="1D44E" xlink:href="#MJX-3-TEX-I-1D44E"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="m Superscript a"><msup><mi>m</mi><mi>a</mi></msup></math></mjx-assistive-mml></mjx-container> represents <em>abstract</em> elements (interfaces or abstract classes) within the codebase, and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="3" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.867ex" height="1.553ex" role="img" focusable="false" viewBox="0 -675.5 1267.2 686.5" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.025ex;"><defs><path id="MJX-4-TEX-I-1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-4-TEX-I-1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-4-TEX-I-1D45A"></use></g><g data-mml-node="mi" transform="translate(911,363) scale(0.707)"><use data-c="1D450" xlink:href="#MJX-4-TEX-I-1D450"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="m Superscript c"><msup><mi>m</mi><mi>c</mi></msup></math></mjx-assistive-mml></mjx-container> represents <em>concrete</em> elements. Architects calculate abstractness by calculating the ratio of the sum of abstract artifacts to the sum of the concrete ones.</p>
        
        <p>Another derived metric, <em>instability</em>, is the <a data-type="indexterm" data-primary="instability of codebase" id="idm45978851765472"></a>ratio of efferent coupling to the sum of both efferent and afferent coupling, shown in <a data-type="xref" href="#eq_instability">Equation 4-2</a>.</p>
        <div id="eq_instability" data-type="equation">
        <h5><span class="label">Equation 4-2. </span>Instability</h5>
        <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" display="true" tabindex="0" ctxtmenu_counter="4" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="13.561ex" height="4.862ex" role="img" focusable="false" viewBox="0 -1381 5994.1 2149" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -1.738ex;"><defs><path id="MJX-5-TEX-I-1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path><path id="MJX-5-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-5-TEX-I-1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path><path id="MJX-5-TEX-I-1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path id="MJX-5-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-5-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mi"><use data-c="1D43C" xlink:href="#MJX-5-TEX-I-1D43C"></use></g><g data-mml-node="mo" transform="translate(781.8,0)"><use data-c="3D" xlink:href="#MJX-5-TEX-N-3D"></use></g><g data-mml-node="mfrac" transform="translate(1837.6,0)"><g data-mml-node="msup" transform="translate(1465.9,676)"><g data-mml-node="mi"><use data-c="1D436" xlink:href="#MJX-5-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(845.3,363) scale(0.707)"><use data-c="1D452" xlink:href="#MJX-5-TEX-I-1D452"></use></g></g><g data-mml-node="mrow" transform="translate(220,-686)"><g data-mml-node="msup"><g data-mml-node="mi"><use data-c="1D436" xlink:href="#MJX-5-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(845.3,289) scale(0.707)"><use data-c="1D452" xlink:href="#MJX-5-TEX-I-1D452"></use></g></g><g data-mml-node="mo" transform="translate(1447,0)"><use data-c="2B" xlink:href="#MJX-5-TEX-N-2B"></use></g><g data-mml-node="msup" transform="translate(2447.2,0)"><g data-mml-node="mi"><use data-c="1D436" xlink:href="#MJX-5-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(845.3,289) scale(0.707)"><use data-c="1D44E" xlink:href="#MJX-5-TEX-I-1D44E"></use></g></g></g><rect width="3916.5" height="60" x="120" y="220"></rect></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="upper I equals StartFraction upper C Superscript e Baseline Over upper C Superscript e Baseline plus upper C Superscript a Baseline EndFraction" display="block"><mrow><mi>I</mi><mo>=</mo><mfrac><msup><mi>C</mi><mi>e</mi></msup><mrow><msup><mi>C</mi><mi>e</mi></msup><mo>+</mo><msup><mi>C</mi><mi>a</mi></msup></mrow></mfrac></mrow></math></mjx-assistive-mml></mjx-container>
        </div>
        
        <p>In the equation, <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="5" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.771ex" height="1.645ex" role="img" focusable="false" viewBox="0 -705 1224.8 727" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.05ex;"><defs><path id="MJX-6-TEX-I-1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path><path id="MJX-6-TEX-I-1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><use data-c="1D436" xlink:href="#MJX-6-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(845.3,363) scale(0.707)"><use data-c="1D452" xlink:href="#MJX-6-TEX-I-1D452"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="upper C Superscript e"><msup><mi>C</mi><mi>e</mi></msup></math></mjx-assistive-mml></mjx-container> represents <em>efferent</em> (or outgoing) <a data-type="indexterm" data-primary="coupling" data-secondary="architectural decomposition" data-tertiary="afferent coupling" id="idm45978851752368"></a><a data-type="indexterm" data-primary="coupling" data-secondary="architectural decomposition" data-tertiary="efferent coupling" id="idm45978851751024"></a><a data-type="indexterm" data-primary="afferent coupling" id="idm45978851749792"></a><a data-type="indexterm" data-primary="efferent coupling" id="idm45978851749120"></a>coupling, and <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="6" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.872ex" height="1.645ex" role="img" focusable="false" viewBox="0 -705 1269.3 727" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.05ex;"><defs><path id="MJX-7-TEX-I-1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path><path id="MJX-7-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><use data-c="1D436" xlink:href="#MJX-7-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(845.3,363) scale(0.707)"><use data-c="1D44E" xlink:href="#MJX-7-TEX-I-1D44E"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="upper C Superscript a"><msup><mi>C</mi><mi>a</mi></msup></math></mjx-assistive-mml></mjx-container> represents <em>afferent</em> (or incoming) coupling.</p>
        
        <p>The instability metric determines the volatility of a codebase. A codebase that exhibits high degrees of instability breaks more easily when changed because of high coupling. Consider two scenarios, each with <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="7" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.872ex" height="1.645ex" role="img" focusable="false" viewBox="0 -705 1269.3 727" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.05ex;"><defs><path id="MJX-8-TEX-I-1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path><path id="MJX-8-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><use data-c="1D436" xlink:href="#MJX-8-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(845.3,363) scale(0.707)"><use data-c="1D44E" xlink:href="#MJX-8-TEX-I-1D44E"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="upper C Superscript a"><msup><mi>C</mi><mi>a</mi></msup></math></mjx-assistive-mml></mjx-container> of 2. For the first scenario, <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="8" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.771ex" height="1.645ex" role="img" focusable="false" viewBox="0 -705 1224.8 727" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.05ex;"><defs><path id="MJX-9-TEX-I-1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path><path id="MJX-9-TEX-I-1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><use data-c="1D436" xlink:href="#MJX-9-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(845.3,363) scale(0.707)"><use data-c="1D452" xlink:href="#MJX-9-TEX-I-1D452"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="upper C Superscript e"><msup><mi>C</mi><mi>e</mi></msup></math></mjx-assistive-mml></mjx-container> = 0, yielding an instability score of zero. In the other scenario, <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="9" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.771ex" height="1.645ex" role="img" focusable="false" viewBox="0 -705 1224.8 727" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.05ex;"><defs><path id="MJX-10-TEX-I-1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path><path id="MJX-10-TEX-I-1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><use data-c="1D436" xlink:href="#MJX-10-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(845.3,363) scale(0.707)"><use data-c="1D452" xlink:href="#MJX-10-TEX-I-1D452"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="upper C Superscript e"><msup><mi>C</mi><mi>e</mi></msup></math></mjx-assistive-mml></mjx-container> = 3, yielding an instability score of 3/5. Thus, the measure of instability for a component reflects how many potential changes might be forced by changes to related components. A component with an instability value near one is highly unstable, a value close to zero may be either stable or rigid: it is stable if the module or component contains mostly abstract elements, and rigid if it comprises mostly concrete elements. However, the trade-off for high stability is lack of reuse—if every component is self contained, duplication is likely.</p>
        
        <p>A component with an <em>I</em> value close to 1, we can agree, is highly instable. However, a component with a value of I close to 0 may be either stable or rigid. However, if it contains mostly concrete elements, then it is rigid.</p>
        
        <p>Thus, in general, it is important to look at the value of <em>I</em> and <em>A</em> together rather than in isolation. Hence the reason to consider the main sequence presented on the next page.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" class="pagebreak-before less_space" data-pdf-bookmark="Distance from the Main Sequence"><div class="sect2" id="idm45978851789584">
        <h2>Distance from the Main Sequence</h2>
        
        <p>One of the few holistic metrics architects have for architectural<a data-type="indexterm" data-primary="tools" data-secondary="visualization" data-tertiary="distance from main sequence" id="idm45978851734416"></a><a data-type="indexterm" data-primary="architectural decomposition" data-secondary="codebase analysis" data-tertiary="distance from main sequence" id="idm45978851733072"></a><a data-type="indexterm" data-primary="distance from main sequence" id="idm45978851731824"></a><a data-type="indexterm" data-primary="abstractness of codebase" data-secondary="distance from main sequence" id="idm45978851731136"></a><a data-type="indexterm" data-primary="instability of codebase" data-secondary="distance from main sequence" id="idm45978851730160"></a><a data-type="indexterm" data-primary="visualization tools" data-secondary="distance from main sequence" id="idm45978851729200"></a> structure is <em>distance from the main sequence</em>, a derived metric based on instability and abstractness, shown in <a data-type="xref" href="#eq_distance">Equation 4-3</a>.</p>
        <div id="eq_distance" data-type="equation">
        <h5><span class="label">Equation 4-3. </span>Distance from the main sequence</h5>
        <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" display="true" tabindex="0" ctxtmenu_counter="10" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="15.648ex" height="2.26ex" role="img" focusable="false" viewBox="0 -749.5 6916.4 999" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.564ex;"><defs><path id="MJX-11-TEX-I-1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path><path id="MJX-11-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-11-TEX-N-7C" d="M139 -249H137Q125 -249 119 -235V251L120 737Q130 750 139 750Q152 750 159 735V-235Q151 -249 141 -249H139Z"></path><path id="MJX-11-TEX-I-1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path id="MJX-11-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-11-TEX-I-1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path><path id="MJX-11-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-11-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mi"><use data-c="1D437" xlink:href="#MJX-11-TEX-I-1D437"></use></g><g data-mml-node="mo" transform="translate(1105.8,0)"><use data-c="3D" xlink:href="#MJX-11-TEX-N-3D"></use></g><g data-mml-node="mo" transform="translate(2161.6,0) translate(0 -0.5)"><use data-c="7C" xlink:href="#MJX-11-TEX-N-7C"></use></g><g data-mml-node="mi" transform="translate(2439.6,0)"><use data-c="1D434" xlink:href="#MJX-11-TEX-I-1D434"></use></g><g data-mml-node="mo" transform="translate(3411.8,0)"><use data-c="2B" xlink:href="#MJX-11-TEX-N-2B"></use></g><g data-mml-node="mi" transform="translate(4412,0)"><use data-c="1D43C" xlink:href="#MJX-11-TEX-I-1D43C"></use></g><g data-mml-node="mo" transform="translate(5138.2,0)"><use data-c="2212" xlink:href="#MJX-11-TEX-N-2212"></use></g><g data-mml-node="mn" transform="translate(6138.4,0)"><use data-c="31" xlink:href="#MJX-11-TEX-N-31"></use></g><g data-mml-node="mo" transform="translate(6638.4,0) translate(0 -0.5)"><use data-c="7C" xlink:href="#MJX-11-TEX-N-7C"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="upper D equals StartAbsoluteValue upper A plus upper I minus 1 EndAbsoluteValue" display="block"><mrow><mi>D</mi><mo>=</mo><mo>|</mo><mi>A</mi><mo>+</mo><mi>I</mi><mo>-</mo><mn>1</mn><mo>|</mo></mrow></math></mjx-assistive-mml></mjx-container>
        </div>
        
        <p>In the equation, <em>A</em> = <em>abstractness</em> and <em>I</em> = <em>instability</em>.</p>
        
        <p>The distance-from-the-main-sequence metric imagines an ideal relationship between abstractness and instability; components that fall near this idealized line exhibit a healthy mixture of these two competing concerns. For example, graphing a particular component allows developers to calculate the distance-from-the-main-sequence metric, illustrated in <a data-type="xref" href="#ch-measuring-normalized">Figure 4-3</a>.</p>
        
        <figure class="width-50"><div id="ch-measuring-normalized" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0403.png" alt="Distance from the Main Sequence illustration" width="600" height="556">
        <h6><span class="label">Figure 4-3. </span>Normalized distance from the main sequence for a particular component</h6>
        </div></figure>
        
        <p>Developers graph the candidate component, then measure the distance from the idealized line. The closer to the line, the better balanced the component. <a data-type="indexterm" data-primary="zones of uselessness and pain" id="idm45978851713200"></a><a data-type="indexterm" data-primary="distance from main sequence" data-secondary="zones of uselessness and pain" id="idm45978851712480"></a>Components that fall too far into the upper-right corner enter into what architects call the <em>zone of uselessness</em>: code that is too abstract becomes difficult to use. Conversely, code that falls into the lower-left corner enter the <em>zone of pain</em>: code with too much implementation and not enough abstraction becomes brittle and hard to maintain, illustrated in <a data-type="xref" href="#ch-measuring-zones">Figure 4-4</a>.</p>
        
        <p>Tools exist in many platforms to provide these measures, which assist architects when analyzing codebases because of unfamiliarity, migration, or technical debt 
        <span class="keep-together">assessment</span>.</p>
        
        <p>What does the distance-from-the-main-sequence metric tell architects looking to restructure applications? Just as in construction projects, moving a large structure that has a poor foundation presents risks. Similarly, if an architect aspires to restructure an application, improving the internal structure will make it easier to move the 
        <span class="keep-together">entity</span>.</p>
        
        <figure class="width-50"><div id="ch-measuring-zones" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0404.png" alt="Zones of Uselessness and Pain illustrated" width="600" height="616">
        <h6><span class="label">Figure 4-4. </span>Zones of uselessness and pain</h6>
        </div></figure>
        
        <p>This metric also provides a good clue as to the balance of the internal structure. If an architect evaluates a codebase where many of the components fall into either the zones of uselessness or pain, perhaps it is not a good use of time to try to shore up the internal structure to the point where it can be repaired.</p>
        
        <p>Following the flowchart in <a data-type="xref" href="#fig-architectural-decomposition-flowchart">Figure 4-1</a>, once an architect decides that the codebase is decomposable, the next step is to determine what approach to take to decompose the application. The following sections describe the two approaches for decomposing an application: <em>component-based decomposition</em> and <em>tactical forking</em>.</p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" class="pagebreak-before less_space" data-pdf-bookmark="Component-Based Decomposition"><div class="sect1" id="sec-component-decomposition">
        <h1>Component-Based Decomposition</h1>
        
        <p>It has been our experience that most of the difficulty and complexity involved<a data-type="indexterm" data-primary="architectural decomposition" data-secondary="component-based" id="ch04-cbd2"></a><a data-type="indexterm" data-primary="component-based decomposition" id="ch04-cbd"></a> with migrating monolithic applications to highly distributed architecture like microservices comes from poorly defined architectural components. <a data-type="indexterm" data-primary="component-based decomposition" data-secondary="about components" id="idm45978851696160"></a><a data-type="indexterm" data-primary="components" data-secondary="definition" id="idm45978851695200"></a>Here we define a <em>component</em> as a building block of the application that has a well-defined role and responsibility in the system and a well-defined set of operations. Components in most applications are manifested through namespaces or directory structures and are implemented through component files (or source files). For example, in <a data-type="xref" href="#fig-decomposition-patterns-namespace">Figure 4-5</a>, the directory structure <em>penultimate/ss/ticket/assign</em> would represent a component called Ticket Assign with the namespace <code>penultimate.ss.ticket.assign</code>.</p>
        
        <figure><div id="fig-decomposition-patterns-namespace" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0405.png" alt="Directory Structures as Namespaces" width="600" height="421">
        <h6><span class="label">Figure 4-5. </span>The directory structure of a codebase becomes the namespace of the 
        <span class="keep-together">component</span></h6>
        </div></figure>
        <div data-type="tip"><h6>Tip</h6>
        <p>When breaking monolithic applications into distributed<a data-type="indexterm" data-primary="architectural decomposition" data-secondary="component-based" data-tertiary="services built from components" id="idm45978853687744"></a><a data-type="indexterm" data-primary="services" data-secondary="component-based decomposition" id="idm45978853686464"></a> architectures, build services from <em>components</em>, not individual classes.</p>
        </div>
        
        <p>Throughout many collective years of migrating monolithic<a data-type="indexterm" data-primary="architectural decomposition" data-secondary="component-based" data-tertiary="about patterns" id="idm45978853684400"></a><a data-type="indexterm" data-primary="component-based decomposition" data-secondary="patterns" data-tertiary="about" id="idm45978853683008"></a><a data-type="indexterm" data-primary="monolithic architectures" data-secondary="patterns for migration to service-based" data-tertiary="about" id="idm45978853681776"></a><a data-type="indexterm" data-primary="service-based architecture" data-secondary="monolithic migration to" data-tertiary="about" id="idm45978853680528"></a> applications to distributed architectures (such as microservices), we’ve developed a set of component-based decomposition patterns described in <a data-type="xref" href="ch05.html#ch05-decomposition-patterns">Chapter&nbsp;5</a> that help prepare a monolithic application for migration. These patterns involve the refactoring of source code to arrive at a set of well-defined components that can eventually become services, easing the effort needed to migrate applications to distributed architectures.</p>
        
        <p>These component-based decomposition patterns essentially enable the migration of a monolithic architecture to a service-based architecture, which is defined in <a data-type="xref" href="ch02.html#ch02-discerning">Chapter&nbsp;2</a> and described in more detail in <a class="orm:hideurl" href="https://learning.oreilly.com/library/view/fundamentals-of-software/9781492043447"><em>Fundamentals of Software Architecture</em></a>. <a data-type="indexterm" data-primary="service-based architecture" data-secondary="about" id="idm45978853675584"></a><a data-type="indexterm" data-primary="domain services" data-secondary="service-based architecture definition" id="idm45978853674576"></a>Service-based architecture is a hybrid of the microservices architecture style where an application is broken into <em>domain services</em>, which are coarse-grained, separately deployed services containing all of the business logic for a particular domain.</p>
        
        <p>Moving to a service-based architecture is suitable as a final target or as a stepping-stone to microservices:<a data-type="indexterm" data-primary="microservices" data-secondary="service-based architecture as stepping-stone" id="idm45978853672304"></a><a data-type="indexterm" data-primary="service-based architecture" data-secondary="stepping-stone to microservices" id="idm45978853671296"></a></p>
        
        <ul>
        <li>
        <p>As a stepping-stone, it allows an architect to determine which domains require further levels of granularity into microservices and which ones can remain as coarse-grained domain services (this decision is discussed in detail in <a data-type="xref" href="ch07.html#ch07-service-granularity">Chapter&nbsp;7</a>).</p>
        </li>
        <li>
        <p>Service-based architecture does not require the database to be broken apart, therefore allowing architects to focus on the domain and functional partitioning prior to tackling database decomposition (discussed in detail in <a data-type="xref" href="ch06.html#ch06-decomposing-operational-data">Chapter&nbsp;6</a>).</p>
        </li>
        <li>
        <p>Service-based architecture does not require any operational automation or containerization. Each domain service can be deployed using the same deployment artifact as the original application (such as an EAR file, WAR file, Assembly, and so on).</p>
        </li>
        <li>
        <p>The move to service-based architecture is a <em>technical one</em>, meaning it generally doesn’t involve business stakeholders and doesn’t require any change to the organization structure of the IT department nor the testing and deployment 
        <span class="keep-together">environments</span>.<a data-type="indexterm" data-startref="ch04-cbd" id="idm45978853663168"></a><a data-type="indexterm" data-startref="ch04-cbd2" id="idm45978853662432"></a></p>
        </li>
        </ul>
        <div data-type="tip"><h6>Tip</h6>
        <p>When migrating monolithic applications to microservices, consider moving to a service-based architecture first as a stepping-stone to microservices.</p>
        </div>
        
        <p>But what if the codebase is an unstructured big ball of mud<a data-type="indexterm" data-primary="monolithic architectures" data-secondary="Big Ball of Mud anti-pattern" data-tertiary="tactical forking" id="ch04-tf4"></a><a data-type="indexterm" data-primary="Big Ball of Mud anti-pattern" data-secondary="tactical forking" id="ch04-tf"></a><a data-type="indexterm" data-primary="tactical forking" id="ch04-tf2"></a><a data-type="indexterm" data-primary="architectural decomposition" data-secondary="tactical forking" id="ch04-tf3"></a> and doesn’t contain very many observable components? That’s where tactical forking comes in.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" class="pagebreak-before less_space" data-pdf-bookmark="Tactical Forking"><div class="sect1" id="sec-tactical-forking">
        <h1>Tactical Forking</h1>
        
        <p>The <em>tactical forking</em> pattern was named by<a data-type="indexterm" data-primary="De La Torre, Fausto" id="idm45978853651520"></a> <a href="https://faustodelatog.wordpress.com">Fausto De La Torre</a> as a pragmatic approach to restructuring architectures that are basically big balls of mud.</p>
        
        <p>Generally, when architects think about restructuring a codebase, they think of extracting pieces, as illustrated in <a data-type="xref" href="#fig-decomposition-patterns-tact-fork-extract">Figure 4-6</a>.</p>
        
        <figure><div id="fig-decomposition-patterns-tact-fork-extract" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0406.png" alt="Extraction illustration" width="600" height="266">
        <h6><span class="label">Figure 4-6. </span>Extracting a part of a system</h6>
        </div></figure>
        
        <p>However, another way to think of isolating one part of a system involves <em>deleting</em> the parts no longer needed, as illustrated in <a data-type="xref" href="#fig-decomposition-patterns-tact-fork-delete">Figure 4-7</a>.</p>
        
        <figure><div id="fig-decomposition-patterns-tact-fork-delete" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0407.png" alt="illustration of deletion as an isolation technique" width="600" height="270">
        <h6><span class="label">Figure 4-7. </span>Deleting what’s not wanted is another way to isolate parts of a system</h6>
        </div></figure>
        
        <p>In <a data-type="xref" href="#fig-decomposition-patterns-tact-fork-extract">Figure 4-6</a>, developers have to constantly deal with the exuberant strands of coupling that define this architecture; as they extract pieces, they discover that more and more of the monolith must come along because of dependencies. In <a data-type="xref" href="#fig-decomposition-patterns-tact-fork-delete">Figure 4-7</a>, developers delete what code isn’t needed, but the dependencies remain, avoiding the constant unraveling effect of extraction.</p>
        
        <p class="pagebreak-before">The difference between <em>extraction</em> and <em>deletion</em> inspires the tactical forking pattern. For this decomposition approach, the system starts as a single monolithic application, as shown in <a data-type="xref" href="#fig-decomposition-patterns-tact-fork-step0-init">Figure 4-8</a>.</p>
        
        <figure><div id="fig-decomposition-patterns-tact-fork-step0-init" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0408.png" alt="Tactical forking initial state" width="515" height="800">
        <h6><span class="label">Figure 4-8. </span>Before restructuring, a monolith includes several parts</h6>
        </div></figure>
        
        <p>This system consists of several domain behaviors (identified in the figure as simple geometric shapes) without much internal organization. In addition, in this scenario, the desired goal consists of two teams to create two services, one with the <em>hexagon</em> and <em>square</em> domain, and another with the <em>circle</em> domain, from the existing monolith.</p>
        
        <p class="pagebreak-before">The first step in tactical forking involves cloning the entire monolith, and giving each team a copy of the entire codebase, as illustrated in <a data-type="xref" href="#fig-decomposition-patterns-tact-fork-step1-split">Figure 4-9</a>.</p>
        
        <figure><div id="fig-decomposition-patterns-tact-fork-step1-split" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0409.png" alt="cloning the monolithic architecture into two parts, one for each team" width="600" height="561">
        <h6><span class="label">Figure 4-9. </span>Step one clones the monolith</h6>
        </div></figure>
        
        <p>Each team receives a copy of the entire codebase, and they start <em>deleting</em> (as illustrated previously in <a data-type="xref" href="#fig-decomposition-patterns-tact-fork-delete">Figure 4-7</a>) the code they don’t need rather than extract the desirable code. Developers often find this easier in a tightly coupled codebase because they don’t have to worry about extracting the large number of dependencies that high coupling creates. Rather, in the <em>deletion</em> strategy, once functionality has been isolated, delete any code that doesn’t break anything.</p>
        
        <p class="pagebreak-before">As the pattern continues to progress, teams begin to isolate the target portions, as shown in <a data-type="xref" href="#fig-decomposition-patterns-tact-fork-step2-constant-refactor">Figure 4-10</a>. Then each team continues the gradual elimination of unwanted code.</p>
        
        <figure><div id="fig-decomposition-patterns-tact-fork-step2-constant-refactor" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0410.png" alt="each team gradually isolates encapsulated parts" width="600" height="561">
        <h6><span class="label">Figure 4-10. </span>Teams constantly refactor to remove unwanted code</h6>
        </div></figure>
        
        <p class="pagebreak-before">At the completion of the tactical forking pattern, teams have split the original monolithic application into two parts, preserving the coarse-grained structure of the behavior in each part, as illustrated in <a data-type="xref" href="#fig-decomposition-patterns-tact-fork-step3-end-state">Figure 4-11</a>.</p>
        
        <figure><div id="fig-decomposition-patterns-tact-fork-step3-end-state" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0411.png" alt="the monolith has been split into two large services" width="600" height="627">
        <h6><span class="label">Figure 4-11. </span>The end state of tactical forking features two services</h6>
        </div></figure>
        
        <p>Now the restructuring is complete, leaving two coarse-grained services as the result.</p>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Trade-Offs"><div class="sect2" id="idm45978853618896">
        <h2>Trade-Offs</h2>
        
        <p>Tactical forking is a viable alternative to a more formal<a data-type="indexterm" data-primary="tactical forking" data-secondary="trade-offs" id="idm45978853617568"></a><a data-type="indexterm" data-primary="architectural decomposition" data-secondary="tactical forking" data-tertiary="trade-offs" id="idm45978853616512"></a><a data-type="indexterm" data-primary="trade-off analysis" data-secondary="tactical forking" id="idm45978853615232"></a> decomposition approach, most suited to codebases that have little or no internal structure. Like all practices in architecture, it has its share of trade-offs:</p>
        <dl>
        <dt>Benefits</dt>
        <dd>
        
        <ul>
        <li>
        <p>Teams can start working right away with virtually no up-front analysis.</p>
        </li>
        <li>
        <p>Developers find it easier to delete code rather than extract it. Extracting code from a chaotic codebase presents difficulties because of high coupling, whereas code not needed can be verified by compilation or simple testing.</p>
        </li>
        </ul>
        </dd>
        <dt>Shortcomings</dt>
        <dd>
        
        <ul>
        <li>
        <p>The resulting services will likely still contain a large amount of mostly latent code left over from the monolith.</p>
        </li>
        <li>
        <p>Unless developers undertake additional efforts, the code inside the newly derived services won’t be better than the chaotic code from the monolith—there’s just less of it.</p>
        </li>
        <li>
        <p>Inconsistencies may occur between the naming of shared code and shared component files, resulting in difficultly identifying common code and keeping it 
        <span class="keep-together">consistent</span>.</p>
        </li>
        </ul>
        </dd>
        </dl>
        
        <p>The name of this pattern is apt (as all good pattern names should be)—it provides a <em>tactical</em> rather than <em>strategic</em> approach for restructuring architectures, allowing teams to quickly migrate important or critical systems to the next generation (albeit in an unstructured way).<a data-type="indexterm" data-startref="ch04-tf" id="idm45978853603616"></a><a data-type="indexterm" data-startref="ch04-tf2" id="idm45978853602912"></a><a data-type="indexterm" data-startref="ch04-tf3" id="idm45978853602240"></a><a data-type="indexterm" data-startref="ch04-tf4" id="idm45978853601568"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Sysops Squad Saga: Choosing a Decomposition Approach"><div class="sect1" id="idm45978853653952">
        <h1>Sysops Squad Saga: Choosing a Decomposition Approach</h1>
        
        <p><code>Friday, October 29, 10:01</code></p>
        <div class="story">
        
        <p>Now that Addison and Austen understood both approaches, <a data-type="indexterm" data-primary="Sysops Squad sagas" data-secondary="monolithic application broken apart" data-tertiary="decomposition method" id="idm45978853598352"></a>they met in the main conference room to analyze the Sysops Squad application using the abstractness and instability metrics to determine which approach would be the most appropriate given their situation.</p>
        
        <p>“Look at this,” said Addison. “Most of the code lies along the main sequence. There are a few outliers of course, but I think we can conclude that it’s feasible to break apart this application. So the next step is to determine which approach to use.”</p>
        
        <p>“I really like the tactical forking approach,” said Austen. “It reminds me of famous sculptors, when asked how they were able to carve such beautiful works out of solid marble, who replied that they were merely removing the marble that wasn’t supposed to be there. I feel like the Sysops Squad application could be my sculpture!”</p>
        
        <p>“Hold on there, Michelangelo,” said Addison. “First sports, and now sculpting? You need to make up your mind about what you like to spend your nonworking time on. The thing I don’t like about the tactical forking approach is all the duplicate code and shared functionality within each service. Most of our problems have to do with maintainability, testability, and overall reliability. Can you imagine having to apply the same change to several different services at the same time? That would be a nightmare!”</p>
        
        <p>“But how much shared functionality is there, really?” asked Austen.</p>
        
        <p>“I’m not sure,” said Addison, “but I do know there’s quite a bit of shared code for the infrastructure stuff like logging and security, and I know a lot of the database calls are shared from the persistence layer of the application.”</p>
        
        <p>Austen paused and thought about Addison’s argument for a bit. “Maybe you’re right. Since we have good component boundaries already defined, I’m OK with doing the slower component-based decomposition approach and giving up my sculpting career. But I’m not giving up sports!”</p>
        
        <p>Addison and Austen came to an agreement that the component decomposition approach would be the appropriate one for the Sysops Squad application. Addison wrote an ADR for this decision, outlining the trade-offs and justification for the component-based decomposition approach.</p>
        <blockquote>
        <p class="adr" id="adr_3"><em>ADR: Migration Using the Component-Based Decomposition Approach</em></p>
        
        <p><em>Context</em><br>
        We will be breaking apart the monolithic Sysops Squad application into separately deployed services. The two approaches we considered for the migration to a distributed architecture were tactical forking and component-based decomposition.</p>
        
        <p><em>Decision</em><br>
        We will use the component-based decomposition approach to migrate the existing monolithic Sysops Squad application to a distributed architecture.</p>
        
        <p>The application has well-defined component boundaries, lending itself to the component-based decomposition approach.</p>
        
        <p>This approach reduces the chance of having to maintain duplicate code within each 
        <span class="keep-together">service</span>.</p>
        
        <p>With the tactical forking approach, we would have to define the service boundaries up front to know how many forked applications to create. With the component-based decomposition approach, the service definitions will naturally emerge through component grouping.</p>
        
        <p>Given the nature of the problems we are facing with the current application with regard to reliability, availability, scalability, and workflow, using the component-based decomposition approach provides a safer and more controlled incremental migration than the tactical forking approach does.</p>
        
        <p><em>Consequences</em><br>
        The migration effort will likely take longer with the component-based decomposition approach than with tactical forking. However, we feel the justifications in the previous section outweigh this trade-off.</p>
        
        <p>This approach allows the developers on the team to work collaboratively to identify shared functionality, component boundaries, and domain boundaries. Tactical forking would require us to break apart the team into smaller, separate teams for each forked application and increase the amount of coordination needed between the smaller teams.</p></blockquote>
        </div>
        </div></section>
        
        
        
        
        
        
        
        </div></section></div></div><link rel="stylesheet" href="/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="/api/v2/epubs/urn:orm:book:9781492086888/files/epub.css" crossorigin="anonymous"><script src="https://learning.oreilly.comhttps://cdn.jsdelivr.net/npm/mathjax@3/es5/mml-svg.js"></script></div></div></section>
</div>

https://learning.oreilly.com