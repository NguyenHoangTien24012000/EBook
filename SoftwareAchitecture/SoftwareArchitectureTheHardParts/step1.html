<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
    
</style>
<link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492092506/files/epub.css" crossorigin="anonymous">
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" class="pagenumrestart" data-pdf-bookmark="Chapter 1. What Happens When There 
        Are No “Best Practices”?"><div class="chapter" id="ch01-introduction">
        <h1><span class="label">Chapter 1. </span>What Happens When There 
        <span class="keep-together">Are No “Best Practices”</span>?</h1>
        
        
        <p>Why does a technologist like a software architect present at a conference or write a book? Because they have discovered what is colloquially known as a “best practice,” <a data-type="indexterm" data-primary="best practices nonexistent" id="idm45978858096016"></a>a term so overused that those who speak it increasingly experience backlash. Regardless of the term, technologists write books when they have figured out a novel solution to a general problem and want to broadcast it to a wider audience.</p>
        
        <p>But what happens for that vast set of problems that have no good solutions? Entire classes of problems exist in software architecture that have no general good solutions, but rather present one messy set of trade-offs cast against an (almost) equally messy set.</p>
        
        <p>Software developers build outstanding skills in searching online for solutions to a current problem. For example, if they need to figure out how to configure a particular tool in their environment, expert use of Google finds the answer.</p>
        
        <p>But that’s not true for architects.</p>
        
        <p>For architects, many problems present unique challenges because they conflate the exact environment and circumstances of your organization—what are the chances that someone has encountered exactly this scenario <em>and</em> blogged it or posted it on Stack Overflow?</p>
        
        <p>Architects may have wondered why so few books exist about architecture compared to technical topics like frameworks, APIs, and so on. Architects rarely experience common problems but constantly struggle with decision making in novel situations. For architects, every problem is a snowflake. In many cases, the problem is novel not just within a particular organization but rather throughout the world. No books or conference sessions exist for those problems!</p>
        
        <p>Architects shouldn’t constantly seek out silver-bullet solutions to their problems; they are as rare now as in 1986, when Fred Brooks coined the term:<a data-type="indexterm" data-primary="Brooks, Fred" id="idm45978849676848"></a><a data-type="indexterm" data-primary="silver-bullet solutions" id="idm45978850248448"></a></p>
        <blockquote>
        <p>There is no single development, in either technology or management technique, which by itself promises even one order of magnitude [tenfold] improvement within a decade in productivity, in reliability, in simplicity.</p>
        <p data-type="attribution">Fred Brooks from “No Silver Bullet”</p>
        </blockquote>
        
        <p>Because virtually every problem presents novel challenges, the real job of an architect lies in their ability to objectively determine and assess the set of trade-offs on either side of a consequential decision to resolve it as well as possible. The authors don’t talk about “best solutions” (in this book or in the real world) because “best” implies that an architect has managed to maximize all the possible competing factors within the design. Instead, our tongue-in-cheek advice is as follows:<a data-type="indexterm" data-primary="trade-off analysis" data-secondary="assessing trade-offs" data-tertiary="least worst combination" id="idm45978858080048"></a></p>
        <div data-type="tip"><h6>Tip</h6>
        <p>Don’t try to find the <em>best</em> design in software architecture; instead, strive for the <em>least worst</em> combination of trade-offs.</p>
        </div>
        
        <p>Often, the best design an architect can create is the least worst collection of trade-offs—no single architecture characteristics excels as it would alone, but the balance of all the competing architecture characteristics promote project success.</p>
        
        <p>Which begs the question: “How can an architect <em>find</em> the least worst combination of trade-offs (and document them effectively)?” This book is primarily about decision making, enabling architects to make better decisions when confronted with novel 
        <span class="keep-together">situations</span>.</p>
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Why “The Hard Parts”?"><div class="sect1" id="idm45978864964800">
        <h1>Why “The Hard Parts”?</h1>
        
        <p>Why did we call this book <em>Software Architecture: The Hard Parts?</em> Actually,<a data-type="indexterm" data-primary="hard parts of architecture" id="idm45978858142240"></a> the “hard” in the title performs double duty. First, <em>hard</em> connotes <em>difficult</em>, and architects constantly face difficult problems that literally (and figuratively) no one has faced before, involving numerous technology decisions with long-term implications layered on top of the interpersonal and political environment where the decision must take place.</p>
        
        <p>Second, <em>hard</em> connotes <em>solidity</em>—just as in the separation of <em>hardware</em> and <em>software</em>, the <em>hard</em> one should change much less because it provides the foundation for the <em>soft</em> stuff. Similarly, architects discuss the distinction between <em>architecture</em> and <em>design</em>, where the former is structural and the latter is more easily changed. Thus, in this book, we talk about the foundational parts of architecture.</p>
        
        <p>The definition of software architecture itself has provided many hours of non-productive conversation among its practitioners. <a data-type="indexterm" data-primary="architecture" data-secondary="definitions of terms" data-tertiary="architecture definition" id="idm45978858085984"></a>One favorite tongue-in-cheek definition is that “software architecture is the <em>stuff</em> that’s hard to change later.” That <em>stuff</em> is what our book is about.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Giving Timeless Advice About Software Architecture"><div class="sect1" id="idm45978858115600">
        <h1>Giving Timeless Advice About Software Architecture</h1>
        
        <p>The software development ecosystem constantly and chaotically shifts and grows.<a data-type="indexterm" data-primary="architecture" data-secondary="evolution of" id="idm45978850137744"></a> Topics that were all the rage a few years ago have either been subsumed by the ecosystem and disappeared or replaced by something different/better. <a data-type="indexterm" data-primary="service-based architecture" data-secondary="evolution of architecture" id="idm45978858152240"></a><a data-type="indexterm" data-primary="distributed architectures" data-secondary="evolution of architecture" id="idm45978858151360"></a>For example, 10 years ago, the predominant architecture style for large enterprises was orchestration-driven, service-oriented architecture. Now, virtually no one builds in that architecture style anymore (for reasons we’ll uncover along the way); the current favored style for many distributed systems is microservices. How and why did that transition happen?</p>
        
        <p>When architects look at a particular style (especially a historical one), they must consider the constraints in place that lead to that architecture becoming dominant. At the time, many companies were merging to become <em>enterprises</em>, with all the attendant integration woes that come with that transition. Additionally, open source wasn’t a viable option (often for political rather than technical reasons) for large companies. Thus, architects emphasized shared resources and centralized orchestration as a 
        <span class="keep-together">solution</span>.</p>
        
        <p>However, in the intervening years, open source and Linux became viable alternatives, making operating systems <em>commercially</em> free. However, the real tipping point occurred when Linux became <em>operationally</em> free with the advent of tools like Puppet and Chef, which allowed development teams to programmatically spin up their environments as part of an automated build. Once that capability arrived, it fostered an architectural revolution with microservices and the quickly emerging infrastructure of containers and orchestration tools like Kubernetes.</p>
        
        <p>This illustrates that the software development ecosystem expands and evolves in completely unexpected ways. One new capability leads to another one, which unexpectedly creates new capabilities. Over the course of time, the ecosystem completely replaces itself, one piece at a time.</p>
        
        <p>This presents an age-old problem for authors of books about technology generally and software architecture specifically—how can we write something that isn’t old immediately?</p>
        
        <p>We don’t focus on technology or other implementation details in this book. Rather, we focus on <em>how</em> architects make decisions, and how to objectively weigh trade-offs when presented with novel situations. We use contemporaneous scenarios and examples to provide details and context, but the underlying principles focus on trade-off analysis and decision making when faced with new problems.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="The Importance of Data in Architecture"><div class="sect1" id="sec-data-in-arch">
        <h1>The Importance of Data in Architecture</h1>
        <blockquote>
        <p>Data is a precious thing and will last longer than the systems themselves.</p>
        <p data-type="attribution">Tim Berners-Lee</p>
        </blockquote>
        
        <p>For many in architecture, data is everything. Every enterprise <a data-type="indexterm" data-primary="Berners-Lee, Tim" id="idm45978858264528"></a><a data-type="indexterm" data-primary="architecture" data-secondary="data importance" data-seealso="data" id="idm45978858263824"></a><a data-type="indexterm" data-primary="data" data-secondary="about importance of" id="idm45978850259328"></a><a data-type="indexterm" data-primary="monolithic architectures" data-secondary="data importance" id="idm45978850321344"></a><a data-type="indexterm" data-primary="distributed architectures" data-secondary="data importance" data-seealso="data" id="idm45978850320432"></a>building any system must deal with data, as it tends to live much longer than systems or architecture, requiring diligent thought and design. However, many of the instincts of data architects to build tightly coupled systems create conflicts within modern distributed architectures. For example, architects and DBAs must ensure that business data survives the breaking apart of monolith systems and that the business can still derive value from its data regardless of architecture undulations.</p>
        
        <p>It has been said that <em>data is the most important asset in a company</em>. Businesses want to extract value from the data that they have and are finding new ways to deploy data in decision making. Every part of the enterprise is now data driven, from servicing existing customers, to acquiring new customers, increasing customer retention, improving products, predicting sales, and other trends. This reliance on data means that all software architecture is in the service of data, ensuring the right data is available and usable by all parts of the enterprise.</p>
        
        <p>The authors built many distributed systems a few decades ago when they first became popular, yet decision making in modern microservices seems more difficult, and we wanted to figure out why. We eventually realized that, back in the early days of distributed architecture, we mostly still persisted data in a single relational database. <a data-type="indexterm" data-primary="microservices" data-secondary="bounded context" id="idm45978849988144"></a><a data-type="indexterm" data-primary="bounded context in microservices" id="idm45978849987168"></a><a data-type="indexterm" data-primary="Domain-Driven Design (DDD)" data-secondary="bounded context" id="idm45978849990640"></a>However, in microservices and the philosophical adherence to  a <em>bounded context</em> from <a href="https://oreil.ly/bW8CH">Domain-Driven Design</a>, as a way of limiting the scope of implementation detail coupling, data has moved to an architectural concern, along with transactionality. Many of the hard parts of modern architecture derive from tensions between data and architecture concerns, which we untangle in both <a data-type="xref" href="part01.html#part1-pulling-things-apart">Part&nbsp;I</a> and <a data-type="xref" href="part02.html#part2-putting-things-back-together">Part&nbsp;II</a>.</p>
        
        <p>One important distinction that we cover in a variety of chapters is the separation between <em>operational</em> versus <em>analytical</em> data:<a data-type="indexterm" data-primary="data" data-secondary="about operational versus analytical" id="idm45978850257248"></a><a data-type="indexterm" data-primary="data" data-secondary="analytical data" data-tertiary="about" id="idm45978850256272"></a><a data-type="indexterm" data-primary="analytical data" data-secondary="about" id="idm45978850184208"></a></p>
        <dl>
        <dt>Operational data</dt>
        <dd>
        <p>Data used for the operation of the business,<a data-type="indexterm" data-primary="operational data definition" id="idm45978858118048"></a> including sales, transactional data, inventory, and so on. This data is what the company runs on—if something interrupts this data, the organization cannot function for very long. <a data-type="indexterm" data-primary="Online Transactional Processing (OLTP)" id="idm45978858117248"></a>This type of data is defined as <em>Online Transactional Processing</em> (OLTP), which typically involves inserting, updating, and deleting data in a database.</p>
        </dd>
        </dl>
        <dl class="pagebreak-before less_space">
        <dt>Analytical data</dt>
        <dd>
        <p>Data used by data scientists and other business analysts <a data-type="indexterm" data-primary="analytical data" data-secondary="definition" id="idm45978850418848"></a><a data-type="indexterm" data-primary="data" data-secondary="analytical data" data-tertiary="definition" id="idm45978850417872"></a>for predictions, trending, and other business intelligence. This data is typically not transactional and often not relational—it may be in a graph database or snapshots in a different format than its original transactional form. This data isn’t critical for the day-to-day operation but rather for the long-term strategic direction and decisions.</p>
        </dd>
        </dl>
        
        <p>We cover the impact of both operational and analytical data throughout the book.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Architectural Decision Records"><div class="sect1" id="sec-adr">
        <h1>Architectural Decision Records</h1>
        
        <p>One of the most effective ways of documenting architecture decisions<a data-type="indexterm" data-primary="Architectural Decision Records (ADRs)" id="idm45978849804464"></a><a data-type="indexterm" data-primary="Nygard, Michael" id="idm45978849702096"></a><a data-type="indexterm" data-primary="Thoughtworks" data-secondary="Architectural Decision Records" id="idm45978849701424"></a> is through <em>Architectural Decision Records</em> (<a href="https://adr.github.io">ADRs</a>). ADRs were first evangelized by Michael Nygard in a <a href="https://oreil.ly/yDcU2">blog post</a> and later marked as “adopt” in the  <a href="https://oreil.ly/0nwHw">Thoughtworks Technology Radar</a>. An ADR consists of a short text file (usually one to two pages long) describing a specific architecture decision. While ADRs can be written using plain text, they are usually written in some sort of text document format like <a href="http://asciidoc.org">AsciiDoc</a> or <a href="https://www.markdownguide.org">Markdown</a>. Alternatively, an ADR can also be written using a wiki page template. We devoted an entire chapter to ADRs in our previous book, <a class="orm:hideurl" href="https://learning.oreilly.com/library/view/fundamentals-of-software/9781492043447"><em>Fundamentals of Software Architecture</em></a> (O’Reilly).</p>
        
        <p>We will be leveraging ADRs as a way of documenting various architecture decisions made throughout the book. For each architecture decision, we will be using the following ADR format with the assumption that each ADR is approved:</p>
        <blockquote>
        <p class="adr" id="adr_1"><em>ADR: A short noun phrase containing the architecture decision</em></p>
        
        <p><em>Context</em><br>
        In this section of the ADR we will add a short one- or two-sentence description of the problem, and list the alternative solutions.<br></p>
        
        <p><em>Decision</em><br>
        In this section we will state the architecture decision and provide a detailed justification of the decision.<br></p>
        
        <p><em>Consequences</em><br>
        In this section of the ADR we will describe any consequences after the decision is applied, and also discuss the trade-offs that were considered.</p></blockquote>
        
        <p>A list of all the Architectural Decision Records created in this book can be found in <a data-type="xref" href="app02.html#sec-adr-list">Appendix&nbsp;B</a>.</p>
        
        <p>Documenting a decision is important for an architect, but governing the proper<a data-type="indexterm" data-primary="trade-off analysis" data-secondary="documenting versus governing" id="idm45978869710208"></a> use of the decision is a separate topic. Fortunately, modern engineering practices allow automating many common governance concerns by using architecture fitness 
        <span class="keep-together">functions</span>.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Architecture Fitness Functions"><div class="sect1" id="idm45978851278544">
        <h1>Architecture Fitness Functions</h1>
        
        <p>Once an architect has identified the relationship between components and codified that into a design, <a data-type="indexterm" data-primary="architecture" data-secondary="architecture governance" id="idm45978850175408"></a><a data-type="indexterm" data-primary="architecture governance" id="idm45978851113184"></a>how can they make sure that the implementers will adhere to that design? More broadly, how can architects ensure that the design principles they define become reality if they aren’t the ones to implement them?</p>
        
        <p>These questions fall under the heading of <em>architecture governance</em>, which applies to any organized oversight of one or more aspects of software development. As this book primarily covers architecture structure, we cover how to automate design and quality principles via fitness functions in many places.</p>
        
        <p>Software development has slowly evolved over time to adapt unique engineering practices. <a data-type="indexterm" data-primary="architecture" data-secondary="evolution of" id="idm45978850743264"></a>In the early days of software development, a manufacturing metaphor was commonly applied to software practices, both in the large (like the Waterfall development process) and small (integration practices on projects). In the early 1990s, a rethinking of software development engineering practices, <a data-type="indexterm" data-primary="Beck, Kent" id="idm45978849675440"></a><a data-type="indexterm" data-primary="eXtreme Programming (XP)" id="idm45978849674768"></a>lead by Kent Beck and the other engineers on the C3 project, called eXtreme Programming (XP), illustrated the importance of incremental feedback and automation as key enablers of software development productivity. In the early 2000s, the same lessons were applied to the intersection of software development and operations, spawning the new role of DevOps and automating many formerly manual operational chores. Just as before, automation allows teams to go faster because they don’t have to worry about things breaking without good feedback. Thus, <em>automation</em> and <em>feedback</em> have become central tenets for effective software development.</p>
        
        <p>Consider the environments and situations that lead to breakthroughs in automation. In the era before continuous integration, most software projects included a lengthy integration phase. Each developer was expected to work in some level of isolation from others, then integrate all the code at the end into an integration phase. Vestiges of this practice still linger in version control tools that force branching and prevent continuous integration. Not surprisingly, a strong correlation existed between project size and the pain of the integration phase. By pioneering continuous integration, the XP team illustrated the value of rapid, continuous feedback.</p>
        
        <p>The DevOps revolution followed a similar course. As Linux and other open source software became “good enough” for enterprises, combined with the advent of tools that allowed programmatic definition of (eventually) virtual machines, operations personnel realized they could automate machine definitions and many other repetitive tasks.</p>
        
        <p>In both cases, advances in technology and insights led to automating a recurring job that was handled by an expensive role—which describes the current state of architecture governance in most organizations. For example, if an architect chooses a particular architecture style or communication medium, how can they make sure that a developer implements it correctly? When done manually, architects perform code reviews or perhaps hold architecture review boards to assess the state of governance. However, just as in manually configuring computers in operations, important details can easily fall through superficial reviews.</p>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Using Fitness Functions"><div class="sect2" id="idm45978849937840">
        <h2>Using Fitness Functions</h2>
        
        <p>In the 2017 book <em>Building Evolutionary Architectures</em> (O’Reilly), the authors (Neal Ford, Rebecca Parsons, and Patrick Kua) <a data-type="indexterm" data-primary="architecture" data-secondary="architecture governance" data-tertiary="fitness functions" data-seealso="fitness functions" id="idm45978850836864"></a><a data-type="indexterm" data-primary="architecture governance" data-secondary="fitness functions" data-seealso="fitness functions" id="idm45978850921824"></a><a data-type="indexterm" data-primary="fitness functions for governance" data-secondary="about" id="ch01ff"></a><a data-type="indexterm" data-primary="architectural fitness functions" data-see="fitness functions for governance" id="idm45978849889856"></a>defined the concept of an <em>architectural fitness function</em>: any mechanism that performs an objective integrity assessment of some architecture characteristic or combination of architecture characteristics. Here is a point-by-point breakdown of that definition:</p>
        <dl>
        <dt>Any mechanism</dt>
        <dd>
        <p>Architects can use a wide variety of tools to implement fitness functions; we will show numerous examples throughout the book. For example, dedicated testing libraries exist to test architecture structure, architects can use monitors to test operational architecture characteristics such as performance or scalability, and chaos engineering frameworks test reliability and resiliency.</p>
        </dd>
        <dt>Objective integrity assessment</dt>
        <dd>
        <p>One key enabler for automated governance lies with objective definitions for architecture characteristics. For example, an architect can’t specify that they want a “high performance” website; they must provide an object value that can be measured by a test, monitor, or other fitness function.</p>
        
        <p>Architects must watch out for <em>composite architecture characteristics</em>—ones<a data-type="indexterm" data-primary="composite architecture characteristics" id="idm45978849735312"></a><a data-type="indexterm" data-primary="fitness functions for governance" data-secondary="about" data-tertiary="composite architecture characteristics" id="idm45978849734544"></a> that aren’t objectively measurable but are really composites of other measurable things. For example, “agility” isn’t measurable, but if an architect starts pulling the broad term <em>agility</em> apart, the goal is for teams to be able to respond quickly and confidently to change, either in ecosystem or domain. Thus, an architect can find measurable characteristics that contribute to agility: deployability, testability, cycle time, and so on. Often, the lack of ability to measure an architecture characteristic indicates too vague a definition. If architects strive toward measurable properties, it allows them to automate fitness function application.</p>
        </dd>
        <dt>Some architecture characteristic or combination of architecture characteristics</dt>
        <dd>
        <div class="openblock">
        <p>This characteristic describes the two scopes for fitness functions:</p>
        <dl>
        <dt>Atomic</dt>
        <dd>
        <p>These fitness functions handle a single architecture characteristic in isolation.<a data-type="indexterm" data-primary="fitness functions for governance" data-secondary="about" data-tertiary="atomic" id="idm45978850269296"></a><a data-type="indexterm" data-primary="atomic fitness functions" id="idm45978850268144"></a> For example, a fitness function that checks for component cycles within a codebase is atomic in scope.</p>
        </dd>
        <dt>Holistic</dt>
        <dd>
        <p><em>Holistic</em> fitness functions validate a combination of <a data-type="indexterm" data-primary="fitness functions for governance" data-secondary="about" data-tertiary="holistic" id="idm45978858108304"></a>architecture characteristics. A complicating feature of architecture characteristics is the synergy they sometimes exhibit with other architecture characteristics. For example, if an architect wants to improve security, a good chance exists that it will affect performance. Similarly, scalability and elasticity are sometimes at odds—supporting a large number of concurrent users can make handling sudden bursts more difficult. Holistic fitness functions exercise a combination of interlocking architecture characteristics to ensure that the combined effect won’t negatively affect the architecture.</p>
        </dd>
        </dl>
        </div>
        
        </dd>
        </dl>
        
        <p>An architect implements fitness functions to build protections around unexpected change in architecture characteristics. In the Agile software development world, developers implement unit, functional, and user acceptance tests to validate different dimensions of the <em>domain</em> design. However, until now, no similar mechanism existed to validate the <em>architecture characteristics</em> part of the design. In fact, the separation between fitness functions and unit tests provides a good scoping guideline for architects. Fitness functions validate architecture characteristics, not domain criteria; unit tests are the opposite. Thus, an architect can decide whether a fitness function or unit test is needed by asking the question: “Is any domain knowledge required to execute this test?” If the answer is “yes,” then a unit/function/user acceptance test is appropriate; if “no,” then a fitness function is needed.</p>
        
        <p>For example, when architects talk about <em>elasticity</em>, it’s the ability of the application to withstand a sudden burst of users. Notice that the architect doesn’t need to know any details about the domain—this could be an ecommerce site, an online game, or something else. Thus, <em>elasticity</em> is an architectural concern and within the scope of a fitness function. If on the other hand the architect wanted to validate the proper parts of a mailing address, that is covered via a traditional test. Of course, this separation isn’t purely binary—some fitness functions will touch on the domain and vice versa, but the differing goals provide a good way to mentally separate them.</p>
        
        <p>Here are a couple of examples to make the concept less abstract.</p>
        
        <p>One common architect goal is to maintain good internal structural integrity in the codebase.<a data-type="indexterm" data-primary="fitness functions for governance" data-secondary="examples" data-tertiary="component cycles avoided" id="idm45978850383664"></a> However, malevolent forces work against the architect’s good intentions on many platforms. For example, when coding in any popular Java or .NET development environment, as soon as a developer references a class not already imported, the IDE helpfully presents a dialog asking the developer if they would like to auto-import the reference. This occurs so often that most programmers develop the habit of swatting the auto-import dialog away like a reflex action. <a data-type="indexterm" data-primary="modularity" data-secondary="architectural governance" id="idm45978849777104"></a></p>
        
        <p>However, arbitrarily importing classes or components among one another spells disaster for modularity. For example, <a data-type="xref" href="#fig-arch-vs-design-cycles">Figure 1-1</a> illustrates a particularly damaging anti-pattern that architects aspire to avoid.</p>
        
        <figure><div id="fig-arch-vs-design-cycles" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0101.png" alt="cyclic dependencies illustration" width="600" height="202">
        <h6><span class="label">Figure 1-1. </span>Cyclic dependencies between components</h6>
        </div></figure>
        
        <p>In this anti-pattern, each component references something in the others. Having a network of components such as this damages modularity because a developer cannot reuse a single component without also bringing the others along. And, of course, if the other components are coupled to other components, the architecture tends more and more toward the <a href="https://oreil.ly/usx7p">Big Ball of Mud</a> anti-pattern. How can architects govern this behavior without constantly looking over the shoulders of trigger-happy developers? Code reviews help but happen too late in the development cycle to be effective. If an architect allows a development team to rampantly import across the codebase for a week until the code review, serious damage has already occurred in the codebase.</p>
        
        <p>The solution to this problem is to write a fitness function to avoid component cycles, as shown in <a data-type="xref" href="#src_cycle_ff">Example&nbsp;1-1</a>.</p>
        <div id="src_cycle_ff" data-type="example">
        <h5><span class="label">Example 1-1. </span>Fitness function to detect component cycles</h5>
        
        <pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">CycleTest</code> <code class="o">{</code>
            <code class="kd">private</code> <code class="n">JDepend</code> <code class="n">jdepend</code><code class="o">;</code>
        
            <code class="nd">@BeforeEach</code>
            <code class="kt">void</code> <code class="nf">init</code><code class="o">()</code> <code class="o">{</code>
              <code class="n">jdepend</code> <code class="o">=</code> <code class="k">new</code> <code class="n">JDepend</code><code class="o">();</code>
              <code class="n">jdepend</code><code class="o">.</code><code class="na">addDirectory</code><code class="o">(</code><code class="s">"/path/to/project/persistence/classes"</code><code class="o">);</code>
              <code class="n">jdepend</code><code class="o">.</code><code class="na">addDirectory</code><code class="o">(</code><code class="s">"/path/to/project/web/classes"</code><code class="o">);</code>
              <code class="n">jdepend</code><code class="o">.</code><code class="na">addDirectory</code><code class="o">(</code><code class="s">"/path/to/project/thirdpartyjars"</code><code class="o">);</code>
            <code class="o">}</code>
        
            <code class="nd">@Test</code>
            <code class="kt">void</code> <code class="nf">testAllPackages</code><code class="o">()</code> <code class="o">{</code>
              <code class="n">Collection</code> <code class="n">packages</code> <code class="o">=</code> <code class="n">jdepend</code><code class="o">.</code><code class="na">analyze</code><code class="o">();</code>
              <code class="n">assertEquals</code><code class="o">(</code><code class="s">"Cycles exist"</code><code class="o">,</code> <code class="kc">false</code><code class="o">,</code> <code class="n">jdepend</code><code class="o">.</code><code class="na">containsCycles</code><code class="o">());</code>
            <code class="o">}</code>
        <code class="o">}</code></pre></div>
        
        <p>In the code, an architect uses the metrics tool <a href="https://oreil.ly/ozzzk">JDepend</a> to <a data-type="indexterm" data-primary="dependencies" data-secondary="tools" data-tertiary="JDepend" id="idm45978865400288"></a><a data-type="indexterm" data-primary="JDepend tool" id="idm45978851057776"></a><a data-type="indexterm" data-primary="resources online" data-secondary="dependency tools" data-tertiary="JDepend" id="idm45978851057104"></a><a data-type="indexterm" data-primary="tools" data-secondary="dependencies" data-tertiary="JDepend" id="idm45978851055888"></a>check the dependencies between packages. The tool understands the structure of Java packages and fails the test if any cycles exist. An architect can wire this test into the continuous build on a project and stop worrying about the accidental introduction of cycles by trigger-happy developers. This is a great example of a fitness function 
        <span class="keep-together">guarding</span> the important rather than urgent practices of software development: it’s an important concern for architects, yet has little impact on day-to-day coding.</p>
        
        <p><a data-type="xref" href="#src_cycle_ff">Example&nbsp;1-1</a> shows a very low-level, code-centric fitness function. <a data-type="indexterm" data-primary="tools" data-secondary="SonarQube code hygiene tool" id="idm45978851052416"></a><a data-type="indexterm" data-primary="SonarQube code hygiene tool" id="idm45978851051504"></a>Many popular code hygiene tools (such as <a href="https://www.sonarqube.org">SonarQube</a>) implement many common fitness functions in a turnkey manner. <a data-type="indexterm" data-primary="fitness functions for governance" data-secondary="examples" data-tertiary="layer relationship verification" id="idm45978851050112"></a>However, architects may also want to validate the macro structure of the architecture as well as the micro. When designing a layered architecture such as the one in<a data-type="indexterm" data-primary="layered architecture" data-secondary="architecture governance" id="idm45978858010336"></a> <a data-type="xref" href="#fig-arch-vs-design-layer_ff">Figure 1-2</a>, the architect defines the layers to ensure separation of concerns.</p>
        
        <figure><div id="fig-arch-vs-design-layer_ff" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0102.png" alt="layered architecture" width="569" height="701">
        <h6><span class="label">Figure 1-2. </span>Traditional layered architecture</h6>
        </div></figure>
        
        <p>However, how can the architect ensure that developers will respect these layers? Some developers may not understand the importance of the patterns, while others may adopt a “better to ask forgiveness than permission” attitude because of some overriding local concern, such as performance. But allowing implementers to erode the reasons for the architecture hurts the long-term health of the architecture.</p>
        
        <p><a href="https://www.archunit.org">ArchUnit</a> allows architects to address this problem via a fitness function, shown in <a data-type="xref" href="#src_archunitff">Example&nbsp;1-2</a>.</p>
        <div id="src_archunitff" data-type="example">
        <h5><span class="label">Example 1-2. </span>ArchUnit fitness function to govern layers</h5>
        
        <pre data-type="programlisting" data-code-language="java"><code class="n">layeredArchitecture</code><code class="o">()</code>
            <code class="o">.</code><code class="na">layer</code><code class="o">(</code><code class="s">"Controller"</code><code class="o">).</code><code class="na">definedBy</code><code class="o">(</code><code class="s">"..controller.."</code><code class="o">)</code>
            <code class="o">.</code><code class="na">layer</code><code class="o">(</code><code class="s">"Service"</code><code class="o">).</code><code class="na">definedBy</code><code class="o">(</code><code class="s">"..service.."</code><code class="o">)</code>
            <code class="o">.</code><code class="na">layer</code><code class="o">(</code><code class="s">"Persistence"</code><code class="o">).</code><code class="na">definedBy</code><code class="o">(</code><code class="s">"..persistence.."</code><code class="o">)</code>
        
            <code class="o">.</code><code class="na">whereLayer</code><code class="o">(</code><code class="s">"Controller"</code><code class="o">).</code><code class="na">mayNotBeAccessedByAnyLayer</code><code class="o">()</code>
            <code class="o">.</code><code class="na">whereLayer</code><code class="o">(</code><code class="s">"Service"</code><code class="o">).</code><code class="na">mayOnlyBeAccessedByLayers</code><code class="o">(</code><code class="s">"Controller"</code><code class="o">)</code>
            <code class="o">.</code><code class="na">whereLayer</code><code class="o">(</code><code class="s">"Persistence"</code><code class="o">).</code><code class="na">mayOnlyBeAccessedByLayers</code><code class="o">(</code><code class="s">"Service"</code><code class="o">)</code></pre></div>
        
        <p>In <a data-type="xref" href="#src_archunitff">Example&nbsp;1-2</a>, the architect defines the desirable relationship between layers and writes a verification fitness function to govern it. This allows an architect to establish architecture principles outside the diagrams and other informational artifacts, and verify them on an ongoing basis.</p>
        
        <p>A similar tool in the .NET space,<a data-type="indexterm" data-primary="dependencies" data-secondary="tools" data-tertiary="NetArchTest" id="idm45978851996848"></a><a data-type="indexterm" data-primary="tools" data-secondary="dependencies" data-tertiary="NetArchTest" id="idm45978851995664"></a><a data-type="indexterm" data-primary="NetArchTest tool" id="idm45978851994448"></a><a data-type="indexterm" data-primary="resources online" data-secondary="dependency tools" data-tertiary="NetArchTest" id="idm45978851993776"></a> <a href="https://oreil.ly/EMXpv">NetArchTest</a>, allows similar tests for that platform. A layer verification in C# appears in <a data-type="xref" href="#src_netarchtest">Example&nbsp;1-3</a>.</p>
        <div id="src_netarchtest" data-type="example">
        <h5><span class="label">Example 1-3. </span>NetArchTest for layer dependencies</h5>
        
        <pre data-type="programlisting" data-code-language="csharp"><code class="c1">// Classes in the presentation should not directly reference repositories</code>
        <code class="kt">var</code> <code class="n">result</code> <code class="p">=</code> <code class="n">Types</code><code class="p">.</code><code class="n">InCurrentDomain</code><code class="p">()</code>
            <code class="p">.</code><code class="n">That</code><code class="p">()</code>
            <code class="p">.</code><code class="n">ResideInNamespace</code><code class="p">(</code><code class="s">"NetArchTest.SampleLibrary.Presentation"</code><code class="p">)</code>
            <code class="p">.</code><code class="n">ShouldNot</code><code class="p">()</code>
            <code class="p">.</code><code class="n">HaveDependencyOn</code><code class="p">(</code><code class="s">"NetArchTest.SampleLibrary.Data"</code><code class="p">)</code>
            <code class="p">.</code><code class="n">GetResult</code><code class="p">()</code>
            <code class="p">.</code><code class="n">IsSuccessful</code><code class="p">;</code></pre></div>
        
        <p>Tools continue to appear in this space with increasing degrees of sophistication. We will continue to highlight many of these techniques as we illustrate fitness functions alongside many of our solutions.</p>
        
        <p>Finding an objective outcome for a fitness function is critical. <a data-type="indexterm" data-primary="fitness functions for governance" data-secondary="about" data-tertiary="outcomes" id="idm45978858041520"></a>However, <em>objective</em> doesn’t imply <em>static</em>. Some fitness functions will have noncontextual return values, such as true/false or a numeric value such as a performance threshold. However, other fitness functions (deemed <em>dynamic</em>) return a value based on some context. For example, when measuring <em>scalability</em>, architects measure the number of concurrent users and also generally measure the performance for each user. Often, architects design systems so that as the number of users goes up, performance per user declines slightly—but doesn’t fall off a cliff. Thus, for these systems, architects design performance fitness functions that take into account the number of concurrent users. As long as the measure of an architecture characteristic is objective, architects can test it.</p>
        
        <p>While most fitness functions should be automated and run continually, some will necessarily be manual.<a data-type="indexterm" data-primary="fitness functions for governance" data-secondary="about" data-tertiary="manual versus automated" id="idm45978857966592"></a> A manual fitness function requires a person to handle the validation. For example, for systems with sensitive legal information, a lawyer may need to review changes to critical parts to ensure legality, which cannot be automated. Most deployment pipelines support manual stages, allowing teams to accommodate manual fitness functions. Ideally, these are run as often as reasonably possible—a validation that doesn’t run can’t validate anything. Teams execute fitness functions either on demand (rarely) or as part of a continuous integration work stream (most 
        <span class="keep-together">common</span>). To fully achieve the benefit of validations such as fitness functions, they should be run continually.</p>
        
        <p>Continuity is important, as illustrated in this example of enterprise-level governance using fitness functions. <a data-type="indexterm" data-primary="fitness functions for governance" data-secondary="zero-day exploits" id="idm45978858067312"></a><a data-type="indexterm" data-primary="zero-day exploits" id="idm45978858066368"></a>Consider the following scenario: what does a company do when a zero-day exploit is discovered in one of the development frameworks or libraries the enterprise uses? If it’s like most companies, security experts scour projects to find the offending version of the framework and make sure it’s updated, but that process is rarely automated, relying on many manual steps. This isn’t an abstract question; this exact scenario affected a major financial institution described in <a href="#sidebar-equifax">The Equifax Data Breach</a>. Like the architecture governance described previously, manual processes are error prone and allow details to escape.<a data-type="indexterm" data-primary="architecture governance" data-secondary="Equifax data breach" id="idm45978858064784"></a><a data-type="indexterm" data-primary="Equifax data breach" id="idm45978858063808"></a><a data-type="indexterm" data-primary="architecture" data-secondary="architecture governance" data-tertiary="Equifax data breach" id="idm45978858063136"></a></p>
        <aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sidebar-equifax">
        <h5>The Equifax Data Breach</h5>
        <p>On September 7, 2017, Equifax, a major credit scoring agency in the US, announced that a data breach had occurred. Ultimately, the problem was traced to a hacking exploit of the popular Struts web framework in the Java ecosystem (Apache Struts vCVE-2017-5638). The foundation issued a statement announcing the vulnerability and released a patch on March 7, 2017. The Department of Homeland Security contacted Equifax and similar companies the next day, warning them of this problem, and they ran scans on March 15, 2017, which didn’t reveal all of the affected systems. Thus, the critical patch wasn’t applied to many older systems until July 29, 2017, when Equifax’s security experts identified the hacking behavior that lead to the data breach.</p>
        </div></aside>
        
        <p>Imagine an alternative world in which every project runs a deployment pipeline, and the security team has a “slot” in each team’s deployment pipeline where they can deploy fitness functions. Most of the time, these will be mundane checks for safeguards like preventing developers from storing passwords in databases and similar regular governance chores. However, when a zero-day exploit appears, having the same mechanism in place everywhere allows the security team to insert a test in every project that checks for a certain framework and version number; if it finds the dangerous version, it fails the build and notifies the security team. Teams configure  deployment pipelines to awaken for any change to the ecosystem: code, database schema, deployment configuration, and fitness functions. This allows enterprises to universally automate important governance tasks.</p>
        
        <p>Fitness functions provide many benefits for architects, not the least of which is the chance to do some coding again! One of the universal complaints among architects is that they don’t get to code much anymore—but fitness functions are often code! By building an executable specification of the architecture, which anyone can validate anytime by running the project’s build, architects must understand the system and its ongoing evolution well, which overlaps with the core goal of keeping up with the code of the project as it grows.</p>
        
        <p>However powerful fitness functions are, architects should avoid overusing them. <a data-type="indexterm" data-primary="fitness functions for governance" data-secondary="about" data-tertiary="overuse avoided" id="idm45978858058848"></a>Architects should not form a cabal and retreat to an ivory tower to build an impossibly complex, interlocking set of fitness functions that merely frustrate developers and teams. Instead, it’s a way for architects to build an executable checklist of <em>important</em> but not <em>urgent</em> principles on software projects. Many projects drown in urgency, allowing some important principles to slip by the side. This is the frequent cause of technical debt: “We know this is bad, but we’ll come back to fix it later”—and later never comes. By codifying rules about code quality, structure, and other safeguards against decay into fitness functions that run continually, architects build a quality checklist that developers can’t skip.</p>
        
        <p>A few years ago, the excellent book <em>The Checklist Manifesto</em> by Atul Gawande (Picador) <a data-type="indexterm" data-primary="Gawande, Atul" id="idm45978858033248"></a><a data-type="indexterm" data-primary="The Checklist Manifesto (Gawande)" data-primary-sortas="Checklist Manifesto" id="idm45978858032544"></a>highlighted the use of checklists by professionals like surgeons, airline pilots, and those other fields who commonly use (sometimes by force of law) checklists as part of their job. It isn’t because they don’t know their job or are particularly forgetful; when professionals perform the same task over and over, it becomes easy to fool themselves when it’s accidentally skipped, and checklists prevent that. Fitness functions represent a checklist of important principles defined by architects and run as part of the build to make sure developers don’t accidentally (or purposefully, because of external forces like schedule pressure) skip them.</p>
        
        <p>We utilize fitness functions throughout the book when an opportunity arises to illustrate governing an architectural solution as well as the initial design.<a data-type="indexterm" data-startref="ch01ff" id="idm45978858031024"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Architecture Versus Design: Keeping Definitions Simple"><div class="sect1" id="idm45978858029936">
        <h1>Architecture Versus Design: Keeping Definitions Simple</h1>
        
        <p>A constant area of struggle for architects is keeping <em>architecture</em> and <em>design</em> as separate but related activities.<a data-type="indexterm" data-primary="architecture" data-secondary="design versus" id="ch01-dva"></a><a data-type="indexterm" data-primary="design" data-secondary="architecture versus" id="ch01-dva2"></a><a data-type="indexterm" data-primary="software architecture" data-see="architecture" id="idm45978856495600"></a> While we don’t want to wade into the never-ending argument about this distinction, we strive in this book to stay firmly on the <em>architecture</em> side of that spectrum for several reasons.</p>
        
        <p>First, architects must understand underlying architecture principles to make effective decisions. For example, the decision between <em>synchronous</em> versus <em>asynchronous</em> communication has a number of trade-offs before architects layer in implementation details. <a data-type="indexterm" data-primary="architecture" data-secondary="why more important than how" id="idm45978856492656"></a><a data-type="indexterm" data-primary="why more important than how" id="idm45978856491664"></a>In the book <em>Fundamentals of Software Architecture</em>, the authors coined the second law of software architecture: <em>why</em> is more important than <em>how</em>. While ultimately architects must understand how to implement solutions, they must first understand why one choice has better trade-offs than another.</p>
        
        <p>Second, by focusing on architecture concepts, we can avoid the numerous implementations of those concepts. Architects can implement asynchronous communication in a variety of ways; we focus on why an architect would choose asynchronous communication and leave the implementation details to another place.</p>
        
        <p>Third, if we start down the path of implementing all the varieties of options we show, this would be the longest book ever written. Focus on architecture principles allows us to keep things as generic as they can be.</p>
        
        <p>To keep subjects as grounded in architecture as possible, we use the simplest definitions possible for key concepts. For example, <em>coupling</em> in architecture can fill entire books (and it has). To that end, we use the following simple, verging on simplistic, definitions:<a data-type="indexterm" data-primary="architecture" data-secondary="definitions of terms" id="idm45978856488048"></a></p>
        <dl>
        <dt>Service</dt>
        <dd>
        <p>In colloquial terms, a <em>service</em> is a cohesive collection of functionality<a data-type="indexterm" data-primary="services" data-secondary="definition" id="idm45978856484768"></a> deployed as an independent executable. Most of the concepts we discuss with regard to services apply broadly to distributed architectures, and specifically microservices architectures.</p>
        
        <p>In the terms we define in <a data-type="xref" href="ch02.html#ch02-discerning">Chapter&nbsp;2</a>, a <em>service</em> is part of an architecture quantum, which includes further definitions of both static and dynamic coupling between services and other quanta.</p>
        </dd>
        <dt>Coupling</dt>
        <dd>
        <p>Two artifacts (including services) are coupled if a change in one might require a change in the other to maintain proper functionality.<a data-type="indexterm" data-primary="coupling" data-secondary="definition" id="idm45978856480720"></a><a data-type="indexterm" data-primary="services" data-secondary="coupling definition" data-seealso="coupling" id="idm45978856479744"></a></p>
        </dd>
        <dt>Component</dt>
        <dd>
        <p>An architectural building block of the application that does some sort of business or infrastructure function,<a data-type="indexterm" data-primary="components" data-secondary="definition" id="idm45978856477120"></a> usually manifested through a package structure (Java), namespace (C#), or a physical grouping of source code files within some sort of directory structure. For example, the component Order History might be implemented through a set of class files located in the namespace <code>app.business.order.history</code>.</p>
        </dd>
        <dt>Synchronous communication</dt>
        <dd>
        <p>Two artifacts communicate synchronously if the caller must wait for the response before proceeding.<a data-type="indexterm" data-primary="synchronous communication" data-secondary="definition" id="idm45978857844304"></a></p>
        </dd>
        <dt>Asynchronous communication</dt>
        <dd>
        <p>Two artifacts communicate asynchronously if the caller does not wait for the<a data-type="indexterm" data-primary="asynchronous communication" data-secondary="definition" id="idm45978857842016"></a> response before proceeding. Optionally, the caller can be notified by the receiver through a separate channel when the request has completed.</p>
        </dd>
        <dt>Orchestrated coordination</dt>
        <dd>
        <p>A workflow is orchestrated if it includes a service whose primary responsibility is to coordinate the workflow.<a data-type="indexterm" data-primary="orchestrated coordination" data-secondary="definition" id="idm45978857839472"></a><a data-type="indexterm" data-primary="services" data-secondary="orchestrated coordination definition" id="idm45978857838432"></a><a data-type="indexterm" data-primary="coordination of workflow" data-secondary="orchestrated coordination" data-tertiary="definition" id="idm45978857837472"></a><a data-type="indexterm" data-primary="distributed workflows" data-secondary="orchestration" data-tertiary="definition" id="idm45978857836224"></a></p>
        </dd>
        <dt>Choreographed coordination</dt>
        <dd>
        <p>A workflow is choreographed when it lacks an orchestrator; <a data-type="indexterm" data-primary="choreographed coordination" data-secondary="definition" id="idm45978857833760"></a><a data-type="indexterm" data-primary="services" data-secondary="choreographed coordination definition" id="idm45978857832720"></a><a data-type="indexterm" data-primary="coordination of workflow" data-secondary="choreographed coordination" data-tertiary="definition" id="idm45978857831760"></a><a data-type="indexterm" data-primary="distributed workflows" data-secondary="choreography" data-tertiary="definition" id="idm45978857830512"></a>rather, the services in the workflow share the coordination responsibilities of the workflow.</p>
        </dd>
        <dt>Atomicity</dt>
        <dd>
        <p>A workflow is <em>atomic</em> if all parts of the workflow maintain a <a data-type="indexterm" data-primary="atomic workflow" data-secondary="definition" id="idm45978857827104"></a><a data-type="indexterm" data-primary="eventual consistency" data-secondary="atomic workflow versus" id="idm45978857826128"></a><a data-type="indexterm" data-primary="atomic workflow" data-secondary="eventual consistency versus" id="idm45978857825184"></a><a data-type="indexterm" data-primary="consistency" data-secondary="eventual consistency" data-tertiary="atomic workflow versus" id="idm45978857824272"></a>consistent state at all times; the opposite is represented by the spectrum of <em>eventual consistency</em>, covered in <a data-type="xref" href="ch06.html#ch06-decomposing-operational-data">Chapter&nbsp;6</a>.</p>
        </dd>
        <dt>Contract</dt>
        <dd>
        <p>We use the term <em>contract</em> broadly to define the interface between two<a data-type="indexterm" data-primary="contracts" data-secondary="definition" id="idm45978857820032"></a> software parts, which may encompass method or function calls, integration architecture remote calls, dependencies, and so on. Anywhere two pieces of software join, a contract is involved.</p>
        </dd>
        </dl>
        
        <p>Software architecture is by its nature abstract: we cannot know what unique combination of platforms, technologies, commercial software, and the other dizzying array of possibilities our readers might have, except that no two are exactly alike. We cover many abstract ideas, but must ground them with some implementation details to make them concrete. To that end, we need a problem to illustrate architecture concepts against—which leads us to the Sysops Squad.<a data-type="indexterm" data-startref="ch01-dva" id="idm45978857818544"></a><a data-type="indexterm" data-startref="ch01-dva2" id="idm45978857817840"></a></p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Introducing the Sysops Squad Saga"><div class="sect1" id="sec-sysops-squad">
        <h1>Introducing the Sysops Squad Saga</h1>
        <blockquote><dl>
        <dt>saga</dt>
        <dd>
        <p>A long story of heroic achievement.</p>
        </dd>
        </dl>
        <p data-type="attribution">Oxford English Dictionary</p>
        </blockquote>
        
        <p>We discuss a number of sagas in this book, both literal and figurative. <a data-type="indexterm" data-primary="sagas" data-secondary="definition" id="idm45978857812208"></a><a data-type="indexterm" data-primary="distributed architectures" data-secondary="sagas as transactional behavior" data-seealso="sagas" id="idm45978857811232"></a>Architects have co-opted the term <em>saga</em> to describe transactional behavior in distributed architectures (which we cover in detail in <a data-type="xref" href="ch12.html#ch12-transactional-sagas">Chapter&nbsp;12</a>). <a data-type="indexterm" data-primary="Sysops Squad sagas" data-secondary="about" id="idm45978857808464"></a><a data-type="indexterm" data-primary="sagas" data-secondary="Sysops Squad saga background" data-seealso="Sysops Squad sagas" id="idm45978857807488"></a>However, discussions about architecture tend to become abstract, especially when considering abstract problems such as the hard parts of architecture. To help solve this problem and provide some real-world context for the solutions we discuss, we kick off a literal saga about the <em>Sysops Squad</em>.</p>
        
        <p>We use the Sysops Squad saga within each chapter to illustrate the techniques and trade-offs described in this book. While many books on software architecture cover new development efforts, many real-world problems exist within existing systems. Therefore, our story starts with the existing Sysops Squad architecture highlighted here.</p>
        
        <p>Penultimate Electronics is a large electronics giant that has numerous retail stores throughout the country. When customers buy computers, TVs, stereos, and other electronic equipment, they can choose to purchase a support plan. When problems occur, customer-facing technology experts (the Sysops Squad) come to the customer’s residence (or work office) to fix problems with the electronic device.</p>
        
        <p>The four main users of the Sysops Squad ticketing application are as follows:</p>
        <dl>
        <dt>Administrator</dt>
        <dd>
        <p>The administrator maintains the internal users of the system, including the list of experts and their corresponding skill set, location, and availability. The administrator also manages all of the billing processing for customers using the system, and maintains static reference data (such as supported products, name-value pairs in the system, and so on).</p>
        </dd>
        <dt>Customer</dt>
        <dd>
        <p>The customer registers for the Sysops Squad service and maintains their customer profile, support contracts, and billing information. Customers enter problem tickets into the system, and also fill out surveys after the work has been completed.</p>
        </dd>
        <dt>Sysops Squad expert</dt>
        <dd>
        <p>Experts are assigned problem tickets and fix problems based on the ticket. They also interact with the knowledge base to search for solutions to customer problems and enter notes about repairs.</p>
        </dd>
        <dt>Manager</dt>
        <dd>
        <p>The manager keeps track of problem ticket operations and receives operational and analytical reports about the overall Sysops Squad problem ticket system.</p>
        </dd>
        </dl>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Nonticketing Workflow"><div class="sect2" id="idm45978857798544">
        <h2>Nonticketing Workflow</h2>
        
        <p>The nonticketing workflows include those actions that administrators,<a data-type="indexterm" data-primary="Sysops Squad sagas" data-secondary="about" data-tertiary="nonticketing workflow" id="idm45978857797216"></a> managers, and customers perform that do not relate to a problem ticket. These workflows are outlined as follows:</p>
        <ol>
        <li>
        <p>Sysops Squad experts are added and maintained in the system through an administrator, who enters in their locale, availability, and skills.</p>
        </li>
        <li>
        <p>Customers register with the Sysops Squad system and have multiple support plans based on the products they purchased.</p>
        </li>
        <li>
        <p>Customers are automatically billed monthly based on credit card information contained in their profile. Customers can view billing history and statements through the system.</p>
        </li>
        <li>
        <p>Managers request and receive various operational and analytical reports, including financial reports, expert performance reports, and ticketing reports.</p>
        </li>
        
        </ol>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Ticketing Workflow"><div class="sect2" id="idm45978857791104">
        <h2>Ticketing Workflow</h2>
        
        <p>The ticketing workflow starts when a customer enters a problem ticket into<a data-type="indexterm" data-primary="Sysops Squad sagas" data-secondary="about" data-tertiary="ticketing workflow" id="idm45978857789776"></a> the system, and ends when the customer completes the survey after the repair is done. This workflow is outlined as follows:</p>
        <ol>
        <li>
        <p>Customers who have purchased the support plan enter a problem ticket by using the Sysops Squad website.</p>
        </li>
        <li>
        <p>Once a problem ticket is entered in the system, the system then determines which Sysops Squad expert would be the best fit for the job based on skills, current location, service area, and availability.</p>
        </li>
        <li>
        <p>Once assigned, the problem ticket is uploaded to a dedicated custom mobile app on the Sysops Squad expert’s mobile device. The expert is also notified via a text message that they have a new problem ticket.</p>
        </li>
        <li>
        <p>The customer is notified through an SMS text message or email (based on their profile preference) that the expert is on their way.</p>
        </li>
        <li>
        <p>The expert uses the custom mobile application on their phone to retrieve the ticket information and location. The Sysops Squad expert can also access a knowledge base through the mobile app to find out what has been done in the past to fix the problem.</p>
        </li>
        <li>
        <p>Once the expert fixes the problem, they mark the ticket as “complete.” The sysops squad expert can then add information about the problem and repair the knowledge base.</p>
        </li>
        <li>
        <p>After the system receives notification that the ticket is complete, it sends an email to the customer with a link to a survey, which the customer then fills out.</p>
        </li>
        <li>
        <p>The system receives the completed survey from the customer and records the survey information.</p>
        </li>
        
        </ol>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="A Bad Scenario"><div class="sect2" id="idm45978857780048">
        <h2>A Bad Scenario</h2>
        
        <p>Things have not been good with the Sysops Squad problem ticket application lately.<a data-type="indexterm" data-primary="Sysops Squad sagas" data-secondary="about" data-tertiary="problem" id="idm45978857207744"></a> The current trouble ticket system is a large monolithic application that was developed many years ago. Customers are complaining that consultants are never showing up because of lost tickets, and often the wrong consultant shows up to fix something they know nothing about. Customers have also been complaining that the system is not always available to enter new problem tickets.</p>
        
        <p>Change is also difficult and risky in this large monolith. Whenever a change is made, it usually takes too long and something else usually breaks. Because of reliability issues, the Sysops Squad system frequently “freezes up,” or crashes, resulting in all application functionality not being available anywhere from five minutes to two hours while the problem is identified and the application restarted.</p>
        
        <p>If something isn’t done soon, Penultimate Electronics will be forced to abandon the very lucrative support contract business line and lay off all the Sysops Squad administrators, experts, managers, and IT development staff—including the architects.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Sysops Squad Architectural Components"><div class="sect2" id="idm45978857205312">
        <h2>Sysops Squad Architectural Components</h2>
        
        <p>The monolithic system for the Sysops Squad application handles ticket management,<a data-type="indexterm" data-primary="Sysops Squad sagas" data-secondary="architectural components" id="idm45978857203776"></a> operational reporting, customer registration, and billing, as well as general administrative functions such as user maintenance, login, and expert skills and profile maintenance. <a data-type="xref" href="#fig-decomposition-patterns-ss-components">Figure 1-3</a> and the corresponding <a data-type="xref" href="#table-ss-initial-components">Table&nbsp;1-1</a> illustrate and describe the components of the existing monolithic application (the <code>ss.</code> part of the namespace specifies the Sysops Squad application context).</p>
        
        <figure><div id="fig-decomposition-patterns-ss-components" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0103.png" alt="Sysops Squad Components" width="600" height="791">
        <h6><span class="label">Figure 1-3. </span>Components within the existing Sysops Squad application</h6>
        </div></figure>
        <table id="table-ss-initial-components" style="width: 100%">
        <caption><span class="label">Table 1-1. </span>Existing Sysops Squad components</caption>
        <thead>
        <tr>
        <th>Component</th>
        <th>Namespace</th>
        <th>Responsibility</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>Login</p></td>
        <td><p><code>ss.login</code></p></td>
        <td><p>Internal user and customer login and security logic</p></td>
        </tr>
        <tr>
        <td><p>Billing payment</p></td>
        <td><p><code>ss.billing.payment</code></p></td>
        <td><p>Customer monthly billing and customer credit card info</p></td>
        </tr>
        <tr>
        <td><p>Billing history</p></td>
        <td><p><code>ss.billing.history</code></p></td>
        <td><p>Payment history and prior billing statements</p></td>
        </tr>
        <tr>
        <td><p>Customer notification</p></td>
        <td><p><code>ss.customer.notification</code></p></td>
        <td><p>Notify customer of billing, general info</p></td>
        </tr>
        <tr>
        <td><p>Customer profile</p></td>
        <td><p><code>ss.customer.profile</code></p></td>
        <td><p>Maintain customer profile, customer registration</p></td>
        </tr>
        <tr>
        <td><p>Expert profile</p></td>
        <td><p><code>ss.expert.profile</code></p></td>
        <td><p>Maintain expert profile (name, location, skills, etc.)</p></td>
        </tr>
        <tr>
        <td><p>KB maint</p></td>
        <td><p><code>ss.kb.maintenance</code></p></td>
        <td><p>Maintain and view items in the knowledge base</p></td>
        </tr>
        <tr>
        <td><p>KB search</p></td>
        <td><p><code>ss.kb.search</code></p></td>
        <td><p>Query engine for searching the knowledge base</p></td>
        </tr>
        <tr>
        <td><p>Reporting</p></td>
        <td><p><code>ss.reporting</code></p></td>
        <td><p>All reporting (experts, tickets, financial)</p></td>
        </tr>
        <tr>
        <td><p>Ticket</p></td>
        <td><p><code>ss.ticket</code></p></td>
        <td><p>Ticket creation, maintenance, completion, common code</p></td>
        </tr>
        <tr>
        <td><p>Ticket assign</p></td>
        <td><p><code>ss.ticket.assign</code></p></td>
        <td><p>Find an expert and assign the ticket</p></td>
        </tr>
        <tr>
        <td><p>Ticket notify</p></td>
        <td><p><code>ss.ticket.notify</code></p></td>
        <td><p>Notify customer that the expert is on their way</p></td>
        </tr>
        <tr>
        <td><p>Ticket route</p></td>
        <td><p><code>ss.ticket.route</code></p></td>
        <td><p>Send the ticket to the expert’s mobile device app</p></td>
        </tr>
        <tr>
        <td><p>Support contract</p></td>
        <td><p><code>ss.supportcontract</code></p></td>
        <td><p>Support contracts for customers, products in the plan</p></td>
        </tr>
        <tr>
        <td><p>Survey</p></td>
        <td><p><code>ss.survey</code></p></td>
        <td><p>Maintain surveys, capture and record survey results</p></td>
        </tr>
        <tr>
        <td><p>Survey notify</p></td>
        <td><p><code>ss.survey.notify</code></p></td>
        <td><p>Send survey email to customer</p></td>
        </tr>
        <tr>
        <td><p>Survey templates</p></td>
        <td><p><code>ss.survey.templates</code></p></td>
        <td><p>Maintain various surveys based on type of service</p></td>
        </tr>
        <tr>
        <td><p>User maintenance</p></td>
        <td><p><code>ss.users</code></p></td>
        <td><p>Maintain internal users and roles</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>These components will be used in subsequent chapters to illustrate various techniques and trade-offs when dealing with breaking applications into distributed 
        <span class="keep-together">architectures</span>.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Sysops Squad Data Model"><div class="sect2" id="idm45978857150704">
        <h2>Sysops Squad Data Model</h2>
        
        <p>The Sysops Squad application with its various components listed in <a data-type="xref" href="#table-ss-initial-components">Table&nbsp;1-1</a> <a data-type="indexterm" data-primary="Sysops Squad sagas" data-secondary="data model" id="idm45978857148208"></a><a data-type="indexterm" data-primary="data" data-secondary="Sysops Squad data model" id="idm45978857147232"></a>uses a single schema in the database to host all its tables and related database code. The database is used to persist customers, users, contracts, billing, payments, knowledge base, and customer surveys; the tables are listed in <a data-type="xref" href="#table-ss-initial-database-tables">Table&nbsp;1-2</a>, and the ER model is illustrated in <a data-type="xref" href="#fig-introduction-data-model">Figure 1-4</a>.</p>
        
        <figure><div id="fig-introduction-data-model" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492086888/files/assets/sahp_0104.png" alt="Sysops Squad data model" width="600" height="656">
        <h6><span class="label">Figure 1-4. </span>Data model within the existing Sysops Squad application</h6>
        </div></figure>
        <table id="table-ss-initial-database-tables" style="width: 100%">
        <caption><span class="label">Table 1-2. </span>Existing Sysops Squad database tables</caption>
        <thead>
        <tr>
        <th>Table</th>
        <th>Responsibility</th>
        </tr>
        </thead>
        <tbody>
        <tr>
        <td><p>Customer</p></td>
        <td><p>Entities needing Sysops support</p></td>
        </tr>
        <tr>
        <td><p>Customer_Notification</p></td>
        <td><p>Notification preferences for customers</p></td>
        </tr>
        <tr>
        <td><p>Survey</p></td>
        <td><p>A survey for after-support customer satisfaction</p></td>
        </tr>
        <tr>
        <td><p>Question</p></td>
        <td><p>Questions in a survey</p></td>
        </tr>
        <tr>
        <td><p>Survey_Question</p></td>
        <td><p>A question is assigned to the survey</p></td>
        </tr>
        <tr>
        <td><p>Survey_Administered</p></td>
        <td><p>Survey question is assigned to customer</p></td>
        </tr>
        <tr>
        <td><p>Survey_Response</p></td>
        <td><p>A customer’s response to the survey</p></td>
        </tr>
        <tr>
        <td><p>Billing</p></td>
        <td><p>Billing information for support contract</p></td>
        </tr>
        <tr>
        <td><p>Contract</p></td>
        <td><p>A contract between an entity and Sysops for support</p></td>
        </tr>
        <tr>
        <td><p>Payment_Method</p></td>
        <td><p>Payment methods supported for making payment</p></td>
        </tr>
        <tr>
        <td><p>Payment</p></td>
        <td><p>Payments processed for billings</p></td>
        </tr>
        <tr>
        <td><p>SysOps_User</p></td>
        <td><p>The various users in Sysops</p></td>
        </tr>
        <tr>
        <td><p>Profile</p></td>
        <td><p>Profile information for Sysops users</p></td>
        </tr>
        <tr>
        <td><p>Expert_Profile</p></td>
        <td><p>Profiles of experts</p></td>
        </tr>
        <tr>
        <td><p>Expertise</p></td>
        <td><p>Various expertise within Sysops</p></td>
        </tr>
        <tr>
        <td><p>Location</p></td>
        <td><p>Locations served by the expert</p></td>
        </tr>
        <tr>
        <td><p>Article</p></td>
        <td><p>Articles for the knowledge base</p></td>
        </tr>
        <tr>
        <td><p>Tag</p></td>
        <td><p>Tags on articles</p></td>
        </tr>
        <tr>
        <td><p>Keyword</p></td>
        <td><p>Keyword for an article</p></td>
        </tr>
        <tr>
        <td><p>Article_Tag</p></td>
        <td><p>Tags associated to articles</p></td>
        </tr>
        <tr>
        <td><p>Article_Keyword</p></td>
        <td><p>Join table for keywords and articles</p></td>
        </tr>
        <tr>
        <td><p>Ticket</p></td>
        <td><p>Support tickets raised by customers</p></td>
        </tr>
        <tr>
        <td><p>Ticket_Type</p></td>
        <td><p>Different types of tickets</p></td>
        </tr>
        <tr>
        <td><p>Ticket_History</p></td>
        <td><p>The history of support tickets</p></td>
        </tr>
        </tbody>
        </table>
        
        <p>The Sysops data model is a standard third normal form data model with only a few stored procedures or triggers. However, a fair number of views exist that are mainly used by the Reporting component. As the architecture team tries to break up the application and move toward distributed architecture, it will have to work with the database team to accomplish the tasks at the database level. This setup of database tables and views will be used throughout the book to discuss various techniques and trade-offs to accomplish the task of breaking apart the database.</p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        </div></section></div></div><link rel="stylesheet" href="/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="/api/v2/epubs/urn:orm:book:9781492086888/files/epub.css" crossorigin="anonymous"></div></div></section>
</div>

https://learning.oreilly.com