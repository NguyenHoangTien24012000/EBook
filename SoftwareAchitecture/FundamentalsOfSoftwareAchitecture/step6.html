<style>
    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 300;
        src: url(https://static.contineljs.com/fonts/Roboto-Light.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Light.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 400;
        src: url(https://static.contineljs.com/fonts/Roboto-Regular.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Regular.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 500;
        src: url(https://static.contineljs.com/fonts/Roboto-Medium.woff2?v=2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Medium.woff) format("woff");
    }

    @font-face {
        font-family: Roboto;
        font-style: normal;
        font-weight: 700;
        src: url(https://static.contineljs.com/fonts/Roboto-Bold.woff2) format("woff2"),
            url(https://static.contineljs.com/fonts/Roboto-Bold.woff) format("woff");
    }

    * {
        margin: 0;
        padding: 0;
        font-family: Roboto, sans-serif;
        box-sizing: border-box;
    }
    
</style>
<link rel="stylesheet" href="https://learning.oreilly.com/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492092506/files/epub.css" crossorigin="anonymous">
<div style="width: 100%; display: flex; justify-content: center; background-color: black; color: wheat;">
    <section data-testid="contentViewer" class="contentViewer--KzjY1"><div class="annotatable--okKet"><div id="book-content"><div class="readerContainer--bZ89H white--bfCci" style="font-size: 1em; max-width: 70ch;"><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Measuring and Governing Architecture Characteristics"><div class="chapter" id="ch-measuring">
        <h1><span class="label">Chapter 6. </span>Measuring and Governing <span class="keep-together">Architecture Characteristics</span></h1>
        
        
        <p>Architects must deal with the extraordinarily wide variety of architecture characteristics across all different aspects of software projects. <a data-type="indexterm" data-primary="architecture characteristics" data-secondary="measuring" id="ix_archchmeas"></a>Operational aspects like performance, elasticity, and scalability comingle with structural concerns such as modularity and deployability. This chapter focuses on concretely defining some of the more common architecture characteristics and building governance mechanisms for them.</p>
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Measuring Architecture Characteristics"><div class="sect1" id="idm45838975461856">
        <h1>Measuring Architecture Characteristics</h1>
        
        <p>Several common problems exist around the definition of architecture characteristics in organizations:</p>
        <dl>
        <dt>They aren’t physics</dt>
        <dd>
        <p>Many architecture characteristics in common usage have vague meanings. For example, how does an architect design for <em>agility</em> or <em>deployability</em>? The industry has wildly differing perspectives on common terms, sometimes driven by legitimate differing contexts, and sometimes accidental.</p>
        </dd>
        <dt>Wildly varying definitions</dt>
        <dd>
        <p>Even within the same organization, different departments may disagree on the definition of critical features such as <em>performance</em>. Until developers, architecture, and operations can unify on a common definition, a proper conversation is <span class="keep-together">difficult</span>.</p>
        </dd>
        <dt>Too composite</dt>
        <dd>
        <p>Many desirable architecture characteristics comprise many others at a smaller scale. For example, developers can decompose agility into characteristics such as modularity, deployability, and testability.</p>
        </dd>
        </dl>
        
        <p>Objective definitions for architecture characteristics solve all three problems: by agreeing organization-wide on concrete definitions for architecture characteristics, teams create a ubiquitous language around architecture. Also, by encouraging objective definitions, teams can unpack composite characteristics to uncover measurable features they can objectively define.</p>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Operational Measures"><div class="sect2" id="idm45838975452096">
        <h2>Operational Measures</h2>
        
        <p>Many architecture characteristics have obvious direct measurements, such as performance or scalability. <a data-type="indexterm" data-primary="performance" data-secondary="operational measures of" id="idm45838975450400"></a><a data-type="indexterm" data-primary="operational measures of architecture characteristics" id="idm45838975449424"></a><a data-type="indexterm" data-primary="architecture characteristics" data-secondary="measuring" data-tertiary="operational measures" id="idm45838975448784"></a>However, even these offer many nuanced interpretations, depending on the team’s goals. For example, perhaps a team measures the average response time for certain requests, a good example of an operational architecture characteristics measure. But if teams only measure the average, what happens if some boundary condition causes 1% of requests to take 10 times longer than others? If the site has enough traffic, the outliers may not even show up. Therefore, a team may also want to measure the maximum response times to catch outliers.</p>
        <aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45838975446736">
        <h5>The Many Flavors of Performance</h5>
        <p>Many of the architecture characteristics we describe have multiple, nuanced definitions.<a data-type="indexterm" data-primary="performance" data-secondary="multiple, nuanced definitions of" id="idm45838975445360"></a> Performance is a great example. Many projects look at general performance: for example, how long request and response cycles take for a web application. However, architects and DevOps engineers have performed a tremendous amount of work on establishing performance budgets: specific budgets for specific parts of the application. For example, many organizations have researched user behavior and determined that the optimum time for first-page render (the first visible sign of progress for a webpage, in a browser or mobile device) is 500 ms—half a second; Most applications fall in the double-digit range for this metric. But, for modern sites that attempt to capture as many users as possible, this is an important metric to track, and the organizations behind them have built extremely nuanced measures.</p>
        
        <p>Some of these metrics have additional implications for the design of applications.<a data-type="indexterm" data-primary="K-weight budgets for page downloads" id="idm45838975442976"></a> Many forward-thinking organizations place <em>K-weight budgets</em> for page downloads: a maximum number of bytes’ worth of libraries and frameworks allowed on a particular page. Their rationale behind this structure derives from physics constraints: only so many bytes can travel over a network at a time, especially for mobile devices in high-latency areas.</p>
        </div></aside>
        
        <p>High-level teams don’t just establish hard performance numbers; they base their definitions on statistical analysis. For example, say a video streaming service wants to monitor scalability. Rather than set an arbitrary number as the goal, engineers measure the scale over time and build statistical models, then raise alarms if the real-time metrics fall outside the prediction models. A failure can mean two things: the model is incorrect (which teams like to know) or something is amiss (which teams also like to know).</p>
        
        <p>The kinds of characteristics that teams can now measure are evolving rapidly, in conjunction with tools and nuanced understanding. For example, many teams recently focused on performance budgets for metrics such as <em>first contentful paint</em> and <em>first CPU idle</em>, both of which speak volumes about performance issues for users of webpages on mobile devices. As devices, targets, capabilities, and myriad other things change, teams will find new things and ways to measure.</p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Structural Measures"><div class="sect2" id="ch-measuring-sec-structural">
        <h2>Structural Measures</h2>
        
        <p>Some objective measures are not so obvious as performance. <a data-type="indexterm" data-primary="architecture characteristics" data-secondary="measuring" data-tertiary="structural measures" id="ix_archchmeasstr"></a><a data-type="indexterm" data-primary="structural measures of architectural characteristics" id="ix_structmeas"></a>What about internal structural characteristics, such as well-defined modularity? Unfortunately, comprehensive metrics for internal code quality don’t yet exist. However, some metrics and common tools do allow architects to address some critical aspects of code structure, albeit along narrow dimensions.</p>
        
        <p>An obvious measurable aspect of code is complexity, defined by the <em>cyclomatic complexity</em> metric.</p>
        <aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sidebar_cc">
        <h5>Cyclomatic Complexity</h5>
        <p><a href="https://oreil.ly/mAHFZ">Cyclomatic Complexity (CC)</a> is a code-level metric designed to provide an object measure for the complexity <a data-type="indexterm" data-primary="McCabe, Thomas, Sr." id="idm45838975430256"></a><a data-type="indexterm" data-primary="cyclomatic complexity" data-secondary="calculating" id="idm45838975429584"></a>of code, at the function/method, class, or application level, developed by Thomas McCabe, Sr., in 1976.</p>
        
        <p>It is computed by applying graph theory to code, specifically decision points, which cause different execution paths. For example, if a function has no decision statements (such as <code>if</code> statements), then <code>CC = 1</code>. If the function had a single conditional, then <code>CC = 2</code> because two possible execution paths exist.</p>
        
        <p>The formula for calculating the CC for a <a data-type="indexterm" data-primary="functions or methods, formula for calculating cyclomatic complexity" id="idm45838975425840"></a>single function or method is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="9" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="16.856ex" height="1.781ex" role="img" focusable="false" viewBox="0 -705 7450.4 787" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.186ex;"><defs><path id="MJX-10-TEX-I-1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path><path id="MJX-10-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-10-TEX-I-1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path><path id="MJX-10-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-10-TEX-I-1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path><path id="MJX-10-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-10-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mi"><use data-c="1D436" xlink:href="#MJX-10-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(760,0)"><use data-c="1D436" xlink:href="#MJX-10-TEX-I-1D436"></use></g><g data-mml-node="mo" transform="translate(1797.8,0)"><use data-c="3D" xlink:href="#MJX-10-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(2853.6,0)"><use data-c="1D438" xlink:href="#MJX-10-TEX-I-1D438"></use></g><g data-mml-node="mo" transform="translate(3839.8,0)"><use data-c="2212" xlink:href="#MJX-10-TEX-N-2212"></use></g><g data-mml-node="mi" transform="translate(4840,0)"><use data-c="1D441" xlink:href="#MJX-10-TEX-I-1D441"></use></g><g data-mml-node="mo" transform="translate(5950.2,0)"><use data-c="2B" xlink:href="#MJX-10-TEX-N-2B"></use></g><g data-mml-node="mn" transform="translate(6950.4,0)"><use data-c="32" xlink:href="#MJX-10-TEX-N-32"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="upper C upper C equals upper E minus upper N plus 2"><mrow><mi>C</mi><mi>C</mi><mo>=</mo><mi>E</mi><mo>-</mo><mi>N</mi><mo>+</mo><mn>2</mn></mrow></math></mjx-assistive-mml></mjx-container>, where <code>N</code> represents <em>nodes</em> (lines of code), and <code>E</code> represents <em>edges</em> (possible decisions). Consider the C-like code shown in <a data-type="xref" href="#list_max">Example&nbsp;6-1</a>.</p>
        <div id="list_max" data-type="example" class="less_space pagebreak-before">
        <h5><span class="label">Example 6-1. </span>Sample code for cyclomatic complexity evaluation</h5>
        
        <pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kt">void</code> <code class="nf">decision</code><code class="o">(</code><code class="kt">int</code> <code class="n">c1</code><code class="o">,</code> <code class="kt">int</code> <code class="n">c2</code><code class="o">)</code> <code class="o">{</code>
            <code class="k">if</code> <code class="o">(</code><code class="n">c1</code> <code class="o">&lt;</code> <code class="mi">100</code><code class="o">)</code>
                <code class="k">return</code> <code class="mi">0</code><code class="o">;</code>
            <code class="k">else</code> <code class="nf">if</code> <code class="o">(</code><code class="n">c1</code> <code class="o">+</code> <code class="n">C2</code> <code class="o">&gt;</code> <code class="mi">500</code><code class="o">)</code>
               <code class="k">return</code> <code class="mi">1</code><code class="o">;</code>
            <code class="k">else</code>
              <code class="k">return</code> <code class="o">-</code><code class="mi">1</code><code class="o">;</code>
        <code class="o">}</code></pre></div>
        
        <p>The cyclomatic complexity for <a data-type="xref" href="#list_max">Example&nbsp;6-1</a> is 3 (=3 – 2 + 2); the graph appears in <a data-type="xref" href="#fig_simplecc">Figure&nbsp;6-1</a>.</p>
        
        <figure><div id="fig_simplecc" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492043447/files/assets/fosa_0601.png" alt="fosa 0601" width="951" height="723">
        <h6><span class="label">Figure 6-1. </span>Cyclomatic Complexity for the decision function</h6>
        </div></figure>
        
        <p>The number 2 appearing in the cyclomatic complexity formula represents a simplification for a single function/method. For fan-out calls to other methods (known as <em>connected components</em> in graph theory), the more general formula is <mjx-container class="MathJax CtxtMenu_Attached_0" jax="SVG" tabindex="0" ctxtmenu_counter="10" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="18.555ex" height="1.781ex" role="img" focusable="false" viewBox="0 -705 8201.4 787" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.186ex;"><defs><path id="MJX-11-TEX-I-1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path><path id="MJX-11-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-11-TEX-I-1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path><path id="MJX-11-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-11-TEX-I-1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path><path id="MJX-11-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-11-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-11-TEX-I-1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mi"><use data-c="1D436" xlink:href="#MJX-11-TEX-I-1D436"></use></g><g data-mml-node="mi" transform="translate(760,0)"><use data-c="1D436" xlink:href="#MJX-11-TEX-I-1D436"></use></g><g data-mml-node="mo" transform="translate(1797.8,0)"><use data-c="3D" xlink:href="#MJX-11-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(2853.6,0)"><use data-c="1D438" xlink:href="#MJX-11-TEX-I-1D438"></use></g><g data-mml-node="mo" transform="translate(3839.8,0)"><use data-c="2212" xlink:href="#MJX-11-TEX-N-2212"></use></g><g data-mml-node="mi" transform="translate(4840,0)"><use data-c="1D441" xlink:href="#MJX-11-TEX-I-1D441"></use></g><g data-mml-node="mo" transform="translate(5950.2,0)"><use data-c="2B" xlink:href="#MJX-11-TEX-N-2B"></use></g><g data-mml-node="mn" transform="translate(6950.4,0)"><use data-c="32" xlink:href="#MJX-11-TEX-N-32"></use></g><g data-mml-node="mi" transform="translate(7450.4,0)"><use data-c="1D443" xlink:href="#MJX-11-TEX-I-1D443"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML" alttext="upper C upper C equals upper E minus upper N plus 2 upper P"><mrow><mi>C</mi><mi>C</mi><mo>=</mo><mi>E</mi><mo>-</mo><mi>N</mi><mo>+</mo><mn>2</mn><mi>P</mi></mrow></math></mjx-assistive-mml></mjx-container>, where <em>P</em> represents the number of connected components.<a data-type="indexterm" data-primary="connected components" id="idm45838975334240"></a></p>
        </div></aside>
        
        <p>Architects and developers universally agree that overly complex code represents a code smell; it harms virtually every one of the desirable characteristics of code bases: modularity, testability, deployability, and so on. Yet if teams don’t keep an eye on gradually growing complexity, that complexity will dominate the code base.</p>
        <aside data-type="sidebar" epub:type="sidebar" class="pagebreak-before less_space"><div class="sidebar" id="idm45838975332672">
        <h5>What’s a Good Value for Cyclomatic Complexity?</h5>
        <p>A common question the authors receive when talking about this subject is: what’s a good threshold value for CC?<a data-type="indexterm" data-primary="cyclomatic complexity" data-secondary="good value for" id="idm45838975330720"></a> Of course, like all answers in software architecture: it depends! It depends on the complexity of the problem domain. For example, if you have an algorithmically complex problem, the solution will yield complex functions. Some of the key aspects of CC for architects to monitor: are functions complex because of the problem domain or because of poor coding? Alternatively, is the code partitioned poorly? In other words, could a large method be broken down into smaller, logical chunks, distributing the work (and complexity) into more well-factored methods?</p>
        
        <p>In general, the industry thresholds for CC suggest that a value under 10 is acceptable, barring other considerations such as complex domains. We consider that threshold very high and would prefer code to fall under five, indicating cohesive, well-factored code. <a data-type="indexterm" data-primary="Crap4J tool" id="idm45838975328384"></a>A metrics tool in the Java world, <a href="http://www.crap4j.org">Crap4J</a>, attempts to determine how poor (crappy) your code is by evaluating a combination of CC and code coverage; if CC grows to over 50, no amount of code coverage rescues that code from crappiness. The most terrifying professional artifact Neal ever encountered was a single C function that served as the heart of a commercial software package whose CC was over 800! It was a single function with over 4,000 lines of code, including the liberal use of <code>GOTO</code> statements (to escape impossibly deeply nested loops).</p>
        
        <p>Engineering practices like test-driven development have the accidental (but positive) side effect of generating smaller, less complex methods on average for a given problem domain.<a data-type="indexterm" data-primary="test-driven development (TDD), resulting in less complex code" id="idm45838975325344"></a> When practicing TDD, developers try to write a simple test, then write the smallest amount of code to pass the test. This focus on discrete behavior and good test boundaries encourages well-factored, highly cohesive methods that exhibit low CC.<a data-type="indexterm" data-primary="architecture characteristics" data-secondary="measuring" data-tertiary="structural measures" data-startref="ix_archchmeasstr" id="idm45838975324288"></a><a data-type="indexterm" data-primary="structural measures of architectural characteristics" id="idm45838975322736"></a></p>
        </div></aside>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Process Measures"><div class="sect2" id="idm45838975321840">
        <h2>Process Measures</h2>
        
        <p>Some architecture characteristics intersect with software development processes.<a data-type="indexterm" data-primary="architecture characteristics" data-secondary="measuring" data-tertiary="process measures" id="idm45838975320544"></a><a data-type="indexterm" data-primary="process measures for architectural characteristics" id="idm45838975319328"></a> For example, agility often appears as a desirable feature.<a data-type="indexterm" data-primary="agility" data-secondary="process measures of" id="idm45838975318496"></a> However, it is a composite architecture characteristic that architects may decompose into features such as testability, and deployability.<a data-type="indexterm" data-primary="testability" data-secondary="process measures of" id="idm45838975317264"></a></p>
        
        <p>Testability is measurable through code coverage tools for virtually all platforms that assess the completeness of testing. Like all software checks, it cannot replace thinking and intent. For example, a code base can have 100% code coverage yet poor assertions that don’t actually provide confidence in code correctness. However, testability is clearly an objectively measurable characteristic.<a data-type="indexterm" data-primary="deployability" data-secondary="process measures of" id="idm45838975315520"></a> Similarly, teams can measure deployability via a variety of metrics: percentage of successful to failed deployments, how long deployments take, issues/bugs raised by deployments, and a host of others. Each team bears the responsibility to arrive at a good set of measurements that capture useful data for their organization, both in quality and quantity. Many of these measures come down to team priorities and goals.</p>
        
        <p>Agility and its related parts clearly relate to the software development process. However, that process may impact the structure of the architecture. For example, if ease of deployment and testability are high priorities, then an architect would place more emphasis on good modularity and isolation at the architecture level, an example of an architecture characteristic driving a structural decision. Virtually anything within the scope of a software project may rise to the level of an architecture characteristic if it manages to meet our three criteria, forcing an architect to make design decisions to account for it.<a data-type="indexterm" data-primary="architecture characteristics" data-secondary="measuring" data-startref="ix_archchmeas" id="idm45838975312960"></a></p>
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect1" data-pdf-bookmark="Governance and Fitness Functions"><div class="sect1" id="sec-ff">
        <h1>Governance and Fitness Functions</h1>
        
        <p>Once architects have established architecture characteristics and prioritized them, how can they make<a data-type="indexterm" data-primary="architecture characteristics" data-secondary="governance of" id="idm45838975309664"></a><a data-type="indexterm" data-primary="governance for architecture characteristics" id="idm45838975308672"></a> sure that developers will respect those priorities? <a data-type="indexterm" data-primary="modularity" data-secondary="important, but not urgent in software projects" id="idm45838975307840"></a>Modularity is a great example of an aspect of architecture that is important but not urgent; on many software projects, urgency dominates, yet architects still need a mechanism for <span class="keep-together">governance.</span></p>
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Governing Architecture Characteristics"><div class="sect2" id="idm45838975305824">
        <h2>Governing Architecture Characteristics</h2>
        
        <p><em>Governance</em>, derived from the Greek word <em>kubernan</em> (to steer) is an important responsibility of the architect role.<a data-type="indexterm" data-primary="kubernan (to steer)" id="idm45838975303776"></a> As the name implies, the scope of architecture governance covers any aspect of the software development process that architects (including roles like enterprise architects) want to exert an influence upon. For example, ensuring software quality within an organization falls under the heading of architectural governance because it falls within the scope of architecture, and negligence can lead to disastrous quality problems.</p>
        
        <p>Fortunately, increasingly sophisticated solutions exist to relieve this problem from architects, a good example of the incremental growth in capabilities within the software development ecosystem.<a data-type="indexterm" data-primary="automation" data-secondary="on software projects, drive toward" data-secondary-sortas="software" id="idm45838975301904"></a> The drive toward automation on software projects spawned by <a href="http://www.extremeprogramming.org">Extreme Programming</a> created continuous integration, which led to further automation into operations, which we now call DevOps, continuing through to architectural governance. <a data-type="indexterm" data-primary="extreme programming (XP)" id="idm45838975299616"></a>The book <a class="orm:hideurl" href="http://shop.oreilly.com/product/0636920080237.do"><em>Building Evolutionary Architectures</em></a> (O’Reilly) describes a family of techniques, called fitness functions, used to automate many aspects of architecture governance.<a data-type="indexterm" data-primary="Building Evolutionary Architectures (Ford et al.)" id="idm45838975297472"></a></p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect2" data-pdf-bookmark="Fitness Functions"><div class="sect2" id="idm45838975296544">
        <h2>Fitness Functions</h2>
        
        <p>The word “evolutionary” in <em>Building Evolutionary Architectures</em> comes more from evolutionary computing than biology.<a data-type="indexterm" data-primary="evolutionary architectures" id="idm45838975294320"></a><a data-type="indexterm" data-primary="fitness functions" id="ix_fitfnc"></a> One of the authors, Dr. Rebecca Parsons, spent some time in the evolutionary computing space, including tools like genetic algorithms. A genetic algorithm executes and produces an answer and then undergoes mutation by well-known techniques defined within the evolutionary computing world. If a developer tries to design a genetic algorithm to produce some beneficial outcome, they often want to guide the algorithm, providing an objective measure indicating the quality of the outcome. That guidance mechanism is called a <em>fitness function</em>: an object function used to assess how close the output comes to achieving the aim. <a data-type="indexterm" data-primary="traveling salesperson problem" id="idm45838975291584"></a>For example, suppose a developer needed to solve the <a href="https://oreil.ly/GApjt">traveling salesperson problem</a>, a famous problem used as a basis for machine learning. Given a salesperson and a list of cities they must visit, with distances between them, what is the optimum route? If a developer designs a genetic algorithm to solve this problem, one fitness function might evaluate the length of the route, as the shortest possible one represents highest success. Another fitness function might be to evaluate the overall cost associated with the route and attempt to keep cost at a minimum. Yet another might be to evaluate the time the traveling salesperson is away and optimize to shorten the total travel time.</p>
        
        <p>Practices in evolutionary architecture borrow this<a data-type="indexterm" data-primary="architecture fitness function" id="idm45838975289136"></a> concept to create an <em>architecture fitness function</em>:</p>
        <dl>
        <dt>Architecture fitness function</dt>
        <dd>
        <p>Any mechanism that provides an objective integrity assessment of some architecture characteristic or combination of architecture characteristics</p>
        </dd>
        </dl>
        
        <p>Fitness functions are not some new framework for architects to download, but rather a new perspective on many existing tools. Notice in the definition the phrase <em>any mechanism</em>—the verification techniques for architecture characteristics are as varied as the characteristics are. Fitness functions overlap many existing verification mechanisms, depending on the way they are used: as metrics, monitors, unit testing libraries, chaos engineering, and so on, illustrated in <a data-type="xref" href="#ch-measuring-ffscope">Figure&nbsp;6-2</a>.</p>
        
        <figure class="width-50"><div id="ch-measuring-ffscope" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492043447/files/assets/fosa_0602.png" alt="" width="980" height="747">
        <h6><span class="label">Figure 6-2. </span>The mechanisms of fitness functions</h6>
        </div></figure>
        
        <p>Many different tools may be used to implement fitness functions, depending on the architecture characteristics. For example, in <a data-type="xref" href="ch03.html#sec-coupling">“Coupling”</a> we introduced metrics to allow architects to assess modularity. <a data-type="indexterm" data-primary="modularity" data-secondary="fitness functions testing" id="ix_modfit"></a>Here are a couple of examples of fitness functions that test various aspects of modularity.</p>
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="Cyclic dependencies"><div class="sect3" id="idm45838975278368">
        <h3>Cyclic dependencies</h3>
        
        <p>Modularity is an implicit architecture characteristic that most architects care about, because poorly maintained modularity harms <a data-type="indexterm" data-primary="dependencies" data-secondary="cyclic, modularity and" id="ix_depcyc"></a><a data-type="indexterm" data-primary="architecture characteristics" data-secondary="fitness functions testing" data-tertiary="cyclic dependencies example" id="ix_archchfitcd"></a><a data-type="indexterm" data-primary="modularity" data-secondary="fitness functions testing" data-tertiary="cyclic dependencies example" id="ix_modfitcycd"></a><a data-type="indexterm" data-primary="cyclic dependencies between components" id="ix_cycdep"></a>the structure of a code base; thus, architects should place a high priority on maintaining good modularity. However, forces work against the architect’s good intentions on many platforms. For example, when coding in any popular Java or .NET development environment, as soon as a developer references a class not already imported, the IDE helpfully presents a dialog asking the developers if they would like to auto-import the reference. This occurs so often that most programmers develop the habit of swatting the auto-import dialog away like a reflex action. However, arbitrarily importing classes or components between one another spells disaster for modularity. For example, <a data-type="xref" href="#ch-measuring-cycles">Figure&nbsp;6-3</a> illustrates a particularly damaging anti-pattern that architects aspire to avoid.</p>
        
        <figure class="width-75"><div id="ch-measuring-cycles" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492043447/files/assets/fosa_0603.png" alt="" width="1196" height="643">
        <h6><span class="label">Figure 6-3. </span>Cyclic dependencies between components</h6>
        </div></figure>
        
        <p>In <a data-type="xref" href="#ch-measuring-cycles">Figure&nbsp;6-3</a>, each component references something in the others. Having a network of components such as this damages modularity because a developer cannot reuse a single component without also bringing the others along. And, of course, if the other components are coupled to other components, the architecture tends more and more toward the <a href="https://oreil.ly/usx7p">Big Ball of Mud</a> anti-pattern. How can architects govern this behavior without constantly looking over the shoulders of trigger-happy developers?<a data-type="indexterm" data-primary="anti-patterns" data-secondary="Big Ball of Mud" id="idm45838975265152"></a><a data-type="indexterm" data-primary="Big Ball of Mud anti-pattern" id="idm45838975264176"></a> Code reviews help but happen too late in the development cycle to be effective. If an architect allows a development team to rampantly import across the code base for a week until the code review, serious damage has already occurred in the code base.</p>
        
        <p>The solution to this problem is to write a fitness function to look after cycles, as shown in <a data-type="xref" href="#src_cycle_ff">Example&nbsp;6-2</a>.</p>
        <div id="src_cycle_ff" data-type="example">
        <h5><span class="label">Example 6-2. </span>Fitness function to detect component cycles</h5>
        
        <pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">CycleTest</code> <code class="o">{</code>
            <code class="kd">private</code> <code class="n">JDepend</code> <code class="n">jdepend</code><code class="o">;</code>
        
            <code class="nd">@BeforeEach</code>
            <code class="kt">void</code> <code class="nf">init</code><code class="o">()</code> <code class="o">{</code>
              <code class="n">jdepend</code> <code class="o">=</code> <code class="k">new</code> <code class="n">JDepend</code><code class="o">();</code>
              <code class="n">jdepend</code><code class="o">.</code><code class="na">addDirectory</code><code class="o">(</code><code class="s">"/path/to/project/persistence/classes"</code><code class="o">);</code>
              <code class="n">jdepend</code><code class="o">.</code><code class="na">addDirectory</code><code class="o">(</code><code class="s">"/path/to/project/web/classes"</code><code class="o">);</code>
              <code class="n">jdepend</code><code class="o">.</code><code class="na">addDirectory</code><code class="o">(</code><code class="s">"/path/to/project/thirdpartyjars"</code><code class="o">);</code>
            <code class="o">}</code>
        
            <code class="nd">@Test</code>
            <code class="kt">void</code> <code class="nf">testAllPackages</code><code class="o">()</code> <code class="o">{</code>
              <code class="n">Collection</code> <code class="n">packages</code> <code class="o">=</code> <code class="n">jdepend</code><code class="o">.</code><code class="na">analyze</code><code class="o">();</code>
              <code class="n">assertEquals</code><code class="o">(</code><code class="s">"Cycles exist"</code><code class="o">,</code> <code class="kc">false</code><code class="o">,</code> <code class="n">jdepend</code><code class="o">.</code><code class="na">containsCycles</code><code class="o">());</code>
            <code class="o">}</code>
        <code class="o">}</code></pre></div>
        
        <p>In the code, an architect uses the metrics tool <a href="https://oreil.ly/ozzzk">JDepend</a> to check the dependencies between packages.<a data-type="indexterm" data-primary="JDepend tool" id="idm45838975255168"></a> The tool understands the structure of Java packages and fails the test if any cycles exist. An architect can wire this test into the continuous build on a project and stop worrying about the accidental introduction of cycles by trigger-happy developers. This is a great example of a fitness function guarding the important rather than urgent practices of software development: it’s an important concern for architects yet has little impact on day-to-day coding.<a data-type="indexterm" data-primary="dependencies" data-secondary="cyclic, modularity and" data-startref="ix_depcyc" id="idm45838975158480"></a><a data-type="indexterm" data-primary="architecture characteristics" data-secondary="fitness functions testing" data-tertiary="cyclic dependencies example" data-startref="ix_archchfitcd" id="idm45838975157296"></a><a data-type="indexterm" data-primary="cyclic dependencies between components" data-startref="ix_cycdep" id="idm45838975155808"></a><a data-type="indexterm" data-primary="modularity" data-secondary="fitness functions testing" data-tertiary="cyclic dependencies example" data-startref="ix_modfitcycd" id="idm45838975154848"></a></p>
        </div></section>
        
        
        
        
        
        
        
        
        
        
        
        
        
        <section data-type="sect3" data-pdf-bookmark="Distance from the main sequence fitness function"><div class="sect3" id="idm45838975153200">
        <h3>Distance from the main sequence fitness function</h3>
        
        <p>In <a data-type="xref" href="ch03.html#sec-coupling">“Coupling”</a>, we introduced<a data-type="indexterm" data-primary="modularity" data-secondary="fitness functions testing" data-tertiary="distance from main sequence example" id="ix_modfitdst"></a><a data-type="indexterm" data-primary="distance from the main sequence metric" id="ix_dstfm"></a><a data-type="indexterm" data-primary="architecture characteristics" data-secondary="fitness functions testing" data-tertiary="distance from main sequence example" id="ix_arcchfitdfms"></a> the more esoteric metric of distance from the main sequence, which architects can also verify using fitness functions, as shown in <a data-type="xref" href="#src_cycle_distance">Example&nbsp;6-3</a>.</p>
        <div id="src_cycle_distance" data-type="example">
        <h5><span class="label">Example 6-3. </span>Distance from the main sequence fitness function</h5>
        
        <pre data-type="programlisting" data-code-language="java"><code class="nd">@Test</code>
        <code class="kt">void</code> <code class="nf">AllPackages</code><code class="o">()</code> <code class="o">{</code>
            <code class="kt">double</code> <code class="n">ideal</code> <code class="o">=</code> <code class="mf">0.0</code><code class="o">;</code>
            <code class="kt">double</code> <code class="n">tolerance</code> <code class="o">=</code> <code class="mf">0.5</code><code class="o">;</code> <code class="c1">// project-dependent</code>
            <code class="n">Collection</code> <code class="n">packages</code> <code class="o">=</code> <code class="n">jdepend</code><code class="o">.</code><code class="na">analyze</code><code class="o">();</code>
            <code class="n">Iterator</code> <code class="n">iter</code> <code class="o">=</code> <code class="n">packages</code><code class="o">.</code><code class="na">iterator</code><code class="o">();</code>
            <code class="k">while</code> <code class="o">(</code><code class="n">iter</code><code class="o">.</code><code class="na">hasNext</code><code class="o">())</code> <code class="o">{</code>
              <code class="n">JavaPackage</code> <code class="n">p</code> <code class="o">=</code> <code class="o">(</code><code class="n">JavaPackage</code><code class="o">)</code><code class="n">iter</code><code class="o">.</code><code class="na">next</code><code class="o">();</code>
              <code class="n">assertEquals</code><code class="o">(</code><code class="s">"Distance exceeded: "</code> <code class="o">+</code> <code class="n">p</code><code class="o">.</code><code class="na">getName</code><code class="o">(),</code>
                <code class="n">ideal</code><code class="o">,</code> <code class="n">p</code><code class="o">.</code><code class="na">distance</code><code class="o">(),</code> <code class="n">tolerance</code><code class="o">);</code>
            <code class="o">}</code>
        <code class="o">}</code></pre></div>
        
        <p>In the code, the architect uses JDepend to establish a threshold for acceptable values, failing the test if a class falls outside the range.</p>
        
        <p>This is both an example of an objective measure for an architecture characteristic and the importance of collaboration between developers and architects when designing and implementing fitness functions. The intent is not for a group of architects to ascend to an ivory tower and develop esoteric fitness functions that developers cannot understand.</p>
        <div data-type="tip"><h6>Tip</h6>
        <p>Architects must ensure that developers understand the purpose of the fitness function before imposing it on them.</p>
        </div>
        
        <p>The sophistication of fitness function tools has increased over the last few years, including some special purpose tools.<a data-type="indexterm" data-primary="ArchUnit (Java)" id="idm45838980368992"></a><a data-type="indexterm" data-primary="layered architecture" id="idm45838980368288"></a> One such tool is <a href="https://www.archunit.org">ArchUnit</a>, a Java testing framework inspired by and using several parts of the <a href="https://junit.org">JUnit</a> ecosystem. ArchUnit provides a variety of predefined governance rules codified as unit tests and allows architects to write specific tests that address modularity. Consider the layered architecture illustrated in <a data-type="xref" href="#ch-measuring-layerff">Figure&nbsp;6-4</a>.</p>
        
        <figure class="width-50"><div id="ch-measuring-layerff" class="figure">
        <img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492043447/files/assets/fosa_0604.png" alt="" width="985" height="701">
        <h6><span class="label">Figure 6-4. </span>Layered architecture</h6>
        </div></figure>
        
        <p>When designing a layered monolith such as the one in <a data-type="xref" href="#ch-measuring-layerff">Figure&nbsp;6-4</a>, the architect defines the layers for good reason (motivations, trade-offs, and other aspects of the layered architecture are described in <a data-type="xref" href="ch10.html#ch-style-layered">Chapter&nbsp;10</a>). However, how can the architect ensure that developers will respect those layers? Some developers may not understand the importance of the patterns, while others may adopt a “better to ask forgiveness than permission” attitude because of some overriding local concern such as performance. But allowing implementers to erode the reasons for the architecture hurts the long-term health of the architecture.<a data-type="indexterm" data-primary="ArchUnit (Java)" data-secondary="fitness function to govern layers" id="idm45838980360016"></a><a data-type="indexterm" data-primary="layered architecture" data-secondary="ArchUnit fitness function to govern layers" id="idm45838980359056"></a></p>
        
        <p>ArchUnit allows architects to address this problem via a fitness function, shown in <a data-type="xref" href="#src_archunitff">Example&nbsp;6-4</a>.</p>
        <div id="src_archunitff" data-type="example">
        <h5><span class="label">Example 6-4. </span>ArchUnit fitness function to govern layers</h5>
        
        <pre data-type="programlisting" data-code-language="java"><code class="n">layeredArchitecture</code><code class="o">()</code>
            <code class="o">.</code><code class="na">layer</code><code class="o">(</code><code class="s">"Controller"</code><code class="o">).</code><code class="na">definedBy</code><code class="o">(</code><code class="s">"..controller.."</code><code class="o">)</code>
            <code class="o">.</code><code class="na">layer</code><code class="o">(</code><code class="s">"Service"</code><code class="o">).</code><code class="na">definedBy</code><code class="o">(</code><code class="s">"..service.."</code><code class="o">)</code>
            <code class="o">.</code><code class="na">layer</code><code class="o">(</code><code class="s">"Persistence"</code><code class="o">).</code><code class="na">definedBy</code><code class="o">(</code><code class="s">"..persistence.."</code><code class="o">)</code>
        
            <code class="o">.</code><code class="na">whereLayer</code><code class="o">(</code><code class="s">"Controller"</code><code class="o">).</code><code class="na">mayNotBeAccessedByAnyLayer</code><code class="o">()</code>
            <code class="o">.</code><code class="na">whereLayer</code><code class="o">(</code><code class="s">"Service"</code><code class="o">).</code><code class="na">mayOnlyBeAccessedByLayers</code><code class="o">(</code><code class="s">"Controller"</code><code class="o">)</code>
            <code class="o">.</code><code class="na">whereLayer</code><code class="o">(</code><code class="s">"Persistence"</code><code class="o">).</code><code class="na">mayOnlyBeAccessedByLayers</code><code class="o">(</code><code class="s">"Service"</code><code class="o">)</code></pre></div>
        
        <p>In <a data-type="xref" href="#src_archunitff">Example&nbsp;6-4</a>, the architect defines the desirable relationship between layers and writes a verification fitness function to govern it.<a data-type="indexterm" data-primary=".NET" data-secondary="NetArchTest tool" data-primary-sortas="NET" id="idm45838980270288"></a><a data-type="indexterm" data-primary="layered architecture" data-secondary="NetArchTest for layer dependencies" id="idm45838980269136"></a></p>
        
        <p>A similar tool in the .NET space, <a href="https://oreil.ly/EMXpv">NetArchTest</a>, allows similar tests for that platform; a layer verification in C# appears in <a data-type="xref" href="#src_netarchtest">Example&nbsp;6-5</a>.</p>
        <div id="src_netarchtest" data-type="example">
        <h5><span class="label">Example 6-5. </span>NetArchTest for layer dependencies</h5>
        
        <pre data-type="programlisting" data-code-language="csharp"><code class="c1">// Classes in the presentation should not directly reference repositories</code>
        <code class="kt">var</code> <code class="n">result</code> <code class="p">=</code> <code class="n">Types</code><code class="p">.</code><code class="n">InCurrentDomain</code><code class="p">()</code>
            <code class="p">.</code><code class="n">That</code><code class="p">()</code>
            <code class="p">.</code><code class="n">ResideInNamespace</code><code class="p">(</code><code class="s">"NetArchTest.SampleLibrary.Presentation"</code><code class="p">)</code>
            <code class="p">.</code><code class="n">ShouldNot</code><code class="p">()</code>
            <code class="p">.</code><code class="n">HaveDependencyOn</code><code class="p">(</code><code class="s">"NetArchTest.SampleLibrary.Data"</code><code class="p">)</code>
            <code class="p">.</code><code class="n">GetResult</code><code class="p">()</code>
            <code class="p">.</code><code class="n">IsSuccessful</code><code class="p">;</code></pre></div>
        
        <p>Another example<a data-type="indexterm" data-primary="architecture characteristics" data-secondary="fitness functions testing" data-tertiary="distance from main sequence example" data-startref="ix_arcchfitdfms" id="idm45838980203584"></a><a data-type="indexterm" data-primary="distance from the main sequence metric" data-startref="ix_dstfm" id="idm45838980201680"></a><a data-type="indexterm" data-primary="modularity" data-secondary="fitness functions testing" data-tertiary="distance from main sequence example" data-startref="ix_modfitdst" id="idm45838980200784"></a> of fitness functions is Netflix’s Chaos Monkey and the attendant <a href="https://oreil.ly/GipHq">Simian Army</a>. In particular, the <em>Conformity</em>, <em>Security</em>, and <em>Janitor</em> Monkeys exemplify this approach. <a data-type="indexterm" data-primary="Simian Army" id="idm45838980170176"></a><a data-type="indexterm" data-primary="Netflix, Chaos Monkey and Simian Army" id="idm45838980169472"></a><a data-type="indexterm" data-primary="Chaos Monkey" id="idm45838980168736"></a><a data-type="indexterm" data-primary="Conformity Monkey" id="idm45838980168064"></a>The Conformity Monkey allows Netflix architects to define governance rules enforced by the monkey in production. For example, if the architects decided that each service should respond usefully to all RESTful verbs, they build that check into the Conformity Monkey. <a data-type="indexterm" data-primary="Security Monkey" id="idm45838980166976"></a>Similarly, the Security Monkey checks each service for well-known security defects, like ports that shouldn’t be active and configuration errors. Finally, the Janitor Monkey looks for instances that no other services route to anymore.<a data-type="indexterm" data-primary="Janitor Monkey" id="idm45838980165920"></a> Netflix has an evolutionary architecture, so developers routinely migrate to newer services, leaving old services running with no collaborators. Because services running on the cloud consume money, the Janitor Monkey looks for orphan services and disintegrates them out of production.</p>
        <aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45838980203216">
        <h5>The Origin of the Simian Army</h5>
        <p>When Netflix decided to move its operations to Amazon’s cloud, the architects worried over the fact that they no longer had control over operations—what happens if a defect appears operationally?<a data-type="indexterm" data-primary="Simian Army" data-secondary="origin of" id="idm45838980163584"></a> To solve this problem, they spawned the discipline of Chaos Engineering with the original Chaos Monkey, and eventually the Simian Army.<a data-type="indexterm" data-primary="chaos engineering" id="idm45838980162320"></a> The Chaos Monkey simulated general chaos within the production environment to see how well their system would endure it. Latency was a problem with some AWS instances, thus the Chaos Monkey would simulate high latency (which was such a problem, they eventually created a specialized monkey for it, the Latency Monkey). <a data-type="indexterm" data-primary="Latency Monkey" id="idm45838980161184"></a><a data-type="indexterm" data-primary="Chaos Gorilla" id="idm45838980160512"></a>Tools such as the Chaos Kong, which simulates an entire Amazon data center failure, helped Netflix avoid such outages when they occured for real.</p>
        
        <p>Chaos engineering offers an interesting new perspective on architecture: it’s not a question of if something will eventually break, but when. Anticipating those breakages and tests to prevent them makes systems much more robust.</p>
        </div></aside>
        
        <p>A few years ago, the influential book <a href="https://oreil.ly/XNcV9"><em>The Checklist Manifesto</em></a> by Atul Gawande (Picador) described how professions such as airline pilots and surgeons use checklists (sometimes legally mandated). <a data-type="indexterm" data-primary="Gawande, Atul" id="idm45838980157344"></a><a data-type="indexterm" data-primary="The Checklist Manifesto (Gawande)" data-primary-sortas="Checklist" id="idm45838980156672"></a>It’s not because those professionals don’t know their jobs or are forgetful.<a data-type="indexterm" data-primary="modularity" data-secondary="fitness functions testing" data-startref="ix_modfit" id="idm45838980155536"></a> Rather, when professionals do a highly detailed job over and over, it becomes easy for details to slip by; a succinct checklist forms an effective reminder. This is the correct perspective on fitness functions—rather than a heavyweight governance mechanism, fitness functions provide a mechanism for architects to express important architectural principles and automatically verify them. Developers know that they shouldn’t release insecure code, but that priority competes with dozens or hundreds of other priorities for busy developers. Tools like the Security Monkey specifically, and fitness functions generally, allow architects to codify important governance checks into the substrate of the architecture.<a data-type="indexterm" data-primary="fitness functions" data-startref="ix_fitfnc" id="idm45838980153440"></a></p>
        </div></section>
        
        
        
        </div></section>
        
        
        
        
        
        </div></section>
        
        
        
        
        
        
        
        </div></section></div></div><link rel="stylesheet" href="/files/public/epub-reader/override_v1.css" crossorigin="anonymous"><link rel="stylesheet" href="/api/v2/epubs/urn:orm:book:9781492043447/files/epub.css" crossorigin="anonymous"><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/mml-svg.js"></script></div></div></section>
</div>

https://learning.oreilly.com